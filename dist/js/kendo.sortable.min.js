/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.draganddrop.min"],e)}(function(){return function(e,t){function n(t,n){try{return e.contains(t,n)||t==n}catch(i){return!1}}function i(e){return e.clone()}function r(e){return e.clone().removeAttr("id").css("visibility","hidden")}var a=window.kendo,o=a.ui.Widget,s="start",l="beforeMove",u="move",c="end",d="change",p="cancel",f="sort",h="remove",m="receive",g=">*",v=-1,_=o.extend({init:function(e,t){var n=this;o.fn.init.call(n,e,t),n.options.placeholder||(n.options.placeholder=r),n.options.hint||(n.options.hint=i),n._draggable=n._createDraggable(),n.floating=!1},events:[s,l,u,c,d,p],options:{name:"Sortable",hint:null,placeholder:null,filter:g,holdToDrag:!1,disabled:null,container:null,connectWith:null,handler:null,cursorOffset:null,axis:null,ignore:null,cursor:"auto"},destroy:function(){this._draggable.destroy(),o.fn.destroy.call(this)},_createDraggable:function(){var t=this,n=t.element,i=t.options;return new a.ui.Draggable(n,{filter:i.filter,hint:a.isFunction(i.hint)?i.hint:e(i.hint),holdToDrag:i.holdToDrag,container:i.container?e(i.container):null,cursorOffset:i.cursorOffset,axis:i.axis,ignore:i.ignore,dragstart:e.proxy(t._dragstart,t),dragcancel:e.proxy(t._dragcancel,t),drag:e.proxy(t._drag,t),dragend:e.proxy(t._dragend,t)})},_dragstart:function(t){var n=this.draggedElement=t.currentTarget,i=t.target||a.elementUnderCursor(t),r=this.options.disabled,o=this.options.handler,l=this.options.placeholder,u=this.placeholder=a.isFunction(l)?e(l.call(this,n)):e(l);r&&n.is(r)?t.preventDefault():o&&!e(i).is(o)?t.preventDefault():this.trigger(s,{item:n,draggableEvent:t})?t.preventDefault():(this.floating=this._isFloating(n),n.css("display","none"),n.before(u),this._setCursor())},_dragcancel:function(){this._cancel(),this.trigger(p,{item:this.draggedElement}),this._resetCursor()},_drag:function(n){var i,r,a,o,s,l=this.draggedElement,u=this._findTarget(n),c={left:n.x.location,top:n.y.location},d={x:n.x.delta,y:n.y.delta},p=this.options.axis,f={item:l,list:this,draggableEvent:n};if("x"===p||"y"===p)return this._movementByAxis(p,c,d[p],f),t;if(u){if(i=this._getElementCenter(u.element),r={left:Math.round(c.left-i.left),top:Math.round(c.top-i.top)},e.extend(f,{target:u.element}),u.appendToBottom)return this._movePlaceholder(u,null,f),t;if(u.appendAfterHidden&&this._movePlaceholder(u,"next",f),this.floating?0>d.x&&0>r.left?a="prev":d.x>0&&r.left>0&&(a="next"):0>d.y&&0>r.top?a="prev":d.y>0&&r.top>0&&(a="next"),a){for(s="prev"===a?jQuery.fn.prev:jQuery.fn.next,o=s.call(u.element);o.length&&!o.is(":visible");)o=s.call(o);o[0]!=this.placeholder[0]&&this._movePlaceholder(u,a,f)}}},_dragend:function(n){var i,r,a,o,s=this.placeholder,l=this.draggedElement,u=this.indexOf(l),p=this.indexOf(s),g=this.options.connectWith;return this._resetCursor(),a={action:f,item:l,oldIndex:u,newIndex:p,draggableEvent:n},p>=0?r=this.trigger(c,a):(i=s.parents(g).getKendoSortable(),a.action=h,o=e.extend({},a,{action:m,oldIndex:v,newIndex:i.indexOf(s)}),r=!(!this.trigger(c,a)&&!i.trigger(c,o))),r||p===u?(this._cancel(),t):(s.replaceWith(l),l.show(),this._draggable.dropped=!0,a={action:this.indexOf(l)!=v?f:h,item:l,oldIndex:u,newIndex:this.indexOf(l),draggableEvent:n},this.trigger(d,a),i&&(o=e.extend({},a,{action:m,oldIndex:v,newIndex:i.indexOf(l)}),i.trigger(d,o)),t)},_findTarget:function(n){var i,r,a=this._findElementUnderCursor(n),o=this.options.connectWith;return e.contains(this.element[0],a)?(i=this.items(),r=i.filter(a)[0]||i.has(a)[0],r?{element:e(r),sortable:this}:null):this.element[0]==a&&this._isEmpty()?{element:this.element,sortable:this,appendToBottom:!0}:this.element[0]==a&&this._isLastHidden()?(r=this.items().eq(0),{element:r,sortable:this,appendAfterHidden:!0}):o?this._searchConnectedTargets(a,n):t},_findElementUnderCursor:function(e){{var t=a.elementUnderCursor(e),i=e.sender;this.items()}return n(i.hint[0],t)&&(i.hint.hide(),t=a.elementUnderCursor(e),t||(t=a.elementUnderCursor(e)),i.hint.show()),t},_searchConnectedTargets:function(t,n){var i,r,a,o,s=e(this.options.connectWith);for(o=0;s.length>o;o++)if(i=s.eq(o).getKendoSortable(),e.contains(s[o],t)){if(i)return r=i.items(),a=r.filter(t)[0]||r.has(t)[0],a?(i.placeholder=this.placeholder,{element:e(a),sortable:i}):null}else if(s[o]==t){if(i&&i._isEmpty())return{element:s.eq(o),sortable:i,appendToBottom:!0};if(this._isCursorAfterLast(i,n))return a=i.items().last(),{element:a,sortable:i}}},_isCursorAfterLast:function(e,t){var n,i,r=e.items().last(),o={left:t.x.location,top:t.y.location};return n=a.getOffset(r),n.top+=r.outerHeight(),n.left+=r.outerWidth(),i=this.floating?n.left-o.left:n.top-o.top,0>i?!0:!1},_movementByAxis:function(t,n,i,r){var a,o="x"===t?n.left:n.top,s=0>i?this.placeholder.prev():this.placeholder.next();s.length&&!s.is(":visible")&&(s=0>i?s.prev():s.next()),e.extend(r,{target:s}),a=this._getElementCenter(s),a&&(a="x"===t?a.left:a.top),s.length&&0>i&&0>o-a?this._movePlaceholder({element:s,sortable:this},"prev",r):s.length&&i>0&&o-a>0&&this._movePlaceholder({element:s,sortable:this},"next",r)},_movePlaceholder:function(e,t,n){var i=this.placeholder;e.sortable.trigger(l,n)||(t?"prev"===t?e.element.before(i):"next"===t&&e.element.after(i):e.element.append(i),e.sortable.trigger(u,n))},_setCursor:function(){var t,n=this.options.cursor;n&&"auto"!==n&&(t=e(document.body),this._originalCursorType=t.css("cursor"),t.css({cursor:n}),this._cursorStylesheet||(this._cursorStylesheet=e("<style>* { cursor: "+n+" !important; }</style>")),this._cursorStylesheet.appendTo(t))},_resetCursor:function(){this._originalCursorType&&(e(document.body).css("cursor",this._originalCursorType),this._originalCursorType=null,this._cursorStylesheet.remove())},_getElementCenter:function(e){var t=e.length?a.getOffset(e):null;return t&&(t.top+=e.outerHeight()/2,t.left+=e.outerWidth()/2),t},_isFloating:function(e){return/left|right/.test(e.css("float"))||/inline|table-cell/.test(e.css("display"))},_cancel:function(){this.draggedElement.show(),this.placeholder.remove()},_items:function(){var e,t=this.options.filter;return e=t?this.element.find(t):this.element.children()},indexOf:function(e){var t=this._items(),n=this.placeholder,i=this.draggedElement;return n&&e[0]==n[0]?t.not(i).index(e):t.not(n).index(e)},items:function(){var e=this.placeholder,t=this._items();return e&&(t=t.not(e)),t},_isEmpty:function(){return!this.items().length},_isLastHidden:function(){return 1===this.items().length&&this.items().is(":hidden")}});a.ui.plugin(_)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});