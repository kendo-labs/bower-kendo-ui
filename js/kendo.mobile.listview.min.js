/**
 * Copyright 2023 Progress Software Corporation and/or one of its subsidiaries or affiliates. All rights reserved.
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("kendo.data.js"),require("kendo.userevents.js"),require("kendo.mobile.button.js")):"function"==typeof define&&define.amd?define(["kendo.data.min","kendo.userevents.min","kendo.mobile.button.min"],t):((e="undefined"!=typeof globalThis?globalThis:e||self).kendomobile=e.kendomobile||{},e.kendomobile.listview=e.kendomobile.listview||{},e.kendomobile.listview.js=t())}(this,(function(){return function(e,t){var i=this,s=window.kendo,n=window.Node,o=s.mobile,r=o.ui,l=s._outerHeight,a=s.data.DataSource,h=r.DataBoundWidget,d=".km-listview-link, .km-listview-label",c="["+s.attr("icon")+"]",u=s.attrValue,f="km-group-title",p='<div class="'+f+'"><div class="km-text"></div></div>',m=s.template((function(e){return'<li><div class="'+f+'"><div class="km-text">'+i.headerTemplate(e)+"</div></div><ul>"+s.render(i.template,e.items)+"</ul></li>"})),g=s.template((function(e){return'<form class="km-filter-form"><div class="km-filter-wrap"><input type="search" placeholder="'+e.placeholder+'"/><a href="#" class="km-filter-reset" title="Clear"><span class="km-icon km-clear"></span><span class="km-text">Clear</span></a></div></form>'})),v=".kendoMobileListView",_="styled",b="dataBound",w="dataBinding",k="itemChange",S="click",y="change",T="progress",x="function",C=/^\s+$/,I=/button/;function H(){return this.nodeType===n.TEXT_NODE&&this.nodeValue.match(C)}function B(e,t){t&&!e[0].querySelector(".km-icon")&&e.prepend('<span class="km-icon km-'+t+'"/>')}function D(t,i){e(t).css("transform","translate3d(0px, "+i+"px, 0px)")}var z=s.Class.extend({init:function(e){var t=e.scroller();if(t){this.options=e.options,this.element=e.element,this.scroller=e.scroller(),this._shouldFixHeaders();var i=this,s=function(){i._cacheHeaders()};e.bind("resize",s),e.bind(_,s),e.bind(b,s),this._scrollHandler=function(e){i._fixHeader(e)},t.bind("scroll",this._scrollHandler)}},destroy:function(){var e=this;e.scroller&&e.scroller.unbind("scroll",e._scrollHandler)},_fixHeader:function(t){if(this.fixedHeaders){var i,s,n,o=0,r=this.scroller,l=this.headers,a=t.scrollTop;do{if(!(i=l[o++])){n=e("<div />");break}s=i.offset,n=i.header}while(s+1>a);this.currentHeader!=o&&(r.fixedContainer.html(n.clone()),this.currentHeader=o)}},_shouldFixHeaders:function(){this.fixedHeaders="group"===this.options.type&&this.options.fixedHeaders},_cacheHeaders:function(){if(this._shouldFixHeaders(),this.fixedHeaders){var t=[],i=this.scroller.scrollTop;this.element.find("."+f).each((function(s,n){n=e(n),t.unshift({offset:n.position().top+i,header:n})})),this.headers=t,this._fixHeader({scrollTop:i})}}}),V=function(){return{page:1}},F=s.Class.extend({init:function(e){var t=this,i=e.options,s=e.scroller(),n=i.pullParameters||V;this.listView=e,this.scroller=s,e.bind("_dataSource",(function(e){t.setDataSource(e.dataSource)})),s.setOptions({pullToRefresh:!0,pull:function(){t._pulled||(t._pulled=!0,t.dataSource.read(n.call(e,t._first)))},messages:{pullTemplate:i.messages.pullTemplate,releaseTemplate:i.messages.releaseTemplate,refreshTemplate:i.messages.refreshTemplate}})},setDataSource:function(e){var t=this;this._first=e.view()[0],this.dataSource=e,e.bind("change",(function(){t._change()})),e.bind("error",(function(){t._change()}))},_change:function(){var e=this.scroller,t=this.dataSource;if(this._pulled&&e.pullHandled(),this._pulled||!this._first){var i=t.view();i[0]&&(this._first=i[0])}this._pulled=!1}}),E=s.Observable.extend({init:function(e){var t=this;s.Observable.fn.init.call(t),t.buffer=e.buffer,t.height=e.height,t.item=e.item,t.items=[],t.footer=e.footer,t.buffer.bind("reset",(function(){t.refresh()}))},refresh:function(){for(var e=this.buffer,t=this.items,i=!1;t.length;)t.pop().destroy();this.offset=e.offset;for(var s,n,o=this.item,r=0;r<e.viewSize;r++){if(r===e.total()){i=!0;break}(n=o(this.content(this.offset+t.length))).below(s),s=n,t.push(n)}this.itemCount=t.length,this.trigger("reset"),this._resize(),i&&this.trigger("endReached")},totalHeight:function(){if(!this.items[0])return 0;var e=this,t=e.items,i=t[0].top,s=t[t.length-1].bottom,n=(s-i)/e.itemCount,o=e.buffer.length-e.offset-e.itemCount;return(this.footer?this.footer.height:0)+s+o*n},batchUpdate:function(e){var t,i=this.height(),s=this.items,n=this.offset;if(s[0]){if(this.lastDirection)for(;s[s.length-1].bottom>e+2*i&&0!==this.offset;)this.offset--,(t=s.pop()).update(this.content(this.offset)),t.above(s[0]),s.unshift(t);else for(;s[0].top<e-i;){var o=this.offset+this.itemCount;if(o===this.buffer.total()){this.trigger("endReached");break}if(o===this.buffer.length)break;(t=s.shift()).update(this.content(this.offset+this.itemCount)),t.below(s[s.length-1]),s.push(t),this.offset++}n!==this.offset&&this._resize()}},update:function(e){var t,i,s,n=this,o=this.items,r=this.height(),l=this.itemCount,a=r/2,h=(this.lastTop||0)>e,d=e-a,c=e+r+a;if(o[0])if(this.lastTop=e,this.lastDirection=h,h)o[0].top>d&&o[o.length-1].bottom>c+a&&this.offset>0&&(this.offset--,t=o.pop(),i=o[0],t.update(this.content(this.offset)),o.unshift(t),t.above(i),n._resize());else if(o[o.length-1].bottom<c&&o[0].top<d-a){var u=this.offset+l;u===this.buffer.total()?this.trigger("endReached"):u!==this.buffer.length&&(t=o.shift(),s=o[o.length-1],o.push(t),t.update(this.content(this.offset+this.itemCount)),n.offset++,t.below(s),n._resize())}},content:function(e){return this.buffer.at(e)},destroy:function(){this.unbind()},_resize:function(){var e=this.items,t=0,i=0,s=e[0],n=e[e.length-1];s&&(t=s.top,i=n.bottom),this.trigger("resize",{top:t,bottom:i}),this.footer&&this.footer.below(n)}});s.mobile.ui.VirtualList=E;var L=s.Class.extend({init:function(t,i){var s=t.append([i],!0)[0],n=s.offsetHeight;e.extend(this,{top:0,element:s,listView:t,height:n,bottom:n})},update:function(e){this.element=this.listView.setDataItem(this.element,e)},above:function(e){e&&(this.height=this.element.offsetHeight,this.top=e.top-this.height,this.bottom=e.top,D(this.element,this.top))},below:function(e){e&&(this.height=this.element.offsetHeight,this.top=e.bottom,this.bottom=this.top+this.height,D(this.element,this.top))},destroy:function(){s.destroy(this.element),e(this.element).remove()}}),R='<div><span class="km-icon"></span><span class="km-loading-left"></span><span class="km-loading-right"></span></div>',M=s.Class.extend({init:function(t){this.element=e('<li class="km-load-more km-scroller-refresh" style="display: none"></li>').appendTo(t.element),this._loadIcon=e(R).appendTo(this.element)},enable:function(){this.element.show(),this.height=l(this.element,!0)},disable:function(){this.element.hide(),this.height=0},below:function(e){e&&(this.top=e.bottom,this.bottom=this.height+this.top,D(this.element,this.top))}}),j=M.extend({init:function(t,i){this._loadIcon=e(R).hide(),this._loadButton=e('<a class="km-load">'+t.options.messages.loadMoreText+"</a>").hide(),this.element=e('<li class="km-load-more" style="display: none"></li>').append(this._loadIcon).append(this._loadButton).appendTo(t.element);var s=this;this._loadButton.kendoMobileButton().data("kendoMobileButton").bind("click",(function(){s._hideShowButton(),i.next()})),i.bind("resize",(function(){s._showLoadButton()})),this.height=l(this.element,!0),this.disable()},_hideShowButton:function(){this._loadButton.hide(),this.element.addClass("km-scroller-refresh"),this._loadIcon.css("display","block")},_showLoadButton:function(){this._loadButton.show(),this.element.removeClass("km-scroller-refresh"),this._loadIcon.hide()}}),O=s.Class.extend({init:function(e){var t=this;this.chromeHeight=l(e.wrapper.children().not(e.element)),this.listView=e,this.scroller=e.scroller(),this.options=e.options,e.bind("_dataSource",(function(e){t.setDataSource(e.dataSource,e.empty)})),e.bind("resize",(function(){t.list.items.length&&(t.scroller.reset(),t.buffer.range(0),t.list.refresh())})),this.scroller.makeVirtual(),this._scroll=function(e){t.list.update(e.scrollTop)},this.scroller.bind("scroll",this._scroll),this._scrollEnd=function(e){t.list.batchUpdate(e.scrollTop)},this.scroller.bind("scrollEnd",this._scrollEnd)},destroy:function(){this.list.unbind(),this.buffer.unbind(),this.scroller.unbind("scroll",this._scroll),this.scroller.unbind("scrollEnd",this._scrollEnd)},setDataSource:function(t,i){var n,o,r,l=this,a=this.options,h=this.listView,d=h.scroller(),c=a.loadMore;if(this.dataSource=t,!(n=t.pageSize()||a.virtualViewSize)&&!i)throw new Error("the DataSource does not have page size configured. Page Size setting is mandatory for the mobile listview virtual scrolling to work as expected.");this.buffer&&this.buffer.destroy(),o=new s.data.Buffer(t,Math.floor(n/2),c),r=c?new j(h,o):new M(h),this.list&&this.list.destroy();var u=new E({buffer:o,footer:r,item:function(e){return new L(h,e)},height:function(){return d.height()}});u.bind("resize",(function(){l.updateScrollerSize(),h.updateSize()})),u.bind("reset",(function(){l.footer.enable()})),u.bind("endReached",(function(){r.disable(),l.updateScrollerSize()})),o.bind("expand",(function(){u.lastDirection=!1,u.batchUpdate(d.scrollTop)})),e.extend(this,{buffer:o,scroller:d,list:u,footer:r})},updateScrollerSize:function(){this.scroller.virtualSize(0,this.list.totalHeight()+this.chromeHeight)},refresh:function(){this.list.refresh()},reset:function(){this.buffer.range(0),this.list.refresh()}}),q=s.Class.extend({init:function(e){var t=this;this.listView=e,this.options=e.options;var i=this;this._refreshHandler=function(e){i.refresh(e)},this._progressHandler=function(){e.showLoading()},e.bind("_dataSource",(function(e){t.setDataSource(e.dataSource)}))},destroy:function(){this._unbindDataSource()},reset:function(){},refresh:function(e){var t,i,s,n,o=e&&e.action,l=e&&e.items,a=this.listView,h=this.dataSource,d=this.options.appendOnRefresh,c=h.view(),u=h.group(),f=u&&u[0];if("itemchange"!==o)if("add"===o&&!f||d&&!a._filter?i=[]:"remove"===o&&!f&&(i=a.findByDataItem(l)),a.trigger(w,{action:o||"rebind",items:l,removedItems:i,index:e&&e.index}))this._shouldShowLoading()&&a.hideLoading();else{if("add"!==o||f)"remove"!==o||f?f?a.replaceGrouped(c):d&&!a._filter?(s=a.prepend(c),n=c):a.replace(c):(s=[],a.remove(l));else{var p=c.indexOf(l[0]);p>-1&&(s=a.insertAt(l,p),n=l)}this._shouldShowLoading()&&a.hideLoading(),a.trigger(b,{ns:r,addedItems:s,addedDataItems:n})}else a._hasBindingTarget()||(t=a.findByDataItem(l)[0])&&a.setDataItem(t,l[0])},setDataSource:function(e){this.dataSource&&this._unbindDataSource(),this.dataSource=e,e.bind(y,this._refreshHandler),this._shouldShowLoading()&&this.dataSource.bind(T,this._progressHandler)},_unbindDataSource:function(){this.dataSource.unbind(y,this._refreshHandler).unbind(T,this._progressHandler)},_shouldShowLoading:function(){var e=this.options;return!e.pullToRefresh&&!e.loadMore&&!e.endlessScroll}}),P=s.Class.extend({init:function(e){var t=this,i=e.options.filterable,s="change paste",n=this;this.listView=e,this.options=i,e.element.before(g({placeholder:i.placeholder||"Search..."})),!1!==i.autoFilter&&(s+=" keyup"),this.element=e.wrapper.find(".km-search-form"),this.searchInput=e.wrapper.find("input[type=search]").closest("form").on("submit"+v,(function(e){e.preventDefault()})).end().on("focus"+v,(function(){t._oldFilter=t.searchInput.val()})).on(s.split(" ").join(v+" ")+v,this._filterChange.bind(this)),this.clearButton=e.wrapper.find(".km-filter-reset").on(S,this._clearFilter.bind(this)).hide(),this._dataSourceChange=this._refreshInput.bind(this),e.bind("_dataSource",(function(e){e.dataSource.bind("change",n._dataSourceChange)}))},_refreshInput:function(){var e=this.listView.dataSource.filter(),t=this.listView._filter.searchInput;e&&e.filters[0].field===this.listView.options.filterable.field?t.val(e.filters[0].value):t.val("")},_search:function(e){this._filter=!0,this.clearButton[e?"show":"hide"](),this.listView.dataSource.filter(e)},_filterChange:function(e){var t=this;"paste"==e.type&&!1!==this.options.autoFilter?setTimeout((function(){t._applyFilter()}),1):this._applyFilter()},_applyFilter:function(){var e=this.options,t=this.searchInput.val(),i=t.length?{field:e.field,operator:e.operator||"startswith",ignoreCase:e.ignoreCase,value:t}:null;t!==this._oldFilter&&(this._oldFilter=t,this._search(i))},_clearFilter:function(e){this.searchInput.val(""),this._search(null),e.preventDefault()}}),A=h.extend({init:function(e,t){var i=this;h.fn.init.call(this,e,t),e=this.element,(t=this.options).scrollTreshold&&(t.scrollThreshold=t.scrollTreshold),e.on("down",d,"_highlight").on("move up cancel",d,"_dim"),this._userEvents=new s.UserEvents(e,{fastTap:!0,filter:".km-list > li, > li:not(.km-group-container)",allowSelection:!0,tap:function(e){i._click(e)}}),e.css("-ms-touch-action","auto"),e.wrap('<div class="km-listview-wrapper"></div>'),this.wrapper=this.element.parent(),this._headerFixer=new z(this),this._itemsCache={},this._templates(),this.virtual=t.endlessScroll||t.loadMore,this._style(),this.options.$angular&&(this.virtual||this.options.pullToRefresh)?setTimeout(this._start.bind(this)):this._start()},_start:function(){var e=this.options;this.options.filterable&&(this._filter=new P(this)),this.virtual?this._itemBinder=new O(this):this._itemBinder=new q(this),this.options.pullToRefresh&&(this._pullToRefreshHandler=new F(this)),this.setDataSource(e.dataSource),this._enhanceItems(this.items()),s.notify(this,r)},events:[S,w,b,k],options:{name:"ListView",style:"",type:"flat",autoBind:!0,fixedHeaders:!1,template:function(e){return s.htmlEncode(e)},headerTemplate:function(e){var t=e.value;return'<span class="km-text">'+s.htmlEncode(t)+"</span>"},appendOnRefresh:!1,loadMore:!1,endlessScroll:!1,scrollThreshold:30,pullToRefresh:!1,messages:{loadMoreText:"Press to load more",pullTemplate:"Pull to refresh",releaseTemplate:"Release to refresh",refreshTemplate:"Refreshing"},pullOffset:140,filterable:!1,virtualViewSize:null},refresh:function(){this._itemBinder.refresh()},reset:function(){this._itemBinder.reset()},setDataSource:function(e){var t=!e;this.dataSource=a.create(e),this.trigger("_dataSource",{dataSource:this.dataSource,empty:t}),this.options.autoBind&&!t&&(this.items().remove(),this.dataSource.fetch())},destroy:function(){h.fn.destroy.call(this),s.destroy(this.element),this._userEvents.destroy(),this._itemBinder&&this._itemBinder.destroy(),this._headerFixer&&this._headerFixer.destroy(),this.element.unwrap(),delete this.element,delete this.wrapper,delete this._userEvents},items:function(){return"group"===this.options.type?this.element.find(".km-list").children():this.element.children().not(".km-load-more")},scroller:function(){return this._scrollerInstance||(this._scrollerInstance=this.element.closest(".km-scroll-wrapper").data("kendoMobileScroller")),this._scrollerInstance},showLoading:function(){var e=this.view();e&&e.loader&&e.loader.show()},hideLoading:function(){var e=this.view();e&&e.loader&&e.loader.hide()},insertAt:function(e,t,i){var s=this;return s._renderItems(e,(function(n){if(0===t?s.element.prepend(n):-1===t?s.element.append(n):s.items().eq(t-1).after(n),i)for(var o=0;o<n.length;o++)s.trigger(k,{item:n.eq(o),data:e[o],ns:r})}))},append:function(e,t){return this.insertAt(e,-1,t)},prepend:function(e,t){return this.insertAt(e,0,t)},replace:function(e){return this.options.type="flat",this._angularItems("cleanup"),s.destroy(this.element.children()),this.element.empty(),this._userEvents.cancel(),this._style(),this.insertAt(e,0)},replaceGrouped:function(t){this.options.type="group",this._angularItems("cleanup"),this.element.empty();var i=e(s.render(this.groupTemplate,t));this._enhanceItems(i.children("ul").children("li")),this.element.append(i),o.init(i),this._style(),this._angularItems("compile")},remove:function(e){var t=this.findByDataItem(e);this.angular("cleanup",(function(){return{elements:t}})),s.destroy(t),t.remove()},findByDataItem:function(e){for(var t=[],i=0,n=e.length;i<n;i++)t[i]="[data-"+s.ns+"uid="+e[i].uid+"]";return this.element.find(t.join(","))},setDataItem:function(t,i){var n=this;return this._renderItems([i],(function(o){var l=e(o[0]);s.destroy(t),n.angular("cleanup",(function(){return{elements:[e(t)]}})),e(t).replaceWith(l),n.trigger(k,{item:l,data:i,ns:r})}))[0]},updateSize:function(){this._size=this.getSize()},_renderItems:function(t,i){var n=e(s.render(this.template,t));return i(n),this.angular("compile",(function(){return{elements:n,data:t.map((function(e){return{dataItem:e}}))}})),o.init(n),this._enhanceItems(n),n},_dim:function(e){this._toggle(e,!1)},_highlight:function(e){this._toggle(e,!0)},_toggle:function(t,i){if(!(t.which>1)){var s=e(t.currentTarget),n=s.parent(),o=!(u(s,"role")||"").match(I),r=t.isDefaultPrevented();o&&n.toggleClass("km-state-active",i&&!r)}},_templates:function(){var e=this,t=this.options.template,i=this.options.headerTemplate,n={},o={};n.template=typeof t===x?t:s.template(t),this.template=s.template((function(t){return"<li"+(t[0].uid?' data-uid="'+t[0].uid+'"':"")+">"+e.template(t)+"</li>"})).bind(n),o.template=this.template,o._headerTemplate=typeof i===x?i:s.template(i),o.headerTemplate=s.template((function(t){return e._headerTemplate(t)})),this.groupTemplate=m.bind(o)},_click:function(t){if(!(t.event.which>1||t.event.isDefaultPrevented())){var i,n=t.target,o=e(t.event.target),l=o.closest(s.roleSelector("button","detailbutton","backbutton")),a=s.widgetInstance(l,r),h=n.attr(s.attr("uid"));h&&(i=this.dataSource.getByUid(h)),this.trigger(S,{target:o,item:n,dataItem:i,button:a})&&t.preventDefault()}},_styleGroups:function(){var t=this.element.children();t.children("ul").addClass("km-list"),t.each((function(){var t=e(this),i=t.contents().first();t.addClass("km-group-container"),i.is("ul")||i.is("div."+f)||i.wrap(p)}))},_style:function(){var e=this.options,t="group"===e.type,i=this.element,s="inset"===e.style;i.addClass("km-listview").toggleClass("km-list",!t).toggleClass("km-virtual-list",this.virtual).toggleClass("km-listinset",!t&&s).toggleClass("km-listgroup",t&&!s).toggleClass("km-listgroupinset",t&&s),i.parents(".km-listview")[0]||i.closest(".km-content").toggleClass("km-insetcontent",s),t&&this._styleGroups(),this.trigger(_)},_enhanceItems:function(t){t.each((function(){var t,i=e(this),n=!1;i.children().each((function(){var i;(t=e(this)).is("a")?(!function(e){var t=e.parent(),i=e.add(t.children(s.roleSelector("detailbutton")));t.contents().not(i).not(H).length||(e.addClass("km-listview-link").attr(s.attr("role"),"listview-link"),B(e,u(t,"icon")),B(e,u(e,"icon")))}(t),n=!0):t.is("label")&&((i=t)[0].querySelector("input[type=checkbox],input[type=radio]")&&(i.parent().contents().not(i).not((function(){return 3==this.nodeType}))[0]||(i.addClass("km-listview-label"),i.children("[type=checkbox],[type=radio]").addClass("km-widget km-icon km-check"))),n=!0)})),n||function(e){B(e,u(e,"icon")),B(e,u(e.children(c),"icon"))}(i)}))}});r.plugin(A)}(window.kendo.jQuery),kendo}));
//# sourceMappingURL=kendo.mobile.listview.min.js.map
