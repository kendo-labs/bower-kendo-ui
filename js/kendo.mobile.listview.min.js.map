{"version":3,"file":"kendo.mobile.listview.min.js","sources":["kendo.mobile.listview.js"],"sourcesContent":["(function(f, define) {\n    define('kendo.mobile.listview',[ \"kendo.data\", \"kendo.userevents\", \"kendo.mobile.button\" ], f);\n})(function() {\n\nvar __meta__ = {\n    id: \"mobile.listview\",\n    name: \"ListView\",\n    category: \"mobile\",\n    description: \"The Kendo Mobile ListView widget is used to display flat or grouped list of items.\",\n    depends: [ \"data\", \"userevents\", \"mobile.button\" ]\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        Node = window.Node,\n        mobile = kendo.mobile,\n        ui = mobile.ui,\n        outerHeight = kendo._outerHeight,\n        DataSource = kendo.data.DataSource,\n        Widget = ui.DataBoundWidget,\n        ITEM_SELECTOR = \".km-list > li, > li:not(.km-group-container)\",\n        HIGHLIGHT_SELECTOR = \".km-listview-link, .km-listview-label\",\n        ICON_SELECTOR = \"[\" + kendo.attr(\"icon\") + \"]\",\n        attrValue = kendo.attrValue,\n        GROUP_CLASS = \"km-group-title\",\n        ACTIVE_CLASS = \"km-state-active\",\n        GROUP_WRAPPER = '<div class=\"' + GROUP_CLASS + '\"><div class=\"km-text\"></div></div>',\n        GROUP_TEMPLATE = kendo.template('<li><div class=\"' + GROUP_CLASS + '\"><div class=\"km-text\">#= this.headerTemplate(data) #</div></div><ul>#= kendo.render(this.template, data.items)#</ul></li>'),\n        WRAPPER = '<div class=\"km-listview-wrapper\"></div>',\n        SEARCH_TEMPLATE = kendo.template('<form class=\"km-filter-form\"><div class=\"km-filter-wrap\"><input type=\"search\" placeholder=\"#=placeholder#\"/><a href=\"\\\\#\" class=\"km-filter-reset\" title=\"Clear\"><span class=\"km-icon km-clear\"></span><span class=\"km-text\">Clear</span></a></div></form>'),\n        NS = \".kendoMobileListView\",\n        STYLED = \"styled\",\n        DATABOUND = \"dataBound\",\n        DATABINDING = \"dataBinding\",\n        ITEM_CHANGE = \"itemChange\",\n        CLICK = \"click\",\n        CHANGE = \"change\",\n        PROGRESS = \"progress\",\n        FUNCTION = \"function\",\n\n        whitespaceRegExp = /^\\s+$/,\n        buttonRegExp = /button/;\n\n    function whitespace() {\n        return this.nodeType === Node.TEXT_NODE && this.nodeValue.match(whitespaceRegExp);\n    }\n\n    function addIcon(item, icon) {\n        if (icon && !item[0].querySelector(\".km-icon\")) {\n            item.prepend('<span class=\"km-icon km-' + icon + '\"/>');\n        }\n    }\n\n    function enhanceItem(item) {\n        addIcon(item, attrValue(item, \"icon\"));\n        addIcon(item, attrValue(item.children(ICON_SELECTOR), \"icon\"));\n    }\n\n    function enhanceLinkItem(item) {\n        var parent = item.parent(),\n            itemAndDetailButtons = item.add(parent.children(kendo.roleSelector(\"detailbutton\"))),\n            otherNodes = parent.contents().not(itemAndDetailButtons).not(whitespace);\n\n        if (otherNodes.length) {\n            return;\n        }\n\n        item.addClass(\"km-listview-link\")\n            .attr(kendo.attr(\"role\"), \"listview-link\");\n\n        addIcon(item, attrValue(parent, \"icon\"));\n        addIcon(item, attrValue(item, \"icon\"));\n    }\n\n    function enhanceCheckBoxItem(label) {\n        if (!label[0].querySelector(\"input[type=checkbox],input[type=radio]\")) {\n            return;\n        }\n\n        var item = label.parent();\n\n        if (item.contents().not(label).not(function() { return this.nodeType == 3; })[0]) {\n            return;\n        }\n\n        label.addClass(\"km-listview-label\");\n\n        label.children(\"[type=checkbox],[type=radio]\").addClass(\"km-widget km-icon km-check\");\n    }\n\n    function putAt(element, top) {\n        $(element).css('transform', 'translate3d(0px, ' + top + 'px, 0px)');\n    }\n\n    var HeaderFixer = kendo.Class.extend({\n        init: function(listView) {\n            var scroller = listView.scroller();\n\n            if (!scroller) {\n                return;\n            }\n\n            this.options = listView.options;\n            this.element = listView.element;\n            this.scroller = listView.scroller();\n            this._shouldFixHeaders();\n\n            var headerFixer = this;\n\n            var cacheHeaders = function() {\n                headerFixer._cacheHeaders();\n            };\n\n            listView.bind(\"resize\", cacheHeaders);\n\n            listView.bind(STYLED, cacheHeaders);\n            listView.bind(DATABOUND, cacheHeaders);\n\n            this._scrollHandler = function(e) {\n                headerFixer._fixHeader(e);\n            };\n            scroller.bind(\"scroll\", this._scrollHandler);\n        },\n\n        destroy: function() {\n            var that = this;\n            if (that.scroller) {\n                that.scroller.unbind(\"scroll\", that._scrollHandler);\n            }\n        },\n\n        _fixHeader: function(e) {\n            if (!this.fixedHeaders) {\n                return;\n            }\n\n            var i = 0,\n                scroller = this.scroller,\n                headers = this.headers,\n                scrollTop = e.scrollTop,\n                headerPair,\n                offset,\n                header;\n\n            do {\n                headerPair = headers[i++];\n                if (!headerPair) {\n                    header = $(\"<div />\");\n                    break;\n                }\n                offset = headerPair.offset;\n                header = headerPair.header;\n            } while (offset + 1 > scrollTop);\n\n            if (this.currentHeader != i) {\n                scroller.fixedContainer.html(header.clone());\n                this.currentHeader = i;\n            }\n        },\n\n        _shouldFixHeaders: function() {\n            this.fixedHeaders = this.options.type === \"group\" && this.options.fixedHeaders;\n        },\n\n        _cacheHeaders: function() {\n            this._shouldFixHeaders();\n\n            if (!this.fixedHeaders) {\n                return;\n            }\n\n            var headers = [], offset = this.scroller.scrollTop;\n\n            this.element.find(\".\" + GROUP_CLASS).each(function(_, header) {\n                header = $(header);\n                headers.unshift({\n                    offset: header.position().top + offset,\n                    header: header\n                });\n            });\n\n            this.headers = headers;\n            this._fixHeader({ scrollTop: offset });\n        }\n    });\n\n    var DEFAULT_PULL_PARAMETERS = function() {\n        return { page: 1 };\n    };\n\n    var RefreshHandler = kendo.Class.extend({\n        init: function(listView) {\n            var handler = this,\n                options = listView.options,\n                scroller = listView.scroller(),\n                pullParameters = options.pullParameters || DEFAULT_PULL_PARAMETERS;\n\n            this.listView = listView;\n            this.scroller = scroller;\n\n            listView.bind(\"_dataSource\", function(e) {\n                handler.setDataSource(e.dataSource);\n            });\n\n            scroller.setOptions({\n                pullToRefresh: true,\n                pull: function() {\n                    if (!handler._pulled) {\n                        handler._pulled = true;\n                        handler.dataSource.read(pullParameters.call(listView, handler._first));\n                    }\n                },\n                messages: {\n                    pullTemplate: options.messages.pullTemplate,\n                    releaseTemplate: options.messages.releaseTemplate,\n                    refreshTemplate: options.messages.refreshTemplate\n                }\n            });\n        },\n\n        setDataSource: function(dataSource) {\n            var handler = this;\n\n            this._first = dataSource.view()[0];\n            this.dataSource = dataSource;\n\n            dataSource.bind(\"change\", function() {\n                handler._change();\n            });\n\n            dataSource.bind(\"error\", function() {\n                handler._change();\n            });\n        },\n\n        _change: function() {\n            var scroller = this.scroller,\n                dataSource = this.dataSource;\n\n            if (this._pulled) {\n                scroller.pullHandled();\n            }\n\n            if (this._pulled || !this._first) {\n                var view = dataSource.view();\n\n                if (view[0]) {\n                    this._first = view[0];\n                }\n            }\n\n            this._pulled = false;\n        }\n    });\n\n    var VirtualList = kendo.Observable.extend({\n        init: function(options) {\n            var list = this;\n\n            kendo.Observable.fn.init.call(list);\n\n            list.buffer = options.buffer;\n            list.height = options.height;\n            list.item = options.item;\n            list.items = [];\n            list.footer = options.footer;\n\n            list.buffer.bind(\"reset\", function() {\n                list.refresh();\n            });\n\n        },\n\n        refresh: function() {\n            var buffer = this.buffer,\n                items = this.items,\n                endReached = false;\n\n            while (items.length) {\n                items.pop().destroy();\n            }\n\n            this.offset = buffer.offset;\n\n            var itemConstructor = this.item,\n                prevItem,\n                item;\n\n            for (var idx = 0; idx < buffer.viewSize; idx ++) {\n                if (idx === buffer.total()) {\n                    endReached = true;\n                    break;\n                }\n                item = itemConstructor(this.content(this.offset + items.length));\n                item.below(prevItem);\n                prevItem = item;\n                items.push(item);\n            }\n\n            this.itemCount = items.length;\n\n            this.trigger(\"reset\");\n\n            this._resize();\n\n            if (endReached) {\n                this.trigger(\"endReached\");\n            }\n        },\n\n        totalHeight: function() {\n            if (!this.items[0]) {\n                return 0;\n            }\n\n            var list = this,\n                items = list.items,\n                top = items[0].top,\n                bottom = items[items.length - 1].bottom,\n                averageItemHeight = (bottom - top) / list.itemCount,\n                remainingItemsCount = list.buffer.length - list.offset - list.itemCount;\n\n            return (this.footer ? this.footer.height : 0) + bottom + remainingItemsCount * averageItemHeight;\n        },\n\n        batchUpdate: function(top) {\n            var height = this.height(),\n                items = this.items,\n                item,\n                initialOffset = this.offset;\n\n            if (!items[0]) {\n                return;\n            }\n\n            if (this.lastDirection) { // scrolling up\n                while (items[items.length - 1].bottom > top + height * 2) {\n                    if (this.offset === 0) {\n                        break;\n                    }\n\n                    this.offset --;\n                    item = items.pop();\n                    item.update(this.content(this.offset));\n                    item.above(items[0]);\n                    items.unshift(item);\n                }\n            } else { // scrolling down\n                while (items[0].top < top - height) {\n                    var nextIndex = this.offset + this.itemCount; // here, it should be offset + 1 + itemCount - 1.\n\n                    if (nextIndex === this.buffer.total()) {\n                        this.trigger(\"endReached\");\n                        break;\n                    }\n\n                    if (nextIndex === this.buffer.length) {\n                        break;\n                    }\n\n                    item = items.shift();\n                    item.update(this.content(this.offset + this.itemCount));\n                    item.below(items[items.length - 1]);\n                    items.push(item);\n                    this.offset ++;\n                }\n            }\n\n            if (initialOffset !== this.offset) {\n                this._resize();\n            }\n        },\n\n        update: function(top) {\n            var list = this,\n                items = this.items,\n                item,\n                firstItem,\n                lastItem,\n                height = this.height(),\n                itemCount = this.itemCount,\n                padding = height / 2,\n                up = (this.lastTop || 0) > top,\n                topBorder = top - padding,\n                bottomBorder = top + height + padding;\n\n            if (!items[0]) {\n                return;\n            }\n\n            this.lastTop = top;\n            this.lastDirection = up;\n\n            if (up) { // scrolling up\n               if (items[0].top > topBorder && // needs reorder\n                   items[items.length - 1].bottom > bottomBorder + padding && // enough padding below\n                   this.offset > 0 // we are not at the top\n                  )\n               {\n                    this.offset --;\n                    item = items.pop();\n                    firstItem = items[0];\n                    item.update(this.content(this.offset));\n                    items.unshift(item);\n\n                    item.above(firstItem);\n                    list._resize();\n               }\n            } else { // scrolling down\n                if (\n                    items[items.length - 1].bottom < bottomBorder && // needs reorder\n                    items[0].top < topBorder - padding // enough padding above\n                )\n                {\n                    var nextIndex = this.offset + itemCount; // here, it should be offset + 1 + itemCount - 1.\n\n                    if (nextIndex === this.buffer.total()) {\n                        this.trigger(\"endReached\");\n                    } else if (nextIndex !== this.buffer.length) {\n                        item = items.shift();\n                        lastItem = items[items.length - 1];\n                        items.push(item);\n                        item.update(this.content(this.offset + this.itemCount));\n                        list.offset ++;\n\n                        item.below(lastItem);\n                        list._resize();\n                    }\n                }\n            }\n        },\n\n        content: function(index) {\n            return this.buffer.at(index);\n        },\n\n        destroy: function() {\n            this.unbind();\n        },\n\n        _resize: function() {\n            var items = this.items,\n                top = 0,\n                bottom = 0,\n                firstItem = items[0],\n                lastItem = items[items.length - 1];\n\n            if (firstItem) {\n                top = firstItem.top;\n                bottom = lastItem.bottom;\n            }\n\n            this.trigger(\"resize\", { top: top, bottom: bottom });\n\n            if (this.footer) {\n                this.footer.below(lastItem);\n            }\n        }\n    });\n\n    // export for testing purposes\n    kendo.mobile.ui.VirtualList = VirtualList;\n\n    var VirtualListViewItem = kendo.Class.extend({\n        init: function(listView, dataItem) {\n            var element = listView.append([dataItem], true)[0],\n                height = element.offsetHeight;\n\n            $.extend(this, {\n                top: 0,\n                element: element,\n                listView: listView,\n                height: height,\n                bottom: height\n            });\n        },\n\n        update: function(dataItem) {\n            this.element = this.listView.setDataItem(this.element, dataItem);\n        },\n\n        above: function(item) {\n            if (item) {\n                this.height = this.element.offsetHeight;\n                this.top = item.top - this.height;\n                this.bottom = item.top;\n                putAt(this.element, this.top);\n            }\n        },\n\n        below: function(item) {\n            if (item) {\n                this.height = this.element.offsetHeight;\n                this.top = item.bottom;\n                this.bottom = this.top + this.height;\n                putAt(this.element, this.top);\n            }\n        },\n\n        destroy: function() {\n            kendo.destroy(this.element);\n            $(this.element).remove();\n        }\n    });\n\n    var LOAD_ICON = '<div><span class=\"km-icon\"></span><span class=\"km-loading-left\"></span><span class=\"km-loading-right\"></span></div>';\n    var VirtualListViewLoadingIndicator = kendo.Class.extend({\n        init: function(listView) {\n            this.element = $('<li class=\"km-load-more km-scroller-refresh\" style=\"display: none\"></li>').appendTo(listView.element);\n            this._loadIcon = $(LOAD_ICON).appendTo(this.element);\n        },\n\n        enable: function() {\n            this.element.show();\n            this.height = outerHeight(this.element, true);\n        },\n\n        disable: function() {\n            this.element.hide();\n            this.height = 0;\n        },\n\n        below: function(item) {\n            if (item) {\n                this.top = item.bottom;\n                this.bottom = this.height + this.top;\n                putAt(this.element, this.top);\n            }\n        }\n    });\n\n    var VirtualListViewPressToLoadMore = VirtualListViewLoadingIndicator.extend({\n        init: function(listView, buffer) {\n\n            this._loadIcon = $(LOAD_ICON).hide();\n            this._loadButton = $('<a class=\"km-load\">' + listView.options.messages.loadMoreText + '</a>').hide();\n            this.element = $('<li class=\"km-load-more\" style=\"display: none\"></li>').append(this._loadIcon).append(this._loadButton).appendTo(listView.element);\n\n            var loadMore = this;\n\n            this._loadButton.kendoMobileButton().data(\"kendoMobileButton\").bind(\"click\", function() {\n                loadMore._hideShowButton();\n                buffer.next();\n            });\n\n            buffer.bind(\"resize\", function() {\n                loadMore._showLoadButton();\n            });\n\n            this.height = outerHeight(this.element, true);\n            this.disable();\n        },\n\n        _hideShowButton: function() {\n            this._loadButton.hide();\n            this.element.addClass(\"km-scroller-refresh\");\n            this._loadIcon.css('display', 'block');\n        },\n\n        _showLoadButton: function() {\n            this._loadButton.show();\n            this.element.removeClass(\"km-scroller-refresh\");\n            this._loadIcon.hide();\n        }\n    });\n\n    var VirtualListViewItemBinder = kendo.Class.extend({\n        init: function(listView) {\n            var binder = this;\n\n            this.chromeHeight = outerHeight(listView.wrapper.children().not(listView.element));\n            this.listView = listView;\n            this.scroller = listView.scroller();\n            this.options = listView.options;\n\n            listView.bind(\"_dataSource\", function(e) {\n                binder.setDataSource(e.dataSource, e.empty);\n            });\n\n            listView.bind(\"resize\", function() {\n                if (!binder.list.items.length) {\n                    return;\n                }\n\n                binder.scroller.reset();\n                binder.buffer.range(0);\n                binder.list.refresh();\n            });\n\n            this.scroller.makeVirtual();\n\n            this._scroll = function(e) {\n                binder.list.update(e.scrollTop);\n            };\n            this.scroller.bind('scroll', this._scroll);\n            this._scrollEnd = function(e) {\n                binder.list.batchUpdate(e.scrollTop);\n            };\n            this.scroller.bind('scrollEnd', this._scrollEnd);\n        },\n\n        destroy: function() {\n            this.list.unbind();\n            this.buffer.unbind();\n            this.scroller.unbind('scroll', this._scroll);\n            this.scroller.unbind('scrollEnd', this._scrollEnd);\n        },\n\n        setDataSource: function(dataSource, empty) {\n            var binder = this,\n                options = this.options,\n                listView = this.listView,\n                scroller = listView.scroller(),\n                pressToLoadMore = options.loadMore,\n                pageSize,\n                buffer,\n                footer;\n\n            this.dataSource = dataSource;\n\n            pageSize = dataSource.pageSize() || options.virtualViewSize;\n\n            if (!pageSize && !empty) {\n                throw new Error(\"the DataSource does not have page size configured. Page Size setting is mandatory for the mobile listview virtual scrolling to work as expected.\");\n            }\n\n            if (this.buffer) {\n                this.buffer.destroy();\n            }\n\n            buffer = new kendo.data.Buffer(dataSource, Math.floor(pageSize / 2), pressToLoadMore);\n\n            if (pressToLoadMore) {\n                footer = new VirtualListViewPressToLoadMore(listView, buffer);\n            } else {\n                footer = new VirtualListViewLoadingIndicator(listView);\n            }\n\n            if (this.list) {\n                this.list.destroy();\n            }\n\n            var list = new VirtualList({\n                buffer: buffer,\n                footer: footer,\n                item: function(dataItem) { return new VirtualListViewItem(listView, dataItem); },\n                height: function() { return scroller.height(); }\n            });\n\n            list.bind(\"resize\", function() {\n                binder.updateScrollerSize();\n                listView.updateSize();\n            });\n\n            list.bind(\"reset\", function() {\n                binder.footer.enable();\n            });\n\n            list.bind(\"endReached\", function() {\n                footer.disable();\n                binder.updateScrollerSize();\n            });\n\n            buffer.bind(\"expand\", function() {\n                list.lastDirection = false; // expand down\n                list.batchUpdate(scroller.scrollTop);\n            });\n\n            $.extend(this, {\n                buffer: buffer,\n                scroller: scroller,\n                list: list,\n                footer: footer\n            });\n        },\n\n        updateScrollerSize: function() {\n            this.scroller.virtualSize(0, this.list.totalHeight() + this.chromeHeight);\n        },\n\n        refresh: function() {\n            this.list.refresh();\n        },\n\n        reset: function() {\n            this.buffer.range(0);\n            this.list.refresh();\n        }\n    });\n\n    var ListViewItemBinder = kendo.Class.extend({\n        init: function(listView) {\n            var binder = this;\n            this.listView = listView;\n            this.options = listView.options;\n\n            var itemBinder = this;\n\n            this._refreshHandler = function(e) {\n                itemBinder.refresh(e);\n            };\n\n            this._progressHandler = function() {\n                listView.showLoading();\n            };\n\n            listView.bind(\"_dataSource\", function(e) {\n                binder.setDataSource(e.dataSource);\n            });\n        },\n\n        destroy: function() {\n            this._unbindDataSource();\n        },\n\n        reset: function() { },\n\n        refresh: function(e) {\n            var action = e && e.action,\n                dataItems = e && e.items,\n                listView = this.listView,\n                dataSource = this.dataSource,\n                prependOnRefresh = this.options.appendOnRefresh,\n                view = dataSource.view(),\n                groups = dataSource.group(),\n                groupedMode = groups && groups[0],\n                item;\n\n\n            if (action === \"itemchange\") {\n                if (!listView._hasBindingTarget()) {\n                    item = listView.findByDataItem(dataItems)[0];\n                    if (item) {\n                        listView.setDataItem(item, dataItems[0]);\n                    }\n                }\n                return;\n            }\n\n            var removedItems, addedItems, addedDataItems;\n            var adding = (action === \"add\" && !groupedMode) || (prependOnRefresh && !listView._filter);\n            var removing = action === \"remove\" && !groupedMode;\n\n            if (adding) {\n                // no need to unbind anything\n                removedItems = [];\n            } else if (removing) {\n                // unbind the items about to be removed;\n                removedItems = listView.findByDataItem(dataItems);\n            }\n\n            if (listView.trigger(DATABINDING, { action: action || \"rebind\", items: dataItems, removedItems: removedItems, index: e && e.index })) {\n                if (this._shouldShowLoading()) {\n                    listView.hideLoading();\n                }\n                return;\n            }\n\n            if (action === \"add\" && !groupedMode) {\n                var index = view.indexOf(dataItems[0]);\n                if (index > -1) {\n                    addedItems = listView.insertAt(dataItems, index);\n                    addedDataItems = dataItems;\n                }\n            } else if (action === \"remove\" && !groupedMode) {\n                addedItems = [];\n                listView.remove(dataItems);\n            } else if (groupedMode) {\n                listView.replaceGrouped(view);\n            }\n            else if (prependOnRefresh && !listView._filter) {\n                addedItems = listView.prepend(view);\n                addedDataItems = view;\n            }\n            else {\n                listView.replace(view);\n            }\n\n            if (this._shouldShowLoading()) {\n                listView.hideLoading();\n            }\n\n            listView.trigger(DATABOUND, { ns: ui, addedItems: addedItems, addedDataItems: addedDataItems });\n        },\n\n        setDataSource: function(dataSource) {\n            if (this.dataSource) {\n                this._unbindDataSource();\n            }\n\n            this.dataSource = dataSource;\n            dataSource.bind(CHANGE, this._refreshHandler);\n\n            if (this._shouldShowLoading()) {\n                this.dataSource.bind(PROGRESS, this._progressHandler);\n            }\n        },\n\n        _unbindDataSource: function() {\n            this.dataSource.unbind(CHANGE, this._refreshHandler).unbind(PROGRESS, this._progressHandler);\n        },\n\n        _shouldShowLoading: function() {\n            var options = this.options;\n            return !options.pullToRefresh && !options.loadMore && !options.endlessScroll;\n        }\n    });\n\n    var ListViewFilter = kendo.Class.extend({\n        init: function(listView) {\n            var filter = this,\n                filterable = listView.options.filterable,\n                events = \"change paste\",\n                that = this;\n\n            this.listView = listView;\n            this.options = filterable;\n\n            listView.element.before(SEARCH_TEMPLATE({ placeholder: filterable.placeholder || \"Search...\" }));\n\n            if (filterable.autoFilter !== false) {\n                events += \" keyup\";\n            }\n\n            this.element = listView.wrapper.find(\".km-search-form\");\n\n            this.searchInput = listView.wrapper.find(\"input[type=search]\")\n                .closest(\"form\").on(\"submit\" + NS, function(e) {\n                    e.preventDefault();\n                })\n                .end()\n                .on(\"focus\" + NS, function() {\n                    filter._oldFilter = filter.searchInput.val();\n                })\n                .on(events.split(\" \").join(NS + \" \") + NS, this._filterChange.bind(this));\n\n            this.clearButton = listView.wrapper.find(\".km-filter-reset\")\n                .on(CLICK, this._clearFilter.bind(this))\n                .hide();\n\n             this._dataSourceChange = this._refreshInput.bind(this);\n             listView.bind(\"_dataSource\", function(e) {\n                 e.dataSource.bind(\"change\", that._dataSourceChange);\n             });\n        },\n\n        _refreshInput: function() {\n            var appliedFilters = this.listView.dataSource.filter();\n            var searchInput = this.listView._filter.searchInput;\n\n            if (!appliedFilters || appliedFilters.filters[0].field !== this.listView.options.filterable.field) {\n                searchInput.val(\"\");\n            } else {\n                searchInput.val(appliedFilters.filters[0].value);\n            }\n        },\n\n        _search: function(expr) {\n            this._filter = true;\n            this.clearButton[expr ? \"show\" : \"hide\"]();\n            this.listView.dataSource.filter(expr);\n        },\n\n        _filterChange: function(e) {\n            var filter = this;\n            if (e.type == \"paste\" && this.options.autoFilter !== false) {\n                setTimeout(function() {\n                    filter._applyFilter();\n                }, 1);\n            } else {\n                this._applyFilter();\n            }\n        },\n\n        _applyFilter: function() {\n            var options = this.options,\n                value = this.searchInput.val(),\n                expr = value.length ? {\n                    field: options.field,\n                    operator: options.operator || \"startswith\",\n                    ignoreCase: options.ignoreCase,\n                    value: value\n                } : null;\n\n            if (value === this._oldFilter) {\n                return;\n            }\n\n            this._oldFilter = value;\n            this._search(expr);\n        },\n\n        _clearFilter: function(e) {\n            this.searchInput.val(\"\");\n            this._search(null);\n\n            e.preventDefault();\n        }\n    });\n\n    var ListView = Widget.extend({\n        init: function(element, options) {\n            var listView = this;\n\n            Widget.fn.init.call(this, element, options);\n\n            element = this.element;\n\n            options = this.options;\n\n            // support for legacy typo in configuration options: scrollTreshold -> scrollThreshold.\n            if (options.scrollTreshold) {\n                options.scrollThreshold = options.scrollTreshold;\n            }\n\n            element\n                .on(\"down\", HIGHLIGHT_SELECTOR, \"_highlight\")\n                .on(\"move up cancel\", HIGHLIGHT_SELECTOR, \"_dim\");\n\n            this._userEvents = new kendo.UserEvents(element, {\n                fastTap: true,\n                filter: ITEM_SELECTOR,\n                allowSelection: true,\n                tap: function(e) {\n                    listView._click(e);\n                }\n            });\n\n            // HACK!!! to negate the ms touch action from the user events.\n            element.css(\"-ms-touch-action\", \"auto\");\n\n            element.wrap(WRAPPER);\n\n            this.wrapper = this.element.parent();\n\n            this._headerFixer = new HeaderFixer(this);\n\n            this._itemsCache = {};\n            this._templates();\n\n            this.virtual = options.endlessScroll || options.loadMore;\n\n            this._style();\n\n            if (this.options.$angular && (this.virtual || this.options.pullToRefresh)) {\n                setTimeout(this._start.bind(this));\n            } else {\n                this._start();\n            }\n\n        },\n\n        _start: function() {\n            var options = this.options;\n\n            if (this.options.filterable) {\n                this._filter = new ListViewFilter(this);\n            }\n\n            if (this.virtual) {\n                this._itemBinder = new VirtualListViewItemBinder(this);\n            } else {\n                this._itemBinder = new ListViewItemBinder(this);\n            }\n\n            if (this.options.pullToRefresh) {\n                this._pullToRefreshHandler = new RefreshHandler(this);\n            }\n\n            this.setDataSource(options.dataSource);\n\n            this._enhanceItems(this.items());\n\n            kendo.notify(this, ui);\n        },\n\n        events: [\n            CLICK,\n            DATABINDING,\n            DATABOUND,\n            ITEM_CHANGE\n        ],\n\n        options: {\n            name: \"ListView\",\n            style: \"\",\n            type: \"flat\",\n            autoBind: true,\n            fixedHeaders: false,\n            template: \"#:data#\",\n            headerTemplate: '<span class=\"km-text\">#:value#</span>',\n            appendOnRefresh: false,\n            loadMore: false,\n            endlessScroll: false,\n            scrollThreshold: 30,\n            pullToRefresh: false,\n            messages: {\n                loadMoreText: \"Press to load more\",\n                pullTemplate: \"Pull to refresh\",\n                releaseTemplate: \"Release to refresh\",\n                refreshTemplate: \"Refreshing\"\n            },\n            pullOffset: 140,\n            filterable: false,\n            virtualViewSize: null\n        },\n\n        refresh: function() {\n            this._itemBinder.refresh();\n        },\n\n        reset: function() {\n            this._itemBinder.reset();\n        },\n\n        setDataSource: function(dataSource) {\n            // the listView should have a ready datasource for MVVM to function properly. But an empty datasource should not empty the element\n            var emptyDataSource = !dataSource;\n            this.dataSource = DataSource.create(dataSource);\n\n            this.trigger(\"_dataSource\", { dataSource: this.dataSource, empty: emptyDataSource });\n\n            if (this.options.autoBind && !emptyDataSource) {\n                this.items().remove();\n                this.dataSource.fetch();\n            }\n        },\n\n        destroy: function() {\n            Widget.fn.destroy.call(this);\n            kendo.destroy(this.element);\n            this._userEvents.destroy();\n            if (this._itemBinder) {\n                this._itemBinder.destroy();\n            }\n\n            if (this._headerFixer) {\n                this._headerFixer.destroy();\n            }\n\n            this.element.unwrap();\n            delete this.element;\n            delete this.wrapper;\n            delete this._userEvents;\n        },\n\n        items: function() {\n            if (this.options.type === \"group\") {\n                return this.element.find(\".km-list\").children();\n            } else {\n                return this.element.children().not('.km-load-more');\n            }\n        },\n\n        scroller: function() {\n            if (!this._scrollerInstance) {\n                this._scrollerInstance = this.element.closest(\".km-scroll-wrapper\").data(\"kendoMobileScroller\");\n            }\n\n            return this._scrollerInstance;\n        },\n\n        showLoading: function() {\n            var view = this.view();\n            if (view && view.loader) {\n                view.loader.show();\n            }\n        },\n\n        hideLoading: function() {\n            var view = this.view();\n            if (view && view.loader) {\n                view.loader.hide();\n            }\n        },\n\n        insertAt: function(dataItems, index, triggerChange) {\n            var listView = this;\n            return listView._renderItems(dataItems, function(items) {\n                if (index === 0) {\n                    listView.element.prepend(items);\n                }\n                else if (index === -1) {\n                    listView.element.append(items);\n                } else {\n                    listView.items().eq(index - 1).after(items);\n                }\n\n                if (triggerChange) {\n                    for (var i = 0; i < items.length; i ++) {\n                        listView.trigger(ITEM_CHANGE, { item: items.eq(i), data: dataItems[i], ns: ui });\n                    }\n                }\n            });\n        },\n\n        append: function(dataItems, triggerChange) {\n            return this.insertAt(dataItems, -1, triggerChange);\n        },\n\n        prepend: function(dataItems, triggerChange) {\n            return this.insertAt(dataItems, 0, triggerChange);\n        },\n\n        replace: function(dataItems) {\n            this.options.type = \"flat\";\n            this._angularItems(\"cleanup\");\n            kendo.destroy(this.element.children());\n            this.element.empty();\n            this._userEvents.cancel();\n            this._style();\n            return this.insertAt(dataItems, 0);\n        },\n\n        replaceGrouped: function(groups) {\n            this.options.type = \"group\";\n            this._angularItems(\"cleanup\");\n            this.element.empty();\n            var items = $(kendo.render(this.groupTemplate, groups));\n\n            this._enhanceItems(items.children(\"ul\").children(\"li\"));\n            this.element.append(items);\n            mobile.init(items);\n            this._style();\n            this._angularItems(\"compile\");\n        },\n\n        remove: function(dataItems) {\n            var items = this.findByDataItem(dataItems);\n            this.angular(\"cleanup\", function() {\n                return { elements: items };\n            });\n            kendo.destroy(items);\n            items.remove();\n        },\n\n        findByDataItem: function(dataItems) {\n            var selectors = [];\n\n            for (var idx = 0, length = dataItems.length; idx < length; idx ++) {\n                selectors[idx] = \"[data-\" + kendo.ns + \"uid=\" + dataItems[idx].uid + \"]\";\n            }\n\n            return this.element.find(selectors.join(\",\"));\n        },\n\n        // item is a DOM element, not jQuery object.\n        setDataItem: function(item, dataItem) {\n            var listView = this,\n                replaceItem = function(items) {\n                    var newItem = $(items[0]);\n                    kendo.destroy(item);\n                    listView.angular(\"cleanup\", function() { return { elements: [ $(item) ] }; });\n                    $(item).replaceWith(newItem);\n                    listView.trigger(ITEM_CHANGE, { item: newItem, data: dataItem, ns: ui });\n                };\n\n            return this._renderItems([dataItem], replaceItem)[0];\n        },\n\n        updateSize: function() {\n            this._size = this.getSize();\n        },\n\n        _renderItems: function(dataItems, callback) {\n            var items = $(kendo.render(this.template, dataItems));\n\n            callback(items);\n\n            this.angular(\"compile\", function() {\n                return {\n                    elements: items,\n                    data: dataItems.map(function(data) {\n                        return { dataItem: data };\n                    })\n                };\n            });\n\n            mobile.init(items);\n            this._enhanceItems(items);\n\n            return items;\n        },\n\n        _dim: function(e) {\n            this._toggle(e, false);\n        },\n\n        _highlight: function(e) {\n            this._toggle(e, true);\n        },\n\n        _toggle: function(e, highlight) {\n            if (e.which > 1) {\n                return;\n            }\n\n            var clicked = $(e.currentTarget),\n                item = clicked.parent(),\n                role = attrValue(clicked, \"role\") || \"\",\n                plainItem = (!role.match(buttonRegExp)),\n                prevented = e.isDefaultPrevented();\n\n            if (plainItem) {\n                item.toggleClass(ACTIVE_CLASS, highlight && !prevented);\n            }\n        },\n\n        _templates: function() {\n            var template = this.options.template,\n                headerTemplate = this.options.headerTemplate,\n                dataIDAttribute = ' data-uid=\"#=arguments[0].uid || \"\"#\"',\n                templateProxy = {},\n                groupTemplateProxy = {};\n\n            if (typeof template === FUNCTION) {\n                templateProxy.template = template;\n                template = \"#=this.template(data)#\";\n            }\n\n            this.template = kendo.template(\"<li\" + dataIDAttribute + \">\" + template + \"</li>\").bind(templateProxy);\n\n            groupTemplateProxy.template = this.template;\n\n            if (typeof headerTemplate === FUNCTION) {\n                groupTemplateProxy._headerTemplate = headerTemplate;\n                headerTemplate = \"#=this._headerTemplate(data)#\";\n            }\n\n            groupTemplateProxy.headerTemplate = kendo.template(headerTemplate);\n\n            this.groupTemplate = GROUP_TEMPLATE.bind(groupTemplateProxy);\n        },\n\n        _click: function(e) {\n            if (e.event.which > 1 || e.event.isDefaultPrevented()) {\n                return;\n            }\n\n            var dataItem,\n                item = e.target,\n                target = $(e.event.target),\n                buttonElement = target.closest(kendo.roleSelector(\"button\", \"detailbutton\", \"backbutton\")),\n                button = kendo.widgetInstance(buttonElement, ui),\n                id = item.attr(kendo.attr(\"uid\"));\n\n            if (id) {\n                dataItem = this.dataSource.getByUid(id);\n            }\n\n            if (this.trigger(CLICK, { target: target, item: item, dataItem: dataItem, button: button })) {\n                e.preventDefault();\n            }\n        },\n\n        _styleGroups: function() {\n            var rootItems = this.element.children();\n\n            rootItems.children(\"ul\").addClass(\"km-list\");\n\n            rootItems.each(function() {\n                var li = $(this),\n                    groupHeader = li.contents().first();\n\n                li.addClass(\"km-group-container\");\n                if (!groupHeader.is(\"ul\") && !groupHeader.is(\"div.\" + GROUP_CLASS)) {\n                    groupHeader.wrap(GROUP_WRAPPER);\n                }\n            });\n        },\n\n        _style: function() {\n            var options = this.options,\n                grouped = options.type === \"group\",\n                element = this.element,\n                inset = options.style === \"inset\";\n\n            element.addClass(\"km-listview\")\n                .toggleClass(\"km-list\", !grouped)\n                .toggleClass(\"km-virtual-list\", this.virtual)\n                .toggleClass(\"km-listinset\", !grouped && inset)\n                .toggleClass(\"km-listgroup\", grouped && !inset)\n                .toggleClass(\"km-listgroupinset\", grouped && inset);\n\n            if (!element.parents(\".km-listview\")[0]) {\n                element.closest(\".km-content\").toggleClass(\"km-insetcontent\", inset); // iOS has white background when the list is not inset.\n            }\n\n            if (grouped) {\n                this._styleGroups();\n            }\n\n            this.trigger(STYLED);\n        },\n\n        _enhanceItems: function(items) {\n            items.each(function() {\n                var item = $(this),\n                    child,\n                    enhanced = false;\n\n                item.children().each(function() {\n                    child = $(this);\n                    if (child.is(\"a\")) {\n                        enhanceLinkItem(child);\n                        enhanced = true;\n                    } else if (child.is(\"label\")) {\n                        enhanceCheckBoxItem(child);\n                        enhanced = true;\n                    }\n                });\n\n                if (!enhanced) {\n                    enhanceItem(item);\n                }\n            });\n        }\n    });\n\n    ui.plugin(ListView);\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3) { (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","$","window","kendo","jQuery","undefined","Node","mobile","ui","outerHeight","_outerHeight","DataSource","data","Widget","DataBoundWidget","ITEM_SELECTOR","HIGHLIGHT_SELECTOR","ICON_SELECTOR","attr","attrValue","GROUP_CLASS","ACTIVE_CLASS","GROUP_WRAPPER","GROUP_TEMPLATE","template","WRAPPER","SEARCH_TEMPLATE","NS","STYLED","DATABOUND","DATABINDING","ITEM_CHANGE","CLICK","CHANGE","PROGRESS","FUNCTION","whitespaceRegExp","buttonRegExp","whitespace","this","nodeType","TEXT_NODE","nodeValue","match","addIcon","item","icon","querySelector","prepend","enhanceItem","children","enhanceLinkItem","parent","itemAndDetailButtons","add","roleSelector","otherNodes","contents","not","length","addClass","enhanceCheckBoxItem","label","putAt","element","top","css","HeaderFixer","Class","extend","init","listView","scroller","options","_shouldFixHeaders","headerFixer","cacheHeaders","_cacheHeaders","bind","_scrollHandler","e","_fixHeader","destroy","that","unbind","fixedHeaders","i","headers","scrollTop","headerPair","offset","header","currentHeader","fixedContainer","html","clone","type","find","each","_","unshift","position","DEFAULT_PULL_PARAMETERS","page","RefreshHandler","handler","pullParameters","setDataSource","dataSource","setOptions","pullToRefresh","pull","_pulled","read","call","_first","messages","pullTemplate","releaseTemplate","refreshTemplate","view","_change","pullHandled","VirtualList","Observable","list","fn","buffer","height","items","footer","refresh","endReached","pop","itemConstructor","prevItem","idx","viewSize","total","content","below","push","itemCount","trigger","_resize","totalHeight","bottom","averageItemHeight","remainingItemsCount","batchUpdate","initialOffset","lastDirection","update","above","nextIndex","shift","firstItem","lastItem","padding","up","lastTop","topBorder","bottomBorder","index","at","VirtualListViewItem","dataItem","append","offsetHeight","setDataItem","remove","LOAD_ICON","VirtualListViewLoadingIndicator","appendTo","_loadIcon","enable","show","disable","hide","VirtualListViewPressToLoadMore","_loadButton","loadMoreText","loadMore","kendoMobileButton","_hideShowButton","next","_showLoadButton","removeClass","VirtualListViewItemBinder","binder","chromeHeight","wrapper","empty","reset","range","makeVirtual","_scroll","_scrollEnd","pressToLoadMore","pageSize","virtualViewSize","Error","Buffer","Math","floor","updateScrollerSize","updateSize","virtualSize","ListViewItemBinder","itemBinder","_refreshHandler","_progressHandler","showLoading","_unbindDataSource","action","dataItems","prependOnRefresh","appendOnRefresh","groups","group","groupedMode","_hasBindingTarget","findByDataItem","removedItems","addedItems","addedDataItems","adding","_filter","removing","_shouldShowLoading","hideLoading","indexOf","insertAt","replaceGrouped","replace","ns","endlessScroll","ListViewFilter","filter","filterable","events","before","placeholder","autoFilter","searchInput","closest","on","preventDefault","end","_oldFilter","val","split","join","_filterChange","clearButton","_clearFilter","_dataSourceChange","_refreshInput","appliedFilters","filters","field","value","_search","expr","setTimeout","_applyFilter","operator","ignoreCase","ListView","scrollTreshold","scrollThreshold","_userEvents","UserEvents","fastTap","allowSelection","tap","_click","wrap","_headerFixer","_itemsCache","_templates","virtual","_style","$angular","_start","_itemBinder","_pullToRefreshHandler","_enhanceItems","notify","style","autoBind","headerTemplate","pullOffset","emptyDataSource","create","fetch","unwrap","_scrollerInstance","loader","triggerChange","_renderItems","eq","after","_angularItems","cancel","render","groupTemplate","angular","elements","selectors","uid","replaceItem","newItem","replaceWith","_size","getSize","callback","map","_dim","_toggle","_highlight","highlight","which","clicked","currentTarget","role","plainItem","prevented","isDefaultPrevented","toggleClass","dataIDAttribute","templateProxy","groupTemplateProxy","_headerTemplate","event","target","buttonElement","button","widgetInstance","getByUid","_styleGroups","rootItems","li","groupHeader","first","is","grouped","inset","parents","child","enhanced","plugin","amd","a1","a2","a3"],"mappings":"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"}