{"version":3,"file":"kendo.mobile.listview.min.js","names":["factory","define","amd","$","undefined$1","this$1$1","this","kendo","window","Node","mobile","ui","outerHeight","_outerHeight","DataSource","data","Widget","DataBoundWidget","HIGHLIGHT_SELECTOR","ICON_SELECTOR","attr","attrValue","GROUP_CLASS","GROUP_WRAPPER","GROUP_TEMPLATE","template","headerTemplate","render","items","SEARCH_TEMPLATE","ref","placeholder","NS","STYLED","DATABOUND","DATABINDING","ITEM_CHANGE","CLICK","CHANGE","PROGRESS","FUNCTION","whitespaceRegExp","buttonRegExp","whitespace","nodeType","TEXT_NODE","nodeValue","match","addIcon","item","icon","querySelector","prepend","putAt","element","top","css","HeaderFixer","Class","extend","init","listView","scroller","options","_shouldFixHeaders","headerFixer","cacheHeaders","_cacheHeaders","bind","_scrollHandler","e","_fixHeader","destroy","that","unbind","fixedHeaders","headerPair","offset","header","i","headers","scrollTop","currentHeader","fixedContainer","html","clone","type","find","each","_","unshift","position","DEFAULT_PULL_PARAMETERS","page","RefreshHandler","handler","pullParameters","setDataSource","dataSource","setOptions","pullToRefresh","pull","_pulled","read","call","_first","messages","pullTemplate","releaseTemplate","refreshTemplate","view","_change","pullHandled","VirtualList","Observable","list","fn","buffer","height","footer","refresh","endReached","length","pop","prevItem","itemConstructor","idx","viewSize","total","content","below","push","itemCount","trigger","_resize","totalHeight","bottom","averageItemHeight","remainingItemsCount","batchUpdate","initialOffset","lastDirection","update","above","nextIndex","shift","firstItem","lastItem","padding","up","lastTop","topBorder","bottomBorder","index","at","VirtualListViewItem","dataItem","append","offsetHeight","setDataItem","remove","LOAD_ICON","VirtualListViewLoadingIndicator","appendTo","_loadIcon","enable","show","disable","hide","VirtualListViewPressToLoadMore","_loadButton","loadMoreText","loadMore","kendoMobileButton","_hideShowButton","next","_showLoadButton","addClass","removeClass","VirtualListViewItemBinder","binder","chromeHeight","wrapper","children","not","empty","reset","range","makeVirtual","_scroll","_scrollEnd","pageSize","pressToLoadMore","virtualViewSize","Error","Buffer","Math","floor","updateScrollerSize","updateSize","virtualSize","ListViewItemBinder","itemBinder","_refreshHandler","_progressHandler","showLoading","_unbindDataSource","removedItems","addedItems","addedDataItems","action","dataItems","prependOnRefresh","appendOnRefresh","groups","group","groupedMode","_filter","findByDataItem","_shouldShowLoading","hideLoading","replaceGrouped","replace","indexOf","insertAt","ns","_hasBindingTarget","endlessScroll","ListViewFilter","filter","filterable","events","before","autoFilter","searchInput","closest","on","preventDefault","end","_oldFilter","val","split","join","_filterChange","clearButton","_clearFilter","_dataSourceChange","_refreshInput","appliedFilters","filters","field","value","_search","expr","setTimeout","_applyFilter","operator","ignoreCase","ListView","scrollTreshold","scrollThreshold","_userEvents","UserEvents","fastTap","allowSelection","tap","_click","wrap","parent","_headerFixer","_itemsCache","_templates","virtual","_style","$angular","_start","_itemBinder","_pullToRefreshHandler","_enhanceItems","notify","name","style","autoBind","htmlEncode","pullOffset","emptyDataSource","create","fetch","unwrap","_scrollerInstance","loader","triggerChange","_renderItems","eq","after","_angularItems","cancel","groupTemplate","angular","elements","selectors","uid","newItem","replaceWith","_size","getSize","callback","map","_dim","_toggle","_highlight","highlight","which","clicked","currentTarget","plainItem","prevented","isDefaultPrevented","toggleClass","templateProxy","groupTemplateProxy","_headerTemplate","event","target","buttonElement","roleSelector","button","widgetInstance","id","getByUid","_styleGroups","rootItems","li","groupHeader","contents","first","is","grouped","inset","parents","child","enhanced","label","itemAndDetailButtons","add","enhanceLinkItem","enhanceItem","plugin","jQuery"],"sources":["kendo.mobile.listview.js"],"mappings":"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","sourcesContent":["(function (factory) {\n    typeof define === 'function' && define.amd ? define(['kendo.data', 'kendo.userevents', 'kendo.mobile.button'], factory) :\n    factory();\n})((function () {\n    var __meta__ = {\n        id: \"mobile.listview\",\n        name: \"ListView\",\n        category: \"mobile\",\n        description: \"The Kendo Mobile ListView widget is used to display flat or grouped list of items.\",\n        depends: [ \"data\", \"userevents\", \"mobile.button\" ]\n    };\n\n    (function($, undefined$1) {\n        var this$1$1 = this;\n\n        var kendo = window.kendo,\n            Node = window.Node,\n            mobile = kendo.mobile,\n            ui = mobile.ui,\n            outerHeight = kendo._outerHeight,\n            DataSource = kendo.data.DataSource,\n            Widget = ui.DataBoundWidget,\n            ITEM_SELECTOR = \".km-list > li, > li:not(.km-group-container)\",\n            HIGHLIGHT_SELECTOR = \".km-listview-link, .km-listview-label\",\n            ICON_SELECTOR = \"[\" + kendo.attr(\"icon\") + \"]\",\n            attrValue = kendo.attrValue,\n            GROUP_CLASS = \"km-group-title\",\n            ACTIVE_CLASS = \"km-state-active\",\n            GROUP_WRAPPER = \"<div class=\\\"\" + GROUP_CLASS + \"\\\"><div class=\\\"km-text\\\"></div></div>\",\n            GROUP_TEMPLATE = kendo.template(function (data) { return (\"<li><div class=\\\"\" + GROUP_CLASS + \"\\\"><div class=\\\"km-text\\\">\" + (this$1$1.headerTemplate(data)) + \"</div></div><ul>\" + (kendo.render(this$1$1.template, data.items)) + \"</ul></li>\"); }),\n            WRAPPER = '<div class=\"km-listview-wrapper\"></div>',\n            SEARCH_TEMPLATE = kendo.template(function (ref) {\n                var placeholder = ref.placeholder;\n\n                return (\"<form class=\\\"km-filter-form\\\"><div class=\\\"km-filter-wrap\\\"><input type=\\\"search\\\" placeholder=\\\"\" + placeholder + \"\\\"/><a href=\\\"#\\\" class=\\\"km-filter-reset\\\" title=\\\"Clear\\\"><span class=\\\"km-icon km-clear\\\"></span><span class=\\\"km-text\\\">Clear</span></a></div></form>\");\n        }),\n            NS = \".kendoMobileListView\",\n            STYLED = \"styled\",\n            DATABOUND = \"dataBound\",\n            DATABINDING = \"dataBinding\",\n            ITEM_CHANGE = \"itemChange\",\n            CLICK = \"click\",\n            CHANGE = \"change\",\n            PROGRESS = \"progress\",\n            FUNCTION = \"function\",\n\n            whitespaceRegExp = /^\\s+$/,\n            buttonRegExp = /button/;\n\n        function whitespace() {\n            return this.nodeType === Node.TEXT_NODE && this.nodeValue.match(whitespaceRegExp);\n        }\n\n        function addIcon(item, icon) {\n            if (icon && !item[0].querySelector(\".km-icon\")) {\n                item.prepend('<span class=\"km-icon km-' + icon + '\"/>');\n            }\n        }\n\n        function enhanceItem(item) {\n            addIcon(item, attrValue(item, \"icon\"));\n            addIcon(item, attrValue(item.children(ICON_SELECTOR), \"icon\"));\n        }\n\n        function enhanceLinkItem(item) {\n            var parent = item.parent(),\n                itemAndDetailButtons = item.add(parent.children(kendo.roleSelector(\"detailbutton\"))),\n                otherNodes = parent.contents().not(itemAndDetailButtons).not(whitespace);\n\n            if (otherNodes.length) {\n                return;\n            }\n\n            item.addClass(\"km-listview-link\")\n                .attr(kendo.attr(\"role\"), \"listview-link\");\n\n            addIcon(item, attrValue(parent, \"icon\"));\n            addIcon(item, attrValue(item, \"icon\"));\n        }\n\n        function enhanceCheckBoxItem(label) {\n            if (!label[0].querySelector(\"input[type=checkbox],input[type=radio]\")) {\n                return;\n            }\n\n            var item = label.parent();\n\n            if (item.contents().not(label).not(function() { return this.nodeType == 3; })[0]) {\n                return;\n            }\n\n            label.addClass(\"km-listview-label\");\n\n            label.children(\"[type=checkbox],[type=radio]\").addClass(\"km-widget km-icon km-check\");\n        }\n\n        function putAt(element, top) {\n            $(element).css('transform', 'translate3d(0px, ' + top + 'px, 0px)');\n        }\n\n        var HeaderFixer = kendo.Class.extend({\n            init: function(listView) {\n                var scroller = listView.scroller();\n\n                if (!scroller) {\n                    return;\n                }\n\n                this.options = listView.options;\n                this.element = listView.element;\n                this.scroller = listView.scroller();\n                this._shouldFixHeaders();\n\n                var headerFixer = this;\n\n                var cacheHeaders = function() {\n                    headerFixer._cacheHeaders();\n                };\n\n                listView.bind(\"resize\", cacheHeaders);\n\n                listView.bind(STYLED, cacheHeaders);\n                listView.bind(DATABOUND, cacheHeaders);\n\n                this._scrollHandler = function(e) {\n                    headerFixer._fixHeader(e);\n                };\n                scroller.bind(\"scroll\", this._scrollHandler);\n            },\n\n            destroy: function() {\n                var that = this;\n                if (that.scroller) {\n                    that.scroller.unbind(\"scroll\", that._scrollHandler);\n                }\n            },\n\n            _fixHeader: function(e) {\n                if (!this.fixedHeaders) {\n                    return;\n                }\n\n                var i = 0,\n                    scroller = this.scroller,\n                    headers = this.headers,\n                    scrollTop = e.scrollTop,\n                    headerPair,\n                    offset,\n                    header;\n\n                do {\n                    headerPair = headers[i++];\n                    if (!headerPair) {\n                        header = $(\"<div />\");\n                        break;\n                    }\n                    offset = headerPair.offset;\n                    header = headerPair.header;\n                } while (offset + 1 > scrollTop);\n\n                if (this.currentHeader != i) {\n                    scroller.fixedContainer.html(header.clone());\n                    this.currentHeader = i;\n                }\n            },\n\n            _shouldFixHeaders: function() {\n                this.fixedHeaders = this.options.type === \"group\" && this.options.fixedHeaders;\n            },\n\n            _cacheHeaders: function() {\n                this._shouldFixHeaders();\n\n                if (!this.fixedHeaders) {\n                    return;\n                }\n\n                var headers = [], offset = this.scroller.scrollTop;\n\n                this.element.find(\".\" + GROUP_CLASS).each(function(_, header) {\n                    header = $(header);\n                    headers.unshift({\n                        offset: header.position().top + offset,\n                        header: header\n                    });\n                });\n\n                this.headers = headers;\n                this._fixHeader({ scrollTop: offset });\n            }\n        });\n\n        var DEFAULT_PULL_PARAMETERS = function() {\n            return { page: 1 };\n        };\n\n        var RefreshHandler = kendo.Class.extend({\n            init: function(listView) {\n                var handler = this,\n                    options = listView.options,\n                    scroller = listView.scroller(),\n                    pullParameters = options.pullParameters || DEFAULT_PULL_PARAMETERS;\n\n                this.listView = listView;\n                this.scroller = scroller;\n\n                listView.bind(\"_dataSource\", function(e) {\n                    handler.setDataSource(e.dataSource);\n                });\n\n                scroller.setOptions({\n                    pullToRefresh: true,\n                    pull: function() {\n                        if (!handler._pulled) {\n                            handler._pulled = true;\n                            handler.dataSource.read(pullParameters.call(listView, handler._first));\n                        }\n                    },\n                    messages: {\n                        pullTemplate: options.messages.pullTemplate,\n                        releaseTemplate: options.messages.releaseTemplate,\n                        refreshTemplate: options.messages.refreshTemplate\n                    }\n                });\n            },\n\n            setDataSource: function(dataSource) {\n                var handler = this;\n\n                this._first = dataSource.view()[0];\n                this.dataSource = dataSource;\n\n                dataSource.bind(\"change\", function() {\n                    handler._change();\n                });\n\n                dataSource.bind(\"error\", function() {\n                    handler._change();\n                });\n            },\n\n            _change: function() {\n                var scroller = this.scroller,\n                    dataSource = this.dataSource;\n\n                if (this._pulled) {\n                    scroller.pullHandled();\n                }\n\n                if (this._pulled || !this._first) {\n                    var view = dataSource.view();\n\n                    if (view[0]) {\n                        this._first = view[0];\n                    }\n                }\n\n                this._pulled = false;\n            }\n        });\n\n        var VirtualList = kendo.Observable.extend({\n            init: function(options) {\n                var list = this;\n\n                kendo.Observable.fn.init.call(list);\n\n                list.buffer = options.buffer;\n                list.height = options.height;\n                list.item = options.item;\n                list.items = [];\n                list.footer = options.footer;\n\n                list.buffer.bind(\"reset\", function() {\n                    list.refresh();\n                });\n\n            },\n\n            refresh: function() {\n                var buffer = this.buffer,\n                    items = this.items,\n                    endReached = false;\n\n                while (items.length) {\n                    items.pop().destroy();\n                }\n\n                this.offset = buffer.offset;\n\n                var itemConstructor = this.item,\n                    prevItem,\n                    item;\n\n                for (var idx = 0; idx < buffer.viewSize; idx ++) {\n                    if (idx === buffer.total()) {\n                        endReached = true;\n                        break;\n                    }\n                    item = itemConstructor(this.content(this.offset + items.length));\n                    item.below(prevItem);\n                    prevItem = item;\n                    items.push(item);\n                }\n\n                this.itemCount = items.length;\n\n                this.trigger(\"reset\");\n\n                this._resize();\n\n                if (endReached) {\n                    this.trigger(\"endReached\");\n                }\n            },\n\n            totalHeight: function() {\n                if (!this.items[0]) {\n                    return 0;\n                }\n\n                var list = this,\n                    items = list.items,\n                    top = items[0].top,\n                    bottom = items[items.length - 1].bottom,\n                    averageItemHeight = (bottom - top) / list.itemCount,\n                    remainingItemsCount = list.buffer.length - list.offset - list.itemCount;\n\n                return (this.footer ? this.footer.height : 0) + bottom + remainingItemsCount * averageItemHeight;\n            },\n\n            batchUpdate: function(top) {\n                var height = this.height(),\n                    items = this.items,\n                    item,\n                    initialOffset = this.offset;\n\n                if (!items[0]) {\n                    return;\n                }\n\n                if (this.lastDirection) { // scrolling up\n                    while (items[items.length - 1].bottom > top + height * 2) {\n                        if (this.offset === 0) {\n                            break;\n                        }\n\n                        this.offset --;\n                        item = items.pop();\n                        item.update(this.content(this.offset));\n                        item.above(items[0]);\n                        items.unshift(item);\n                    }\n                } else { // scrolling down\n                    while (items[0].top < top - height) {\n                        var nextIndex = this.offset + this.itemCount; // here, it should be offset + 1 + itemCount - 1.\n\n                        if (nextIndex === this.buffer.total()) {\n                            this.trigger(\"endReached\");\n                            break;\n                        }\n\n                        if (nextIndex === this.buffer.length) {\n                            break;\n                        }\n\n                        item = items.shift();\n                        item.update(this.content(this.offset + this.itemCount));\n                        item.below(items[items.length - 1]);\n                        items.push(item);\n                        this.offset ++;\n                    }\n                }\n\n                if (initialOffset !== this.offset) {\n                    this._resize();\n                }\n            },\n\n            update: function(top) {\n                var list = this,\n                    items = this.items,\n                    item,\n                    firstItem,\n                    lastItem,\n                    height = this.height(),\n                    itemCount = this.itemCount,\n                    padding = height / 2,\n                    up = (this.lastTop || 0) > top,\n                    topBorder = top - padding,\n                    bottomBorder = top + height + padding;\n\n                if (!items[0]) {\n                    return;\n                }\n\n                this.lastTop = top;\n                this.lastDirection = up;\n\n                if (up) { // scrolling up\n                   if (items[0].top > topBorder && // needs reorder\n                       items[items.length - 1].bottom > bottomBorder + padding && // enough padding below\n                       this.offset > 0 // we are not at the top\n                      )\n                   {\n                        this.offset --;\n                        item = items.pop();\n                        firstItem = items[0];\n                        item.update(this.content(this.offset));\n                        items.unshift(item);\n\n                        item.above(firstItem);\n                        list._resize();\n                   }\n                } else { // scrolling down\n                    if (\n                        items[items.length - 1].bottom < bottomBorder && // needs reorder\n                        items[0].top < topBorder - padding // enough padding above\n                    )\n                    {\n                        var nextIndex = this.offset + itemCount; // here, it should be offset + 1 + itemCount - 1.\n\n                        if (nextIndex === this.buffer.total()) {\n                            this.trigger(\"endReached\");\n                        } else if (nextIndex !== this.buffer.length) {\n                            item = items.shift();\n                            lastItem = items[items.length - 1];\n                            items.push(item);\n                            item.update(this.content(this.offset + this.itemCount));\n                            list.offset ++;\n\n                            item.below(lastItem);\n                            list._resize();\n                        }\n                    }\n                }\n            },\n\n            content: function(index) {\n                return this.buffer.at(index);\n            },\n\n            destroy: function() {\n                this.unbind();\n            },\n\n            _resize: function() {\n                var items = this.items,\n                    top = 0,\n                    bottom = 0,\n                    firstItem = items[0],\n                    lastItem = items[items.length - 1];\n\n                if (firstItem) {\n                    top = firstItem.top;\n                    bottom = lastItem.bottom;\n                }\n\n                this.trigger(\"resize\", { top: top, bottom: bottom });\n\n                if (this.footer) {\n                    this.footer.below(lastItem);\n                }\n            }\n        });\n\n        // export for testing purposes\n        kendo.mobile.ui.VirtualList = VirtualList;\n\n        var VirtualListViewItem = kendo.Class.extend({\n            init: function(listView, dataItem) {\n                var element = listView.append([dataItem], true)[0],\n                    height = element.offsetHeight;\n\n                $.extend(this, {\n                    top: 0,\n                    element: element,\n                    listView: listView,\n                    height: height,\n                    bottom: height\n                });\n            },\n\n            update: function(dataItem) {\n                this.element = this.listView.setDataItem(this.element, dataItem);\n            },\n\n            above: function(item) {\n                if (item) {\n                    this.height = this.element.offsetHeight;\n                    this.top = item.top - this.height;\n                    this.bottom = item.top;\n                    putAt(this.element, this.top);\n                }\n            },\n\n            below: function(item) {\n                if (item) {\n                    this.height = this.element.offsetHeight;\n                    this.top = item.bottom;\n                    this.bottom = this.top + this.height;\n                    putAt(this.element, this.top);\n                }\n            },\n\n            destroy: function() {\n                kendo.destroy(this.element);\n                $(this.element).remove();\n            }\n        });\n\n        var LOAD_ICON = '<div><span class=\"km-icon\"></span><span class=\"km-loading-left\"></span><span class=\"km-loading-right\"></span></div>';\n        var VirtualListViewLoadingIndicator = kendo.Class.extend({\n            init: function(listView) {\n                this.element = $('<li class=\"km-load-more km-scroller-refresh\" style=\"display: none\"></li>').appendTo(listView.element);\n                this._loadIcon = $(LOAD_ICON).appendTo(this.element);\n            },\n\n            enable: function() {\n                this.element.show();\n                this.height = outerHeight(this.element, true);\n            },\n\n            disable: function() {\n                this.element.hide();\n                this.height = 0;\n            },\n\n            below: function(item) {\n                if (item) {\n                    this.top = item.bottom;\n                    this.bottom = this.height + this.top;\n                    putAt(this.element, this.top);\n                }\n            }\n        });\n\n        var VirtualListViewPressToLoadMore = VirtualListViewLoadingIndicator.extend({\n            init: function(listView, buffer) {\n\n                this._loadIcon = $(LOAD_ICON).hide();\n                this._loadButton = $('<a class=\"km-load\">' + listView.options.messages.loadMoreText + '</a>').hide();\n                this.element = $('<li class=\"km-load-more\" style=\"display: none\"></li>').append(this._loadIcon).append(this._loadButton).appendTo(listView.element);\n\n                var loadMore = this;\n\n                this._loadButton.kendoMobileButton().data(\"kendoMobileButton\").bind(\"click\", function() {\n                    loadMore._hideShowButton();\n                    buffer.next();\n                });\n\n                buffer.bind(\"resize\", function() {\n                    loadMore._showLoadButton();\n                });\n\n                this.height = outerHeight(this.element, true);\n                this.disable();\n            },\n\n            _hideShowButton: function() {\n                this._loadButton.hide();\n                this.element.addClass(\"km-scroller-refresh\");\n                this._loadIcon.css('display', 'block');\n            },\n\n            _showLoadButton: function() {\n                this._loadButton.show();\n                this.element.removeClass(\"km-scroller-refresh\");\n                this._loadIcon.hide();\n            }\n        });\n\n        var VirtualListViewItemBinder = kendo.Class.extend({\n            init: function(listView) {\n                var binder = this;\n\n                this.chromeHeight = outerHeight(listView.wrapper.children().not(listView.element));\n                this.listView = listView;\n                this.scroller = listView.scroller();\n                this.options = listView.options;\n\n                listView.bind(\"_dataSource\", function(e) {\n                    binder.setDataSource(e.dataSource, e.empty);\n                });\n\n                listView.bind(\"resize\", function() {\n                    if (!binder.list.items.length) {\n                        return;\n                    }\n\n                    binder.scroller.reset();\n                    binder.buffer.range(0);\n                    binder.list.refresh();\n                });\n\n                this.scroller.makeVirtual();\n\n                this._scroll = function(e) {\n                    binder.list.update(e.scrollTop);\n                };\n                this.scroller.bind('scroll', this._scroll);\n                this._scrollEnd = function(e) {\n                    binder.list.batchUpdate(e.scrollTop);\n                };\n                this.scroller.bind('scrollEnd', this._scrollEnd);\n            },\n\n            destroy: function() {\n                this.list.unbind();\n                this.buffer.unbind();\n                this.scroller.unbind('scroll', this._scroll);\n                this.scroller.unbind('scrollEnd', this._scrollEnd);\n            },\n\n            setDataSource: function(dataSource, empty) {\n                var binder = this,\n                    options = this.options,\n                    listView = this.listView,\n                    scroller = listView.scroller(),\n                    pressToLoadMore = options.loadMore,\n                    pageSize,\n                    buffer,\n                    footer;\n\n                this.dataSource = dataSource;\n\n                pageSize = dataSource.pageSize() || options.virtualViewSize;\n\n                if (!pageSize && !empty) {\n                    throw new Error(\"the DataSource does not have page size configured. Page Size setting is mandatory for the mobile listview virtual scrolling to work as expected.\");\n                }\n\n                if (this.buffer) {\n                    this.buffer.destroy();\n                }\n\n                buffer = new kendo.data.Buffer(dataSource, Math.floor(pageSize / 2), pressToLoadMore);\n\n                if (pressToLoadMore) {\n                    footer = new VirtualListViewPressToLoadMore(listView, buffer);\n                } else {\n                    footer = new VirtualListViewLoadingIndicator(listView);\n                }\n\n                if (this.list) {\n                    this.list.destroy();\n                }\n\n                var list = new VirtualList({\n                    buffer: buffer,\n                    footer: footer,\n                    item: function(dataItem) { return new VirtualListViewItem(listView, dataItem); },\n                    height: function() { return scroller.height(); }\n                });\n\n                list.bind(\"resize\", function() {\n                    binder.updateScrollerSize();\n                    listView.updateSize();\n                });\n\n                list.bind(\"reset\", function() {\n                    binder.footer.enable();\n                });\n\n                list.bind(\"endReached\", function() {\n                    footer.disable();\n                    binder.updateScrollerSize();\n                });\n\n                buffer.bind(\"expand\", function() {\n                    list.lastDirection = false; // expand down\n                    list.batchUpdate(scroller.scrollTop);\n                });\n\n                $.extend(this, {\n                    buffer: buffer,\n                    scroller: scroller,\n                    list: list,\n                    footer: footer\n                });\n            },\n\n            updateScrollerSize: function() {\n                this.scroller.virtualSize(0, this.list.totalHeight() + this.chromeHeight);\n            },\n\n            refresh: function() {\n                this.list.refresh();\n            },\n\n            reset: function() {\n                this.buffer.range(0);\n                this.list.refresh();\n            }\n        });\n\n        var ListViewItemBinder = kendo.Class.extend({\n            init: function(listView) {\n                var binder = this;\n                this.listView = listView;\n                this.options = listView.options;\n\n                var itemBinder = this;\n\n                this._refreshHandler = function(e) {\n                    itemBinder.refresh(e);\n                };\n\n                this._progressHandler = function() {\n                    listView.showLoading();\n                };\n\n                listView.bind(\"_dataSource\", function(e) {\n                    binder.setDataSource(e.dataSource);\n                });\n            },\n\n            destroy: function() {\n                this._unbindDataSource();\n            },\n\n            reset: function() { },\n\n            refresh: function(e) {\n                var action = e && e.action,\n                    dataItems = e && e.items,\n                    listView = this.listView,\n                    dataSource = this.dataSource,\n                    prependOnRefresh = this.options.appendOnRefresh,\n                    view = dataSource.view(),\n                    groups = dataSource.group(),\n                    groupedMode = groups && groups[0],\n                    item;\n\n\n                if (action === \"itemchange\") {\n                    if (!listView._hasBindingTarget()) {\n                        item = listView.findByDataItem(dataItems)[0];\n                        if (item) {\n                            listView.setDataItem(item, dataItems[0]);\n                        }\n                    }\n                    return;\n                }\n\n                var removedItems, addedItems, addedDataItems;\n                var adding = (action === \"add\" && !groupedMode) || (prependOnRefresh && !listView._filter);\n                var removing = action === \"remove\" && !groupedMode;\n\n                if (adding) {\n                    // no need to unbind anything\n                    removedItems = [];\n                } else if (removing) {\n                    // unbind the items about to be removed;\n                    removedItems = listView.findByDataItem(dataItems);\n                }\n\n                if (listView.trigger(DATABINDING, { action: action || \"rebind\", items: dataItems, removedItems: removedItems, index: e && e.index })) {\n                    if (this._shouldShowLoading()) {\n                        listView.hideLoading();\n                    }\n                    return;\n                }\n\n                if (action === \"add\" && !groupedMode) {\n                    var index = view.indexOf(dataItems[0]);\n                    if (index > -1) {\n                        addedItems = listView.insertAt(dataItems, index);\n                        addedDataItems = dataItems;\n                    }\n                } else if (action === \"remove\" && !groupedMode) {\n                    addedItems = [];\n                    listView.remove(dataItems);\n                } else if (groupedMode) {\n                    listView.replaceGrouped(view);\n                }\n                else if (prependOnRefresh && !listView._filter) {\n                    addedItems = listView.prepend(view);\n                    addedDataItems = view;\n                }\n                else {\n                    listView.replace(view);\n                }\n\n                if (this._shouldShowLoading()) {\n                    listView.hideLoading();\n                }\n\n                listView.trigger(DATABOUND, { ns: ui, addedItems: addedItems, addedDataItems: addedDataItems });\n            },\n\n            setDataSource: function(dataSource) {\n                if (this.dataSource) {\n                    this._unbindDataSource();\n                }\n\n                this.dataSource = dataSource;\n                dataSource.bind(CHANGE, this._refreshHandler);\n\n                if (this._shouldShowLoading()) {\n                    this.dataSource.bind(PROGRESS, this._progressHandler);\n                }\n            },\n\n            _unbindDataSource: function() {\n                this.dataSource.unbind(CHANGE, this._refreshHandler).unbind(PROGRESS, this._progressHandler);\n            },\n\n            _shouldShowLoading: function() {\n                var options = this.options;\n                return !options.pullToRefresh && !options.loadMore && !options.endlessScroll;\n            }\n        });\n\n        var ListViewFilter = kendo.Class.extend({\n            init: function(listView) {\n                var filter = this,\n                    filterable = listView.options.filterable,\n                    events = \"change paste\",\n                    that = this;\n\n                this.listView = listView;\n                this.options = filterable;\n\n                listView.element.before(SEARCH_TEMPLATE({ placeholder: filterable.placeholder || \"Search...\" }));\n\n                if (filterable.autoFilter !== false) {\n                    events += \" keyup\";\n                }\n\n                this.element = listView.wrapper.find(\".km-search-form\");\n\n                this.searchInput = listView.wrapper.find(\"input[type=search]\")\n                    .closest(\"form\").on(\"submit\" + NS, function(e) {\n                        e.preventDefault();\n                    })\n                    .end()\n                    .on(\"focus\" + NS, function() {\n                        filter._oldFilter = filter.searchInput.val();\n                    })\n                    .on(events.split(\" \").join(NS + \" \") + NS, this._filterChange.bind(this));\n\n                this.clearButton = listView.wrapper.find(\".km-filter-reset\")\n                    .on(CLICK, this._clearFilter.bind(this))\n                    .hide();\n\n                 this._dataSourceChange = this._refreshInput.bind(this);\n                 listView.bind(\"_dataSource\", function(e) {\n                     e.dataSource.bind(\"change\", that._dataSourceChange);\n                 });\n            },\n\n            _refreshInput: function() {\n                var appliedFilters = this.listView.dataSource.filter();\n                var searchInput = this.listView._filter.searchInput;\n\n                if (!appliedFilters || appliedFilters.filters[0].field !== this.listView.options.filterable.field) {\n                    searchInput.val(\"\");\n                } else {\n                    searchInput.val(appliedFilters.filters[0].value);\n                }\n            },\n\n            _search: function(expr) {\n                this._filter = true;\n                this.clearButton[expr ? \"show\" : \"hide\"]();\n                this.listView.dataSource.filter(expr);\n            },\n\n            _filterChange: function(e) {\n                var filter = this;\n                if (e.type == \"paste\" && this.options.autoFilter !== false) {\n                    setTimeout(function() {\n                        filter._applyFilter();\n                    }, 1);\n                } else {\n                    this._applyFilter();\n                }\n            },\n\n            _applyFilter: function() {\n                var options = this.options,\n                    value = this.searchInput.val(),\n                    expr = value.length ? {\n                        field: options.field,\n                        operator: options.operator || \"startswith\",\n                        ignoreCase: options.ignoreCase,\n                        value: value\n                    } : null;\n\n                if (value === this._oldFilter) {\n                    return;\n                }\n\n                this._oldFilter = value;\n                this._search(expr);\n            },\n\n            _clearFilter: function(e) {\n                this.searchInput.val(\"\");\n                this._search(null);\n\n                e.preventDefault();\n            }\n        });\n\n        var ListView = Widget.extend({\n            init: function(element, options) {\n                var listView = this;\n\n                Widget.fn.init.call(this, element, options);\n\n                element = this.element;\n\n                options = this.options;\n\n                // support for legacy typo in configuration options: scrollTreshold -> scrollThreshold.\n                if (options.scrollTreshold) {\n                    options.scrollThreshold = options.scrollTreshold;\n                }\n\n                element\n                    .on(\"down\", HIGHLIGHT_SELECTOR, \"_highlight\")\n                    .on(\"move up cancel\", HIGHLIGHT_SELECTOR, \"_dim\");\n\n                this._userEvents = new kendo.UserEvents(element, {\n                    fastTap: true,\n                    filter: ITEM_SELECTOR,\n                    allowSelection: true,\n                    tap: function(e) {\n                        listView._click(e);\n                    }\n                });\n\n                // HACK!!! to negate the ms touch action from the user events.\n                element.css(\"-ms-touch-action\", \"auto\");\n\n                element.wrap(WRAPPER);\n\n                this.wrapper = this.element.parent();\n\n                this._headerFixer = new HeaderFixer(this);\n\n                this._itemsCache = {};\n                this._templates();\n\n                this.virtual = options.endlessScroll || options.loadMore;\n\n                this._style();\n\n                if (this.options.$angular && (this.virtual || this.options.pullToRefresh)) {\n                    setTimeout(this._start.bind(this));\n                } else {\n                    this._start();\n                }\n\n            },\n\n            _start: function() {\n                var options = this.options;\n\n                if (this.options.filterable) {\n                    this._filter = new ListViewFilter(this);\n                }\n\n                if (this.virtual) {\n                    this._itemBinder = new VirtualListViewItemBinder(this);\n                } else {\n                    this._itemBinder = new ListViewItemBinder(this);\n                }\n\n                if (this.options.pullToRefresh) {\n                    this._pullToRefreshHandler = new RefreshHandler(this);\n                }\n\n                this.setDataSource(options.dataSource);\n\n                this._enhanceItems(this.items());\n\n                kendo.notify(this, ui);\n            },\n\n            events: [\n                CLICK,\n                DATABINDING,\n                DATABOUND,\n                ITEM_CHANGE\n            ],\n\n            options: {\n                name: \"ListView\",\n                style: \"\",\n                type: \"flat\",\n                autoBind: true,\n                fixedHeaders: false,\n                template: function (data) { return kendo.htmlEncode(data); },\n                headerTemplate: function (ref) {\n                    var value = ref.value;\n\n                    return (\"<span class=\\\"km-text\\\">\" + (kendo.htmlEncode(value)) + \"</span>\");\n        },\n                appendOnRefresh: false,\n                loadMore: false,\n                endlessScroll: false,\n                scrollThreshold: 30,\n                pullToRefresh: false,\n                messages: {\n                    loadMoreText: \"Press to load more\",\n                    pullTemplate: \"Pull to refresh\",\n                    releaseTemplate: \"Release to refresh\",\n                    refreshTemplate: \"Refreshing\"\n                },\n                pullOffset: 140,\n                filterable: false,\n                virtualViewSize: null\n            },\n\n            refresh: function() {\n                this._itemBinder.refresh();\n            },\n\n            reset: function() {\n                this._itemBinder.reset();\n            },\n\n            setDataSource: function(dataSource) {\n                // the listView should have a ready datasource for MVVM to function properly. But an empty datasource should not empty the element\n                var emptyDataSource = !dataSource;\n                this.dataSource = DataSource.create(dataSource);\n\n                this.trigger(\"_dataSource\", { dataSource: this.dataSource, empty: emptyDataSource });\n\n                if (this.options.autoBind && !emptyDataSource) {\n                    this.items().remove();\n                    this.dataSource.fetch();\n                }\n            },\n\n            destroy: function() {\n                Widget.fn.destroy.call(this);\n                kendo.destroy(this.element);\n                this._userEvents.destroy();\n                if (this._itemBinder) {\n                    this._itemBinder.destroy();\n                }\n\n                if (this._headerFixer) {\n                    this._headerFixer.destroy();\n                }\n\n                this.element.unwrap();\n                delete this.element;\n                delete this.wrapper;\n                delete this._userEvents;\n            },\n\n            items: function() {\n                if (this.options.type === \"group\") {\n                    return this.element.find(\".km-list\").children();\n                } else {\n                    return this.element.children().not('.km-load-more');\n                }\n            },\n\n            scroller: function() {\n                if (!this._scrollerInstance) {\n                    this._scrollerInstance = this.element.closest(\".km-scroll-wrapper\").data(\"kendoMobileScroller\");\n                }\n\n                return this._scrollerInstance;\n            },\n\n            showLoading: function() {\n                var view = this.view();\n                if (view && view.loader) {\n                    view.loader.show();\n                }\n            },\n\n            hideLoading: function() {\n                var view = this.view();\n                if (view && view.loader) {\n                    view.loader.hide();\n                }\n            },\n\n            insertAt: function(dataItems, index, triggerChange) {\n                var listView = this;\n                return listView._renderItems(dataItems, function(items) {\n                    if (index === 0) {\n                        listView.element.prepend(items);\n                    }\n                    else if (index === -1) {\n                        listView.element.append(items);\n                    } else {\n                        listView.items().eq(index - 1).after(items);\n                    }\n\n                    if (triggerChange) {\n                        for (var i = 0; i < items.length; i ++) {\n                            listView.trigger(ITEM_CHANGE, { item: items.eq(i), data: dataItems[i], ns: ui });\n                        }\n                    }\n                });\n            },\n\n            append: function(dataItems, triggerChange) {\n                return this.insertAt(dataItems, -1, triggerChange);\n            },\n\n            prepend: function(dataItems, triggerChange) {\n                return this.insertAt(dataItems, 0, triggerChange);\n            },\n\n            replace: function(dataItems) {\n                this.options.type = \"flat\";\n                this._angularItems(\"cleanup\");\n                kendo.destroy(this.element.children());\n                this.element.empty();\n                this._userEvents.cancel();\n                this._style();\n                return this.insertAt(dataItems, 0);\n            },\n\n            replaceGrouped: function(groups) {\n                this.options.type = \"group\";\n                this._angularItems(\"cleanup\");\n                this.element.empty();\n                var items = $(kendo.render(this.groupTemplate, groups));\n\n                this._enhanceItems(items.children(\"ul\").children(\"li\"));\n                this.element.append(items);\n                mobile.init(items);\n                this._style();\n                this._angularItems(\"compile\");\n            },\n\n            remove: function(dataItems) {\n                var items = this.findByDataItem(dataItems);\n                this.angular(\"cleanup\", function() {\n                    return { elements: items };\n                });\n                kendo.destroy(items);\n                items.remove();\n            },\n\n            findByDataItem: function(dataItems) {\n                var selectors = [];\n\n                for (var idx = 0, length = dataItems.length; idx < length; idx ++) {\n                    selectors[idx] = \"[data-\" + kendo.ns + \"uid=\" + dataItems[idx].uid + \"]\";\n                }\n\n                return this.element.find(selectors.join(\",\"));\n            },\n\n            // item is a DOM element, not jQuery object.\n            setDataItem: function(item, dataItem) {\n                var listView = this,\n                    replaceItem = function(items) {\n                        var newItem = $(items[0]);\n                        kendo.destroy(item);\n                        listView.angular(\"cleanup\", function() { return { elements: [ $(item) ] }; });\n                        $(item).replaceWith(newItem);\n                        listView.trigger(ITEM_CHANGE, { item: newItem, data: dataItem, ns: ui });\n                    };\n\n                return this._renderItems([dataItem], replaceItem)[0];\n            },\n\n            updateSize: function() {\n                this._size = this.getSize();\n            },\n\n            _renderItems: function(dataItems, callback) {\n                var items = $(kendo.render(this.template, dataItems));\n\n                callback(items);\n\n                this.angular(\"compile\", function() {\n                    return {\n                        elements: items,\n                        data: dataItems.map(function(data) {\n                            return { dataItem: data };\n                        })\n                    };\n                });\n\n                mobile.init(items);\n                this._enhanceItems(items);\n\n                return items;\n            },\n\n            _dim: function(e) {\n                this._toggle(e, false);\n            },\n\n            _highlight: function(e) {\n                this._toggle(e, true);\n            },\n\n            _toggle: function(e, highlight) {\n                if (e.which > 1) {\n                    return;\n                }\n\n                var clicked = $(e.currentTarget),\n                    item = clicked.parent(),\n                    role = attrValue(clicked, \"role\") || \"\",\n                    plainItem = (!role.match(buttonRegExp)),\n                    prevented = e.isDefaultPrevented();\n\n                if (plainItem) {\n                    item.toggleClass(ACTIVE_CLASS, highlight && !prevented);\n                }\n            },\n\n            _templates: function() {\n                var this$1$1 = this;\n\n                var template = this.options.template,\n                    headerTemplate = this.options.headerTemplate,\n                    templateProxy = {},\n                    groupTemplateProxy = {};\n\n                if (typeof template === FUNCTION) {\n                    templateProxy.template = template;\n                } else {\n                    templateProxy.template = kendo.template(template);\n                }\n\n                this.template = kendo.template(function (data) { return (\"<li\" + (data[0].uid ? (\" data-uid=\\\"\" + (data[0].uid) + \"\\\"\") : \"\") + \">\" + (this$1$1.template(data)) + \"</li>\"); }).bind(templateProxy);\n\n                groupTemplateProxy.template = this.template;\n\n                if (typeof headerTemplate === FUNCTION) {\n                    groupTemplateProxy._headerTemplate = headerTemplate;\n                } else {\n                    groupTemplateProxy._headerTemplate = kendo.template(headerTemplate);\n                }\n\n                groupTemplateProxy.headerTemplate = kendo.template(function (data){ return this$1$1._headerTemplate(data); });\n\n                this.groupTemplate = GROUP_TEMPLATE.bind(groupTemplateProxy);\n            },\n\n            _click: function(e) {\n                if (e.event.which > 1 || e.event.isDefaultPrevented()) {\n                    return;\n                }\n\n                var dataItem,\n                    item = e.target,\n                    target = $(e.event.target),\n                    buttonElement = target.closest(kendo.roleSelector(\"button\", \"detailbutton\", \"backbutton\")),\n                    button = kendo.widgetInstance(buttonElement, ui),\n                    id = item.attr(kendo.attr(\"uid\"));\n\n                if (id) {\n                    dataItem = this.dataSource.getByUid(id);\n                }\n\n                if (this.trigger(CLICK, { target: target, item: item, dataItem: dataItem, button: button })) {\n                    e.preventDefault();\n                }\n            },\n\n            _styleGroups: function() {\n                var rootItems = this.element.children();\n\n                rootItems.children(\"ul\").addClass(\"km-list\");\n\n                rootItems.each(function() {\n                    var li = $(this),\n                        groupHeader = li.contents().first();\n\n                    li.addClass(\"km-group-container\");\n                    if (!groupHeader.is(\"ul\") && !groupHeader.is(\"div.\" + GROUP_CLASS)) {\n                        groupHeader.wrap(GROUP_WRAPPER);\n                    }\n                });\n            },\n\n            _style: function() {\n                var options = this.options,\n                    grouped = options.type === \"group\",\n                    element = this.element,\n                    inset = options.style === \"inset\";\n\n                element.addClass(\"km-listview\")\n                    .toggleClass(\"km-list\", !grouped)\n                    .toggleClass(\"km-virtual-list\", this.virtual)\n                    .toggleClass(\"km-listinset\", !grouped && inset)\n                    .toggleClass(\"km-listgroup\", grouped && !inset)\n                    .toggleClass(\"km-listgroupinset\", grouped && inset);\n\n                if (!element.parents(\".km-listview\")[0]) {\n                    element.closest(\".km-content\").toggleClass(\"km-insetcontent\", inset); // iOS has white background when the list is not inset.\n                }\n\n                if (grouped) {\n                    this._styleGroups();\n                }\n\n                this.trigger(STYLED);\n            },\n\n            _enhanceItems: function(items) {\n                items.each(function() {\n                    var item = $(this),\n                        child,\n                        enhanced = false;\n\n                    item.children().each(function() {\n                        child = $(this);\n                        if (child.is(\"a\")) {\n                            enhanceLinkItem(child);\n                            enhanced = true;\n                        } else if (child.is(\"label\")) {\n                            enhanceCheckBoxItem(child);\n                            enhanced = true;\n                        }\n                    });\n\n                    if (!enhanced) {\n                        enhanceItem(item);\n                    }\n                });\n            }\n        });\n\n        ui.plugin(ListView);\n    })(window.kendo.jQuery);\n\n}));\n"]}