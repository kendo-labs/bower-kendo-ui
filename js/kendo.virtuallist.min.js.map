{"version":3,"file":"kendo.virtuallist.min.js","sources":["kendo.virtuallist.js"],"sourcesContent":["(function(f, define){\n    define('kendo.virtuallist',[ \"kendo.data\" ], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"virtuallist\",\n    name: \"VirtualList\",\n    category: \"framework\",\n    depends: [ \"data\" ],\n    hidden: true\n};\n\n(function($, undefined) {\n    var kendo = window.kendo,\n        ui = kendo.ui,\n        Widget = ui.Widget,\n        DataBoundWidget = ui.DataBoundWidget,\n        percentageUnitsRegex = /^\\d+(\\.\\d+)?%$/i,\n        LIST_CONTENT = \"k-list-content k-virtual-content\",\n        TABLE_CONTENT = \"k-table-body k-table-scroller\",\n        HEADER = \"k-list-group-sticky-header\",\n        LIST_ITEM = \"k-list-item\",\n        TABLE_ITEM = \"k-table-row\",\n        HEIGHTCONTAINER = \"k-height-container\",\n        GROUPITEM = \"k-list-item-group-label\",\n        LIST_UL = \"k-list-ul\",\n        TABLE_LIST = \"k-table-list\",\n\n        SELECTED = \"k-selected\",\n        FOCUSED = \"k-focus\",\n        HOVER = \"k-hover\",\n        CHANGE = \"change\",\n        CLICK = \"click\",\n        LISTBOUND = \"listBound\",\n        ITEMCHANGE = \"itemChange\",\n\n        ACTIVATE = \"activate\",\n        DEACTIVATE = \"deactivate\",\n\n        GROUP_ROW_SEL = \".k-table-group-row\",\n\n        VIRTUAL_LIST_NS = \".VirtualList\";\n\n    function lastFrom(array) {\n        return array[array.length - 1];\n    }\n\n    function toArray(value) {\n        return value instanceof Array ? value : [value];\n    }\n\n    function isPrimitive(dataItem) {\n        return typeof dataItem === \"string\" || typeof dataItem === \"number\" || typeof dataItem === \"boolean\";\n    }\n\n    function getItemCount(screenHeight, listScreens, itemHeight) {\n        return Math.ceil(screenHeight * listScreens / itemHeight);\n    }\n\n    function appendChild(parent, className, tagName) {\n        var element = document.createElement(tagName || \"div\");\n        if (className) {\n            element.className = className;\n        }\n        parent.appendChild(element);\n\n        return element;\n    }\n\n    function getDefaultItemHeight(listSize) {\n        var mockList = $('<div class=\"k-list ' + listSize + ' k-virtual-list\">' +\n                '<div class=\"k-list-content k-virtual-content\">' +\n                    '<ul class=\"k-list-ul\">' +\n                        '<li class=\"k-list-item\">' +\n                            '<span class=\"k-list-item-text\">test</span>' +\n                        '</li>' +\n                    '</ul>' +\n                '</div>' +\n            '</div>');\n        var lineHeight;\n\n        mockList.css({\n            position: \"absolute\",\n            left: \"-200000px\",\n            visibility: \"hidden\"\n        });\n        mockList.appendTo(document.body);\n        lineHeight = parseFloat(kendo.getComputedStyles(mockList.find(\".k-list-item\")[0], [\"height\"]).height);\n        mockList.remove();\n\n        return lineHeight;\n    }\n\n    function bufferSizes(screenHeight, listScreens, opposite) { //in pixels\n        return {\n            down: screenHeight * opposite,\n            up: screenHeight * (listScreens - 1 - opposite)\n        };\n    }\n\n    function listValidator(options, screenHeight) {\n        var downThreshold = (options.listScreens - 1 - options.threshold) * screenHeight;\n        var upThreshold = options.threshold * screenHeight;\n\n        return function(list, scrollTop, lastScrollTop) {\n            if (scrollTop > lastScrollTop) {\n                return scrollTop - list.top < downThreshold;\n            } else {\n                return list.top === 0 || scrollTop - list.top > upThreshold;\n            }\n        };\n    }\n\n    function scrollCallback(element, callback) {\n        return function(force) {\n            return callback(element.scrollTop, force);\n        };\n    }\n\n    function syncList(reorder) {\n        return function(list, force) {\n            reorder(list.items, list.index, force);\n            return list;\n        };\n    }\n\n    function position(element, y) {\n        element.style.webkitTransform = 'translateY(' + y + \"px)\";\n        element.style.transform = 'translateY(' + y + \"px)\";\n    }\n\n    function map2(callback, templates) {\n        return function(arr1, arr2) {\n            for (var i = 0, len = arr1.length; i < len; i++) {\n                callback(arr1[i], arr2[i], templates);\n                if (arr2[i].item) {\n                    this.trigger(ITEMCHANGE, { item: $(arr1[i]), data: arr2[i].item, ns: kendo.ui });\n                }\n            }\n        };\n    }\n\n    function reshift(items, diff) {\n        var range;\n\n        if (diff > 0) { // down\n            range = items.splice(0, diff);\n            items.push.apply(items, range);\n        } else { // up\n            range = items.splice(diff, -diff);\n            items.unshift.apply(items, range);\n        }\n\n        return range;\n    }\n\n    function render(element, data, templates) {\n        var itemTemplate = templates.template,\n            hasColumns = this.options.columns && this.options.columns.length,\n            altRow = data.index % 2 === 1 ? \"k-table-alt-row\" : \"\";\n\n        element = $(element);\n\n        if (!data.item) {\n            itemTemplate = templates.placeholderTemplate;\n        }\n\n        if (data.index === 0 && this.header && data.group) {\n            this.header.html(templates.fixedGroupTemplate(data.group));\n        }\n\n        this.angular(\"cleanup\", function() {\n            return { elements: [ element ]};\n        });\n\n        element\n            .attr(\"data-uid\", data.item ? data.item.uid : \"\")\n            .attr(\"data-offset-index\", data.index);\n\n        if (hasColumns && data.item) {\n            if (altRow.length > 0) {\n                element.addClass(altRow);\n            } else {\n                element.removeClass(\"k-table-alt-row\");\n            }\n            element.html(renderColumns(this.options, data.item, templates));\n        } else {\n            element.find(\".\" + GROUPITEM).remove();\n            element.find(\".k-list-item-text\").html(itemTemplate(data.item || {}));\n        }\n\n        element.toggleClass(FOCUSED, data.current);\n        element.toggleClass(SELECTED, data.selected);\n        element.toggleClass(\"k-first\", data.newGroup);\n        element.toggleClass(\"k-last\", data.isLastGroupedItem);\n        element.toggleClass(\"k-loading-item\", !data.item);\n\n        if (data.index !== 0 && data.newGroup) {\n            if (hasColumns) {\n                $('<span class=\"k-table-td k-table-group-td\"><span>' + templates.groupTemplate(data.group) + '</span></span>')\n                    .appendTo(element);\n            } else {\n                $(\"<div class=\" + GROUPITEM + \"></div>\")\n                    .appendTo(element)\n                    .html(templates.groupTemplate(data.group));\n            }\n        } else if (data.group && hasColumns) {\n            element.append($('<span class=\"k-table-td k-table-spacer-td\"></span>'));\n        }\n\n        if (data.top !== undefined) {\n            position(element[0], data.top);\n        }\n\n        this.angular(\"compile\", function() {\n            return { elements: [ element ], data: [ { dataItem: data.item, group: data.group, newGroup: data.newGroup } ]};\n        });\n    }\n\n    function renderColumns(options, dataItem, templates) {\n        var item = \"\";\n\n        for (var i = 0; i < options.columns.length; i++) {\n            var currentWidth = options.columns[i].width;\n            var currentWidthInt = parseInt(currentWidth, 10);\n            var widthStyle = '';\n\n            if(currentWidth){\n                widthStyle += \"style='width:\";\n                widthStyle += currentWidthInt;\n                widthStyle += percentageUnitsRegex.test(currentWidth) ? \"%\" : \"px\";\n                widthStyle += \";'\";\n            }\n            item += \"<span class='k-table-td' \" + widthStyle + \">\";\n            item += templates[\"column\"+ i](dataItem);\n            item += \"</span>\";\n        }\n\n        return item;\n    }\n\n    function mapChangedItems(selected, itemsToMatch) {\n        var itemsLength = itemsToMatch.length;\n        var selectedLength = selected.length;\n        var dataItem;\n        var found;\n        var i, j;\n\n        var changed = [];\n        var unchanged = [];\n\n        if (selectedLength) {\n            for (i = 0; i < selectedLength; i++) {\n                dataItem = selected[i];\n                found = false;\n\n                for (j = 0; j < itemsLength; j++) {\n                    if (dataItem === itemsToMatch[j]) {\n                        found = true;\n                        changed.push({ index: i, item: dataItem });\n                        break;\n                    }\n                }\n\n                if (!found) {\n                    unchanged.push(dataItem);\n                }\n            }\n        }\n\n        return {\n            changed: changed,\n            unchanged: unchanged\n        };\n    }\n\n    function isActivePromise(promise) {\n        return promise && promise.state() !== \"resolved\";\n    }\n\n    var VirtualList = DataBoundWidget.extend({\n        init: function(element, options) {\n            var that = this,\n                contentClasses = options.columns && options.columns.length ? TABLE_CONTENT : LIST_CONTENT;\n\n            that.bound(false);\n            that._fetching = false;\n\n            Widget.fn.init.call(that, element, options);\n\n            if (!that.options.itemHeight) {\n                that.options.itemHeight = getDefaultItemHeight(options.listSize);\n            }\n\n            options = that.options;\n\n            that.element.attr(\"role\", \"listbox\");\n\n            that.content = that.wrapper = that.element.wrap(\"<div unselectable='on' class='\" + contentClasses + \"'></div>\").parent();\n\n            if(that.options.columns && that.options.columns.length) {\n                var thead = that.element.closest(\".k-data-table\").find('.k-table-thead');\n                var row = $('<tr class=\"k-table-group-row\">' +\n                    '<th class=\"k-table-th\" colspan=\"' + that.options.columns.length + '\"></th>' +\n                '</tr>');\n\n                thead.append(row);\n\n                that.header = row.find(\".k-table-th\");\n                that.element.addClass(TABLE_LIST + \" k-virtual-table\");\n            } else {\n                that.header = that.content.before(\"<div class='\" + HEADER + \"'></div>\").prev();\n                that.element.addClass(LIST_UL);\n            }\n\n            if(options.ariaLabel) {\n                this.element.attr(\"aria-label\", options.ariaLabel);\n            } else if(options.ariaLabelledBy) {\n                this.element.attr(\"aria-labelledby\", options.ariaLabelledBy);\n            }\n\n            that.element.on(\"mouseenter\" + VIRTUAL_LIST_NS, \"li:not(.k-loading-item)\", function() { $(this).addClass(HOVER); })\n                        .on(\"mouseleave\" + VIRTUAL_LIST_NS, \"li\", function() { $(this).removeClass(HOVER); });\n\n            that._values = toArray(that.options.value);\n            that._selectedDataItems = [];\n            that._selectedIndexes = [];\n            that._rangesList = {};\n            that._promisesList = [];\n            that._optionID = kendo.guid();\n\n            that._templates();\n\n            that.setDataSource(options.dataSource);\n\n            that.content.on(\"scroll\" + VIRTUAL_LIST_NS, kendo.throttle(function() {\n                that._renderItems();\n                that._triggerListBound();\n            }, options.delay));\n\n            that._selectable();\n        },\n\n        options: {\n            name: \"VirtualList\",\n            autoBind: true,\n            delay: 100,\n            height: null,\n            listScreens: 4,\n            threshold: 0.5,\n            itemHeight: null,\n            oppositeBuffer: 1,\n            type: \"flat\",\n            selectable: false,\n            value: [],\n            dataValueField: null,\n            template: \"#:data#\",\n            placeholderTemplate: \"loading...\",\n            groupTemplate: \"#:data#\",\n            fixedGroupTemplate: \"#:data#\",\n            mapValueTo: \"index\",\n            valueMapper: null,\n            ariaLabel: null,\n            ariaLabelledBy: null\n        },\n\n        events: [\n            CHANGE,\n            CLICK,\n            LISTBOUND,\n            ITEMCHANGE,\n            ACTIVATE,\n            DEACTIVATE\n        ],\n\n        setOptions: function(options) {\n            var itemClass = this.options.columns && this.options.columns.length ? TABLE_ITEM : LIST_ITEM;\n\n            Widget.fn.setOptions.call(this, options);\n\n            if (this._selectProxy && this.options.selectable === false) {\n                this.element.off(CLICK, \".\" + itemClass, this._selectProxy);\n            } else if (!this._selectProxy && this.options.selectable) {\n                this._selectable();\n            }\n\n            this._templates();\n            this.refresh();\n        },\n\n        items: function() {\n            return $(this._items);\n        },\n\n        destroy: function() {\n            this.wrapper.off(VIRTUAL_LIST_NS);\n            this.dataSource.unbind(CHANGE, this._refreshHandler);\n            Widget.fn.destroy.call(this);\n        },\n\n        setDataSource: function(source) {\n            var that = this;\n            var dataSource = source || {};\n            var value;\n\n            dataSource = Array.isArray(dataSource) ? {data: dataSource} : dataSource;\n            dataSource = kendo.data.DataSource.create(dataSource);\n\n            if (that.dataSource) {\n                that.dataSource.unbind(CHANGE, that._refreshHandler);\n\n                that._clean();\n                that.bound(false);\n\n                that._deferValueSet = true;\n                value = that.value();\n\n                that.value([]);\n                that.mute(function() {\n                    that.value(value);\n                });\n            } else {\n                that._refreshHandler = that.refresh.bind(that);\n            }\n\n            that.dataSource = dataSource.bind(CHANGE, that._refreshHandler);\n\n            that.setDSFilter(dataSource.filter());\n\n            if (dataSource.view().length !== 0) {\n                that.refresh();\n            } else if (that.options.autoBind) {\n                dataSource.fetch();\n            }\n        },\n\n        skip: function() {\n            return this.dataSource.currentRangeStart();\n        },\n\n        _triggerListBound: function () {\n            var that = this;\n            var skip = that.skip();\n\n            if (that.bound() && !that._selectingValue && that._skip !== skip) {\n                that._skip = skip;\n                that.trigger(LISTBOUND);\n            }\n        },\n\n        _getValues: function(dataItems) {\n            var getter = this._valueGetter;\n\n            return $.map(dataItems, function(dataItem) {\n                return getter(dataItem);\n            });\n        },\n\n        _highlightSelectedItems: function () {\n            for (var i = 0; i < this._selectedDataItems.length; i++) {\n                var item = this._getElementByDataItem(this._selectedDataItems[i]);\n                if(item.length){\n                    item.addClass(SELECTED);\n                }\n            }\n        },\n\n        refresh: function(e) {\n            var that = this;\n            var action = e && e.action;\n            var isItemChange = action === \"itemchange\";\n            var filtered = this.isFiltered();\n            var result;\n\n            if (that._mute) { return; }\n\n            that._deferValueSet = false;\n\n            if (!that._fetching) {\n                if (filtered) {\n                    that.focus(0);\n                }\n\n                that._createList();\n                if (!action && that._values.length && !filtered &&\n                     !that.options.skipUpdateOnBind && !that._emptySearch) {\n                    that._selectingValue = true;\n\n                    that.bound(true);\n                    that.value(that._values, true).done(function () {\n                        that._selectingValue = false;\n                        that._triggerListBound();\n                    });\n                } else {\n                    that.bound(true);\n                    that._highlightSelectedItems();\n                    that._triggerListBound();\n                }\n            } else {\n                if (that._renderItems) {\n                    that._renderItems(true);\n                }\n\n                that._triggerListBound();\n            }\n\n            if (isItemChange || action === \"remove\") {\n                result = mapChangedItems(that._selectedDataItems, e.items);\n                if (result.changed.length) {\n                    if (isItemChange) {\n                        that.trigger(\"selectedItemChange\", {\n                            items: result.changed\n                        });\n                    } else {\n                        that.value(that._getValues(result.unchanged));\n                    }\n                }\n            }\n\n            that._fetching = false;\n        },\n\n        removeAt: function(position) {\n            var value = this._values.splice(position, 1)[0];\n\n            return {\n                position: position,\n                dataItem: this._removeSelectedDataItem(value)\n            };\n        },\n\n        _removeSelectedDataItem: function (value) {\n            var that = this,\n                valueGetter = that._valueGetter;\n\n            for (var idx in that._selectedDataItems) {\n                if(valueGetter(that._selectedDataItems[idx]) === value) {\n                    that._selectedIndexes.splice(idx, 1);\n                    return that._selectedDataItems.splice(idx, 1)[0];\n                }\n            }\n        },\n\n        setValue: function(value) {\n            this._values = toArray(value);\n        },\n\n        value: function(value, _forcePrefetch) {\n            var that = this;\n\n            if (value === undefined) {\n                return that._values.slice();\n            }\n\n            if (value === null) {\n                value = [];\n            }\n\n            value = toArray(value);\n\n            if (!that._valueDeferred || that._valueDeferred.state() === \"resolved\") {\n                that._valueDeferred = $.Deferred();\n            }\n\n            var shouldClear = that.options.selectable === \"multiple\" && that.select().length && value.length;\n\n            if (shouldClear || !value.length) {\n                that.select(-1);\n            }\n\n            that._values = value;\n\n            if ((that.bound() && !that._mute && !that._deferValueSet) || _forcePrefetch) {\n                that._prefetchByValue(value);\n            }\n\n            return that._valueDeferred;\n        },\n\n        _checkValuesOrder: function (value) {\n            if (this._removedAddedIndexes &&\n                this._removedAddedIndexes.length === value.length) {\n                    var newValue = this._removedAddedIndexes.slice();\n                    this._removedAddedIndexes = null;\n                return newValue;\n            }\n\n            return value;\n        },\n\n        _prefetchByValue: function(value) {\n            var that = this,\n                dataView = that._dataView,\n                valueGetter = that._valueGetter,\n                mapValueTo = that.options.mapValueTo,\n                item, match = false,\n                forSelection = [];\n\n            //try to find the items in the loaded data\n            for (var i = 0; i < value.length; i++) {\n                for (var idx = 0; idx < dataView.length; idx++) {\n                    item = dataView[idx].item;\n                    if (item) {\n                        match = isPrimitive(item) ? value[i] === item : value[i] === valueGetter(item);\n\n                        if (match) {\n                            forSelection.push(dataView[idx].index);\n                        }\n                    }\n                }\n            }\n\n            if (forSelection.length === value.length) {\n                that._values = [];\n                that.select(forSelection);\n                return;\n            }\n\n            //prefetch the items\n            if (typeof that.options.valueMapper === \"function\") {\n                that.options.valueMapper({\n                    value: (this.options.selectable === \"multiple\") ? value : value[0],\n                    success: function(response) {\n                        if (mapValueTo === \"index\") {\n                            that.mapValueToIndex(response);\n                        } else if (mapValueTo === \"dataItem\") {\n                            that.mapValueToDataItem(response);\n                        }\n                    }\n                });\n            } else {\n                 if (!that.value()[0]) {\n                     that.select([-1]);\n                 } else {\n                    that._selectingValue = false;\n                    that._triggerListBound();\n                 }\n            }\n        },\n\n        mapValueToIndex: function(indexes) {\n            if (indexes === undefined || indexes === -1 || indexes === null) {\n                indexes = [];\n            } else {\n                indexes = toArray(indexes);\n            }\n\n            if (!indexes.length) {\n                indexes = [-1];\n            } else {\n                var removed = this._deselect([]).removed;\n                if (removed.length) {\n                    this._triggerChange(removed, []);\n                }\n            }\n\n            this.select(indexes);\n        },\n\n        mapValueToDataItem: function(dataItems) {\n            var removed, added;\n\n            if (dataItems === undefined || dataItems === null) {\n                dataItems = [];\n            } else {\n                dataItems = toArray(dataItems);\n            }\n\n            if (!dataItems.length) {\n                this.select([-1]);\n            } else {\n                removed = $.map(this._selectedDataItems, function(item, index) {\n                    return { index: index, dataItem: item };\n                });\n\n                added = $.map(dataItems, function(item, index) {\n                    return { index: index, dataItem: item };\n                });\n\n                this._selectedDataItems = dataItems;\n\n                this._selectedIndexes = [];\n\n                for (var i = 0; i < this._selectedDataItems.length; i++) {\n                    var item = this._getElementByDataItem(this._selectedDataItems[i]);\n                    this._selectedIndexes.push(this._getIndecies(item)[0]);\n                    item.addClass(SELECTED);\n                }\n\n                this._triggerChange(removed, added);\n\n                if (this._valueDeferred) {\n                    this._valueDeferred.resolve();\n                }\n            }\n        },\n\n        deferredRange: function(index) {\n            var dataSource = this.dataSource;\n            var take = this.itemCount;\n            var ranges = this._rangesList;\n            var result = $.Deferred();\n            var defs = [];\n\n            var low = Math.floor(index / take) * take;\n            var high = Math.ceil(index / take) * take;\n\n            var pages = high === low ? [ high ] : [ low, high ];\n\n            $.each(pages, function(_, skip) {\n                var end = skip + take;\n                var existingRange = ranges[skip];\n                var deferred;\n\n                if (!existingRange || (existingRange.end !== end)) {\n                    deferred = $.Deferred();\n                    ranges[skip] = { end: end, deferred: deferred };\n\n                    dataSource._multiplePrefetch(skip, take, function() {\n                        deferred.resolve();\n                    });\n                } else {\n                    deferred = existingRange.deferred;\n                }\n\n                defs.push(deferred);\n            });\n\n            $.when.apply($, defs).then(function() {\n                result.resolve();\n            });\n\n            return result;\n        },\n\n        prefetch: function(indexes) {\n            var that = this,\n                take = this.itemCount,\n                isEmptyList = !that._promisesList.length;\n\n            if (!isActivePromise(that._activeDeferred)) {\n                that._activeDeferred = $.Deferred();\n                that._promisesList = [];\n            }\n\n            $.each(indexes, function(_, index) {\n                that._promisesList.push(that.deferredRange(that._getSkip(index, take)));\n            });\n\n            if (isEmptyList) {\n                $.when.apply($, that._promisesList).done(function() {\n                    that._promisesList = [];\n                    that._activeDeferred.resolve();\n                });\n            }\n\n            return that._activeDeferred;\n        },\n\n        _findDataItem: function(view, index) {\n            var group;\n\n            //find in grouped view\n            if (this.options.type === \"group\") {\n                for (var i = 0; i < view.length; i++) {\n                    group = view[i].items;\n                    if (group.length <= index) {\n                        index = index - group.length;\n                    } else {\n                        return group[index];\n                    }\n                }\n            }\n\n            //find in flat view\n            return view[index];\n        },\n\n        _getRange: function(skip, take) {\n            return this.dataSource._findRange(skip, Math.min(skip + take, this.dataSource.total()));\n        },\n\n        dataItemByIndex: function(index) {\n            var that = this;\n            var take = that.itemCount;\n            var skip = that._getSkip(index, take);\n            var view = this._getRange(skip, take);\n\n            //should not return item if data is not loaded\n            if (!that._getRange(skip, take).length) {\n                return null;\n            }\n\n            if (that.options.type === \"group\") {\n                kendo.ui.progress($(that.wrapper), true);\n                that.mute(function() {\n                    that.dataSource.range(skip, take, function () {\n                        kendo.ui.progress($(that.wrapper), false);\n                    });\n                    view = that.dataSource.view();\n                });\n            }\n\n            return that._findDataItem(view, [index - skip]);\n        },\n\n        selectedDataItems: function() {\n            return this._selectedDataItems.slice();\n        },\n\n        scrollWith: function(value) {\n            this.content.scrollTop(this.content.scrollTop() + value);\n        },\n\n        scrollTo: function(y) {\n            this.content.scrollTop(y); //works only if the element is visible\n        },\n\n        scrollToIndex: function(index) {\n            this.scrollTo(index * this.options.itemHeight);\n        },\n\n        focus: function(candidate) {\n            var element,\n                index,\n                data,\n                current,\n                itemHeight = this.options.itemHeight,\n                id = this._optionID,\n                triggerEvent = true;\n\n            if (candidate === undefined) {\n                current = this.element.find(\".\" + FOCUSED);\n                return current.length ? current : null;\n            }\n\n            if (typeof candidate === \"function\") {\n                data = this.dataSource.flatView();\n                for (var idx = 0; idx < data.length; idx++) {\n                    if (candidate(data[idx])) {\n                        candidate = idx;\n                        break;\n                    }\n                }\n            }\n\n            if (candidate instanceof Array) {\n                candidate = lastFrom(candidate);\n            }\n\n            if (isNaN(candidate)) {\n                element = $(candidate);\n                index = parseInt($(element).attr(\"data-offset-index\"), 10);\n            } else {\n                index = candidate;\n                element = this._getElementByIndex(index);\n            }\n\n            if (index === -1) {\n                this.element.find(\".\" + FOCUSED).removeClass(FOCUSED);\n                this._focusedIndex = undefined;\n                return;\n            }\n\n            if (element.length) { /*focus rendered item*/\n                if (element.hasClass(FOCUSED)) {\n                    triggerEvent = false;\n                }\n                if (this._focusedIndex !== undefined) {\n                    current = this._getElementByIndex(this._focusedIndex);\n                    current\n                        .removeClass(FOCUSED)\n                        .removeAttr(\"id\");\n\n                    if (triggerEvent) {\n                        this.trigger(DEACTIVATE);\n                    }\n                }\n\n                this._focusedIndex = index;\n\n                element\n                    .addClass(FOCUSED)\n                    .attr(\"id\", id);\n\n                var position = this._getElementLocation(index);\n\n                if (position === \"top\") {\n                    this.scrollTo(index * itemHeight);\n                } else if (position === \"bottom\") {\n                    this.scrollTo((index * itemHeight + itemHeight) - this._screenHeight);\n                } else if (position === \"outScreen\") {\n                    this.scrollTo(index * itemHeight);\n                }\n\n                if (triggerEvent) {\n                    this.trigger(ACTIVATE);\n                }\n            } else { /*focus non rendered item*/\n                this._focusedIndex = index;\n                this.items().removeClass(FOCUSED);\n                this.scrollToIndex(index);\n            }\n        },\n\n        focusIndex: function() {\n            return this._focusedIndex;\n        },\n\n        focusFirst: function() {\n            this.scrollTo(0);\n            this.focus(0);\n        },\n\n        focusLast: function() {\n            var lastIndex = this.dataSource.total();\n            this.scrollTo(this.heightContainer.offsetHeight);\n            this.focus(lastIndex - 1);\n        },\n\n        focusPrev: function() {\n            var index = this._focusedIndex;\n            var current;\n\n            if (!isNaN(index) && index > 0) {\n                index -= 1;\n                this.focus(index);\n\n                current = this.focus();\n                if (current && current.hasClass(\"k-loading-item\")) {\n                    index += 1;\n                    this.focus(index);\n                }\n\n                return index;\n            } else {\n                index = this.dataSource.total() - 1;\n                this.focus(index);\n                return index;\n            }\n        },\n\n        focusNext: function() {\n            var index = this._focusedIndex;\n            var lastIndex = this.dataSource.total() - 1;\n            var current;\n\n            if (!isNaN(index) && index < lastIndex) {\n                index += 1;\n                this.focus(index);\n\n                current = this.focus();\n                if (current && current.hasClass(\"k-loading-item\")) {\n                    index -= 1;\n                    this.focus(index);\n                }\n\n                return index;\n            } else {\n                index = 0;\n                this.focus(index);\n                return index;\n            }\n        },\n\n        _triggerChange: function(removed, added) {\n            removed = removed || [];\n            added = added || [];\n\n            if (removed.length || added.length) {\n                this.trigger(CHANGE, {\n                    removed: removed,\n                    added: added\n                });\n            }\n        },\n\n        select: function(candidate) {\n            var that = this,\n                indices,\n                initialIndices,\n                singleSelection = that.options.selectable !== \"multiple\",\n                prefetchStarted = isActivePromise(that._activeDeferred),\n                filtered = this.isFiltered(),\n                isAlreadySelected,\n                deferred,\n                result,\n                removed = [];\n\n            if (candidate === undefined) {\n                return that._selectedIndexes.slice();\n            }\n\n            if (!that._selectDeferred || that._selectDeferred.state() === \"resolved\") {\n                that._selectDeferred = $.Deferred();\n            }\n\n            indices = that._getIndecies(candidate);\n            isAlreadySelected = singleSelection && !filtered && lastFrom(indices) === lastFrom(this._selectedIndexes);\n            removed = that._deselectCurrentValues(indices);\n\n            if (removed.length || !indices.length || isAlreadySelected) {\n                that._triggerChange(removed);\n\n                if (that._valueDeferred) {\n                    that._valueDeferred.resolve().promise();\n                }\n\n                return that._selectDeferred.resolve().promise();\n            }\n\n            if (indices.length === 1 && indices[0] === -1) {\n                indices = [];\n            }\n\n            initialIndices = indices;\n            result = that._deselect(indices);\n            removed = result.removed;\n            indices = result.indices;\n\n            if (singleSelection) {\n                prefetchStarted = false;\n                if (indices.length) {\n                    indices = [lastFrom(indices)];\n                }\n            }\n\n            var done = function() {\n                var added = that._select(indices);\n\n                if (initialIndices.length === indices.length || singleSelection) {\n                    that.focus(indices);\n                }\n\n                that._triggerChange(removed, added);\n\n                if (that._valueDeferred) {\n                    that._valueDeferred.resolve();\n                }\n\n                that._selectDeferred.resolve();\n            };\n\n            deferred = that.prefetch(indices);\n\n            if (!prefetchStarted) {\n                if (deferred) {\n                    deferred.done(done);\n                } else {\n                    done();\n                }\n            }\n\n            return that._selectDeferred.promise();\n        },\n\n        bound: function(bound) {\n            if (bound === undefined) {\n                return this._listCreated;\n            }\n\n            this._listCreated = bound;\n        },\n\n        mute: function(callback) {\n            this._mute = true;\n            callback();\n            this._mute = false;\n        },\n\n        setDSFilter: function(filter) {\n            this._lastDSFilter = $.extend({}, filter);\n        },\n\n        isFiltered: function() {\n            if (!this._lastDSFilter) {\n                this.setDSFilter(this.dataSource.filter());\n            }\n\n            return !kendo.data.Query.compareFilters(this.dataSource.filter(), this._lastDSFilter);\n        },\n\n        skipUpdate: $.noop,\n\n        _getElementByIndex: function(index) {\n            return this.items().filter(function(idx, element) {\n                return index === parseInt($(element).attr(\"data-offset-index\"), 10);\n            });\n        },\n\n        _getElementByDataItem: function(dataItem) {\n            var dataView = this._dataView,\n            valueGetter = this._valueGetter,\n                element, match;\n\n            for (var i = 0; i < dataView.length; i++) {\n                match = dataView[i].item && isPrimitive(dataView[i].item) ? dataView[i].item === dataItem : dataView[i].item && dataItem && valueGetter(dataView[i].item) == valueGetter(dataItem);\n                if (match) {\n                    element = dataView[i];\n                    break;\n                }\n            }\n\n            return element ? this._getElementByIndex(element.index) : $();\n        },\n\n        _clean: function() {\n            this.result = undefined;\n            this._lastScrollTop = undefined;\n            this._skip = undefined;\n            $(this.heightContainer).remove();\n            this.heightContainer = undefined;\n            this.element.empty();\n        },\n\n        _height: function() {\n            var hasData = !!this.dataSource.view().length,\n                height = this.options.height,\n                itemHeight = this.options.itemHeight,\n                total = this.dataSource.total();\n\n            if (!hasData) {\n                height = 0;\n            } else if (height/itemHeight > total) {\n                height = total * itemHeight;\n            }\n\n            return height;\n        },\n\n        setScreenHeight: function() {\n            var height = this._height();\n\n            this.content.height(height);\n            this._screenHeight = height;\n        },\n\n        screenHeight: function() {\n            return this._screenHeight;\n        },\n\n        _getElementLocation: function(index) {\n            var scrollTop = this.content.scrollTop(),\n                screenHeight = this._screenHeight,\n                itemHeight = this.options.itemHeight,\n                yPosition = index * itemHeight,\n                yDownPostion = yPosition + itemHeight,\n                screenEnd = scrollTop + screenHeight,\n                position;\n\n            if (yPosition === (scrollTop - itemHeight) || (yDownPostion > scrollTop && yPosition < scrollTop)) {\n                position = \"top\";\n            } else if (yPosition === screenEnd || (yPosition < screenEnd && screenEnd < yDownPostion)) {\n                position = \"bottom\";\n            } else if ((yPosition >= scrollTop) && (yPosition <= scrollTop + (screenHeight - itemHeight))) {\n                position = \"inScreen\";\n            } else {\n                position = \"outScreen\";\n            }\n\n            return position;\n        },\n\n        _templates: function() {\n            var options = this.options;\n            var templates = {\n                template: options.template,\n                placeholderTemplate: options.placeholderTemplate,\n                groupTemplate: options.groupTemplate,\n                fixedGroupTemplate: options.fixedGroupTemplate\n            };\n\n            if (options.columns) {\n                for (var i = 0; i < options.columns.length; i++) {\n                    var currentColumn = options.columns[i];\n                    var templateText = currentColumn.field ? currentColumn.field.toString(): \"text\";\n\n                    templates[\"column\"+ i] = currentColumn.template || \"#: \" + templateText + \"#\";\n                }\n            }\n\n            for (var key in templates) {\n                if (typeof templates[key] !== \"function\") {\n                    templates[key] = kendo.template(templates[key] || \"\");\n                }\n            }\n\n            this.templates = templates;\n        },\n\n        _generateItems: function(element, count) {\n            var items = [],\n                item, text,\n                itemHeight = this.options.itemHeight + \"px\",\n                itemClass = this.options.columns && this.options.columns.length ? TABLE_ITEM : LIST_ITEM;\n\n            while(count-- > 0) {\n                text = document.createElement(\"span\");\n                text.className = \"k-list-item-text\";\n\n                item = document.createElement(\"li\");\n                item.tabIndex = -1;\n                item.className = itemClass;\n                item.setAttribute(\"role\", \"option\");\n                item.style.height = itemHeight;\n                item.style.minHeight = itemHeight;\n                item.appendChild(text);\n\n                element.appendChild(item);\n\n                items.push(item);\n            }\n\n            return items;\n        },\n\n        _saveInitialRanges: function() {\n            var ranges = this.dataSource._ranges;\n            var deferred = $.Deferred();\n            deferred.resolve();\n\n            this._rangesList = {};\n            for (var i = 0; i < ranges.length; i++) {\n                this._rangesList[ranges[i].start] = { end: ranges[i].end, deferred: deferred };\n            }\n        },\n\n        _createList: function() {\n            var that = this,\n                content = that.content.get(0),\n                options = that.options,\n                dataSource = that.dataSource;\n\n            if (that.bound()) {\n                that._clean();\n            }\n\n            that._saveInitialRanges();\n            that._buildValueGetter();\n            that.setScreenHeight();\n            that.itemCount = getItemCount(that._screenHeight, options.listScreens, options.itemHeight);\n\n            if (that.itemCount > dataSource.total()) {\n                that.itemCount = dataSource.total();\n            }\n\n            that._items = that._generateItems(that.element[0], that.itemCount);\n\n            that._setHeight(options.itemHeight * dataSource.total());\n            that.options.type = (dataSource.group() || []).length ? \"group\" : \"flat\";\n\n            if (that.options.type === \"flat\") {\n                if (that.header.closest(GROUP_ROW_SEL).length) {\n                    that.header.closest(GROUP_ROW_SEL).hide();\n                } else {\n                    that.header.hide();\n                }\n            } else {\n                if (that.header.closest(GROUP_ROW_SEL).length) {\n                    that.header.closest(GROUP_ROW_SEL).show();\n                } else {\n                    that.header.show();\n                }\n            }\n\n            that.getter = that._getter(function() {\n                that._renderItems(true);\n            });\n\n            that._onScroll = function(scrollTop, force) {\n                var getList = that._listItems(that.getter);\n                return that._fixedHeader(scrollTop, getList(scrollTop, force));\n            };\n\n            that._renderItems = that._whenChanged(\n                scrollCallback(content, that._onScroll),\n                syncList(that._reorderList(that._items, render.bind(that)))\n            );\n\n            that._renderItems();\n            that._calculateGroupPadding(that._screenHeight);\n            that._calculateColumnsHeaderPadding();\n        },\n\n        _setHeight: function(height) {\n            var currentHeight,\n                heightContainer = this.heightContainer;\n\n            if (!heightContainer) {\n                heightContainer = this.heightContainer = appendChild(this.content[0], HEIGHTCONTAINER);\n            } else {\n                currentHeight = heightContainer.offsetHeight;\n            }\n\n            if (height !== currentHeight) {\n                heightContainer.innerHTML = \"\";\n\n                while (height > 0) {\n                    var padHeight = Math.min(height, 250000); //IE workaround, should not create elements with height larger than 250000px\n                    appendChild(heightContainer).style.height = padHeight + \"px\";\n                    height -= padHeight;\n                }\n            }\n        },\n\n        _getter: function() {\n            var lastRequestedRange = null,\n                dataSource = this.dataSource,\n                lastRangeStart = dataSource.skip(),\n                type = this.options.type,\n                pageSize = this.itemCount,\n                flatGroups = {};\n\n            if (dataSource.pageSize() < pageSize) {\n                this.mute(function() {\n                    dataSource.pageSize(pageSize);\n                });\n            }\n\n            return function(index, rangeStart) {\n                var that = this;\n                if (!dataSource.inRange(rangeStart, pageSize)) {\n                    if (lastRequestedRange !== rangeStart) {\n                        lastRequestedRange = rangeStart;\n                        lastRangeStart = rangeStart;\n\n                        if (that._getterDeferred) {\n                            that._getterDeferred.reject();\n                        }\n\n                        that._getterDeferred = that.deferredRange(rangeStart);\n                        that._getterDeferred.then(function() {\n                            var firstItemIndex = that._indexConstraint(that.content[0].scrollTop);\n\n                            that._getterDeferred = null;\n\n                            if (rangeStart <= firstItemIndex && firstItemIndex <= (rangeStart + pageSize)) {\n                                that._fetching = true;\n                                dataSource.range(rangeStart, pageSize);\n                            }\n                        });\n                    }\n\n                    return null;\n                } else {\n                    if (lastRangeStart !== rangeStart) {\n                        this.mute(function() {\n                            dataSource.range(rangeStart, pageSize);\n                            lastRangeStart = rangeStart;\n                        });\n                    }\n\n                    var result;\n                    if (type === \"group\") { //grouped list\n                        if (!flatGroups[rangeStart]) {\n                            var flatGroup = flatGroups[rangeStart] = [];\n                            var groups = dataSource.view();\n                            for (var i = 0, len = groups.length; i < len; i++) {\n                                var group = groups[i];\n                                for (var j = 0, groupLength = group.items.length; j < groupLength; j++) {\n                                    flatGroup.push({ item: group.items[j], group: group.value });\n                                }\n                            }\n                        }\n\n                        result = flatGroups[rangeStart][index - rangeStart];\n                    } else { //flat list\n                        result = dataSource.view()[index - rangeStart];\n                    }\n\n                    return result;\n                }\n            };\n        },\n\n        _fixedHeader: function(scrollTop, list) {\n            var group = this.currentVisibleGroup,\n                itemHeight = this.options.itemHeight,\n                firstVisibleDataItemIndex = Math.floor((scrollTop - list.top) / itemHeight),\n                firstVisibleDataItem = list.items[firstVisibleDataItemIndex];\n\n            if (firstVisibleDataItem && firstVisibleDataItem.item) {\n                var firstVisibleGroup = firstVisibleDataItem.group;\n\n                if (firstVisibleGroup !== group) {\n                    var fixedGroupText = firstVisibleGroup || \"\";\n                    this.header.html(this.templates.fixedGroupTemplate(fixedGroupText));\n                    this.currentVisibleGroup = firstVisibleGroup;\n                }\n            }\n\n            return list;\n        },\n\n        _itemMapper: function(item, index, value) {\n            var listType = this.options.type,\n                itemHeight = this.options.itemHeight,\n                currentIndex = this._focusedIndex,\n                selected = false,\n                current = false,\n                newGroup = false,\n                group = null,\n                match = false,\n                valueGetter = this._valueGetter;\n\n            if (listType === \"group\") {\n                if (item) {\n                    newGroup = index === 0 || (this._currentGroup !== false && this._currentGroup !== item.group);\n                    this._currentGroup = item.group;\n                }\n\n                group = item ? item.group : null;\n                item = item ? item.item : null;\n            }\n\n            if (this.options.mapValueTo === \"dataItem\" && this._selectedDataItems.length && item) {\n                for (var i = 0; i < this._selectedDataItems.length; i++) {\n                    match = valueGetter(this._selectedDataItems[i]) === valueGetter(item);\n                    if (match) {\n                        selected = true;\n                        break;\n                    }\n                }\n            } else if (!this.isFiltered() && value.length && item) {\n                for (var j = 0; j < value.length; j++) {\n                    match = isPrimitive(item) ? value[j] === item : value[j] === valueGetter(item);\n                    if (match) {\n                        value.splice(j , 1);\n                        selected = true;\n                        break;\n                    }\n                }\n            }\n\n            if (currentIndex === index) {\n                current = true;\n            }\n\n            return {\n                item: item ? item : null,\n                group: group,\n                newGroup: newGroup,\n                selected: selected,\n                current: current,\n                index: index,\n                top: index * itemHeight\n            };\n        },\n\n        _range: function(index) {\n            var itemCount = this.itemCount,\n                value = this._values.slice(),\n                items = [],\n                item;\n\n            this._view = {};\n            this._currentGroup = false;\n\n            for (var i = index, length = index + itemCount; i < length; i++) {\n                item = this._itemMapper(this.getter(i, index), i, value);\n                if(items[items.length - 1]){\n                    items[items.length - 1].isLastGroupedItem = item.newGroup;\n                }\n                items.push(item);\n                this._view[item.index] = item;\n            }\n\n            this._dataView = items;\n            return items;\n        },\n\n        _getDataItemsCollection: function(scrollTop, lastScrollTop) {\n            var items = this._range(this._listIndex(scrollTop, lastScrollTop));\n            return {\n                index: items.length ? items[0].index : 0,\n                top: items.length ? items[0].top : 0,\n                items: items\n            };\n        },\n\n        _listItems: function() {\n            var screenHeight = this._screenHeight,\n                options = this.options;\n\n            var theValidator = listValidator(options, screenHeight);\n\n            return (function(value, force) {\n                var result = this.result,\n                    lastScrollTop = this._lastScrollTop;\n\n                if (force || !result || !theValidator(result, value, lastScrollTop)) {\n                    result = this._getDataItemsCollection(value, lastScrollTop);\n                }\n\n                this._lastScrollTop = value;\n                this.result = result;\n\n                return result;\n            }).bind(this);\n        },\n\n        _whenChanged: function(getter, callback) {\n            var current;\n\n            return function(force) {\n                var theNew = getter(force);\n\n                if (theNew !== current) {\n                    current = theNew;\n                    callback(theNew, force);\n                }\n            };\n        },\n\n        _reorderList: function(list, reorder) {\n            var that = this;\n            var length = list.length;\n            var currentOffset = -Infinity;\n            reorder = map2(reorder, this.templates).bind(this);\n\n            return function(list2, offset, force) {\n                var diff = offset - currentOffset;\n                var range, range2;\n\n                if (force || Math.abs(diff) >= length) { // full reorder\n                    range = list;\n                    range2 = list2;\n                } else { // partial reorder\n                    range = reshift(list, diff);\n                    range2 = diff > 0 ? list2.slice(-diff) : list2.slice(0, -diff);\n                }\n\n                reorder(range, range2, that.bound());\n\n                currentOffset = offset;\n            };\n        },\n\n        _bufferSizes: function() {\n            var options = this.options;\n\n            return bufferSizes(this._screenHeight, options.listScreens, options.oppositeBuffer);\n        },\n\n        _indexConstraint: function(position) {\n            var itemCount = this.itemCount,\n                itemHeight = this.options.itemHeight,\n                total = this.dataSource.total();\n\n            return Math.min(Math.max(total - itemCount, 0), Math.max(0, Math.floor(position / itemHeight )));\n        },\n\n        _listIndex: function(scrollTop, lastScrollTop) {\n            var buffers = this._bufferSizes(),\n                position;\n\n            position = scrollTop - ((scrollTop > lastScrollTop) ? buffers.down : buffers.up);\n\n            return this._indexConstraint(position);\n        },\n\n        _selectable: function() {\n            var itemClass = this.options.columns && this.options.columns.length ? TABLE_ITEM : LIST_ITEM;\n\n            if (this.options.selectable) {\n                this._selectProxy = this._clickHandler.bind(this);\n                this.element.on(CLICK + VIRTUAL_LIST_NS, \".\" + itemClass, this._selectProxy);\n            }\n        },\n\n        getElementIndex: function(element) {\n            if (!(element instanceof jQuery)) {\n                return undefined;\n            }\n\n            return parseInt(element.attr(\"data-offset-index\"), 10);\n        },\n\n        _getIndecies: function(candidate) {\n            var result = [], data;\n\n            if (typeof candidate === \"function\") {\n                data = this.dataSource.flatView();\n                for (var idx = 0; idx < data.length; idx++) {\n                    if (candidate(data[idx])) {\n                        result.push(idx);\n                        break;\n                    }\n                }\n            }\n\n            if (typeof candidate === \"number\") {\n                result.push(candidate);\n            }\n\n            var elementIndex = this.getElementIndex(candidate);\n            if (!isNaN(elementIndex)) {\n                result.push(elementIndex);\n            }\n\n            if (candidate instanceof Array) {\n                result = candidate;\n            }\n\n            return result;\n        },\n\n        _deselect: function(indices) {\n            var removed = [],\n                selectedIndex,\n                dataItem,\n                selectedIndexes = this._selectedIndexes,\n                selectedDataItems = this._selectedDataItems,\n                position = 0,\n                selectable = this.options.selectable,\n                removedindexesCounter = 0,\n                valueGetter = this._valueGetter,\n                item, match,\n                result = null;\n\n            indices = indices.slice();\n\n            if (selectable === true || !indices.length) { //deselect everything\n                for (var idx = 0; idx < selectedIndexes.length; idx++) {\n                    if (selectedIndexes[idx] !== undefined) {\n                        this._getElementByIndex(selectedIndexes[idx]).removeClass(SELECTED);\n                    } else if (selectedDataItems[idx]) {\n                        this._getElementByDataItem(selectedDataItems[idx]).removeClass(SELECTED);\n                    }\n\n                    removed.push({\n                        index: selectedIndexes[idx],\n                        position: idx,\n                        dataItem: selectedDataItems[idx]\n                    });\n                }\n\n                this._values = [];\n                this._selectedDataItems = [];\n                this._selectedIndexes = [];\n            } else if (selectable === \"multiple\") {\n                for (var i = 0; i < indices.length; i++) {\n                    result = null;\n                    position = $.inArray(indices[i], selectedIndexes);\n                    dataItem = this.dataItemByIndex(indices[i]);\n\n                    if (position === -1 && dataItem) {\n                        for (var j = 0; j < selectedDataItems.length; j++) {\n                            match = isPrimitive(dataItem) ? selectedDataItems[j] === dataItem : valueGetter(selectedDataItems[j]) === valueGetter(dataItem);\n                            if (match) {\n                                item = this._getElementByIndex(indices[i]);\n                                result = this._deselectSingleItem(item, j, indices[i], removedindexesCounter);\n                            }\n                        }\n                    } else {\n                        selectedIndex = selectedIndexes[position];\n\n                        if (selectedIndex !== undefined) {\n                            item = this._getElementByIndex(selectedIndex);\n                            result = this._deselectSingleItem(item, position, selectedIndex, removedindexesCounter);\n                        }\n                    }\n\n                    if (result) {\n                        indices.splice(i, 1);\n                        removed.push(result);\n\n                        removedindexesCounter++;\n                        i--;\n                    }\n                }\n            }\n\n            return {\n                indices: indices,\n                removed: removed\n            };\n        },\n\n        _deselectSingleItem: function(item, position, selectedIndex, removedindexesCounter) {\n            var dataItem;\n\n            if (!item.hasClass(SELECTED)) {\n                return;\n            }\n\n            item.removeClass(SELECTED);\n            this._values.splice(position, 1);\n            this._selectedIndexes.splice(position, 1);\n            dataItem = this._selectedDataItems.splice(position, 1)[0];\n\n            return {\n                index: selectedIndex,\n                position: position + removedindexesCounter,\n                dataItem: dataItem\n            };\n        },\n\n        _deselectCurrentValues: function(indices) {\n            var children = this.element[0].children;\n            var value, index, position;\n            var values = this._values;\n            var removed = [];\n            var idx = 0;\n            var j;\n\n            if (this.options.selectable !== \"multiple\" || !this.isFiltered()) {\n                return [];\n            }\n\n            if (indices[0] === -1) {\n                $(children).removeClass(SELECTED);\n                removed = $.map(this._selectedDataItems.slice(0), function(dataItem, idx) {\n                   return {\n                      dataItem: dataItem,\n                      position: idx\n                   };\n                });\n                this._selectedIndexes = [];\n                this._selectedDataItems = [];\n                this._values = [];\n                return removed;\n            }\n\n            for (; idx < indices.length; idx++) {\n                position = -1;\n                index = indices[idx];\n                if (this.dataItemByIndex(index)) {\n                    value = this._valueGetter(this.dataItemByIndex(index));\n                }\n\n                for (j = 0; j < values.length; j++) {\n                    if (value == values[j]) {\n                        position = j;\n                        break;\n                    }\n                }\n\n                if (position > -1) {\n                    removed.push(this.removeAt(position));\n                    $(children[index]).removeClass(SELECTED);\n                }\n            }\n\n            return removed;\n        },\n\n        _getSkip: function(index, take) {\n            var page = index < take ? 1 : Math.floor(index / take) + 1;\n\n            return (page - 1) * take;\n        },\n\n        _select: function(indexes) {\n            var that = this,\n                singleSelection = this.options.selectable !== \"multiple\",\n                dataSource = this.dataSource,\n                dataItem, oldSkip,\n                take = this.itemCount,\n                valueGetter = this._valueGetter,\n                added = [];\n\n            if (singleSelection) {\n                that._selectedIndexes = [];\n                that._selectedDataItems = [];\n                that._values = [];\n            }\n\n            oldSkip = dataSource.skip();\n\n            $.each(indexes, function(_, index) {\n                var skip = that._getSkip(index, take);\n\n                that.mute(function() {\n                    dataSource.range(skip, take); //switch the range to get the dataItem\n\n                    dataItem = that._findDataItem(dataSource.view(), [index - skip]);\n                    that._selectedIndexes.push(index);\n                    that._selectedDataItems.push(dataItem);\n                    that._values.push(isPrimitive(dataItem) ? dataItem : valueGetter(dataItem));\n\n                    added.push({\n                        index: index,\n                        dataItem: dataItem\n                    });\n\n                    that._getElementByIndex(index).addClass(SELECTED);\n\n                    dataSource.range(oldSkip, take); //switch back the range\n                });\n            });\n\n            that._values = that._checkValuesOrder(that._values);\n\n            return added;\n        },\n\n        _clickHandler: function(e) {\n            var item = $(e.currentTarget);\n\n            if (!e.isDefaultPrevented() && item.attr(\"data-uid\")) {\n                this.trigger(CLICK, { item: item });\n            }\n        },\n\n        _buildValueGetter: function() {\n            this._valueGetter = kendo.getter(this.options.dataValueField);\n        },\n\n        _calculateGroupPadding: function (height) {\n            var firstItem = this.items().first(),\n                groupHeader = this.header,\n                padding = 0;\n\n            if (groupHeader[0] && groupHeader[0].style.display !== \"none\") {\n                if (height !== \"auto\") {\n                    padding = kendo.support.scrollbar();\n                }\n\n                padding += parseFloat(firstItem.css(\"border-right-width\"), 10) + parseFloat(firstItem.children(\".k-group\").css(\"right\"), 10);\n\n                groupHeader.css(\"padding-right\", padding);\n            }\n        },\n\n        _calculateColumnsHeaderPadding: function () {\n            if(this.options.columns && this.options.columns.length){\n                var isRtl = kendo.support.isRtl(this.wrapper);\n                var scrollbar = kendo.support.scrollbar();\n                var columnsHeader = this.content.parent().parent().find(\".k-table-header\");\n                var total = this.dataSource.total();\n\n                columnsHeader.css((isRtl ? \"padding-left\" : \"padding-right\"), total ? scrollbar : 0);\n            }\n        }\n\n    });\n\n    kendo.ui.VirtualList = VirtualList;\n    kendo.ui.plugin(VirtualList);\n\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","depends","hidden","$","window","kendo","jQuery","undefined","ui","Widget","DataBoundWidget","percentageUnitsRegex","LIST_CONTENT","TABLE_CONTENT","HEADER","LIST_ITEM","TABLE_ITEM","HEIGHTCONTAINER","GROUPITEM","LIST_UL","TABLE_LIST","SELECTED","FOCUSED","HOVER","CHANGE","CLICK","LISTBOUND","ITEMCHANGE","ACTIVATE","DEACTIVATE","GROUP_ROW_SEL","VIRTUAL_LIST_NS","lastFrom","array","length","toArray","value","Array","isPrimitive","dataItem","getItemCount","screenHeight","listScreens","itemHeight","Math","ceil","appendChild","parent","className","tagName","element","document","createElement","getDefaultItemHeight","listSize","mockList","lineHeight","css","position","left","visibility","appendTo","body","parseFloat","getComputedStyles","find","height","remove","bufferSizes","opposite","down","up","listValidator","options","downThreshold","threshold","upThreshold","list","scrollTop","lastScrollTop","top","scrollCallback","callback","force","syncList","reorder","items","index","y","style","webkitTransform","transform","map2","templates","arr1","arr2","i","len","item","this","trigger","data","ns","reshift","diff","range","splice","push","apply","unshift","render","itemTemplate","template","hasColumns","columns","altRow","placeholderTemplate","header","group","html","fixedGroupTemplate","angular","elements","attr","uid","addClass","removeClass","renderColumns","toggleClass","current","selected","newGroup","isLastGroupedItem","groupTemplate","append","currentWidth","width","currentWidthInt","parseInt","widthStyle","test","mapChangedItems","itemsToMatch","itemsLength","selectedLength","found","j","changed","unchanged","isActivePromise","promise","state","VirtualList","extend","init","that","contentClasses","bound","_fetching","fn","call","content","wrapper","wrap","thead","closest","row","before","prev","ariaLabel","ariaLabelledBy","on","_values","_selectedDataItems","_selectedIndexes","_rangesList","_promisesList","_optionID","guid","_templates","setDataSource","dataSource","throttle","_renderItems","_triggerListBound","delay","_selectable","autoBind","oppositeBuffer","type","selectable","dataValueField","mapValueTo","valueMapper","events","setOptions","itemClass","_selectProxy","off","refresh","_items","destroy","unbind","_refreshHandler","source","isArray","DataSource","create","_clean","_deferValueSet","mute","bind","setDSFilter","filter","view","fetch","skip","currentRangeStart","_selectingValue","_skip","_getValues","dataItems","getter","_valueGetter","map","_highlightSelectedItems","_getElementByDataItem","e","action","isItemChange","filtered","isFiltered","result","_mute","focus","_createList","skipUpdateOnBind","_emptySearch","done","removeAt","_removeSelectedDataItem","valueGetter","idx","setValue","_forcePrefetch","slice","_valueDeferred","Deferred","shouldClear","select","_prefetchByValue","_checkValuesOrder","_removedAddedIndexes","newValue","dataView","_dataView","match","forSelection","success","response","mapValueToIndex","mapValueToDataItem","indexes","removed","_deselect","_triggerChange","added","_getIndecies","resolve","deferredRange","take","itemCount","ranges","defs","low","floor","high","pages","each","_","end","existingRange","deferred","_multiplePrefetch","when","then","prefetch","isEmptyList","_activeDeferred","_getSkip","_findDataItem","_getRange","_findRange","min","total","dataItemByIndex","progress","selectedDataItems","scrollWith","scrollTo","scrollToIndex","candidate","triggerEvent","flatView","isNaN","_getElementByIndex","_focusedIndex","hasClass","removeAttr","_getElementLocation","_screenHeight","focusIndex","focusFirst","focusLast","lastIndex","heightContainer","offsetHeight","focusPrev","focusNext","indices","initialIndices","singleSelection","prefetchStarted","isAlreadySelected","_selectDeferred","_deselectCurrentValues","_select","_listCreated","_lastDSFilter","Query","compareFilters","skipUpdate","noop","_lastScrollTop","empty","_height","hasData","setScreenHeight","yPosition","yDownPostion","screenEnd","currentColumn","templateText","field","toString","key","_generateItems","count","text","tabIndex","setAttribute","minHeight","_saveInitialRanges","_ranges","start","get","_buildValueGetter","_setHeight","hide","show","_getter","_onScroll","getList","_listItems","_fixedHeader","_whenChanged","_reorderList","_calculateGroupPadding","_calculateColumnsHeaderPadding","currentHeight","innerHTML","padHeight","lastRequestedRange","lastRangeStart","pageSize","flatGroups","rangeStart","inRange","_getterDeferred","reject","firstItemIndex","_indexConstraint","flatGroup","groups","groupLength","currentVisibleGroup","firstVisibleDataItemIndex","firstVisibleDataItem","firstVisibleGroup","fixedGroupText","_itemMapper","listType","currentIndex","_currentGroup","_range","_view","_getDataItemsCollection","_listIndex","theValidator","theNew","currentOffset","Infinity","list2","offset","range2","abs","_bufferSizes","max","buffers","_clickHandler","getElementIndex","elementIndex","selectedIndex","selectedIndexes","removedindexesCounter","inArray","_deselectSingleItem","children","values","page","oldSkip","currentTarget","isDefaultPrevented","firstItem","first","groupHeader","padding","display","support","scrollbar","isRtl","columnsHeader","plugin","amd","a1","a2","a3"],"mappings":"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"}