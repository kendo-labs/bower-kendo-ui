/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.datepicker.min","./kendo.timepicker.min"],e)}(function(){return function(e,t){function n(e){var t=new Date(2100,0,1);return t.setMinutes(-e),t}function i(e){e.preventDefault()}function r(t){var n,i=a.getCulture(t.culture).calendars.standard.patterns;t.format=u(t.format||i.g),t.timeFormat=n=u(t.timeFormat||i.t),a.DateView.normalize(t),-1===e.inArray(n,t.parseFormats)&&t.parseFormats.splice(1,0,n)}var a=window.kendo,o=a.TimeView,s=a.parseDate,l=a._activeElement,u=a._extractFormat,c=a.calendar,d=c.isInRange,f=c.restrictValue,h=c.isEqualDatePart,p=o.getMilliseconds,g=a.ui,m=g.Widget,v="open",_="close",y="change",w=".kendoDateTimePicker",b="click"+w,C="disabled",k="readonly",x="k-state-default",F="k-state-focused",S="k-state-hover",T="k-state-disabled",M="mouseenter"+w+" mouseleave"+w,D="mousedown"+w,A="month",O="<span/>",I="aria-activedescendant",E="aria-expanded",z="aria-hidden",H="aria-owns",P="aria-disabled",N="aria-readonly",R=Date,B=new R(1900,0,1),V=new R(2099,11,31),L={view:"date"},q={view:"time"},j=e.extend,U=m.extend({init:function(e,t){var n,i=this;m.fn.init.call(i,e,t),e=i.element,t=i.options,t.min=s(e.attr("min"))||s(t.min),t.max=s(e.attr("max"))||s(t.max),r(t),i._wrapper(),i._views(),i._icons(),i._reset(),i._template();try{e[0].setAttribute("type","text")}catch(o){e[0].type="text"}e.addClass("k-input").attr({role:"combobox","aria-expanded":!1}),i._midnight=p(t.min)+p(t.max)===0,n=e.is("[disabled]"),n?i.enable(!1):i.readonly(e.is("[readonly]")),i._old=i._update(t.value||i.element.val()),i._oldText=e.val(),a.notify(i)},options:{name:"DateTimePicker",value:null,format:"",timeFormat:"",culture:"",parseFormats:[],dates:[],min:new R(B),max:new R(V),interval:30,height:200,footer:"",start:A,depth:A,animation:{},month:{},ARIATemplate:'Current focused date is #=kendo.toString(data.current, "d")#'},events:[v,_,y],setOptions:function(e){var t,n,i,o=this,l=o._value;m.fn.setOptions.call(o,e),e=o.options,e.min=t=s(e.min),e.max=n=s(e.max),r(e),i=e.value||o._value||o.dateView._current,t&&!h(t,i)&&(t=new R(B)),n&&!h(n,i)&&(n=new R(V)),o.dateView.setOptions(e),o.timeView.setOptions(j({},e,{format:e.timeFormat,min:t,max:n})),l&&(o.element.val(a.toString(l,e.format,e.culture)),o._updateARIA(l))},_editable:function(t){var n=this,r=n.element.off(w),o=n._dateIcon.off(w),s=n._timeIcon.off(w),u=n._inputWrapper.off(w),c=t.readonly,d=t.disable;c||d?(u.addClass(d?T:x).removeClass(d?x:T),r.attr(C,d).attr(k,c).attr(P,d).attr(N,c)):(u.addClass(x).removeClass(T).on(M,n._toggleHover),r.removeAttr(C).removeAttr(k).attr(P,!1).attr(N,!1).on("keydown"+w,e.proxy(n._keydown,n)).on("focus"+w,function(){n._inputWrapper.addClass(F)}).on("blur"+w,function(){n._inputWrapper.removeClass(F),r.val()!==n._oldText&&n._change(r.val()),n.close("date"),n.close("time")}),o.on(D,i).on(b,function(){n.toggle("date"),a.support.touch||r[0]===l()||r.focus()}),s.on(D,i).on(b,function(){n.toggle("time"),a.support.touch||r[0]===l()||r.focus()}))},readonly:function(e){this._editable({readonly:e===t?!0:e,disable:!1})},enable:function(e){this._editable({readonly:!1,disable:!(e=e===t?!0:e)})},destroy:function(){var e=this;m.fn.destroy.call(e),e.dateView.destroy(),e.timeView.destroy(),e.element.off(w),e._dateIcon.off(w),e._timeIcon.off(w),e._inputWrapper.off(w),e._form&&e._form.off("reset",e._resetHandler)},close:function(e){"time"!==e&&(e="date"),this[e+"View"].close()},open:function(e){"time"!==e&&(e="date"),this[e+"View"].open()},min:function(e){return this._option("min",e)},max:function(e){return this._option("max",e)},toggle:function(e){var t="timeView";"time"!==e?e="date":t="dateView",this[e+"View"].toggle(),this[t].close()},value:function(e){var n=this;return e===t?n._value:(n._old=n._update(e),null===n._old&&n.element.val(""),n._oldText=n.element.val(),t)},_change:function(e){var t=this;e=t._update(e),+t._old!=+e&&(t._old=e,t._oldText=t.element.val(),t.trigger(y),t.element.trigger(y))},_option:function(e,i){var r,a,o=this,l=o.options,u=o.timeView,c=u.options,d=o._value||o._old;if(i===t)return l[e];if(i=s(i,l.parseFormats,l.culture)){if(l.min.getTime()===l.max.getTime()&&(c.dates=[]),l[e]=new R(i.getTime()),o.dateView[e](i),o._midnight=p(l.min)+p(l.max)===0,d&&(r=h(l.min,d),a=h(l.max,d)),r||a){if(c[e]=i,r&&!a&&(c.max=n(l.interval)),a){if(o._midnight)return u.dataBind([V]),t;r||(c.min=B)}}else c.max=V,c.min=B;u.bind()}},_toggleHover:function(t){e(t.currentTarget).toggleClass(S,"mouseenter"===t.type)},_update:function(t){var i,r,o,l,u,c=this,p=c.options,g=p.min,m=p.max,v=p.dates,_=c.timeView,y=c._value,w=s(t,p.parseFormats,p.culture),b=null===w&&null===y||w instanceof Date&&y instanceof Date;return+w===+y&&b?(u=a.toString(w,p.format,p.culture),u!==t&&c.element.val(null===w?t:u),w):(null!==w&&h(w,g)?w=f(w,g,m):d(w,g,m)||(w=null),c._value=w,_.value(w),c.dateView.value(w),w&&(o=c._old,r=_.options,v[0]&&(v=e.grep(v,function(e){return h(w,e)}),v[0]&&(_.dataBind(v),l=!0)),l||(h(w,g)&&(r.min=g,r.max=n(p.interval),i=!0),h(w,m)&&(c._midnight?(_.dataBind([V]),l=!0):(r.max=m,i||(r.min=B),i=!0))),!l&&(!o&&i||o&&!h(o,w))&&(i||(r.max=V,r.min=B),_.bind())),c.element.val(w?a.toString(w,p.format,p.culture):t),c._updateARIA(w),w)},_keydown:function(e){var t=this,n=t.dateView,i=t.timeView,r=t.element.val(),o=n.popup.visible();e.altKey&&e.keyCode===a.keys.DOWN?t.toggle(o?"time":"date"):o?(n.move(e),t._updateARIA(n._current)):i.popup.visible()?i.move(e):e.keyCode===a.keys.ENTER&&r!==t._oldText&&t._change(r)},_views:function(){var e,t,n,i,r,l,u=this,c=u.element,f=u.options,h=c.attr("id");u.dateView=e=new a.DateView(j({},f,{id:h,anchor:u.wrapper,change:function(){var t,n=e.calendar.value(),i=+n,r=+f.min,a=+f.max;(i===r||i===a)&&(t=new R(+u._value),t.setFullYear(n.getFullYear(),n.getMonth(),n.getDate()),d(t,r,a)&&(n=t)),u._change(n),u.close("date")},close:function(e){u.trigger(_,L)?e.preventDefault():(c.attr(E,!1),n.attr(z,!0),t.popup.visible()||c.removeAttr(H))},open:function(t){u.trigger(v,L)?t.preventDefault():(u.element.val()!==u._oldText&&(l=s(c.val(),f.parseFormats,f.culture),u.dateView[l?"current":"value"](l)),n.attr(z,!1),c.attr(E,!0).attr(H,e._dateViewID),u._updateARIA(l))}})),n=e.div,r=f.min.getTime(),u.timeView=t=new o({id:h,value:f.value,anchor:u.wrapper,animation:f.animation,format:f.timeFormat,culture:f.culture,height:f.height,interval:f.interval,min:new R(B),max:new R(V),dates:r===f.max.getTime()?[new Date(r)]:[],parseFormats:f.parseFormats,change:function(n,i){n=t._parse(n),f.min>n?(n=new R(+f.min),t.options.min=n):n>f.max&&(n=new R(+f.max),t.options.max=n),i?(u._timeSelected=!0,u._change(n)):(c.val(a.toString(n,f.format,f.culture)),e.value(n),u._updateARIA(n))},close:function(t){u.trigger(_,q)?t.preventDefault():(i.attr(z,!0),c.attr(E,!1),e.popup.visible()||c.removeAttr(H))},open:function(e){t._adjustListWidth(),u.trigger(v,q)?e.preventDefault():(i.attr(z,!1),c.attr(E,!0).attr(H,t._timeViewID),t.options.active(t.current()))},active:function(e){c.removeAttr(I),e&&c.attr(I,t._optionID)}}),i=t.ul},_icons:function(){var t,n=this,i=n.element;t=i.next("span.k-select"),t[0]||(t=e('<span unselectable="on" class="k-select"><span unselectable="on" class="k-icon k-i-calendar">select</span><span unselectable="on" class="k-icon k-i-clock">select</span></span>').insertAfter(i)),t=t.children(),n._dateIcon=t.eq(0).attr({role:"button","aria-controls":n.dateView._dateViewID}),n._timeIcon=t.eq(1).attr({role:"button","aria-controls":n.timeView._timeViewID})},_wrapper:function(){var t,n=this,i=n.element;t=i.parents(".k-datetimepicker"),t[0]||(t=i.wrap(O).parent().addClass("k-picker-wrap k-state-default"),t=t.wrap(O).parent()),t[0].style.cssText=i[0].style.cssText,i.css({width:"100%",height:i[0].style.height}),n.wrapper=t.addClass("k-widget k-datetimepicker k-header").addClass(i[0].className),n._inputWrapper=e(t[0].firstChild)},_reset:function(){var t=this,n=t.element,i=n.attr("form"),r=i?e("#"+i):n.closest("form");r[0]&&(t._resetHandler=function(){t.value(n[0].defaultValue)},t._form=r.on("reset",t._resetHandler))},_template:function(){this._ariaTemplate=a.template(this.options.ARIATemplate)},_updateARIA:function(e){var t,n=this,i=n.dateView.calendar;n.element.removeAttr(I),i&&(t=i._cell,t.attr("aria-label",n._ariaTemplate({current:e||i.current()})),n.element.attr(I,t.attr("id")))}});g.plugin(U)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});