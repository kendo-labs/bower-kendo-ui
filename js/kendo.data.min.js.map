{"version":3,"file":"kendo.data.min.js","sources":["kendo.data.js"],"sourcesContent":["(function(f, define){\n    define('kendo.data',[ \"kendo.core\", \"kendo.data.odata\", \"kendo.data.xml\" ], f);\n})(function(){\n\nvar __meta__ = { // jshint ignore:line\n    id: \"data\",\n    name: \"Data source\",\n    category: \"framework\",\n    description: \"Powerful component for using local and remote data.Fully supports CRUD, Sorting, Paging, Filtering, Grouping, and Aggregates.\",\n    depends: [ \"core\" ],\n    features: [ {\n        id: \"data-odata\",\n        name: \"OData\",\n        description: \"Support for accessing Open Data Protocol (OData) services.\",\n        depends: [ \"data.odata\" ]\n    }, {\n        id: \"data-signalr\",\n        name: \"SignalR\",\n        description: \"Support for binding to SignalR hubs.\",\n        depends: [ \"data.signalr\" ]\n    }, {\n        id: \"data-XML\",\n        name: \"XML\",\n        description: \"Support for binding to XML.\",\n        depends: [ \"data.xml\" ]\n    }]\n};\n\n/*jshint eqnull: true, loopfunc: true, evil: true */\n(function($, undefined) {\n    var extend = $.extend,\n        isPlainObject = $.isPlainObject,\n        isEmptyObject = $.isEmptyObject,\n        isArray = Array.isArray,\n        grep = $.grep,\n        ajax = $.ajax,\n        map,\n        each = $.each,\n        noop = $.noop,\n        kendo = window.kendo,\n        isFunction = kendo.isFunction,\n        Observable = kendo.Observable,\n        Class = kendo.Class,\n        STRING = \"string\",\n        FUNCTION = \"function\",\n        ASCENDING = \"asc\",\n        CREATE = \"create\",\n        READ = \"read\",\n        UPDATE = \"update\",\n        DESTROY = \"destroy\",\n        CHANGE = \"change\",\n        SYNC = \"sync\",\n        GET = \"get\",\n        ERROR = \"error\",\n        REQUESTSTART = \"requestStart\",\n        PROGRESS = \"progress\",\n        REQUESTEND = \"requestEnd\",\n        ITEMSLOADED = \"itemsLoaded\",\n        ITEMLOAD = \"itemLoad\",\n        crud = [CREATE, READ, UPDATE, DESTROY],\n        identity = function(o) { return o; },\n        getter = kendo.getter,\n        stringify = kendo.stringify,\n        math = Math,\n        push = [].push,\n        join = [].join,\n        pop = [].pop,\n        splice = [].splice,\n        shift = [].shift,\n        slice = [].slice,\n        unshift = [].unshift,\n        toString = {}.toString,\n        stableSort = kendo.support.stableSort,\n        dateRegExp = /^\\/Date\\((.*?)\\)\\/$/,\n        objectKeys = [];\n\n    var ObservableArray = Observable.extend({\n        init: function(array, type) {\n            var that = this;\n\n            that.type = type || ObservableObject;\n\n            Observable.fn.init.call(that);\n\n            that.length = array.length;\n\n            that.wrapAll(array, that);\n            that._loadPromises = [];\n            that._loadedNodes = [];\n        },\n\n        at: function(index) {\n            return this[index];\n        },\n\n        toJSON: function(serializeFunctions) {\n            var idx, length = this.length, value, json = new Array(length);\n\n            for (idx = 0; idx < length; idx++){\n                value = this[idx];\n\n                if (value instanceof ObservableObject) {\n                    value = value.toJSON(serializeFunctions);\n                }\n\n                json[idx] = value;\n            }\n\n            return json;\n        },\n\n        parent: noop,\n\n        wrapAll: function(source, target) {\n            var that = this,\n                idx,\n                length,\n                parent = function() {\n                    return that;\n                };\n\n            target = target || [];\n\n            for (idx = 0, length = source.length; idx < length; idx++) {\n                target[idx] = that.wrap(source[idx], parent);\n            }\n\n            return target;\n        },\n\n        wrap: function(object, parent) {\n            var that = this,\n                observable;\n\n            if (object !== null && toString.call(object) === \"[object Object]\") {\n                observable = object instanceof that.type || object instanceof Model;\n\n                if (!observable) {\n                    object = object instanceof ObservableObject ? object.toJSON() : object;\n                    object = new that.type(object);\n                }\n\n                object.parent = parent;\n\n                object.bind(CHANGE, function(e) {\n                    var isGroup = object.hasOwnProperty(\"hasSubgroups\");\n                    that.trigger(CHANGE, {\n                        field: e.field,\n                        node: e.node,\n                        index: e.index,\n                        items: e.items || [this],\n                        action: e.node || isGroup ? (e.action || \"itemloaded\") : \"itemchange\"\n                    });\n                });\n\n                object.bind(ITEMLOAD, function (e) {\n                    that._loadPromises.push(e.promise);\n                    that._loading = true;\n\n                    e.promise.done(function(){\n                        that._loadedNodes.push(e.node);\n                        var index = that._loadPromises.indexOf(e.promise);\n                        that._loadPromises.splice(index, 1);\n\n                        if(!that._loadPromises.length){\n                            that._loading = false;\n                            that.trigger(ITEMSLOADED, {collection: that, nodes: that._loadedNodes});\n                            that._loadedNodes = [];\n                        }\n                    });\n                });\n            }\n\n            return object;\n        },\n\n        loading: function () {\n            return this._loading;\n        },\n\n        push: function() {\n            var index = this.length,\n                items = this.wrapAll(arguments),\n                result;\n\n            result = push.apply(this, items);\n\n            if (!this.omitChangeEvent) {\n                this.trigger(CHANGE, {\n                    action: \"add\",\n                    index: index,\n                    items: items\n                });\n            }\n\n            return result;\n        },\n\n        slice: slice,\n\n        sort: [].sort,\n\n        join: join,\n\n        pop: function() {\n            var length = this.length, result = pop.apply(this);\n\n            if (length) {\n                this.trigger(CHANGE, {\n                    action: \"remove\",\n                    index: length - 1,\n                    items:[result]\n                });\n            }\n\n            return result;\n        },\n\n        splice: function(index, howMany, item) {\n            var items = this.wrapAll(slice.call(arguments, 2)),\n                result, i, len;\n\n            result = splice.apply(this, [index, howMany].concat(items));\n\n            if (result.length) {\n                if (!this.omitChangeEvent) {\n                    this.trigger(CHANGE, {\n                        action: \"remove\",\n                        index: index,\n                        items: result\n                    });\n                }\n\n                for (i = 0, len = result.length; i < len; i++) {\n                    if (result[i] && result[i].children) {\n                        result[i].unbind(CHANGE);\n                    }\n                }\n            }\n\n            if (item) {\n                if (!this.omitChangeEvent) {\n                    this.trigger(CHANGE, {\n                        action: \"add\",\n                        index: index,\n                        items: items\n                    });\n                }\n            }\n            return result;\n        },\n\n        shift: function() {\n            var length = this.length, result = shift.apply(this);\n\n            if (length) {\n                this.trigger(CHANGE, {\n                    action: \"remove\",\n                    index: 0,\n                    items:[result]\n                });\n            }\n\n            return result;\n        },\n\n        unshift: function() {\n            var items = this.wrapAll(arguments),\n                result;\n\n            result = unshift.apply(this, items);\n\n            this.trigger(CHANGE, {\n                action: \"add\",\n                index: 0,\n                items: items\n            });\n\n            return result;\n        },\n\n        indexOf: function(item) {\n            var that = this,\n                idx,\n                length;\n\n            for (idx = 0, length = that.length; idx < length; idx++) {\n                if (that[idx] === item) {\n                    return idx;\n                }\n            }\n            return -1;\n        },\n\n        forEach: function(callback, thisArg) {\n            var idx = 0;\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                callback.call(context, this[idx], idx, this);\n            }\n        },\n\n        map: function(callback, thisArg) {\n            var idx = 0;\n            var result = [];\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                result[idx] = callback.call(context, this[idx], idx, this);\n            }\n\n            return result;\n        },\n\n        reduce: function(callback) {\n            var idx = 0,\n                result,\n                length = this.length;\n\n            if (arguments.length == 2) {\n                result = arguments[1];\n            } else if (idx < length) {\n                result = this[idx++];\n            }\n\n            for (; idx < length; idx++) {\n                result = callback(result, this[idx], idx, this);\n            }\n\n            return result;\n        },\n\n        reduceRight: function(callback) {\n            var idx = this.length - 1,\n                result;\n\n            if (arguments.length == 2) {\n                result = arguments[1];\n            } else if (idx > 0) {\n                result = this[idx--];\n            }\n\n            for (; idx >= 0; idx--) {\n                result = callback(result, this[idx], idx, this);\n            }\n\n            return result;\n        },\n\n        filter: function(callback, thisArg) {\n            var idx = 0;\n            var result = [];\n            var item;\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                item = this[idx];\n                if (callback.call(context, item, idx, this)) {\n                    result[result.length] = item;\n                }\n            }\n\n            return result;\n        },\n\n        find: function(callback, thisArg) {\n            var idx = 0;\n            var item;\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                item = this[idx];\n                if (callback.call(context, item, idx, this)) {\n                    return item;\n                }\n            }\n        },\n\n        every: function(callback, thisArg) {\n            var idx = 0;\n            var item;\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                item = this[idx];\n                if (!callback.call(context, item, idx, this)) {\n                    return false;\n                }\n            }\n\n            return true;\n        },\n\n        some: function(callback, thisArg) {\n            var idx = 0;\n            var item;\n            var length = this.length;\n            var context = thisArg || window;\n\n            for (; idx < length; idx++) {\n                item = this[idx];\n                if (callback.call(context, item, idx, this)) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        // non-standard collection methods\n        remove: function(item) {\n            var idx = this.indexOf(item);\n\n            if (idx !== -1) {\n                this.splice(idx, 1);\n            }\n        },\n\n        empty: function() {\n            this.splice(0, this.length);\n        }\n    });\n\n    // Polyfill for Symbol.iterator\n    if (typeof Symbol !== \"undefined\" && Symbol.iterator && !ObservableArray.prototype[Symbol.iterator]) {\n        ObservableArray.prototype[Symbol.iterator] = [][Symbol.iterator];\n    }\n\n    var LazyObservableArray = ObservableArray.extend({\n        init: function (data, type, events) {\n            var parentFn = function() { return this; };\n\n            Observable.fn.init.call(this);\n\n            this.type = type || ObservableObject;\n\n            if (events) {\n                this._events = events;\n            }\n\n            for (var idx = 0; idx < data.length; idx++) {\n                this[idx] = data[idx];\n            }\n\n            this.length = idx;\n            this._parent = parentFn.bind(this);\n        },\n        at: function(index) {\n            var item = this[index];\n\n            if (!(item instanceof this.type)) {\n                item = this[index] = this.wrap(item, this._parent);\n            } else {\n                item.parent = this._parent;\n            }\n\n            return item;\n        }\n    });\n\n    function eventHandler(context, type, field, prefix) {\n        return function(e) {\n            var event = {}, key;\n\n            for (key in e) {\n                event[key] = e[key];\n            }\n\n            if (prefix) {\n                event.field = field + \".\" + e.field;\n            } else {\n                event.field = field;\n            }\n\n            if (type == CHANGE && context._notifyChange) {\n                context._notifyChange(event);\n            }\n\n            context.trigger(type, event);\n        };\n    }\n\n    function ownKeys (value, ignoreObjectKeys) {\n        var props = [];\n        var keys, filteredObjectKeys;\n\n        value = value || {};\n\n        keys = Object.getOwnPropertyNames(value);\n        filteredObjectKeys = objectKeys.filter(function(key){\n            return keys.indexOf(key) < 0;\n        });\n\n        while (value) {\n            Object.getOwnPropertyNames(value).forEach(function (prop) {\n                if (props.indexOf(prop) === -1 && (!ignoreObjectKeys || filteredObjectKeys.indexOf(prop) < 0)) {\n                    props.push(prop);\n                }\n            });\n            value = Object.getPrototypeOf(value);\n        }\n\n        return props;\n    }\n\n    objectKeys = ownKeys({}, false);\n\n    var ObservableObject = Observable.extend({\n        init: function(value) {\n            var that = this,\n                member,\n                keys = ownKeys(value, true),\n                parent = function() {\n                    return that;\n                };\n\n            Observable.fn.init.call(this);\n\n            this._handlers = {};\n\n            keys.forEach(function(field){\n                member = value[field];\n\n                if (typeof member === \"object\" && member && !member.getTime && field.charAt(0) != \"_\") {\n                    member = that.wrap(member, field, parent);\n                }\n\n                that[field] = member;\n            });\n\n            that.uid = kendo.guid();\n        },\n\n        shouldSerialize: function(field, serializeFunctions) {\n            return this.hasOwnProperty(field) && field !== \"_handlers\" && field !== \"_events\" && ((serializeFunctions && serializeFunctions[field]) || typeof this[field] !== FUNCTION) && field !== \"uid\";\n        },\n\n        forEach: function(f) {\n            for (var i in this) {\n                if (this.shouldSerialize(i)) {\n                    f(this[i], i);\n                }\n            }\n        },\n\n        toJSON: function (serializeFunctions) {\n            var result = {}, value, field;\n\n            for (field in this) {\n                if (this.shouldSerialize(field, serializeFunctions)) {\n                    value = this[field];\n\n                    if (value instanceof ObservableObject || value instanceof ObservableArray) {\n                        value = value.toJSON(serializeFunctions);\n                    }\n\n                    result[field] = value;\n                }\n            }\n\n            return result;\n        },\n\n        get: function(field) {\n            var that = this, result;\n\n            that.trigger(GET, { field: field });\n\n            if (field === \"this\") {\n                result = that;\n            } else {\n                result = kendo.getter(field, true)(that);\n            }\n\n            return result;\n        },\n\n        _set: function(field, value) {\n            var that = this;\n            var composite = field.indexOf(\".\") >= 0;\n\n            if (composite) {\n                var paths = field.split(\".\"),\n                    path = \"\";\n\n                while (paths.length > 1) {\n                    path += paths.shift();\n                    var obj = kendo.getter(path, true)(that);\n                    if (obj instanceof ObservableObject) {\n                        obj.set(paths.join(\".\"), value);\n                        return composite;\n                    }\n                    path += \".\";\n                }\n            }\n\n            kendo.setter(field)(that, value);\n\n            return composite;\n        },\n\n        set: function(field, value) {\n            var that = this,\n                isSetPrevented = false,\n                composite = field.indexOf(\".\") >= 0,\n                current = kendo.getter(field, true)(that);\n\n            if (current !== value) {\n                if (current instanceof Observable && this._handlers[field]) {\n                    if (this._handlers[field].get) {\n                       current.unbind(GET, this._handlers[field].get);\n                    }\n                    current.unbind(CHANGE, this._handlers[field].change);\n                }\n\n                isSetPrevented = that.trigger(\"set\", { field: field, value: value });\n\n                if (!isSetPrevented) {\n                    if (!composite) {\n                        value = that.wrap(value, field, function() { return that; });\n                    }\n                    if (!that._set(field, value) || field.indexOf(\"(\") >= 0 || field.indexOf(\"[\") >= 0) {\n                        that.trigger(CHANGE, { field: field });\n                    }\n                }\n            }\n\n            return isSetPrevented;\n        },\n\n        parent: noop,\n\n        wrap: function(object, field, parent) {\n            var that = this;\n            var get;\n            var change;\n            var type = toString.call(object);\n\n            if (object != null && (type === \"[object Object]\" || type === \"[object Array]\")) {\n                var isObservableArray = object instanceof ObservableArray;\n                var isDataSource = object instanceof DataSource;\n\n                if (type === \"[object Object]\" && !isDataSource && !isObservableArray) {\n                    if (!(object instanceof ObservableObject)) {\n                        object = new ObservableObject(object);\n                    }\n\n                    get = eventHandler(that, GET, field, true);\n                    object.bind(GET, get);\n                    change = eventHandler(that, CHANGE, field, true);\n                    object.bind(CHANGE, change);\n\n                    that._handlers[field] = { get: get, change: change };\n                } else if (type === \"[object Array]\" || isObservableArray || isDataSource) {\n                    if (!isObservableArray && !isDataSource) {\n                        object = new ObservableArray(object);\n                    }\n\n                    change = eventHandler(that, CHANGE, field, false);\n\n                    object.bind(CHANGE, change);\n\n                    that._handlers[field] = { change: change };\n                }\n\n                object.parent = parent;\n            }\n\n            return object;\n        }\n    });\n\n    function equal(x, y) {\n        if (x === y) {\n            return true;\n        }\n\n        var xtype = kendo.type(x), ytype = kendo.type(y), field;\n\n        if (xtype !== ytype) {\n            return false;\n        }\n\n        if (xtype === \"date\") {\n            return x.getTime() === y.getTime();\n        }\n\n        if (xtype !== \"object\" && xtype !== \"array\") {\n            return false;\n        }\n\n        for (field in x) {\n            if (!equal(x[field], y[field])) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    var parsers = {\n        \"number\": function(value) {\n            if (typeof value === STRING && value.toLowerCase() === \"null\") {\n                return null;\n            }\n            return kendo.parseFloat(value);\n        },\n\n        \"date\": function(value) {\n            if (typeof value === STRING && value.toLowerCase() === \"null\") {\n                return null;\n            }\n            return kendo.parseDate(value);\n        },\n\n        \"boolean\": function(value) {\n            if (typeof value === STRING) {\n                if (value.toLowerCase() === \"null\") {\n                    return null;\n                } else {\n                    return value.toLowerCase() === \"true\";\n                }\n            }\n            return value != null ? !!value : value;\n        },\n\n        \"string\": function(value) {\n            if (typeof value === STRING && value.toLowerCase() === \"null\") {\n                return null;\n            }\n            return value != null ? (value + \"\") : value;\n        },\n\n        \"default\": function(value) {\n            return value;\n        }\n    };\n\n    var defaultValues = {\n        \"string\": \"\",\n        \"number\": 0,\n        \"date\": new Date(),\n        \"boolean\": false,\n        \"default\": \"\"\n    };\n\n    function getFieldByName(obj, name) {\n        var field,\n            fieldName;\n\n        for (fieldName in obj) {\n            field = obj[fieldName];\n            if (isPlainObject(field) && field.field && field.field === name) {\n                return field;\n            } else if (field === name) {\n                return field;\n            }\n        }\n        return null;\n    }\n\n    var Model = ObservableObject.extend({\n        init: function(data) {\n            var that = this;\n\n            if (!data || $.isEmptyObject(data)) {\n                data = $.extend({}, that.defaults, data);\n\n                if (that._initializers) {\n                    for (var idx = 0; idx < that._initializers.length; idx++) {\n                         var name = that._initializers[idx];\n                         data[name] = that.defaults[name]();\n                    }\n                }\n            }\n\n            ObservableObject.fn.init.call(that, data);\n\n            that.dirty = false;\n            that.dirtyFields = {};\n\n            if (that.idField) {\n                that.id = that.get(that.idField);\n\n                if (that.id === undefined) {\n                    that.id = that._defaultId;\n                }\n            }\n        },\n\n        shouldSerialize: function(field) {\n            return ObservableObject.fn.shouldSerialize.call(this, field) &&\n                field !== \"uid\" && !(this.idField !== \"id\" && field === \"id\") &&\n                field !== \"dirty\" &&  field !== \"dirtyFields\" && field !== \"_accessors\";\n        },\n\n        _parse: function(field, value) {\n            var that = this,\n                fieldName = field,\n                fields = (that.fields || {}),\n                parse;\n\n            field = fields[field];\n            if (!field) {\n                field = getFieldByName(fields, fieldName);\n            }\n            if (field) {\n                parse = field.parse;\n                if (!parse && field.type) {\n                    parse = parsers[field.type.toLowerCase()];\n                }\n            }\n\n            return parse ? parse(value) : value;\n        },\n\n        _notifyChange: function(e) {\n            var action = e.action;\n\n            if (action == \"add\" || action == \"remove\") {\n                this.dirty = true;\n                this.dirtyFields[e.field] = true;\n            }\n        },\n\n        editable: function(field) {\n            field = (this.fields || {})[field];\n            return field ? field.editable !== false : true;\n        },\n\n        set: function(field, value) {\n            var that = this;\n            var dirty = that.dirty;\n\n            if (that.editable(field)) {\n                value = that._parse(field, value);\n\n                if (!equal(value, that.get(field))) {\n                    that.dirty = true;\n                    that.dirtyFields[field] = true;\n\n                    if (ObservableObject.fn.set.call(that, field, value) && !dirty) {\n                        that.dirty = dirty;\n\n                        if (!that.dirty) {\n                            that.dirtyFields[field] = false;\n                        }\n                    }\n                } else {\n                    that.trigger(\"equalSet\", { field: field, value: value });\n                }\n            }\n        },\n\n        accept: function(data) {\n            var that = this,\n                parent = function() { return that; },\n                field;\n\n            for (field in data) {\n                var value = data[field];\n\n                if (field.charAt(0) != \"_\") {\n                    value = that.wrap(data[field], field, parent);\n                }\n\n                that._set(field, value);\n            }\n\n            if (that.idField) {\n                that.id = that.get(that.idField);\n            }\n\n            that.dirty = false;\n            that.dirtyFields = {};\n        },\n\n        isNew: function() {\n            return this.id === this._defaultId;\n        }\n    });\n\n    Model.define = function(base, options) {\n        if (options === undefined) {\n            options = base;\n            base = Model;\n        }\n\n        var model,\n            proto = extend({ defaults: {} }, options),\n            name,\n            field,\n            type,\n            value,\n            idx,\n            length,\n            fields = {},\n            originalName,\n            id = proto.id,\n            functionFields = [];\n\n        if (id) {\n            proto.idField = id;\n        }\n\n        if (proto.id) {\n            delete proto.id;\n        }\n\n        if (id) {\n            proto.defaults[id] = proto._defaultId = \"\";\n        }\n\n        if (toString.call(proto.fields) === \"[object Array]\") {\n            for (idx = 0, length = proto.fields.length; idx < length; idx++) {\n                field = proto.fields[idx];\n                if (typeof field === STRING) {\n                    fields[field] = {};\n                } else if (field.field) {\n                    fields[field.field] = field;\n                }\n            }\n            proto.fields = fields;\n        }\n\n        for (name in proto.fields) {\n            field = proto.fields[name];\n            type = field.type || \"default\";\n            value = null;\n            originalName = name;\n\n            name = typeof (field.field) === STRING ? field.field : name;\n\n            if (!field.nullable) {\n                value = proto.defaults[originalName !== name ? originalName : name] = field.defaultValue !== undefined ? field.defaultValue : defaultValues[type.toLowerCase()];\n\n                if (typeof value === \"function\") {\n                    functionFields.push(name);\n                }\n            }\n\n            if (options.id === name) {\n                proto._defaultId = value;\n            }\n\n            proto.defaults[originalName !== name ? originalName : name] = value;\n\n            field.parse = field.parse || parsers[type];\n        }\n\n        if (functionFields.length > 0) {\n            proto._initializers = functionFields;\n        }\n\n        model = base.extend(proto);\n        model.define = function(options) {\n            return Model.define(model, options);\n        };\n\n        if (proto.fields) {\n            model.fields = proto.fields;\n            model.idField = proto.idField;\n        }\n\n        return model;\n    };\n\n    var Comparer = {\n        selector: function(field) {\n            return isFunction(field) ? field : getter(field);\n        },\n\n        compare: function(field) {\n            var selector = this.selector(field);\n            return function (a, b) {\n                a = selector(a);\n                b = selector(b);\n\n                if (a == null && b == null) {\n                    return 0;\n                }\n\n                if (a == null) {\n                    return -1;\n                }\n\n                if (b == null) {\n                    return 1;\n                }\n\n                if (a.localeCompare) {\n                    return a.localeCompare(b);\n                }\n\n                return a > b ? 1 : (a < b ? -1 : 0);\n            };\n        },\n\n        create: function(sort) {\n            var compare = sort.compare || this.compare(sort.field);\n\n            if (sort.dir == \"desc\") {\n                return function(a, b) {\n                    return compare(b, a, true);\n                };\n            }\n\n            return compare;\n        },\n\n        combine: function(comparers) {\n            return function(a, b) {\n                var result = comparers[0](a, b),\n                    idx,\n                    length;\n\n                for (idx = 1, length = comparers.length; idx < length; idx ++) {\n                    result = result || comparers[idx](a, b);\n                }\n\n                return result;\n            };\n        }\n    };\n\n    var StableComparer = extend({}, Comparer, {\n        asc: function(field) {\n            var selector = this.selector(field);\n            return function (a, b) {\n                var valueA = selector(a);\n                var valueB = selector(b);\n\n                if (valueA && valueA.getTime && valueB && valueB.getTime) {\n                    valueA = valueA.getTime();\n                    valueB = valueB.getTime();\n                }\n\n                if (valueA === valueB) {\n                    return a.__position - b.__position;\n                }\n\n                if (valueA == null) {\n                    return -1;\n                }\n\n                if (valueB == null) {\n                    return 1;\n                }\n\n                if (valueA.localeCompare) {\n                    return valueA.localeCompare(valueB);\n                }\n\n                return valueA > valueB ? 1 : -1;\n            };\n        },\n\n        desc: function(field) {\n            var selector = this.selector(field);\n            return function (a, b) {\n                var valueA = selector(a);\n                var valueB = selector(b);\n\n                if (valueA && valueA.getTime && valueB && valueB.getTime) {\n                    valueA = valueA.getTime();\n                    valueB = valueB.getTime();\n                }\n\n                if (valueA === valueB) {\n                    return a.__position - b.__position;\n                }\n\n                if (valueA == null) {\n                    return 1;\n                }\n\n                if (valueB == null) {\n                    return -1;\n                }\n\n                if (valueB.localeCompare) {\n                    return valueB.localeCompare(valueA);\n                }\n\n                return valueA < valueB ? 1 : -1;\n            };\n        },\n        create: function(sort) {\n           return this[sort.dir](sort.field);\n        }\n    });\n\n    map = function (array, callback) {\n        var idx, length = array.length, result = new Array(length);\n\n        for (idx = 0; idx < length; idx++) {\n            result[idx] = callback(array[idx], idx, array);\n        }\n\n        return result;\n    };\n\n    var operators = (function(){\n\n        function quote(str) {\n            if (typeof str == \"string\") {\n                str = str.replace(/[\\r\\n]+/g, \"\");\n            }\n            return JSON.stringify(str);\n        }\n\n        function textOp(impl) {\n            return function(a, b, ignore, accentFoldingFiltering) {\n                b += \"\";\n                if (ignore) {\n                    a = \"(\" + a + \" + '').toString()\" + ((accentFoldingFiltering) ? \".toLocaleLowerCase('\" + accentFoldingFiltering  +\"')\" : \".toLowerCase()\");\n                    b = ((accentFoldingFiltering) ? b.toLocaleLowerCase(accentFoldingFiltering) : b.toLowerCase());\n                }\n                return impl(a, quote(b), ignore);\n            };\n        }\n\n        function operator(op, a, b, ignore, accentFoldingFiltering) {\n            if (b != null) {\n                if (typeof b === STRING) {\n                    var date = dateRegExp.exec(b);\n                    if (date) {\n                        b = new Date(+date[1]);\n                    } else if (ignore) {\n                        b = quote(((accentFoldingFiltering) ? b.toLocaleLowerCase(accentFoldingFiltering) : b.toLowerCase()));\n                        a = \"((\" + a + \" || '')+'')\" + ((accentFoldingFiltering) ? \".toLocaleLowerCase('\" + accentFoldingFiltering  +\"')\" : \".toLowerCase()\");\n                    } else {\n                        b = quote(b);\n                    }\n                }\n\n                if (b.getTime) {\n                    //b looks like a Date\n                    a = \"(\" + a + \"&&\" + a + \".getTime?\" + a + \".getTime():\" + a + \")\";\n                    b = b.getTime();\n                }\n            }\n\n            return a + \" \" + op + \" \" + b;\n        }\n\n        function getMatchRegexp(pattern) {\n            // take a pattern, as supported by Excel match filter, and\n            // convert it to the equivalent JS regular expression.\n            // Excel patterns support:\n            //\n            //   * - match any sequence of characters\n            //   ? - match a single character\n            //\n            // to match a literal * or ?, they must be prefixed by a tilde (~)\n            for (var rx = \"/^\", esc = false, i = 0; i < pattern.length; ++i) {\n                var ch = pattern.charAt(i);\n                if (esc) {\n                    rx += \"\\\\\" + ch;\n                } else if (ch == \"~\") {\n                    esc = true;\n                    continue;\n                } else if (ch == \"*\") {\n                    rx += \".*\";\n                } else if (ch == \"?\") {\n                    rx += \".\";\n                } else if (\".+^$()[]{}|\\\\/\\n\\r\\u2028\\u2029\\xA0\".indexOf(ch) >= 0) {\n                    rx += \"\\\\\" + ch;\n                } else {\n                    rx += ch;\n                }\n                esc = false;\n            }\n            return rx + \"$/\";\n        }\n\n        return {\n            quote: function(value) {\n                if (value && value.getTime) {\n                    return \"new Date(\" + value.getTime() + \")\";\n                }\n                return quote(value);\n            },\n            eq: function(a, b, ignore, accentFoldingFiltering) {\n                return operator(\"==\", a, b, ignore, accentFoldingFiltering);\n            },\n            neq: function(a, b, ignore, accentFoldingFiltering) {\n                return operator(\"!=\", a, b, ignore, accentFoldingFiltering);\n            },\n            gt: function(a, b, ignore) {\n                return operator(\">\", a, b, ignore);\n            },\n            gte: function(a, b, ignore) {\n                return operator(\">=\", a, b, ignore);\n            },\n            lt: function(a, b, ignore) {\n                return operator(\"<\", a, b, ignore);\n            },\n            lte: function(a, b, ignore) {\n                return operator(\"<=\", a, b, ignore);\n            },\n            startswith: textOp(function(a, b) {\n                return a + \".lastIndexOf(\" + b + \", 0) == 0\";\n            }),\n            doesnotstartwith: textOp(function(a, b) {\n                return a + \".lastIndexOf(\" + b + \", 0) == -1\";\n            }),\n            endswith: textOp(function(a, b) {\n                var n = b ? b.length - 2 : 0;\n                return a + \".indexOf(\" + b + \", \" + a + \".length - \" + n + \") >= 0\";\n            }),\n            doesnotendwith: textOp(function(a, b) {\n                var n = b ? b.length - 2 : 0;\n                return a + \".indexOf(\" + b + \", \" + a + \".length - \" + n + \") < 0\";\n            }),\n            contains: textOp(function(a, b) {\n                return a + \".indexOf(\" + b + \") >= 0\";\n            }),\n            doesnotcontain: textOp(function(a, b) {\n                return a + \".indexOf(\" + b + \") == -1\";\n            }),\n            matches: textOp(function(a, b){\n                b = b.substring(1, b.length - 1);\n                return getMatchRegexp(b) + \".test(\" + a + \")\";\n            }),\n            doesnotmatch: textOp(function(a, b){\n                b = b.substring(1, b.length - 1);\n                return \"!\" + getMatchRegexp(b) + \".test(\" + a + \")\";\n            }),\n            isempty: function(a) {\n                return a + \" === ''\";\n            },\n            isnotempty: function(a) {\n                return a + \" !== ''\";\n            },\n            isnull: function(a) {\n                return \"(\" + a + \" == null)\";\n            },\n            isnotnull: function(a) {\n                return \"(\" + a + \" != null)\";\n            },\n            isnullorempty: function(a) {\n                return \"(\" + a + \" === null) || (\" + a + \" === '')\";\n            },\n            isnotnullorempty: function(a) {\n                return \"(\" + a + \" !== null) && (\" + a + \" !== '')\";\n            }\n        };\n    })();\n\n    function Query(data) {\n        this.data = data || [];\n    }\n\n    Query.filterExpr = function(expression) {\n        var expressions = [],\n            logic = { and: \" && \", or: \" || \" },\n            idx,\n            length,\n            filter,\n            expr,\n            fieldFunctions = [],\n            operatorFunctions = [],\n            field,\n            operator,\n            filters = expression.filters;\n\n        for (idx = 0, length = filters.length; idx < length; idx++) {\n            filter = filters[idx];\n            field = filter.field;\n            operator = filter.operator;\n\n            if (filter.filters) {\n                expr = Query.filterExpr(filter);\n                //Nested function fields or operators - update their index e.g. __o[0] -> __o[1]\n                filter = expr.expression\n                .replace(/__o\\[(\\d+)\\]/g, function(match, index) {\n                    index = +index;\n                    return \"__o[\" + (operatorFunctions.length + index) + \"]\";\n                })\n                .replace(/__f\\[(\\d+)\\]/g, function(match, index) {\n                    index = +index;\n                    return \"__f[\" + (fieldFunctions.length + index) + \"]\";\n                });\n\n                operatorFunctions.push.apply(operatorFunctions, expr.operators);\n                fieldFunctions.push.apply(fieldFunctions, expr.fields);\n            } else {\n                if (typeof field === FUNCTION) {\n                    expr = \"__f[\" + fieldFunctions.length +\"](d)\";\n                    fieldFunctions.push(field);\n                } else {\n                    expr = kendo.expr(field);\n                }\n\n                if (typeof operator === FUNCTION) {\n                    filter = \"__o[\" + operatorFunctions.length + \"](\" + expr + \", \" + operators.quote(filter.value) + \")\";\n                    operatorFunctions.push(operator);\n                } else {\n                    filter = operators[(operator || \"eq\").toLowerCase()](expr, filter.value, filter.ignoreCase !== undefined? filter.ignoreCase : true, expression.accentFoldingFiltering);\n                }\n            }\n\n            expressions.push(filter);\n        }\n\n        return  { expression: \"(\" + expressions.join(logic[expression.logic]) + \")\", fields: fieldFunctions, operators: operatorFunctions };\n    };\n\n    function normalizeSort(field, dir) {\n        if (field) {\n            var descriptor = typeof field === STRING ? { field: field, dir: dir } : field,\n            descriptors = isArray(descriptor) ? descriptor : (descriptor !== undefined ? [descriptor] : []);\n\n            return grep(descriptors, function(d) { return !!d.dir; });\n        }\n    }\n\n    function sortFields(sorts, dir) {\n        var sortObject = {};\n\n        if (sorts) {\n            var descriptor = typeof sorts === STRING ? { field: sorts, dir: dir } : sorts,\n            descriptors = isArray(descriptor) ? descriptor : (descriptor !== undefined ? [descriptor] : []);\n\n            for (var i = 0; i < descriptors.length; i++) {\n                sortObject[descriptors[i].field] = { dir: descriptors[i].dir, index: i + 1 };\n            }\n        }\n\n        return sortObject;\n    }\n\n    var operatorMap = {\n        \"==\": \"eq\",\n        equals: \"eq\",\n        isequalto: \"eq\",\n        equalto: \"eq\",\n        equal: \"eq\",\n        \"!=\": \"neq\",\n        ne: \"neq\",\n        notequals: \"neq\",\n        isnotequalto: \"neq\",\n        notequalto: \"neq\",\n        notequal: \"neq\",\n        \"<\": \"lt\",\n        islessthan: \"lt\",\n        lessthan: \"lt\",\n        less: \"lt\",\n        \"<=\": \"lte\",\n        le: \"lte\",\n        islessthanorequalto: \"lte\",\n        lessthanequal: \"lte\",\n        \">\": \"gt\",\n        isgreaterthan: \"gt\",\n        greaterthan: \"gt\",\n        greater: \"gt\",\n        \">=\": \"gte\",\n        isgreaterthanorequalto: \"gte\",\n        greaterthanequal: \"gte\",\n        ge: \"gte\",\n        notsubstringof: \"doesnotcontain\",\n        isnull: \"isnull\",\n        isempty: \"isempty\",\n        isnotempty: \"isnotempty\"\n    };\n\n    function normalizeOperator(expression) {\n        var idx,\n        length,\n        filter,\n        operator,\n        filters = expression.filters;\n\n        if (filters) {\n            for (idx = 0, length = filters.length; idx < length; idx++) {\n                filter = filters[idx];\n                operator = filter.operator;\n\n                if (operator && typeof operator === STRING) {\n                    filter.operator = operatorMap[operator.toLowerCase()] || operator;\n                }\n\n                normalizeOperator(filter);\n            }\n        }\n    }\n\n    function normalizeFilter(expression) {\n        if (expression && !isEmptyObject(expression)) {\n            if (isArray(expression) || !expression.filters) {\n                expression = {\n                    logic: \"and\",\n                    filters: isArray(expression) ? expression : [expression]\n                };\n            }\n\n            normalizeOperator(expression);\n\n            return expression;\n        }\n    }\n\n    Query.normalizeFilter = normalizeFilter;\n\n    function compareDescriptor(f1, f2) {\n        if (f1.logic || f2.logic) {\n            return false;\n        }\n\n        return f1.field === f2.field && f1.value === f2.value && f1.operator === f2.operator;\n    }\n\n    function normalizeDescriptor(filter) {\n        filter = filter || {};\n\n        if (isEmptyObject(filter)) {\n            return { logic: \"and\", filters: [] };\n        }\n\n        return normalizeFilter(filter);\n    }\n\n    function fieldComparer(a, b) {\n        if (b.logic || (a.field > b.field)) {\n            return 1;\n        } else if (a.field < b.field) {\n            return -1;\n        } else {\n            return 0;\n        }\n    }\n\n    function compareFilters(expr1, expr2) {\n        expr1 = normalizeDescriptor(expr1);\n        expr2 = normalizeDescriptor(expr2);\n\n        if (expr1.logic !== expr2.logic) {\n            return false;\n        }\n\n        var f1, f2;\n        var filters1 = (expr1.filters || []).slice();\n        var filters2 = (expr2.filters || []).slice();\n\n        if (filters1.length !== filters2.length) {\n            return false;\n        }\n\n        filters1 = filters1.sort(fieldComparer);\n        filters2 = filters2.sort(fieldComparer);\n\n        for (var idx = 0; idx < filters1.length; idx++) {\n            f1 = filters1[idx];\n            f2 = filters2[idx];\n\n            if (f1.logic && f2.logic) {\n                if (!compareFilters(f1, f2)) {\n                    return false;\n                }\n            } else if (!compareDescriptor(f1, f2)) {\n                return false;\n            }\n        }\n\n        return true;\n    }\n\n    Query.compareFilters = compareFilters;\n\n    function normalizeAggregate(expressions) {\n        return isArray(expressions) ? expressions : [expressions];\n    }\n\n    function normalizeGroup(field, dir, compare, skipItemSorting) {\n        var descriptor = typeof field === STRING ? { field: field, dir: dir, compare: compare, skipItemSorting : skipItemSorting } : field,\n        descriptors = isArray(descriptor) ? descriptor : (descriptor !== undefined ? [descriptor] : []);\n\n        return map(descriptors, function(d) {\n            return {\n                field: d.field,\n                dir: d.dir || \"asc\",\n                aggregates: d.aggregates,\n                compare: d.compare,\n                skipItemSorting: d.skipItemSorting\n            };\n        });\n    }\n\n    function normalizeGroupWithoutCompare(field, dir, compare) {\n        var descriptors = normalizeGroup(field, dir, compare);\n\n        for (var i = 0; i < descriptors.length; i++) {\n            delete descriptors[i].compare;\n        }\n\n        return descriptors;\n    }\n\n    function anyGroupDescriptorHasCompare(groupDescriptors) {\n        var descriptors = isArray(groupDescriptors) ? groupDescriptors : [groupDescriptors];\n\n        for (var i = 0; i < descriptors.length; i++) {\n            if (descriptors[i] && isFunction(descriptors[i].compare)) {\n                return true;\n            }\n        }\n\n        return false;\n    }\n\n    Query.prototype = {\n        toArray: function () {\n            return this.data;\n        },\n        range: function(index, count) {\n            return new Query(this.data.slice(index, index + count));\n        },\n        skip: function (count) {\n            return new Query(this.data.slice(count));\n        },\n        take: function (count) {\n            return new Query(this.data.slice(0, count));\n        },\n        select: function (selector) {\n            return new Query(map(this.data, selector));\n        },\n        order: function(selector, dir, inPlace) {\n            var sort = { dir: dir };\n\n            if (selector) {\n                if (selector.compare) {\n                    sort.compare = selector.compare;\n                } else {\n                    sort.field = selector;\n                }\n            }\n\n            if (inPlace) {\n                return new Query(this.data.sort(Comparer.create(sort)));\n            }\n\n            return new Query(this.data.slice(0).sort(Comparer.create(sort)));\n        },\n        orderBy: function(selector, inPlace) {\n            return this.order(selector, \"asc\", inPlace);\n        },\n        orderByDescending: function(selector, inPlace) {\n            return this.order(selector, \"desc\", inPlace);\n        },\n        sort: function(field, dir, comparer, inPlace) {\n            var idx,\n            length,\n            descriptors = normalizeSort(field, dir),\n            comparers = [];\n\n            comparer = comparer || Comparer;\n\n            if (descriptors.length) {\n                for (idx = 0, length = descriptors.length; idx < length; idx++) {\n                    comparers.push(comparer.create(descriptors[idx]));\n                }\n\n                return this.orderBy({ compare: comparer.combine(comparers) }, inPlace);\n            }\n\n            return this;\n        },\n\n        filter: function(expressions) {\n            var idx,\n            current,\n            length,\n            compiled,\n            predicate,\n            data = this.data,\n            fields,\n            operators,\n            result = [],\n            filter;\n\n            expressions = normalizeFilter(expressions);\n\n            if (!expressions || expressions.filters.length === 0) {\n                return this;\n            }\n\n            compiled = Query.filterExpr(expressions);\n            fields = compiled.fields;\n            operators = compiled.operators;\n\n            predicate = filter = new Function(\"d, __f, __o\", \"return \" + compiled.expression);\n\n            if (fields.length || operators.length) {\n                filter = function(d) {\n                    return predicate(d, fields, operators);\n                };\n            }\n\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                current = data[idx];\n\n                if (filter(current)) {\n                    result.push(current);\n                }\n            }\n\n            return new Query(result);\n        },\n\n        group: function(descriptors, allData, options) {\n            descriptors =  normalizeGroup(descriptors || []);\n            allData = allData || this.data;\n\n            var that = this,\n            result = new Query(that.data),\n            descriptor;\n\n            if (descriptors.length > 0) {\n                descriptor = descriptors[0];\n\n                if (options && options.groupPaging) {\n                    result = new Query(allData).groupAllData(descriptor, allData).select(function (group) {\n                        var data = new Query(allData).filter([{\n                            field: group.field,\n                            operator: \"eq\",\n                            value: group.value,\n                            ignoreCase: false\n                        }]);\n                        var items = descriptors.length > 1 ? new Query(group.items).group(descriptors.slice(1), data.toArray(), options).toArray() : group.items;\n                        return {\n                            field: group.field,\n                            value: group.value,\n                            hasSubgroups: descriptors.length > 1,\n                            items: items,\n                            aggregates: data.aggregate(descriptor.aggregates),\n                            uid: kendo.guid(),\n                            itemCount: items.length,\n                            subgroupCount: items.length\n                        };\n                    });\n\n                } else {\n                    result = result.groupBy(descriptor).select(function(group) {\n                        var data = new Query(allData).filter([ { field: group.field, operator: \"eq\", value: group.value, ignoreCase: false } ]);\n                        return {\n                            field: group.field,\n                            value: group.value,\n                            items: descriptors.length > 1 ? new Query(group.items).group(descriptors.slice(1), data.toArray()).toArray() : group.items,\n                            hasSubgroups: descriptors.length > 1,\n                            aggregates: data.aggregate(descriptor.aggregates)\n                        };\n                    });\n                }\n            }\n            return result;\n        },\n\n        groupBy: function(descriptor) {\n            var that = this;\n\n            if (isEmptyObject(descriptor) || !this.data.length) {\n                return new Query([]);\n            }\n\n            var field = descriptor.field,\n                sorted = descriptor.skipItemSorting ? this.data : this._sortForGrouping(field, descriptor.dir || \"asc\"),\n                accessor = kendo.accessor(field),\n                item,\n                groupValue = accessor.get(sorted[0], field),\n                group = {\n                    field: field,\n                    value: groupValue,\n                    items: []\n                },\n                currentValue,\n                idx,\n                len,\n                result = [group];\n\n            for(idx = 0, len = sorted.length; idx < len; idx++) {\n                item = sorted[idx];\n                currentValue = accessor.get(item, field);\n                if(!groupValueComparer(groupValue, currentValue)) {\n                    groupValue = currentValue;\n                    group = {\n                        field: field,\n                        value: groupValue,\n                        items: []\n                    };\n                    result.push(group);\n                }\n                group.items.push(item);\n            }\n\n            result = that._sortGroups(result, descriptor);\n\n            return new Query(result);\n        },\n\n        groupAllData: function (descriptor, allData) {\n            if (isEmptyObject(descriptor) || this.data && !this.data.length) {\n                return new Query([]);\n            }\n\n            var field = descriptor.field,\n                sorted = descriptor.skipItemSorting ? allData : new Query(allData).sort(field, descriptor.dir || \"asc\", StableComparer).toArray(),\n                accessor = kendo.accessor(field),\n                item,\n                groupValue = accessor.get(sorted[0], field),\n                group = {\n                    field: field,\n                    value: groupValue,\n                    items: []\n                },\n                currentValue,\n                idx,\n                len,\n                result = [group];\n\n            for (idx = 0, len = sorted.length; idx < len; idx++) {\n                item = sorted[idx];\n                currentValue = accessor.get(item, field);\n                if (!groupValueComparer(groupValue, currentValue)) {\n                    groupValue = currentValue;\n                    group = {\n                        field: field,\n                        value: groupValue,\n                        items: []\n                    };\n                    result.push(group);\n                }\n                group.items.push(item);\n            }\n\n            result = this._sortGroups(result, descriptor);\n\n            return new Query(result);\n        },\n\n        _sortForGrouping: function(field, dir) {\n            var idx, length,\n                data = this.data;\n\n            if (!stableSort) {\n                for (idx = 0, length = data.length; idx < length; idx++) {\n                    data[idx].__position = idx;\n                }\n\n                data = new Query(data).sort(field, dir, StableComparer).toArray();\n\n                for (idx = 0, length = data.length; idx < length; idx++) {\n                    delete data[idx].__position;\n                }\n                return data;\n            }\n\n            return this.sort(field, dir).toArray();\n        },\n\n        _sortGroups: function(groups, descriptor) {\n            var result = groups;\n\n            if (descriptor && isFunction(descriptor.compare)) {\n                result = new Query(result).order({ compare: descriptor.compare }, descriptor.dir || ASCENDING).toArray();\n            }\n\n            return result;\n        },\n\n        aggregate: function (aggregates) {\n            var idx,\n                len,\n                result = {},\n                state = {};\n\n            if (aggregates && aggregates.length) {\n                for(idx = 0, len = this.data.length; idx < len; idx++) {\n                    calculateAggregate(result, aggregates, this.data[idx], idx, len, state);\n                }\n            }\n            return result;\n        }\n    };\n\n    function groupValueComparer(a, b) {\n        if (a && a.getTime && b && b.getTime) {\n            return a.getTime() === b.getTime();\n        }\n        return a === b;\n    }\n\n    function calculateAggregate(accumulator, aggregates, item, index, length, state) {\n        aggregates = aggregates || [];\n        var idx,\n            aggr,\n            functionName,\n            len = aggregates.length;\n\n        for (idx = 0; idx < len; idx++) {\n            aggr = aggregates[idx];\n            functionName = aggr.aggregate;\n            var field = aggr.field;\n            accumulator[field] = accumulator[field] || {};\n            state[field] = state[field] || {};\n            state[field][functionName] = state[field][functionName] || {};\n            accumulator[field][functionName] = functions[functionName.toLowerCase()](accumulator[field][functionName], item, kendo.accessor(field), index, length, state[field][functionName]);\n        }\n    }\n\n    var functions = {\n        sum: function(accumulator, item, accessor) {\n            var value = accessor.get(item);\n\n            if (!isNumber(accumulator)) {\n                accumulator = value;\n            } else if (isNumber(value)) {\n                accumulator += value;\n            }\n\n            return accumulator;\n        },\n        count: function(accumulator) {\n            return (accumulator || 0) + 1;\n        },\n        average: function(accumulator, item, accessor, index, length, state) {\n            var value = accessor.get(item);\n\n            if (state.count === undefined) {\n                state.count = 0;\n            }\n\n            if (!isNumber(accumulator)) {\n                accumulator = value;\n            } else if (isNumber(value)) {\n                accumulator += value;\n            }\n\n            if (isNumber(value)) {\n                state.count++;\n            }\n\n            if(index == length - 1 && isNumber(accumulator)) {\n                accumulator = accumulator / state.count;\n            }\n            return accumulator;\n        },\n        max: function(accumulator, item, accessor) {\n            var value = accessor.get(item);\n\n            if (!isNumber(accumulator) && !isDate(accumulator)) {\n                accumulator = value;\n            }\n\n            if(accumulator < value && (isNumber(value) || isDate(value))) {\n                accumulator = value;\n            }\n            return accumulator;\n        },\n        min: function(accumulator, item, accessor) {\n            var value = accessor.get(item);\n\n            if (!isNumber(accumulator) && !isDate(accumulator)) {\n                accumulator = value;\n            }\n\n            if(accumulator > value && (isNumber(value) || isDate(value))) {\n                accumulator = value;\n            }\n            return accumulator;\n        }\n    };\n\n    function isNumber(val) {\n        return typeof val === \"number\" && !isNaN(val);\n    }\n\n    function isDate(val) {\n        return val && val.getTime;\n    }\n\n    function toJSON(array) {\n        var idx, length = array.length, result = new Array(length);\n\n        for (idx = 0; idx < length; idx++) {\n            result[idx] = array[idx].toJSON();\n        }\n\n        return result;\n    }\n\n    Query.normalizeGroup = normalizeGroup;\n    Query.normalizeSort = normalizeSort;\n\n    Query.process = function(data, options, inPlace) {\n        options = options || {};\n\n        var group = options.group;\n        var customGroupSort = anyGroupDescriptorHasCompare(normalizeGroup(group || []));\n        var query = new Query(data),\n            groupDescriptorsWithoutCompare = normalizeGroupWithoutCompare(group || []),\n            normalizedSort = normalizeSort(options.sort || []),\n            sort = customGroupSort ? normalizedSort : groupDescriptorsWithoutCompare.concat(normalizedSort),\n            groupDescriptorsWithoutSort,\n            total,\n            filterCallback = options.filterCallback,\n            filter = options.filter,\n            skip = options.skip,\n            take = options.take;\n\n        if (sort && inPlace) {\n            query = query.sort(sort, undefined, undefined, inPlace);\n        }\n\n        if (filter) {\n            query = query.filter(filter);\n\n            if (filterCallback) {\n                query = filterCallback(query);\n            }\n\n            total = query.toArray().length;\n        }\n\n        if (sort) {\n            if (!inPlace) {\n                query = query.sort(sort);\n            }\n\n            if (group) {\n                data = query.toArray();\n            }\n        }\n\n        if (customGroupSort) {\n            query = query.group(group, data, options);\n\n            if (skip !== undefined && take !== undefined && !options.groupPaging) {\n                query = new Query(flatGroups(query.toArray())).range(skip, take);\n\n                groupDescriptorsWithoutSort = map(groupDescriptorsWithoutCompare, function(groupDescriptor) {\n                    return extend({}, groupDescriptor, {\n                        skipItemSorting: true\n                    });\n                });\n\n                query = query.group(groupDescriptorsWithoutSort, data, options);\n            }\n        } else {\n            if (skip !== undefined && take !== undefined) {\n                total = query.data.length;\n\n                if (skip + take > total && options.virtual) {\n                    skip -= skip + take - total;\n                }\n                query = query.range(skip, take);\n            }\n\n            if (group && (!isEmptyObject(group) || group.length !== 0)) {\n                query = query.group(group, data, options);\n            }\n        }\n\n        return {\n            total: total,\n            data: query.toArray()\n        };\n    };\n\n    var LocalTransport = Class.extend({\n        init: function(options) {\n            this.data = options.data;\n        },\n\n        read: function(options) {\n            options.success(this.data);\n        },\n        update: function(options) {\n            options.success(options.data);\n        },\n        create: function(options) {\n            options.success(options.data);\n        },\n        destroy: function(options) {\n            options.success(options.data);\n        }\n    });\n\n    var RemoteTransport = Class.extend( {\n        init: function(options) {\n            var that = this, parameterMap;\n\n            options = that.options = extend({}, that.options, options);\n\n            each(crud, function(index, type) {\n                if (typeof options[type] === STRING) {\n                    options[type] = {\n                        url: options[type]\n                    };\n                }\n            });\n\n            that.cache = options.cache? Cache.create(options.cache) : {\n                find: noop,\n                add: noop\n            };\n\n            parameterMap = options.parameterMap;\n\n            if (options.submit) {\n                that.submit = options.submit;\n            }\n\n            if (isFunction(options.push)) {\n                that.push = options.push;\n            }\n\n            if (!that.push) {\n                that.push = identity;\n            }\n\n            that.parameterMap = isFunction(parameterMap) ? parameterMap : function(options) {\n                var result = {};\n\n                each(options, function(option, value) {\n                    if (option in parameterMap) {\n                        option = parameterMap[option];\n                        if (isPlainObject(option)) {\n                            value = option.value(value);\n                            option = option.key;\n                        }\n                    }\n\n                    result[option] = value;\n                });\n\n                return result;\n            };\n        },\n\n        options: {\n            parameterMap: identity\n        },\n\n        create: function(options) {\n            return ajax(this.setup(options, CREATE));\n        },\n\n        read: function(options) {\n            var that = this,\n                success,\n                error,\n                result,\n                cache = that.cache;\n\n            options = that.setup(options, READ);\n\n            success = options.success || noop;\n            error = options.error || noop;\n\n            result = cache.find(options.data);\n\n            if(result !== undefined) {\n                success(result);\n            } else {\n                options.success = function(result) {\n                    cache.add(options.data, result);\n\n                    success(result);\n                };\n\n                $.ajax(options);\n            }\n        },\n\n        update: function(options) {\n            return ajax(this.setup(options, UPDATE));\n        },\n\n        destroy: function(options) {\n            return ajax(this.setup(options, DESTROY));\n        },\n\n        setup: function(options, type) {\n            options = options || {};\n\n            var that = this,\n                parameters,\n                operation = that.options[type],\n                data = isFunction(operation.data) ? operation.data(options.data) : operation.data;\n\n            options = extend(true, {}, operation, options);\n            parameters = extend(true, {}, data, options.data);\n\n            options.data = that.parameterMap(parameters, type);\n\n            if (isFunction(options.url)) {\n                options.url = options.url(parameters);\n            }\n\n            return options;\n        }\n    });\n\n    var Cache = Class.extend({\n        init: function() {\n            this._store = {};\n        },\n        add: function(key, data) {\n            if(key !== undefined) {\n                this._store[stringify(key)] = data;\n            }\n        },\n        find: function(key) {\n            return this._store[stringify(key)];\n        },\n        clear: function() {\n            this._store = {};\n        },\n        remove: function(key) {\n            delete this._store[stringify(key)];\n        }\n    });\n\n    Cache.create = function(options) {\n        var store = {\n            \"inmemory\": function() { return new Cache(); }\n        };\n\n        if (isPlainObject(options) && isFunction(options.find)) {\n            return options;\n        }\n\n        if (options === true) {\n            return new Cache();\n        }\n\n        return store[options]();\n    };\n\n    function serializeRecords(data, getters, modelInstance, originalFieldNames, fieldNames) {\n        var record,\n            getter,\n            originalName,\n            idx,\n            setters = {},\n            length;\n\n        for (idx = 0, length = data.length; idx < length; idx++) {\n            record = data[idx];\n            for (getter in getters) {\n                originalName = fieldNames[getter];\n\n                if (originalName && originalName !== getter) {\n                    if (!setters[originalName]) {\n                        setters[originalName] = kendo.setter(originalName);\n                    }\n                    setters[originalName](record, getters[getter](record));\n                    delete record[getter];\n                }\n            }\n        }\n    }\n\n    function convertRecords(data, getters, modelInstance, originalFieldNames, fieldNames) {\n        var record,\n            getter,\n            originalName,\n            idx,\n            length;\n\n        for (idx = 0, length = data.length; idx < length; idx++) {\n            record = data[idx];\n            for (getter in getters) {\n                record[getter] = modelInstance._parse(getter, getters[getter](record));\n\n                originalName = fieldNames[getter];\n                if (originalName && originalName !== getter) {\n                    delete record[originalName];\n                }\n            }\n        }\n    }\n\n    function convertGroup(data, getters, modelInstance, originalFieldNames, fieldNames) {\n        var record,\n            idx,\n            fieldName,\n            length;\n\n        for (idx = 0, length = data.length; idx < length; idx++) {\n            record = data[idx];\n\n            fieldName = originalFieldNames[record.field];\n            if (fieldName && fieldName != record.field) {\n                record.field = fieldName;\n            }\n\n            record.value = modelInstance._parse(record.field, record.value);\n\n            if (record.items) {\n                if (record.hasSubgroups) {\n                    convertGroup(record.items, getters, modelInstance, originalFieldNames, fieldNames);\n                } else {\n                    convertRecords(record.items, getters, modelInstance, originalFieldNames, fieldNames);\n                }\n            }\n        }\n    }\n\n    function wrapDataAccess(originalFunction, model, converter, getters, originalFieldNames, fieldNames) {\n        return function(data) {\n            data = originalFunction(data);\n\n            return wrapDataAccessBase(model, converter, getters, originalFieldNames, fieldNames)(data);\n        };\n    }\n\n    function wrapDataAccessBase(model, converter, getters, originalFieldNames, fieldNames) {\n        return function(data) {\n\n            if (data && !isEmptyObject(getters)) {\n                if (toString.call(data) !== \"[object Array]\" && !(data instanceof ObservableArray)) {\n                    data = [data];\n                }\n\n                converter(data, getters, new model(), originalFieldNames, fieldNames);\n            }\n\n            return data || [];\n        };\n    }\n\n    var DataReader = Class.extend({\n        init: function(schema) {\n            var that = this, member, get, model, base;\n\n            schema = schema || {};\n\n            for (member in schema) {\n                get = schema[member];\n\n                that[member] = typeof get === STRING ? getter(get) : get;\n            }\n\n            base = schema.modelBase || Model;\n\n            if (isPlainObject(that.model)) {\n                that.model = model = base.define(that.model);\n            }\n\n            var dataFunction = that.data.bind(that);\n\n            that._dataAccessFunction = dataFunction;\n\n            if (that.model) {\n                var groupsFunction = that.groups.bind(that),\n                    serializeFunction = that.serialize.bind(that),\n                    originalFieldNames = {},\n                    getters = {},\n                    serializeGetters = {},\n                    fieldNames = {},\n                    shouldSerialize = false,\n                    fieldName,\n                    name;\n\n                model = that.model;\n\n                if (model.fields) {\n                    each(model.fields, function(field, value) {\n                        var fromName;\n\n                        fieldName = field;\n\n                        if (isPlainObject(value) && value.field) {\n                            fieldName = value.field;\n                        } else if (typeof value === STRING) {\n                            fieldName = value;\n                        }\n\n                        if (isPlainObject(value) && value.from) {\n                            fromName = value.from;\n                        }\n\n                        shouldSerialize = shouldSerialize || (fromName && fromName !== field) || fieldName !== field;\n                        name = fromName || fieldName;\n                        getters[field] = name.indexOf(\".\") !== -1 ? getter(name, true) : getter(name);\n                        serializeGetters[field] = getter(field);\n                        originalFieldNames[fromName || fieldName] = field;\n                        fieldNames[field] = fromName || fieldName;\n                    });\n\n                    if (!schema.serialize && shouldSerialize) {\n                        that.serialize = wrapDataAccess(serializeFunction, model, serializeRecords, serializeGetters, originalFieldNames, fieldNames);\n                    }\n                }\n\n                that._dataAccessFunction = dataFunction;\n                that._wrapDataAccessBase = wrapDataAccessBase(model, convertRecords, getters, originalFieldNames, fieldNames);\n                that.data = wrapDataAccess(dataFunction, model, convertRecords, getters, originalFieldNames, fieldNames);\n                that.groups = wrapDataAccess(groupsFunction, model, convertGroup, getters, originalFieldNames, fieldNames);\n            }\n        },\n        errors: function(data) {\n            return data ? data.errors : null;\n        },\n        parse: identity,\n        data: identity,\n        total: function(data) {\n            return data.length;\n        },\n        groups: identity,\n        aggregates: function() {\n            return {};\n        },\n        serialize: function(data) {\n            return data;\n        }\n    });\n\n    function fillLastGroup(originalGroup, newGroup) {\n        var currOriginal;\n        var currentNew;\n\n        if (newGroup.items && newGroup.items.length) {\n            for (var i = 0; i < newGroup.items.length; i++) {\n                currOriginal = originalGroup.items[originalGroup.items.length - 1];\n                currentNew = newGroup.items[i];\n                if (currOriginal && currentNew) {\n                    if (currOriginal.hasSubgroups && currOriginal.value == currentNew.value) {\n                        fillLastGroup(currOriginal, currentNew);\n                    } else if (currOriginal.field && currOriginal.value == currentNew.value) {\n                        currOriginal.items.push.apply(currOriginal.items, currentNew.items);\n                    } else {\n                        originalGroup.items.push.apply(originalGroup.items, [currentNew]);\n                    }\n                } else if (currentNew) {\n                    originalGroup.items.push.apply(originalGroup.items, [currentNew]);\n                }\n            }\n        }\n    }\n    function mergeGroups(target, dest, skip, take) {\n        var group,\n            idx = 0,\n            items;\n\n        while (dest.length && take) {\n            group = dest[idx];\n            items = group.items;\n\n            var length = items.length;\n\n            if (target && target.field === group.field && target.value === group.value) {\n                if (target.hasSubgroups && target.items.length) {\n                    mergeGroups(target.items[target.items.length - 1], group.items, skip, take);\n                } else {\n                    items = items.slice(skip, skip + take);\n                    target.items = target.items.concat(items);\n                }\n                dest.splice(idx--, 1);\n            } else if (group.hasSubgroups && items.length) {\n                mergeGroups(group, items, skip, take);\n                if (!group.items.length) {\n                    dest.splice(idx--, 1);\n                }\n            } else {\n                items = items.slice(skip, skip + take);\n                group.items = items;\n\n                if (!group.items.length) {\n                    dest.splice(idx--, 1);\n                }\n            }\n\n            if (items.length === 0) {\n                skip -= length;\n            } else {\n                skip = 0;\n                take -= items.length;\n            }\n\n            if (++idx >= dest.length) {\n                break;\n            }\n        }\n\n        if (idx < dest.length) {\n            dest.splice(idx, dest.length - idx);\n        }\n    }\n\n    function flatGroups(groups, indexFunction) {\n        var result = [];\n        var groupsLength = (groups || []).length;\n        var group;\n        var items;\n        var indexFn = isFunction(indexFunction) ? indexFunction : function(array, index) {\n            return array[index];\n        };\n\n        for (var groupIndex = 0; groupIndex < groupsLength; groupIndex++) {\n            group = indexFn(groups, groupIndex);\n\n            if (group.hasSubgroups) {\n                result = result.concat(flatGroups(group.items));\n            } else {\n                items = group.items;\n\n                for (var itemIndex = 0; itemIndex < items.length; itemIndex++) {\n                    result.push(indexFn(items, itemIndex));\n                }\n            }\n        }\n        return result;\n    }\n\n    function flattenGroups(data) {\n        var idx,\n            result = [],\n            length,\n            items,\n            itemIndex;\n\n        for (idx = 0, length = data.length; idx < length; idx++) {\n            var group = data.at(idx);\n            if (group.items) {\n                if (group.hasSubgroups) {\n                    result = result.concat(flattenGroups(group.items));\n                } else {\n                    items = group.items;\n                    for (itemIndex = 0; itemIndex < items.length; itemIndex++) {\n                        result.push(items.at(itemIndex));\n                    }\n                }\n            }\n        }\n        return result;\n    }\n\n    function wrapGroupItems(data, model) {\n        var idx, length, group;\n        if (model) {\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                group = data.at(idx);\n                if (group.items) {\n                    if (group.hasSubgroups) {\n                        wrapGroupItems(group.items, model);\n                    } else {\n                        group.items = new LazyObservableArray(group.items, model, group.items._events);\n                    }\n                }\n            }\n        }\n    }\n\n    function eachGroupItems(data, func) {\n        for (var idx = 0; idx < data.length; idx++) {\n            if (data[idx].hasSubgroups) {\n                if (eachGroupItems(data[idx].items, func)) {\n                    return true;\n                }\n            } else if (func(data[idx].items, data[idx])) {\n                return true;\n            }\n        }\n    }\n\n    function replaceInRanges(ranges, data, item, observable) {\n        for (var idx = 0; idx < ranges.length; idx++) {\n            if (ranges[idx].data === data) {\n                break;\n            }\n            if (replaceInRange(ranges[idx].data, item, observable)) {\n                break;\n            }\n        }\n    }\n\n    function replaceInRange(items, item, observable) {\n        for (var idx = 0, length = items.length; idx < length; idx++) {\n            if (items[idx] && items[idx].hasSubgroups) {\n                return replaceInRange(items[idx].items, item, observable);\n            } else if (items[idx] === item || items[idx] === observable) {\n               items[idx] = observable;\n               return true;\n            }\n        }\n    }\n\n    function replaceWithObservable(view, data, ranges, type, serverGrouping) {\n        for (var viewIndex = 0, length = view.length; viewIndex < length; viewIndex++) {\n            var item = view[viewIndex];\n\n            if (!item || item instanceof type) {\n                continue;\n            }\n\n            if (item.hasSubgroups !== undefined && !serverGrouping) {\n                replaceWithObservable(item.items, data, ranges, type, serverGrouping);\n            } else {\n                for (var idx = 0; idx < data.length; idx++) {\n                    if (data[idx] === item) {\n                        view[viewIndex] = data.at(idx);\n                        replaceInRanges(ranges, data, item, view[viewIndex]);\n                        break;\n                    }\n                }\n            }\n        }\n    }\n\n    function removeModel(data, model) {\n        if (!data) {\n            return;\n        }\n        var length = data.length;\n        var dataItem;\n        var idx;\n\n        for (idx = 0; idx < length; idx++) {\n            dataItem = data[idx];\n\n            if (dataItem.uid && dataItem.uid == model.uid) {\n                data.splice(idx, 1);\n                return dataItem;\n            }\n        }\n    }\n\n    function indexOfPristineModel(data, model) {\n        if (model) {\n            return indexOf(data, function(item) {\n                return (item.uid && item.uid == model.uid) || (item[model.idField] === model.id && model.id !== model._defaultId);\n            });\n        }\n        return -1;\n    }\n\n    function indexOfModel(data, model) {\n        if (model) {\n            return indexOf(data, function(item) {\n                return item.uid == model.uid;\n            });\n        }\n        return -1;\n    }\n\n    function indexOf(data, comparer) {\n        var idx, length;\n        if (!data) {\n            return;\n        }\n\n        for (idx = 0, length = data.length; idx < length; idx++) {\n            if (comparer(data[idx])) {\n                return idx;\n            }\n        }\n\n        return -1;\n    }\n\n    function fieldNameFromModel(fields, name) {\n        if (fields && !isEmptyObject(fields)) {\n            var descriptor = fields[name];\n            var fieldName;\n            if (isPlainObject(descriptor)) {\n                fieldName = descriptor.from || descriptor.field || name;\n            } else {\n                fieldName = fields[name] || name;\n            }\n\n            if (isFunction(fieldName)) {\n                return name;\n            }\n\n            return fieldName;\n        }\n        return name;\n    }\n\n    function convertFilterDescriptorsField(descriptor, model) {\n        var idx,\n            length,\n            target = {};\n\n        for (var field in descriptor) {\n            if (field !== \"filters\") {\n                target[field] = descriptor[field];\n            }\n        }\n\n        if (descriptor.filters) {\n            target.filters = [];\n            for (idx = 0, length = descriptor.filters.length; idx < length; idx++) {\n                target.filters[idx] = convertFilterDescriptorsField(descriptor.filters[idx], model);\n            }\n        } else {\n            target.field = fieldNameFromModel(model.fields, target.field);\n        }\n        return target;\n    }\n\n    function convertDescriptorsField(descriptors, model) {\n        var idx,\n            length,\n            result = [],\n            target,\n            descriptor;\n\n        for (idx = 0, length = descriptors.length; idx < length; idx ++) {\n            target = {};\n\n            descriptor = descriptors[idx];\n\n            for (var field in descriptor) {\n                target[field] = descriptor[field];\n            }\n\n            target.field = fieldNameFromModel(model.fields, target.field);\n\n            if (target.aggregates && isArray(target.aggregates)) {\n                target.aggregates = convertDescriptorsField(target.aggregates, model);\n            }\n            result.push(target);\n        }\n        return result;\n    }\n\n    var DataSource = Observable.extend({\n        init: function(options) {\n            var that = this, model, data;\n\n            if (options) {\n                data = options.data;\n            }\n\n            options = that.options = extend({}, that.options, options);\n\n            that._map = {};\n            that._prefetch = {};\n            that._data = [];\n            that._pristineData = [];\n            that._ranges = [];\n            that._view = [];\n            that._pristineTotal = 0;\n            that._destroyed = [];\n            that._pageSize = options.pageSize;\n            that._page = options.page  || (options.pageSize ? 1 : undefined);\n            that._sort = normalizeSort(options.sort);\n            that._sortFields = sortFields(options.sort);\n            that._filter = normalizeFilter(options.filter);\n            that._group = normalizeGroup(options.group);\n            that._aggregate = options.aggregate;\n            that._total = options.total;\n            that._groupPaging = options.groupPaging;\n\n            if (that._groupPaging) {\n                that._groupsState = {};\n            }\n            that._shouldDetachObservableParents = true;\n\n            Observable.fn.init.call(that);\n\n            that.transport = Transport.create(options, data, that);\n\n            if (isFunction(that.transport.push)) {\n                that.transport.push({\n                    pushCreate: that._pushCreate.bind(that),\n                    pushUpdate: that._pushUpdate.bind(that),\n                    pushDestroy: that._pushDestroy.bind(that)\n                });\n            }\n\n            if (options.offlineStorage != null) {\n                if (typeof options.offlineStorage == \"string\") {\n                    var key = options.offlineStorage;\n\n                    that._storage = {\n                        getItem: function() {\n                            return JSON.parse(localStorage.getItem(key));\n                        },\n                        setItem: function(item) {\n                            localStorage.setItem(key, stringify(that.reader.serialize(item)));\n                        }\n                    };\n                } else {\n                    that._storage = options.offlineStorage;\n                }\n            }\n\n            that.reader = new kendo.data.readers[options.schema.type || \"json\" ](options.schema);\n\n            model = that.reader.model || {};\n\n            that._detachObservableParents();\n\n            that._data = that._observe(that._data);\n            that._online = true;\n\n            that.bind([\"push\", ERROR, CHANGE, REQUESTSTART, SYNC, REQUESTEND, PROGRESS], options);\n        },\n\n        options: {\n            data: null,\n            schema: {\n               modelBase: Model\n            },\n            offlineStorage: null,\n            serverSorting: false,\n            serverPaging: false,\n            serverFiltering: false,\n            serverGrouping: false,\n            serverAggregates: false,\n            batch: false,\n            inPlaceSort: false\n        },\n\n        clone: function() {\n            return this;\n        },\n\n        online: function(value) {\n            if (value !== undefined) {\n                if (this._online != value) {\n                    this._online = value;\n\n                    if (value) {\n                        return this.sync();\n                    }\n                }\n\n                return $.Deferred().resolve().promise();\n            } else {\n                return this._online;\n            }\n        },\n\n        offlineData: function(state) {\n            if (this.options.offlineStorage == null) {\n                return null;\n            }\n\n            if (state !== undefined) {\n                return this._storage.setItem(state);\n            }\n\n            return this._storage.getItem() || [];\n        },\n\n        _isServerGrouped: function() {\n            var group = this.group() || [];\n\n            return this.options.serverGrouping && group.length;\n        },\n\n        _isServerGroupPaged: function(){\n            return this._isServerGrouped() && this._groupPaging;\n        },\n\n        _isGroupPaged: function(){\n            var group = this._group || [];\n\n            return this._groupPaging && group.length;\n        },\n\n        _pushCreate: function(result) {\n            this._push(result, \"pushCreate\");\n        },\n\n        _pushUpdate: function(result) {\n            this._push(result, \"pushUpdate\");\n        },\n\n        _pushDestroy: function(result) {\n            this._push(result, \"pushDestroy\");\n        },\n\n        _push: function(result, operation) {\n            var data = this._readData(result);\n\n            if (!data) {\n                data = result;\n            }\n\n            this[operation](data);\n        },\n\n        _flatData: function(data, skip) {\n            if (data) {\n                if (this._isServerGrouped()) {\n                    return flattenGroups(data);\n                }\n\n                if (!skip) {\n                    for (var idx = 0; idx < data.length; idx++) {\n                        data.at(idx);\n                    }\n                }\n            }\n\n            return data;\n        },\n\n        parent: noop,\n\n        get: function(id) {\n            var idx, length, data = this._flatData(this._data, this.options.useRanges);\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].id == id) {\n                    return data[idx];\n                }\n            }\n        },\n\n        getByUid: function(id) {\n            return this._getByUid(id, this._data);\n        },\n\n        _getByUid: function(id, dataItems) {\n            var idx, length, data = this._flatData(dataItems, this.options.useRanges);\n\n            if (!data) {\n                return;\n            }\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].uid == id) {\n                    return data[idx];\n                }\n            }\n        },\n\n        indexOf: function(model) {\n            return indexOfModel(this._data, model);\n        },\n\n        at: function(index) {\n            return this._data.at(index);\n        },\n\n        data: function(value) {\n            var that = this;\n            if (value !== undefined) {\n                that._detachObservableParents();\n                that._data = this._observe(value);\n\n                that._pristineData = value.slice(0);\n\n                that._storeData();\n\n                that._ranges = [];\n                that.trigger(\"reset\");\n                that._addRange(that._data);\n\n                that._total = that._data.length;\n                that._pristineTotal = that._total;\n\n                that._process(that._data);\n            } else {\n                if (that._data) {\n                    for (var idx = 0; idx < that._data.length; idx++) {\n                        that._data.at(idx);\n                    }\n                }\n\n                return that._data;\n            }\n        },\n\n        view: function(value) {\n            if (value === undefined) {\n                return this._view;\n            } else {\n                this._view = this._observeView(value);\n            }\n        },\n\n        _observeView: function(data) {\n            var that = this;\n            replaceWithObservable(data, that._data, that._ranges, that.reader.model || ObservableObject, that._isServerGrouped());\n\n            var view = new LazyObservableArray(data, that.reader.model);\n            view.parent = function() { return that.parent(); };\n            return view;\n        },\n\n        flatView: function() {\n            var groups = this.group() || [];\n\n            if (groups.length) {\n                return flattenGroups(this._view);\n            } else {\n                return this._view;\n            }\n        },\n\n        add: function(model) {\n            return this.insert(this._data.length, model);\n        },\n\n        _createNewModel: function(model) {\n            if (this.reader.model) {\n                return new this.reader.model(model);\n            }\n\n            if (model instanceof ObservableObject) {\n                return model;\n            }\n\n            return new ObservableObject(model);\n        },\n\n        insert: function(index, model) {\n            if (!model) {\n                model = index;\n                index = 0;\n            }\n\n            if (!(model instanceof Model)) {\n                model = this._createNewModel(model);\n            }\n\n            if (this._isServerGrouped()) {\n                this._data.splice(index, 0, this._wrapInEmptyGroup(model));\n            } else {\n                this._data.splice(index, 0, model);\n            }\n\n            this._insertModelInRange(index, model);\n\n            return model;\n        },\n\n        pushInsert: function(index, items) {\n            var that = this;\n            var rangeSpan = that._getCurrentRangeSpan();\n\n            if (!items) {\n                items = index;\n                index = 0;\n            }\n\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            var pushed = [];\n            var autoSync = this.options.autoSync;\n            this.options.autoSync = false;\n\n            try {\n                for (var idx = 0; idx < items.length; idx ++) {\n                    var item = items[idx];\n\n                    var result = this.insert(index, item);\n\n                    pushed.push(result);\n\n                    var pristine = result.toJSON();\n\n                    if (this._isServerGrouped()) {\n                        pristine = this._wrapInEmptyGroup(pristine);\n                    }\n\n                    this._pristineData.push(pristine);\n\n                    if (rangeSpan && rangeSpan.length) {\n                        $(rangeSpan).last()[0].pristineData.push(pristine);\n                    }\n\n                    index++;\n                }\n            } finally {\n                this.options.autoSync = autoSync;\n            }\n\n            if (pushed.length) {\n                this.trigger(\"push\", {\n                    type: \"create\",\n                    items: pushed\n                });\n            }\n        },\n\n        pushCreate: function(items) {\n            this.pushInsert(this._data.length, items);\n        },\n\n        pushUpdate: function(items) {\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            var pushed = [];\n\n            for (var idx = 0; idx < items.length; idx ++) {\n                var item = items[idx];\n                var model = this._createNewModel(item);\n\n                var target = this.get(model.id);\n\n                if (target) {\n                    pushed.push(target);\n\n                    target.accept(item);\n\n                    target.trigger(CHANGE);\n\n                    this._updatePristineForModel(target, item);\n                } else {\n                    this.pushCreate(item);\n                }\n            }\n\n            if (pushed.length) {\n                this.trigger(\"push\", {\n                    type: \"update\",\n                    items: pushed\n                });\n            }\n        },\n\n        pushDestroy: function(items) {\n            var pushed = this._removeItems(items);\n\n            if (pushed.length) {\n                this.trigger(\"push\", {\n                    type: \"destroy\",\n                    items: pushed\n                });\n            }\n        },\n\n        _removeItems: function(items, removePristine) {\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            var shouldRemovePristine = typeof removePristine !== \"undefined\" ? removePristine : true;\n\n            var destroyed = [];\n            var autoSync = this.options.autoSync;\n            this.options.autoSync = false;\n            try {\n                for (var idx = 0; idx < items.length; idx ++) {\n                    var item = items[idx];\n                    var model = this._createNewModel(item);\n                    var found = false;\n\n                    this._eachItem(this._data, function(items){\n                        for (var idx = 0; idx < items.length; idx++) {\n                            var item = items.at(idx);\n                            if (item.id === model.id) {\n                                destroyed.push(item);\n                                items.splice(idx, 1);\n                                found = true;\n                                break;\n                            }\n                        }\n                    });\n\n                    if (found && shouldRemovePristine) {\n                        this._removePristineForModel(model);\n                        this._destroyed.pop();\n                    }\n                }\n            } finally {\n                this.options.autoSync = autoSync;\n            }\n\n            return destroyed;\n        },\n\n        pushMove: function(index, items) {\n            var pushed = this._moveItems(index, items);\n\n            if (pushed.length) {\n                this.trigger(\"push\", {\n                    type: \"update\",\n                    items: pushed\n                });\n            }\n        },\n\n        _moveItems: function (index, items) {\n            if (!isArray(items)) {\n                items = [items];\n            }\n\n            var moved = [];\n            var autoSync = this.options.autoSync;\n            this.options.autoSync = false;\n\n            try {\n                for (var i = 0; i < items.length; i ++) {\n                    var item = items[i];\n                    var model = this._createNewModel(item);\n\n                    this._eachItem(this._data, function(dataItems){\n                        for (var idx = 0; idx < dataItems.length; idx++) {\n                            var dataItem = dataItems.at(idx);\n                            if (dataItem.id === model.id) {\n                                moved.push(dataItem);\n                                dataItems.splice(index >= idx ? --index : index, 0, dataItems.splice(idx, 1)[0]);\n                                index++;\n                                break;\n                            }\n                        }\n                    });\n                }\n            } finally {\n                this.options.autoSync = autoSync;\n            }\n\n            return moved;\n        },\n\n        remove: function(model) {\n            var result,\n                that = this,\n                hasGroups = that._isServerGrouped();\n\n            if (hasGroups && model.uid && (!model.isNew || !model.isNew())) {\n                that._destroyed.push(model);\n            }\n\n            this._eachItem(that._data, function(items) {\n                result = removeModel(items, model);\n\n                if (result && hasGroups) {\n                    return true;\n                }\n            });\n\n            this._removeModelFromRanges(model);\n\n            return model;\n        },\n\n        destroyed: function() {\n            return this._destroyed;\n        },\n\n        created: function() {\n            var idx,\n                length,\n                result = [],\n                data = this._flatData(this._data, this.options.useRanges);\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if (data[idx].isNew && data[idx].isNew()) {\n                    result.push(data[idx]);\n                }\n            }\n            return result;\n        },\n\n        updated: function() {\n            var idx,\n                length,\n                result = [],\n                data = this._flatData(this._data, this.options.useRanges);\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if ((data[idx].isNew && !data[idx].isNew()) && data[idx].dirty) {\n                    result.push(data[idx]);\n                }\n            }\n            return result;\n        },\n\n        sync: function() {\n            var that = this,\n                created = [],\n                updated = [],\n                destroyed = that._destroyed;\n\n            var promise = $.Deferred().resolve().promise();\n\n            if (that.online()) {\n\n                if (!that.reader.model) {\n                    return promise;\n                }\n\n                created = that.created();\n                updated = that.updated();\n\n                var promises = [];\n\n                if (that.options.batch && that.transport.submit) {\n                    promises = that._sendSubmit(created, updated, destroyed);\n                } else {\n                    promises.push.apply(promises, that._send(\"create\", created));\n                    promises.push.apply(promises, that._send(\"update\", updated));\n                    promises.push.apply(promises, that._send(\"destroy\", destroyed));\n                }\n\n                promise = $.when\n                 .apply(null, promises)\n                 .then(function() {\n                    var idx, length;\n\n                    for (idx = 0, length = arguments.length; idx < length; idx++){\n                        if (arguments[idx]) {\n                            that._accept(arguments[idx]);\n                        }\n                    }\n\n                    that._storeData(true);\n\n                    that._syncEnd();\n\n                    that._change({ action: \"sync\" });\n\n                    that.trigger(SYNC);\n\n                    if (that._isServerGroupPaged()) {\n                        that.read();\n                    }\n                });\n            } else {\n                that._storeData(true);\n\n                that._syncEnd();\n\n                that._change({ action: \"sync\" });\n            }\n\n            return promise;\n        },\n\n        _syncEnd: noop,\n\n        cancelChanges: function(model) {\n            var that = this;\n\n            if (model instanceof kendo.data.Model) {\n                that._cancelModel(model);\n            } else {\n                that._destroyed = [];\n                that._detachObservableParents();\n                that._data = that._observe(that._pristineData);\n                if (that.options.serverPaging) {\n                    that._total = that._pristineTotal;\n                }\n\n                that._ranges = [];\n                that._addRange(that._data, 0);\n\n                that._changesCanceled();\n\n                that._change();\n\n                that._markOfflineUpdatesAsDirty();\n\n                if (that._isServerGrouped()) {\n                    that.read();\n                }\n            }\n        },\n\n        _changesCanceled: noop,\n\n        _markOfflineUpdatesAsDirty: function() {\n            var that = this;\n\n            if (that.options.offlineStorage != null) {\n                that._eachItem(that._data, function(items) {\n                    for (var idx = 0; idx < items.length; idx++) {\n                        var item = items.at(idx);\n                        if (item.__state__ == \"update\" || item.__state__ == \"create\") {\n                            item.dirty = true;\n                        }\n                    }\n                });\n            }\n        },\n\n        hasChanges: function() {\n            var idx,\n                length,\n                data = this._flatData(this._data, this.options.useRanges);\n\n            if (this._destroyed.length) {\n                return true;\n            }\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                if ((data[idx].isNew && data[idx].isNew()) || data[idx].dirty) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        _accept: function(result) {\n            var that = this,\n                models = result.models,\n                response = result.response,\n                idx = 0,\n                serverGroup = that._isServerGrouped(),\n                pristine = that._pristineData,\n                type = result.type,\n                length;\n\n            that.trigger(REQUESTEND, { response: response, type: type });\n\n            if (response && !isEmptyObject(response)) {\n                response = that.reader.parse(response);\n\n                if (that._handleCustomErrors(response)) {\n                    return;\n                }\n\n                response = that.reader.data(response);\n\n                if (!isArray(response)) {\n                    response = [response];\n                }\n            } else {\n                response = $.map(models, function(model) { return model.toJSON(); } );\n            }\n\n            if (type === \"destroy\") {\n                that._destroyed = [];\n            }\n\n            for (idx = 0, length = models.length; idx < length; idx++) {\n                if (type !== \"destroy\") {\n                    models[idx].accept(response[idx]);\n\n                    if (type === \"create\") {\n                        pristine.push(serverGroup ? that._wrapInEmptyGroup(models[idx].toJSON()) : response[idx]);\n                    } else if (type === \"update\") {\n                        that._updatePristineForModel(models[idx], response[idx]);\n                    }\n                } else {\n                    that._removePristineForModel(models[idx]);\n                }\n            }\n        },\n\n        _updatePristineForModel: function(model, values) {\n            this._executeOnPristineForModel(model, function(index, items) {\n                kendo.deepExtend(items[index], values);\n            });\n        },\n\n        _executeOnPristineForModel: function(model, callback) {\n            this._eachPristineItem(\n                function(items) {\n                    var index = indexOfPristineModel(items, model);\n                    if (index > -1) {\n                        callback(index, items);\n                        return true;\n                    }\n                });\n        },\n\n        _removePristineForModel: function(model) {\n            this._executeOnPristineForModel(model, function(index, items) {\n                items.splice(index, 1);\n            });\n        },\n\n        _readData: function(data) {\n            var read = !this._isServerGrouped() ? this.reader.data : this.reader.groups;\n            return read.call(this.reader, data);\n        },\n\n        _eachPristineItem: function(callback) {\n            var that = this;\n            var options = that.options;\n            var rangeSpan = that._getCurrentRangeSpan();\n\n            that._eachItem(that._pristineData, callback);\n\n            if (options.serverPaging && options.useRanges) {\n                each(rangeSpan, function(i, range) {\n                    that._eachItem(range.pristineData, callback);\n                });\n            }\n        },\n\n       _eachItem: function(data, callback) {\n            if (data && data.length) {\n                if (this._isServerGrouped()) {\n                    eachGroupItems(data, callback);\n                } else {\n                    callback(data);\n                }\n            }\n        },\n\n        _pristineForModel: function(model) {\n            var pristine,\n                idx,\n                callback = function(items) {\n                    idx = indexOfPristineModel(items, model);\n                    if (idx > -1) {\n                        pristine = items[idx];\n                        return true;\n                    }\n                };\n\n            this._eachPristineItem(callback);\n\n            return pristine;\n        },\n\n        _cancelModel: function(model) {\n            var that = this;\n            var pristine = this._pristineForModel(model);\n\n            this._eachItem(this._data, function(items) {\n                var idx = indexOfModel(items, model);\n                if (idx >= 0) {\n                    if (pristine && (!model.isNew() || pristine.__state__)) {\n                        items[idx].accept(pristine);\n\n                        if (pristine.__state__ == \"update\") {\n                            items[idx].dirty = true;\n                        }\n\n                    } else {\n                        that._modelCanceled(model);\n\n                        items.splice(idx, 1);\n\n                        that._removeModelFromRanges(model);\n                    }\n                }\n            });\n        },\n\n        _modelCanceled: noop,\n\n        _submit: function(promises, data) {\n            var that = this;\n\n            that.trigger(REQUESTSTART, { type: \"submit\" });\n\n            that.trigger(PROGRESS);\n\n            that.transport.submit(extend({\n                success: function(response, type) {\n                    var promise = $.grep(promises, function(x) {\n                        return x.type == type;\n                    })[0];\n\n                    if (promise) {\n                        promise.resolve({\n                            response: response,\n                            models: promise.models,\n                            type: type\n                        });\n                    }\n                },\n                error: function(response, status, error) {\n                    for (var idx = 0; idx < promises.length; idx++) {\n                        promises[idx].reject(response);\n                    }\n\n                    that.error(response, status, error);\n                }\n            }, data));\n        },\n\n        _sendSubmit: function(created, updated, destroyed) {\n            var that = this,\n                promises = [];\n\n            if (that.options.batch) {\n                if (created.length) {\n                    promises.push($.Deferred(function(deferred) {\n                        deferred.type = \"create\";\n                        deferred.models = created;\n                    }));\n                }\n\n                if (updated.length) {\n                    promises.push($.Deferred(function(deferred) {\n                        deferred.type = \"update\";\n                        deferred.models = updated;\n                    }));\n                }\n\n                if (destroyed.length) {\n                    promises.push($.Deferred(function(deferred) {\n                        deferred.type = \"destroy\";\n                        deferred.models = destroyed;\n                    }));\n                }\n\n                that._submit(promises, {\n                    data: {\n                        created: that.reader.serialize(toJSON(created)),\n                        updated: that.reader.serialize(toJSON(updated)),\n                        destroyed: that.reader.serialize(toJSON(destroyed))\n                    }\n                });\n            }\n\n            return promises;\n        },\n\n        _promise: function(data, models, type) {\n            var that = this;\n\n            return $.Deferred(function(deferred) {\n                that.trigger(REQUESTSTART, { type: type });\n\n                that.trigger(PROGRESS);\n\n                that.transport[type].call(that.transport, extend({\n                    success: function(response) {\n                        deferred.resolve({\n                            response: response,\n                            models: models,\n                            type: type\n                        });\n                    },\n                    error: function(response, status, error) {\n                        deferred.reject(response);\n                        that.error(response, status, error);\n                    }\n                }, data));\n            }).promise();\n        },\n\n        _send: function(method, data) {\n            var that = this,\n                idx,\n                length,\n                promises = [],\n                converted = that.reader.serialize(toJSON(data));\n\n            if (that.options.batch) {\n                if (data.length) {\n                    promises.push(that._promise( { data: { models: converted } }, data , method));\n                }\n            } else {\n                for (idx = 0, length = data.length; idx < length; idx++) {\n                    promises.push(that._promise( { data: converted[idx] }, [ data[idx] ], method));\n                }\n            }\n\n            return promises;\n        },\n\n        read: function(data) {\n            var that = this, params = that._params(data);\n            var deferred = $.Deferred();\n\n            that._queueRequest(params, function() {\n                var isPrevented = that.trigger(REQUESTSTART, { type: \"read\" });\n                if (!isPrevented) {\n                    that.trigger(PROGRESS);\n\n                    that._ranges = [];\n                    that.trigger(\"reset\");\n                    if (that.online()) {\n                        that.transport.read({\n                            data: params,\n                            success: function(data) {\n                                that._ranges = [];\n                                that.success(data, params);\n\n                                deferred.resolve();\n                            },\n                            error: function() {\n                                var args = slice.call(arguments);\n\n                                that.error.apply(that, args);\n\n                                deferred.reject.apply(deferred, args);\n                            }\n                        });\n                    } else if (that.options.offlineStorage != null){\n                        that.success(that.offlineData(), params);\n\n                        deferred.resolve();\n                    }\n                } else {\n                    that._dequeueRequest();\n\n                    deferred.resolve(isPrevented);\n                }\n            });\n\n            return deferred.promise();\n        },\n\n        _readAggregates: function(data) {\n            return this.reader.aggregates(data);\n        },\n\n        success: function(data) {\n            var that = this,\n                options = that.options,\n                items,\n                replaceSubset;\n\n            that.trigger(REQUESTEND, { response: data, type: \"read\" });\n\n            if (that.online()) {\n                data = that.reader.parse(data);\n\n                if (that._handleCustomErrors(data)) {\n                    that._dequeueRequest();\n                    return;\n                }\n\n                that._total = that.reader.total(data);\n\n                if (that._isServerGroupPaged()) {\n                    that._serverGroupsTotal = that._total;\n                }\n\n                if (that._pageSize > that._total) {\n                    that._pageSize = that._total;\n                    if (that.options.pageSize && that.options.pageSize > that._pageSize) {\n                        that._pageSize = that.options.pageSize;\n                    }\n                }\n\n                if (that._aggregate && options.serverAggregates) {\n                    that._aggregateResult = that._readAggregates(data);\n                }\n\n                data = that._readData(data);\n\n                that._destroyed = [];\n            } else {\n                data = that._readData(data);\n\n                items = [];\n                var itemIds = {};\n                var model = that.reader.model;\n                var idField = model ? model.idField : \"id\";\n                var idx;\n\n                for (idx = 0; idx < this._destroyed.length; idx++) {\n                    var id = this._destroyed[idx][idField];\n                    itemIds[id] = id;\n                }\n\n                for (idx = 0; idx < data.length; idx++) {\n                    var item = data[idx];\n                    var state = item.__state__;\n                    if (state == \"destroy\") {\n                        if (!itemIds[item[idField]]) {\n                            this._destroyed.push(this._createNewModel(item));\n                        }\n                    } else {\n                        items.push(item);\n                    }\n                }\n\n                data = items;\n\n                that._total = data.length;\n            }\n\n            that._pristineTotal = that._total;\n            replaceSubset = that._skip && that._data.length && that._skip < that._data.length;\n\n            if (that.options.endless) {\n                if (replaceSubset) {\n                    that._pristineData.splice(that._skip, that._pristineData.length);\n                }\n                items = data.slice(0);\n                for (var j = 0; j < items.length; j++) {\n                    that._pristineData.push(items[j]);\n                }\n            } else {\n                that._pristineData = data.slice(0);\n            }\n\n            that._detachObservableParents();\n\n            if (that.options.endless) {\n                that._data.unbind(CHANGE, that._changeHandler);\n\n                if (that._isServerGrouped() && that._data[that._data.length - 1].value === data[0].value) {\n                    fillLastGroup(that._data[that._data.length - 1], data[0]);\n                    data.shift();\n                }\n\n                data = that._observe(data);\n                if (replaceSubset) {\n                    that._data.splice(that._skip, that._data.length);\n                }\n                for (var i = 0; i < data.length; i++) {\n                    that._data.push(data[i]);\n                }\n                that._data.bind(CHANGE, that._changeHandler);\n            } else {\n                that._data = that._observe(data);\n            }\n\n            that._markOfflineUpdatesAsDirty();\n\n            that._storeData();\n\n            that._addRange(that._data);\n\n            that._process(that._data);\n\n            that._dequeueRequest();\n        },\n\n        _detachObservableParents: function() {\n            if (this._data && this._shouldDetachObservableParents) {\n                for (var idx = 0; idx < this._data.length; idx++) {\n                    if (this._data[idx].parent) {\n                        this._data[idx].parent = noop;\n                    }\n                }\n            }\n        },\n\n        _storeData: function(updatePristine) {\n            var serverGrouping = this._isServerGrouped();\n            var model = this.reader.model;\n\n            function items(data) {\n                var state = [];\n\n                for (var idx = 0; idx < data.length; idx++) {\n                    var dataItem = data.at(idx);\n                    var item = dataItem.toJSON();\n\n                    if (serverGrouping && dataItem.items) {\n                        item.items = items(dataItem.items);\n                    } else {\n                        item.uid = dataItem.uid;\n\n                        if (model) {\n                            if (dataItem.isNew()) {\n                                item.__state__ = \"create\";\n                            } else if (dataItem.dirty) {\n                                item.__state__ = \"update\";\n                            }\n                        }\n                    }\n                    state.push(item);\n                }\n\n                return state;\n            }\n\n            if (this.options.offlineStorage != null) {\n                var state = items(this._data);\n\n                var destroyed = [];\n\n                for (var idx = 0; idx < this._destroyed.length; idx++) {\n                    var item = this._destroyed[idx].toJSON();\n                    item.__state__ = \"destroy\";\n                    destroyed.push(item);\n                }\n\n                this.offlineData(state.concat(destroyed));\n\n                if (updatePristine) {\n                    this._pristineData = this.reader.reader ? this.reader.reader._wrapDataAccessBase(state) : this.reader._wrapDataAccessBase(state);\n                }\n            }\n        },\n\n        _addRange: function (data, skip) {\n            var that = this,\n                start = typeof (skip) !== \"undefined\" ? skip : (that._skip || 0),\n                end,\n                range = {\n                    data: data,\n                    pristineData: data.toJSON(),\n                    timestamp: that._timeStamp()\n                };\n\n            if (this._isGroupPaged()) {\n                end = start + data.length;\n                range.outerStart = start;\n                range.outerEnd = end;\n            } else {\n                end = start + that._flatData(data, true).length;\n            }\n\n            range.start = start;\n            range.end = end;\n            that._ranges.push(range);\n            that._sortRanges();\n\n            if (that._isGroupPaged()) {\n                if (!that._groupsFlat) {\n                    that._groupsFlat = [];\n                }\n                that._appendToGroupsFlat(range.data);\n                that._updateOuterRangesLength();\n            }\n        },\n\n        _appendToGroupsFlat: function (data) {\n            var length = data.length;\n\n            for (var i = 0; i < length; i++) {\n                this._groupsFlat.push(data[i]);\n            }\n        },\n\n        _getGroupByUid: function(uid){\n            var length = this._groupsFlat.length;\n            var group;\n\n            for (var i = 0; i < length; i++) {\n                group = this._groupsFlat[i];\n                if (group.uid === uid) {\n                    return group;\n                }\n            }\n        },\n\n        _sortRanges: function() {\n            this._ranges.sort(function(x, y) {\n                return x.start - y.start;\n            });\n        },\n\n        error: function(xhr, status, errorThrown) {\n            this._dequeueRequest();\n            this.trigger(REQUESTEND, { });\n            this.trigger(ERROR, { xhr: xhr, status: status, errorThrown: errorThrown });\n        },\n\n        _params: function(data) {\n            var that = this,\n                options =  extend({\n                    take: that.take(),\n                    skip: that.skip(),\n                    page: that.page(),\n                    pageSize: that.pageSize(),\n                    sort: that._sort,\n                    filter: that._filter,\n                    group: that._group,\n                    aggregate: that._aggregate,\n                    groupPaging: !!that._groupPaging\n                }, data);\n\n            if (!that.options.serverPaging) {\n                delete options.take;\n                delete options.skip;\n                delete options.page;\n                delete options.pageSize;\n            }\n\n            if (!that.options.serverGrouping) {\n                delete options.group;\n            } else if (that.reader.model && options.group) {\n                options.group = convertDescriptorsField(options.group, that.reader.model);\n            }\n\n            if (!that.options.serverFiltering) {\n                delete options.filter;\n            } else if (that.reader.model && options.filter) {\n               options.filter = convertFilterDescriptorsField(options.filter, that.reader.model);\n            }\n\n            if (!that.options.serverSorting) {\n                delete options.sort;\n            } else if (that.reader.model && options.sort) {\n                options.sort = convertDescriptorsField(options.sort, that.reader.model);\n            }\n\n            if (!that.options.serverAggregates) {\n                delete options.aggregate;\n            } else if (that.reader.model && options.aggregate) {\n                options.aggregate = convertDescriptorsField(options.aggregate, that.reader.model);\n            }\n\n            if (!that.options.groupPaging) {\n                delete options.groupPaging;\n            }\n\n            return options;\n        },\n\n        _queueRequest: function(options, callback) {\n            var that = this;\n            if (!that._requestInProgress) {\n                that._requestInProgress = true;\n                that._pending = undefined;\n                callback();\n            } else {\n                that._pending = { callback: callback.bind(that), options: options };\n            }\n        },\n\n        _dequeueRequest: function() {\n            var that = this;\n            that._requestInProgress = false;\n            if (that._pending) {\n                that._queueRequest(that._pending.options, that._pending.callback);\n            }\n        },\n\n        _handleCustomErrors: function(response) {\n            if (this.reader.errors) {\n                var errors = this.reader.errors(response);\n                if (errors) {\n                    this.trigger(ERROR, { xhr: null, status: \"customerror\", errorThrown: \"custom error\", errors: errors });\n                    return true;\n                }\n            }\n            return false;\n        },\n\n        _shouldWrap: function(data) {\n            var model = this.reader.model;\n\n            if (model && data.length) {\n                return !(data[0] instanceof model);\n            }\n\n            return false;\n        },\n\n        _observe: function(data) {\n            var that = this,\n                model = that.reader.model;\n\n            that._shouldDetachObservableParents = true;\n\n            if (data instanceof ObservableArray) {\n                that._shouldDetachObservableParents = false;\n                if (that._shouldWrap(data)) {\n                    data.type = that.reader.model;\n                    data.wrapAll(data, data);\n                }\n            } else {\n                var arrayType = that.pageSize() && !that.options.serverPaging ? LazyObservableArray : ObservableArray;\n                data = new arrayType(data, that.reader.model);\n                data.parent = function() { return that.parent(); };\n            }\n\n            if (that._isServerGrouped()) {\n                wrapGroupItems(data, model);\n            }\n\n            if (that._changeHandler && that._data && that._data instanceof ObservableArray &&\n                !(that.options.useRanges && that.options.serverPaging)) {\n                that._data.unbind(CHANGE, that._changeHandler);\n            } else {\n                that._changeHandler = that._change.bind(that);\n            }\n\n            return data.bind(CHANGE, that._changeHandler);\n        },\n\n        _updateTotalForAction: function(action, items) {\n            var that = this;\n\n            var total = parseInt(that._total, 10);\n\n            if (!isNumber(that._total)) {\n                total = parseInt(that._pristineTotal, 10);\n            }\n            if (action === \"add\") {\n                total += items.length;\n            } else if (action === \"remove\") {\n                total -= items.length;\n            } else if (action !== \"itemchange\" && action !== \"sync\" && !that.options.serverPaging) {\n                total = that._pristineTotal;\n            } else if (action === \"sync\") {\n                total = that._pristineTotal = parseInt(that._total, 10);\n            }\n\n            that._total = total;\n        },\n\n        _change: function(e) {\n            var that = this, idx, length, action = e ? e.action : \"\";\n\n            if (action === \"remove\") {\n                for (idx = 0, length = e.items.length; idx < length; idx++) {\n                    if (!e.items[idx].isNew || !e.items[idx].isNew()) {\n                        that._destroyed.push(e.items[idx]);\n                    }\n                }\n            }\n\n            if (that.options.autoSync && (action === \"add\" || action === \"remove\" || action === \"itemchange\")) {\n\n                var handler = function(args) {\n                    if (args.action === \"sync\") {\n                        that.unbind(\"change\", handler);\n                        that._updateTotalForAction(action, e.items);\n                    }\n                };\n\n                that.first(\"change\", handler);\n\n                that.sync();\n\n            } else {\n                that._updateTotalForAction(action, e ? e.items : []);\n\n                that._process(that._data, e);\n            }\n        },\n\n        _calculateAggregates: function (data, options) {\n            options = options || {};\n\n            var query = new Query(data),\n                aggregates = options.aggregate,\n                filter = options.filter;\n\n            if (filter) {\n                query = query.filter(filter);\n            }\n\n            return query.aggregate(aggregates);\n        },\n\n        _process: function (data, e) {\n            var that = this,\n                options = {},\n                result;\n\n            if (that.options.serverPaging !== true) {\n                options.skip = that._skip;\n                options.take = that._take || that._pageSize;\n\n                if(options.skip === undefined && that._page !== undefined && that._pageSize !== undefined) {\n                    options.skip = (that._page - 1) * that._pageSize;\n                }\n\n                if (that.options.useRanges) {\n                    options.skip = that.currentRangeStart();\n                }\n            }\n\n            if (that.options.serverSorting !== true) {\n                options.sort = that._sort;\n            }\n\n            if (that.options.serverFiltering !== true) {\n                options.filter = that._filter;\n            }\n\n            if (that.options.serverGrouping !== true) {\n                options.group = that._group;\n            }\n\n            if (that.options.serverAggregates !== true) {\n                options.aggregate = that._aggregate;\n            }\n\n            if (that.options.serverGrouping) {\n                that._clearEmptyGroups(data);\n            }\n\n            options.groupPaging = that._groupPaging;\n\n            if (that._isGroupPaged() && e && (e.action === \"page\" || e.action === \"expandGroup\" || e.action === \"collapseGroup\")) {\n                result = that._queryProcess(data, {\n                    aggregate: that._aggregate\n                });\n            } else {\n                result = that._queryProcess(data, options);\n            }\n\n            if (that.options.serverAggregates !== true) {\n                // for performance reasons, calculate aggregates for part of the data only after query process\n                // this is necessary in the TreeList when paging\n                that._aggregateResult = that._calculateAggregates(result.dataToAggregate || data, options);\n            }\n\n            that._setView(result, options, e);\n\n            that._setFilterTotal(result.total, false);\n\n            e = e || {};\n\n            e.items = e.items || that._view;\n\n            that.trigger(CHANGE, e);\n        },\n\n        _setView: function (result, options, e) {\n            var that = this;\n\n            if (that._isGroupPaged() && !that._isServerGrouped()) {\n                if (e && (e.action === \"page\" || e.action === \"expandGroup\" || e.action === \"collapseGroup\")) {\n                    that.view(result.data);\n                    that._updateOuterRangesLength();\n                } else {\n                    that._ranges = [];\n                    var query = new Query(result.data);\n                    that._addRange(that._observe(result.data));\n\n                    if (options.skip + options.take > result.data.length) {\n                        options.skip = result.data.length - options.take;\n                    }\n\n                    that.view(query.range(options.skip, options.take).toArray());\n                }\n\n            } else {\n                that.view(result.data);\n            }\n        },\n\n        _clearEmptyGroups: function(data) {\n            for (var idx = data.length - 1; idx >=0; idx--) {\n                var group = data[idx];\n                if (group.hasSubgroups) {\n                    this._clearEmptyGroups(group.items);\n                }\n                \n                if (group.items && !group.items.length && !group.itemCount) {\n                    splice.apply(group.parent(), [idx, 1]);\n                }\n            }\n        },\n\n        _queryProcess: function(data, options) {\n            if (this.options.inPlaceSort) {\n                return Query.process(data, options, this.options.inPlaceSort);\n            }\n            else {\n                return Query.process(data, options);\n            }\n        },\n\n        _mergeState: function(options) {\n            var that = this;\n\n            if (options !== undefined) {\n                that._pageSize = options.pageSize;\n                that._page = options.page;\n                that._sort = options.sort;\n                that._filter = options.filter;\n                that._group = options.group;\n                that._aggregate = options.aggregate;\n                that._skip = that._currentRangeStart = options.skip;\n                that._take = options.take;\n\n                if(that._skip === undefined) {\n                    that._skip = that._currentRangeStart = that.skip();\n                    options.skip = that.skip();\n                }\n\n                if(that._take === undefined && that._pageSize !== undefined) {\n                    that._take = that._pageSize;\n                    options.take = that._take;\n                }\n\n                if(that.options.virtual) {\n                    options.virtual = that.options.virtual;\n                }\n\n                if (options.sort) {\n                    that._sort = options.sort = normalizeSort(options.sort);\n                    that._sortFields = sortFields(options.sort);\n                }\n\n                if (options.filter) {\n                    that._filter = options.filter = (that.options.accentFoldingFiltering && !$.isEmptyObject(options.filter)) ? $.extend({}, normalizeFilter(options.filter), { accentFoldingFiltering: that.options.accentFoldingFiltering}) : normalizeFilter(options.filter);\n                }\n\n                if (options.group) {\n                    that._group = options.group = normalizeGroup(options.group);\n                }\n                if (options.aggregate) {\n                    that._aggregate = options.aggregate = normalizeAggregate(options.aggregate);\n                }\n            }\n            return options;\n        },\n\n        query: function(options) {\n            var result;\n            var remote = this.options.serverSorting || this.options.serverPaging || this.options.serverFiltering || this.options.serverGrouping || this.options.serverAggregates;\n\n            if (remote || ((this._data === undefined || this._data.length === 0) && !this._destroyed.length)) {\n                if (this.options.endless) {\n                    var moreItemsCount = options.pageSize - this.pageSize();\n                    if (moreItemsCount > 0) {\n                        moreItemsCount = this.pageSize();\n                        options.page = options.pageSize / moreItemsCount;\n                        options.pageSize = moreItemsCount;\n                    } else {\n                        options.page = 1;\n                        this.options.endless = false;\n                    }\n                }\n                return this.read(this._mergeState(options));\n            }\n\n            var isPrevented = this.trigger(REQUESTSTART, { type: \"read\" });\n            if (!isPrevented) {\n                this.trigger(PROGRESS);\n                if (options) {\n                    options.groupPaging = this._groupPaging;\n                }\n                result = this._queryProcess(this._data, this._mergeState(options));\n\n                this._setFilterTotal(result.total, true);\n\n                this._aggregateResult = this._calculateAggregates(result.dataToAggregate || this._data, options);\n                this._setView(result, options);\n                this.trigger(REQUESTEND, { type: \"read\" });\n                this.trigger(CHANGE, { items: result.data, action: options ? options.action : \"\" });\n            }\n\n            return $.Deferred().resolve(isPrevented).promise();\n        },\n\n        _hasExpandedSubGroups: function (group) {\n            var result = false;\n            var length = group.items ? group.items.length : 0;\n\n            if (!group.hasSubgroups) {\n                return false;\n            }\n\n            for (var i = 0; i < length; i++) {\n                if (this._groupsState[group.items[i].uid]) {\n                    result = true;\n                    break;\n                }\n            }\n            return result;\n        },\n\n        _findGroupedRange: function (data, result, options, parents, callback) {\n            var that = this;\n            var length = data.length;\n            var group;\n            var current;\n            var itemsLength;\n            var groupCount;\n            var itemsToSkip;\n\n            for (var i = 0; i < length; i++) {\n                group = data[i];\n\n                if (options.taken >= options.take) {\n                    break;\n                }\n\n                if (!that._getGroupByUid(group.uid)) {\n                    that._groupsFlat.push(group);\n                }\n\n                if (that._groupsState[group.uid]) {\n                    if (that._isServerGroupPaged()) {\n                       if (that._fetchGroupItems(group, options, parents, callback)) {\n                            that._fetchingGroupItems = true;\n                            return;\n                       }\n                       groupCount = (group.subgroupCount || group.itemCount) + 1;\n                       itemsToSkip = options.skip - options.skipped;\n                       if (!that._hasExpandedSubGroups(group) && itemsToSkip > groupCount) {\n                           options.skipped += groupCount;\n                           continue;\n                       }\n                    }\n\n                    if (options.includeParents && options.skipped < options.skip) {\n                        options.skipped++;\n                        group.excludeHeader = true;\n                    } else if (options.includeParents) {\n                        options.taken++;\n                        group.excludeHeader = false;\n                    }\n\n                    if (group.hasSubgroups && group.items && group.items.length) {\n                        group.currentItems = [];\n\n                        if (!parents) {\n                            parents = [];\n                        }\n                        parents.push(group);\n\n                        that._findGroupedRange(group.items, group.currentItems, options, parents, callback);\n                        parents.pop();\n\n                        if (group.currentItems.length || options.taken > 0) {\n                            result.push(group);\n                        } else {\n                            group.excludeHeader = false;\n                        }\n                    } else {\n                        current = [];\n                        itemsLength = group.items.length;\n\n                        for (var j = 0; j < itemsLength; j++) {\n                            if (options.skipped < options.skip) {\n                                options.skipped++;\n                                continue;\n                            }\n\n                            if (options.taken >= options.take) {\n                                break;\n                            }\n                            current.push(group.items[j]);\n                            options.taken++;\n                        }\n\n                        if (current.length || options.taken > 0) {\n                            group.currentItems = current;\n                            result.push(group);\n                        } else {\n                            group.excludeHeader = false;\n                        }\n                    }\n                } else {\n                    if (options.skipped < options.skip) {\n                        options.skipped++;\n                        continue;\n                    }\n                    result.push(group);\n                    options.taken++;\n                }\n            }\n        },\n\n        _expandedSubGroupItemsCount: function (group, end, includeCurrentItems) {\n            var that = this;\n            var result = 0;\n            var subGroup;\n            var endSpecified = typeof end === \"number\";\n            var length = endSpecified ? end : group.subgroupCount;\n            var temp;\n\n            if (!group.hasSubgroups) {\n                return result;\n            }\n\n            for (var i = 0; i < length; i++) {\n                subGroup = group.items[i];\n\n                if (!subGroup) {\n                    break;\n                }\n\n                if (subGroup.hasSubgroups && that._groupsState[group.uid]) {\n                    temp = that._expandedSubGroupItemsCount(subGroup, length, true);\n                    result += temp;\n\n                    if (endSpecified) {\n                        length -= temp;\n                    }\n                } else if (!subGroup.hasSubgroups && that._groupsState[subGroup.uid]) {\n                    temp = subGroup.items ? subGroup.items.length : 0;\n                    result += temp;\n                    if (endSpecified) {\n                        length -= temp;\n                    }\n                }\n\n                if (includeCurrentItems) {\n                    result += 1;\n                    if (endSpecified) {\n                        length -= 1;\n                    }\n                }\n\n                if (endSpecified && result > length) {\n                    return result;\n                }\n            }\n\n            return result;\n        },\n\n        _fetchGroupItems: function(group, options, parents, callback) {\n            var that = this;\n            var groupItemsSkip;\n            var firstItem;\n            var lastItem;\n            var groupItemCount = group.hasSubgroups ? group.subgroupCount : group.itemCount;\n            var take = options.take;\n            var skipped = options.skipped;\n            var pageSize = that.take();\n            var expandedSubGroupItemsCount;\n\n            if (options.includeParents) {\n                if (skipped < options.skip) {\n                    skipped += 1;\n                } else {\n                    take -= 1;\n                }\n            }\n\n            if (!group.items || (group.items && !group.items.length)) {\n                that.getGroupItems(group, options, parents, callback, 0);\n                return true;\n            } else {\n                expandedSubGroupItemsCount = this._expandedSubGroupItemsCount(group, options.skip - skipped);\n                groupItemsSkip = Math.max(options.skip - (skipped + expandedSubGroupItemsCount), 0);\n\n                if (groupItemsSkip >= groupItemCount) {\n                    return false;\n                }\n\n                firstItem = group.items[groupItemsSkip];\n                lastItem = group.items[Math.min(groupItemsSkip + take, groupItemCount - 1)];\n\n                if (firstItem.notFetched) {\n                    that.getGroupItems(group, options, parents, callback, math.max(math.floor(groupItemsSkip / pageSize), 0) * pageSize, math.round((groupItemsSkip + pageSize) / pageSize));\n                    return true;\n                }\n\n                if (lastItem.notFetched) {\n                    that.getGroupItems(group, options, parents, callback, math.max(math.floor((groupItemsSkip + pageSize) / pageSize), 0) * pageSize, math.round((groupItemsSkip + pageSize) / pageSize));\n                    return true;\n                }\n            }\n        },\n\n        getGroupItems: function(group, options, parents, callback, groupItemsSkip, page) {\n            var that = this;\n            var take;\n            var filter;\n            var data;\n            var subgroups;\n\n            if (!group.items) {\n                group.items = [];\n            }\n\n            take = that.take();\n            filter = this._composeItemsFilter(group, parents);\n            data = {\n                page: page || 1,\n                pageSize: take,\n                skip: groupItemsSkip,\n                take: take,\n                filter: filter,\n                aggregate: that._aggregate,\n                sort: that._sort\n            };\n            subgroups = that.findSubgroups(group);\n\n            if (subgroups && subgroups.length) {\n                data.group = subgroups;\n                data.groupPaging = true;\n            }\n\n            clearTimeout(that._timeout);\n            that._timeout = setTimeout(function () {\n                that._queueRequest(data, function () {\n                    if (!that.trigger(REQUESTSTART, {\n                            type: \"read\"\n                        })) {\n                        that.transport.read({\n                            data: data,\n                            success: that._groupItemsSuccessHandler(group, options.skip, that.take(), callback, groupItemsSkip),\n                            error: function () {\n                                var args = slice.call(arguments);\n                                that.error.apply(that, args);\n                            }\n                        });\n                    } else {\n                        that._dequeueRequest();\n                    }\n                });\n            }, 100);\n        },\n\n        _groupItemsSuccessHandler: function(group, skip, take, callback, groupItemsSkip) {\n            var that = this;\n            var timestamp = that._timeStamp();\n            callback = isFunction(callback) ? callback : noop;\n            var totalField = that.options.schema && that.options.schema.total ? that.options.schema.total : \"Total\";\n\n            return function (data) {\n                var temp;\n                var model = Model.define(that.options.schema.model);\n                var totalCount;\n\n                that._dequeueRequest();\n\n                that.trigger(REQUESTEND, {\n                    response: data,\n                    type: \"read\"\n                });\n\n                if (isFunction(totalField)) {\n                    totalCount = totalField(data);\n                } else {\n                    totalCount = data[totalField];\n                }\n\n                data = that.reader.parse(data);\n\n                if (group.hasSubgroups) {\n                    temp = that.reader.groups(data);\n                    group.subgroupCount = totalCount;\n                } else {\n                    temp = that.reader.data(data);\n                    temp = temp.map(function (item) {\n                        return new model(item);\n                    });\n                }\n\n                group.items.omitChangeEvent = true;\n                for (var i = 0; i < totalCount; i++) {\n                    if (i >= groupItemsSkip && i < (groupItemsSkip + take) ) {\n                        group.items.splice(i, 1, temp[i - groupItemsSkip]);\n                    } else {\n                        if (!group.items[i]) {\n                            group.items.splice(i, 0, { notFetched: true });\n                        }\n                    }\n                }\n                group.items.omitChangeEvent = false;\n\n                that._updateRangePristineData(group);\n                that._fetchingGroupItems = false;\n\n                if (!group.countAdded) {\n                    that._serverGroupsTotal += totalCount;\n                    group.countAdded = true;\n                }\n\n                that.range(skip, take, callback, \"expandGroup\");\n\n                if (timestamp >= that._currentRequestTimeStamp || !that._skipRequestsInProgress) {\n                    that.trigger(CHANGE, {});\n                }\n            };\n        },\n\n        findSubgroups: function(group) {\n            var indexOfCurrentGroup = this._group.map(function (g) {\n                return g.field;\n            }).indexOf(group.field);\n\n            return this._group.slice(indexOfCurrentGroup + 1, this._group.length);\n        },\n\n        _composeItemsFilter: function(group, parents) {\n            var filter = this.filter() || {\n                logic: \"and\",\n                filters: []\n            };\n\n            filter.logic = 'and';\n            filter = extend(true, {}, filter);\n            filter.filters.push({\n                field: group.field,\n                operator: \"eq\",\n                value: group.value\n            });\n\n            if (parents) {\n                for (var i = 0; i < parents.length; i++) {\n                    filter.filters.push({\n                        field: parents[i].field,\n                        operator: \"eq\",\n                        value: parents[i].value\n                    });\n                }\n            }\n\n            return filter;\n        },\n\n        _updateRangePristineData: function(group) {\n            var that = this;\n            var ranges = that._ranges;\n            var rangesLength = ranges.length;\n            var temp;\n            var currentGroup;\n            var range;\n            var dataLength;\n            var indexes;\n            var currIdx;\n\n            for (var i = 0; i < rangesLength; i++) {\n                range = ranges[i];\n                dataLength = range.data.length;\n                indexes = [];\n                temp = null;\n\n                for (var j = 0; j < dataLength; j++) {\n                    currentGroup = range.data[j];\n                    indexes.push(j);\n\n                    if ((currentGroup.uid === group.uid) || (currentGroup.hasSubgroups && currentGroup.items.length && that._containsSubGroup(currentGroup, group, indexes))) {\n                        break;\n                    }\n                    indexes.pop();\n                }\n\n                if (indexes.length) {\n                    temp = ranges[i].pristineData;\n\n                    while (indexes.length > 1) {\n                        currIdx = indexes.splice(0, 1)[0];\n                        temp = temp[currIdx].items;\n                    }\n                    temp[indexes[0]] = that._cloneGroup(group);\n                    break;\n                }\n            }\n        },\n\n        _containsSubGroup: function(group, subgroup, indexes) {\n            var that = this;\n            var length = group.items.length;\n            var currentSubGroup;\n\n            if (group.hasSubgroups && length) {\n                for (var i = 0; i < length; i++) {\n                    currentSubGroup = group.items[i];\n                    indexes.push(i);\n                    if (currentSubGroup.uid === subgroup.uid) {\n                        return true;\n                    } else if (currentSubGroup.hasSubgroups && currentSubGroup.items.length) {\n                        return that._containsSubGroup(currentSubGroup, subgroup, indexes);\n                    }\n                    indexes.pop();\n                }\n            }\n\n        },\n\n        _cloneGroup: function(group) {\n            var that = this;\n            group = typeof group.toJSON == \"function\" ? group.toJSON() : group;\n\n            if (group.items && group.items.length) {\n                group.items = group.items.map(function (item) {\n                    return that._cloneGroup(item);\n                });\n            }\n\n            return group;\n        },\n\n        _setFilterTotal: function(filterTotal, setDefaultValue) {\n            var that = this;\n\n            if (!that.options.serverFiltering) {\n                if (filterTotal !== undefined) {\n                    that._total = filterTotal;\n                } else if (setDefaultValue) {\n                    that._total = that._data.length;\n                }\n            }\n        },\n\n        fetch: function(callback) {\n            var that = this;\n            var fn = function(isPrevented) {\n                if (isPrevented !== true && isFunction(callback)) {\n                    callback.call(that);\n                }\n            };\n\n            return this._query().done(fn);\n        },\n\n        _query: function(options) {\n            var that = this;\n\n            return that.query(extend({}, {\n                page: that.page(),\n                pageSize: that.pageSize(),\n                sort: that.sort(),\n                filter: that.filter(),\n                group: that.group(),\n                aggregate: that.aggregate()\n            }, options));\n        },\n\n        next: function(options) {\n            var that = this,\n                page = that.page(),\n                total = that.total();\n\n            options = options || {};\n\n            if (!page || (total && page + 1 > that.totalPages())) {\n                return;\n            }\n\n            that._skip = that._currentRangeStart = page * that.take();\n\n            page += 1;\n            options.page = page;\n\n            that._query(options);\n\n            return page;\n        },\n\n        prev: function(options) {\n            var that = this,\n                page = that.page();\n\n            options = options || {};\n\n            if (!page || page === 1) {\n                return;\n            }\n\n            that._skip = that._currentRangeStart = that._skip - that.take();\n\n            page -= 1;\n            options.page = page;\n\n            that._query(options);\n\n            return page;\n        },\n\n        page: function(val) {\n            var that = this,\n            skip;\n\n            if(val !== undefined) {\n                val = math.max(math.min(math.max(val, 1), that.totalPages()), 1);\n                var take = that.take();\n\n                if (that._isGroupPaged()) {\n                    val -= 1;\n                    that.range(val * take, take, null, \"page\");\n                    return;\n                }\n                that._query(that._pageableQueryOptions({ page: val }));\n                return;\n            }\n            skip = that.skip();\n\n            return skip !== undefined ? math.round((skip || 0) / (that.take() || 1)) + 1 : undefined;\n        },\n\n        pageSize: function(val) {\n            var that = this;\n\n            if (val !== undefined) {\n                that._query(that._pageableQueryOptions({ pageSize: val, page: 1 }));\n                return;\n            }\n\n            return that.take();\n        },\n\n        sort: function(val) {\n            var that = this;\n\n            if(val !== undefined) {\n                that.trigger(\"sort\");\n                that._query({ sort: val });\n                return;\n            }\n\n            return that._sort;\n        },\n\n        filter: function(val) {\n            var that = this;\n\n            if (val === undefined) {\n                return that._filter;\n            }\n\n            that.trigger(\"reset\");\n            that._query({ filter: val, page: 1 });\n        },\n\n        group: function(val) {\n            var that = this;\n            var options = { group: val };\n\n            if (that._groupPaging) {\n                // clear ranges if ungrouping is performed\n                if (val!== undefined && (!val || !val.length) ) {\n                    that._ranges = [];\n                }\n                options.page = 1;\n            }\n\n            if(val !== undefined) {\n                that._query(options);\n                return;\n            }\n\n            return that._group;\n        },\n\n        getGroupsFlat: function (data) {\n            var idx,\n                result = [],\n                length;\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                var group = data[idx];\n                if (group.hasSubgroups) {\n                    result = result.concat(this.getGroupsFlat(group.items));\n                }\n\n                result.push(group);\n            }\n\n            return result;\n        },\n\n        total: function() {\n            return parseInt(this._total || 0, 10);\n        },\n\n        groupsTotal: function (includeExpanded) {\n            var that = this;\n\n            if (!that._group.length) {\n                return that.total();\n            }\n\n            if (that._isServerGrouped()) {\n                if (that._serverGroupsTotal) {\n                    return that._serverGroupsTotal;\n                }\n                that._serverGroupsTotal = that.total();\n\n                return that._serverGroupsTotal;\n            }\n\n            return that._calculateGroupsTotal(that._ranges.length ? that._ranges[0].data : [], includeExpanded);\n        },\n\n        _calculateGroupsTotal: function (groups, includeExpanded, itemsField, ignoreState) {\n            var that = this;\n            itemsField = itemsField || \"items\";\n            var total;\n            var length;\n\n            if (that._group.length && groups) {\n                total = 0;\n                length = groups.length;\n\n                for (var i = 0; i < length; i++) {\n                    total += that.groupCount(groups[i], includeExpanded, itemsField, ignoreState);\n                }\n                that._groupsTotal = total;\n                return total;\n            }\n\n            that._groupsTotal = that._data.length;\n            return that._groupsTotal;\n        },\n\n        groupCount: function (group, includeExpanded, itemsField, ignoreState) {\n            var that = this;\n            var total = 0;\n\n            if (group.hasSubgroups && that._groupsState[group.uid]) {\n                if (includeExpanded && !group.excludeHeader || ignoreState) {\n                    total += 1;\n                }\n\n                group[itemsField].forEach(function (subgroup) {\n                    total += that.groupCount(subgroup, includeExpanded, itemsField, ignoreState);\n                });\n            } else {\n                if (that._groupsState[group.uid]) {\n                    if (includeExpanded && !group.excludeHeader || ignoreState) {\n                        total++;\n                    }\n                    total += group[itemsField] ? group[itemsField].length : 0;\n                } else {\n                    total++;\n                }\n            }\n            return total;\n        },\n\n        countGroupRange: function (range) {\n            var total = 0;\n            var length = range.length;\n\n            for (var i = 0; i < length; i++) {\n                total += this.groupCount(range[i], true);\n            }\n\n            return total;\n        },\n\n        aggregate: function(val) {\n            var that = this;\n\n            if(val !== undefined) {\n                that._query({ aggregate: val });\n                return;\n            }\n\n            return that._aggregate;\n        },\n\n        aggregates: function() {\n            var result = this._aggregateResult;\n\n            if (isEmptyObject(result)) {\n                result = this._emptyAggregates(this.aggregate());\n            }\n\n            return result;\n        },\n\n        _emptyAggregates: function(aggregates) {\n            var result = {};\n\n            if (!isEmptyObject(aggregates)) {\n                var aggregate = {};\n\n                if (!isArray(aggregates)){\n                    aggregates = [aggregates];\n                }\n\n                for (var idx = 0; idx <aggregates.length; idx++) {\n                    aggregate[aggregates[idx].aggregate] = 0;\n                    result[aggregates[idx].field] = aggregate;\n                }\n            }\n\n            return result;\n        },\n\n        _pageableQueryOptions: function(options) {\n            return options;\n        },\n\n        _wrapInEmptyGroup: function(model) {\n            var groups = this.group(),\n                parent,\n                group,\n                idx,\n                length;\n\n            for (idx = groups.length-1, length = 0; idx >= length; idx--) {\n                group = groups[idx];\n                parent = {\n                    value: model.get ? model.get(group.field) : model[group.field],\n                    field: group.field,\n                    items: parent ? [parent] : [model],\n                    hasSubgroups: !!parent,\n                    aggregates: this._emptyAggregates(group.aggregates)\n                };\n            }\n\n            return parent;\n        },\n\n        totalPages: function() {\n            var that = this,\n                pageSize = that.pageSize() || that.total(),\n                total = that._isGroupPaged() ? that.groupsTotal(true) : that.total();\n\n            return math.ceil((total || 0) / pageSize);\n        },\n\n        inRange: function(skip, take) {\n            var that = this,\n                end = math.min(skip + take, that.total());\n\n            if (!that.options.serverPaging && that._data.length > 0) {\n                return true;\n            }\n\n            return that._findRange(skip, end).length > 0;\n        },\n\n        lastRange: function() {\n            var ranges = this._ranges;\n            return ranges[ranges.length - 1] || { start: 0, end: 0, data: [] };\n        },\n\n        firstItemUid: function() {\n            var ranges = this._ranges;\n            return ranges.length && ranges[0].data.length && ranges[0].data[0].uid;\n        },\n\n        enableRequestsInProgress: function() {\n            this._skipRequestsInProgress = false;\n        },\n\n        _timeStamp: function() {\n            return new Date().getTime();\n        },\n\n        range: function(skip, take, callback, action) {\n            this._currentRequestTimeStamp = this._timeStamp();\n            this._skipRequestsInProgress = true;\n            var total = this._isGroupPaged() ? this.groupsTotal(true) : this.total();\n\n            if (action === \"expandGroup\" || action === \"collapseGroup\") {\n                this._updateOuterRangesLength();\n            }\n\n            skip = math.min(skip || 0, total);\n            callback = isFunction(callback) ? callback : noop;\n\n            var that = this,\n                pageSkip = math.max(math.floor(skip / take), 0) * take,\n                size = math.min(pageSkip + take, total),\n                data;\n\n            data = that._findRange(skip, math.min(skip + take, total), callback);\n\n            if ((data.length || total === 0) && !that._fetchingGroupItems) {\n                that._processRangeData(data, skip, take, that._originalPageSkip || pageSkip, that._originalSize || size, {\n                    action: action\n                });\n                that._originalPageSkip = null;\n                that._originalSize = null;\n                callback();\n                return;\n            }\n\n            if (that._isGroupPaged()) {\n                that._originalPageSkip = pageSkip;\n                that._originalSize = size;\n\n                pageSkip = math.max(math.floor(that._adjustPageSkip(skip, take) / take), 0) * take;\n                size = math.min(pageSkip + take, total);\n            }\n\n            if (take !== undefined && !that._fetchingGroupItems) {\n                if ((that._isGroupPaged() && !that._groupRangeExists(pageSkip, take)) || !that._rangeExists(pageSkip, size)) {\n                    that.prefetch(pageSkip, take, function() {\n                        if (skip > pageSkip && size < that.total() && !that._rangeExists(size, math.min(size + take, that.total()))) {\n                            that.prefetch(size, take, function() {\n                                that.range(skip, take, callback );\n                            });\n                        } else {\n                            that.range(skip, take, callback);\n                        }\n                    });\n                } else if (pageSkip < skip) {\n                    that.prefetch(size, take, function() {\n                        that.range(skip, take, callback );\n                    });\n                }\n            }\n        },\n\n        _findRange: function(start, end, callback) {\n            var that = this,\n                ranges = that._ranges,\n                range,\n                data = [],\n                skipIdx,\n                takeIdx,\n                startIndex,\n                endIndex,\n                rangeData,\n                rangeEnd,\n                processed,\n                options = that.options,\n                remote = options.serverSorting || options.serverPaging || options.serverFiltering || options.serverGrouping || options.serverAggregates,\n                flatData,\n                count,\n                length,\n                groupMapOptions = {\n                        take: end - start,\n                        skip: start,\n                        skipped: 0,\n                        taken: 0,\n                        includeParents: true\n                    },\n                prevRangeEnd,\n                isGroupPaged = that._isGroupPaged(),\n                startField = isGroupPaged ? \"outerStart\" : \"start\",\n                endField = isGroupPaged ? \"outerEnd\" : \"end\",\n                currentDataLength;\n\n            for (skipIdx = 0, length = ranges.length; skipIdx < length; skipIdx++) {\n                range = ranges[skipIdx];\n\n                if (isGroupPaged) {\n                    if (range.outerStart >= end) {\n                        return [];\n                    }\n\n                    if (start > range.outerEnd) {\n                        groupMapOptions.skipped += range.outerEnd - (prevRangeEnd || 0);\n                        prevRangeEnd = range.outerEnd;\n                        continue;\n                    }\n\n                    if (typeof prevRangeEnd !== \"undefined\" && prevRangeEnd != range.outerStart) {\n                        groupMapOptions.skipped += range.outerStart - prevRangeEnd;\n                    }\n\n                    if (groupMapOptions.skipped > groupMapOptions.skip) {\n                        return [];\n                    }\n\n                    if (typeof prevRangeEnd === \"undefined\" && start > 0 && range.start > 0) {\n                        groupMapOptions.skipped = range.outerStart;\n                    }\n\n                    takeIdx = skipIdx;\n                    while (true) {\n                        this._findGroupedRange(range.data, data, groupMapOptions, null, callback);\n                        currentDataLength = that._calculateGroupsTotal(data, true, \"currentItems\");\n\n                        if (currentDataLength >= groupMapOptions.take) {\n                            return data;\n                        }\n\n                        if (that._fetchingGroupItems) {\n                            return [];\n                        }\n                        takeIdx++;\n\n                        if (ranges[takeIdx] && ranges[takeIdx].outerStart === range.outerEnd) {\n                            range = ranges[takeIdx];\n                        } else {\n                            break;\n                        }\n                    }\n                } else if (start >= range[startField] && start <= range[endField]) {\n                    count = 0;\n\n                    for (takeIdx = skipIdx; takeIdx < length; takeIdx++) {\n                        range = ranges[takeIdx];\n                        flatData = that._flatData(range.data, true);\n\n                        if (flatData.length && start + count >= range.start) {\n                            rangeData = range.data;\n                            rangeEnd = range.end;\n\n                            if (!remote) {\n                                if (options.inPlaceSort) {\n                                    processed = that._queryProcess(range.data, { filter: that.filter() });\n                                } else {\n                                    var sort = normalizeGroupWithoutCompare(that.group() || []).concat(normalizeSort(that.sort() || []));\n                                    processed = that._queryProcess(range.data, { sort: sort, filter: that.filter() });\n                                }\n                                flatData = rangeData = processed.data;\n\n                                if (processed.total !== undefined) {\n                                    rangeEnd = processed.total;\n                                }\n                            }\n\n                            startIndex = 0;\n                            if (start + count > range.start) {\n                                startIndex = (start + count) - range.start;\n                            }\n                            endIndex = flatData.length;\n                            if (rangeEnd > end) {\n                                endIndex = endIndex - (rangeEnd - end);\n                            }\n                            count += endIndex - startIndex;\n                            data = that._mergeGroups(data, rangeData, startIndex, endIndex);\n\n                            if (end <= range.end && count == end - start) {\n                                return data;\n                            }\n                        }\n                    }\n                    break;\n                }\n                prevRangeEnd = range.outerEnd;\n            }\n            return [];\n        },\n\n        _getRangesMismatch: function (pageSkip) {\n            var that = this;\n            var ranges = that._ranges;\n            var mismatch = 0;\n            var i = 0;\n\n            while (true) {\n                var range = ranges[i];\n                if (!range || range.outerStart > pageSkip) {\n                    break;\n                }\n\n                if (range.outerEnd != range.end) {\n                    mismatch = range.outerEnd - range.end;\n                }\n                i++;\n            }\n\n            return mismatch;\n        },\n\n        _mergeGroups: function(data, range, skip, take) {\n            if (this._isServerGrouped()) {\n                var temp = range.toJSON(),\n                    prevGroup;\n\n                if (data.length) {\n                    prevGroup = data[data.length - 1];\n                }\n\n                mergeGroups(prevGroup, temp, skip, take);\n\n                return data.concat(temp);\n            }\n            return data.concat(range.slice(skip, take));\n        },\n\n        _processRangeData: function(data, skip, take, pageSkip, size, eventData) {\n            var that = this;\n\n            that._pending = undefined;\n\n            that._skip = skip > that.skip() && !that._omitPrefetch ? math.min(size, (that.totalPages() - 1) * that.take()) : pageSkip;\n\n            that._currentRangeStart = skip;\n\n            that._take = take;\n\n            var paging = that.options.serverPaging;\n            var sorting = that.options.serverSorting;\n            var filtering = that.options.serverFiltering;\n            var aggregates = that.options.serverAggregates;\n            try {\n                that.options.serverPaging = true;\n                if (!that._isServerGrouped() && !(that.group() && that.group().length)) {\n                    that.options.serverSorting = true;\n                }\n                that.options.serverFiltering = true;\n                that.options.serverPaging = true;\n                that.options.serverAggregates = true;\n\n                if (paging) {\n                    that._detachObservableParents();\n                    that._data = data = that._observe(data);\n                }\n                that._process(data, eventData);\n            } finally {\n                that.options.serverPaging = paging;\n                that.options.serverSorting = sorting;\n                that.options.serverFiltering = filtering;\n                that.options.serverAggregates = aggregates;\n            }\n        },\n\n        skip: function() {\n            var that = this;\n\n            if (that._skip === undefined) {\n                return (that._page !== undefined ? (that._page  - 1) * (that.take() || 1) : undefined);\n            }\n            return that._skip;\n        },\n\n        currentRangeStart: function() {\n            return this._currentRangeStart || 0;\n        },\n\n        take: function() {\n            return this._take || this._pageSize;\n        },\n\n        _prefetchSuccessHandler: function (skip, size, callback, force) {\n            var that = this;\n            var timestamp = that._timeStamp();\n\n            return function(data) {\n                var found = false,\n                    range = { start: skip, end: size, data: [], timestamp: that._timeStamp() },\n                    idx,\n                    length,\n                    temp;\n\n                that._dequeueRequest();\n\n                that.trigger(REQUESTEND, { response: data, type: \"read\" });\n\n                data = that.reader.parse(data);\n\n                temp = that._readData(data);\n\n                if (temp.length) {\n                    for (idx = 0, length = that._ranges.length; idx < length; idx++) {\n                        if (that._ranges[idx].start === skip) {\n                            found = true;\n                            range = that._ranges[idx];\n\n                            if (!that._isGroupPaged()) {\n                                range.pristineData = temp;\n                                range.data = that._observe(temp);\n                                range.end = range.start + that._flatData(range.data, true).length;\n                                that._sortRanges();\n                            }\n\n                            break;\n                        }\n                    }\n\n                    if (!found) {\n                        that._addRange(that._observe(temp), skip);\n                    }\n                }\n\n                that._total = that.reader.total(data);\n\n                if (force || (timestamp >= that._currentRequestTimeStamp || !that._skipRequestsInProgress)) {\n                    if (callback && temp.length) {\n                        callback();\n                    } else {\n                        that.trigger(CHANGE, {});\n                    }\n                }\n            };\n        },\n\n        prefetch: function(skip, take, callback) {\n            var that = this,\n                size = math.min(skip + take, that.total()),\n                options = {\n                    take: take,\n                    skip: skip,\n                    page: skip / take + 1,\n                    pageSize: take,\n                    sort: that._sort,\n                    filter: that._filter,\n                    group: that._group,\n                    aggregate: that._aggregate\n                };\n\n\n            if ((that._isGroupPaged() && !that._isServerGrouped() && that._groupRangeExists(skip, size))) {\n                if (callback) {\n                    callback();\n                }\n                return;\n            }\n\n            if ((that._isServerGroupPaged() && !that._groupRangeExists(skip, size)) || !that._rangeExists(skip, size)) {\n                clearTimeout(that._timeout);\n\n                that._timeout = setTimeout(function() {\n                    that._queueRequest(options, function() {\n                        if (!that.trigger(REQUESTSTART, { type: \"read\" })) {\n                            if (that._omitPrefetch) {\n                                that.trigger(PROGRESS);\n                            }\n                            that.transport.read({\n                                data: that._params(options),\n                                success: that._prefetchSuccessHandler(skip, size, callback),\n                                error: function() {\n                                    var args = slice.call(arguments);\n                                    that.error.apply(that, args);\n                                }\n                            });\n                        } else {\n                            that._dequeueRequest();\n                        }\n                    });\n                }, 100);\n            } else if (callback) {\n                callback();\n            }\n        },\n\n        _multiplePrefetch: function(skip, take, callback) {\n            var that = this,\n                size = math.min(skip + take, that.total()),\n                options = {\n                    take: take,\n                    skip: skip,\n                    page: skip / take + 1,\n                    pageSize: take,\n                    sort: that._sort,\n                    filter: that._filter,\n                    group: that._group,\n                    aggregate: that._aggregate\n                };\n\n            if (!that._rangeExists(skip, size)) {\n                if (!that.trigger(REQUESTSTART, { type: \"read\" })) {\n                    that.transport.read({\n                        data: that._params(options),\n                        success: that._prefetchSuccessHandler(skip, size, callback, true)\n                    });\n                }\n            } else if (callback) {\n                callback();\n            }\n        },\n\n        _adjustPageSkip: function (start, take) {\n            var that = this;\n            var prevRange = that._getPrevRange(start);\n            var result;\n            var total = that.total();\n            var mismatch;\n\n            if (prevRange) {\n                mismatch = that._getRangesMismatch(start);\n\n                if (!mismatch) {\n                    return start;\n                }\n                start -= mismatch;\n            }\n            result = math.max(math.floor(start / take), 0) * take;\n\n            if (result > total) {\n                while (true) {\n                    result -= take;\n                    if (result < total) {\n                        break;\n                    }\n                }\n            }\n            return result;\n        },\n\n        _getNextRange: function (end) {\n            var that = this,\n                ranges = that._ranges,\n                idx,\n                length;\n\n            for (idx = 0, length = ranges.length; idx < length; idx++) {\n                if (ranges[idx].start <= end && ranges[idx].end >= end) {\n                    return ranges[idx];\n                }\n            }\n        },\n\n        _getPrevRange: function (start) {\n            var that = this,\n                ranges = that._ranges,\n                idx,\n                range,\n                length = ranges.length;\n\n            for (idx = length - 1; idx >= 0; idx--) {\n                if (ranges[idx].outerStart <= start) {\n                    range = ranges[idx];\n                    break;\n                }\n\n            }\n\n            return range;\n        },\n\n        _rangeExists: function(start, end) {\n            var that = this,\n                ranges = that._ranges,\n                idx,\n                length;\n\n            for (idx = 0, length = ranges.length; idx < length; idx++) {\n                if (ranges[idx].start <= start && ranges[idx].end >= end) {\n                    return true;\n                }\n            }\n\n            return false;\n        },\n\n        _groupRangeExists: function (start, end) {\n            var that = this,\n                ranges = that._ranges,\n                idx,\n                length,\n                availableItemsCount = 0,\n                total = that.groupsTotal(true);\n\n            if (end > total && !that._isServerGrouped()) {\n                end = total;\n            }\n\n            for (idx = 0, length = ranges.length; idx < length; idx++) {\n                var range = ranges[idx];\n                if (range.outerStart <= start && range.outerEnd >= start) {\n                    availableItemsCount += range.outerEnd - start;\n                } else if (range.outerStart <= end && range.outerEnd >= end) {\n                    availableItemsCount += end - range.outerStart;\n                }\n            }\n\n            return availableItemsCount >= end - start;\n        },\n\n        _getCurrentRangeSpan: function() {\n            var that = this;\n            var ranges = that._ranges;\n            var start = that.currentRangeStart();\n            var end = start + (that.take() || 0);\n            var rangeSpan = [];\n            var range;\n            var idx;\n            var length = ranges.length;\n\n            for (idx = 0; idx < length; idx++) {\n                range = ranges[idx];\n\n                if ((range.start <= start && range.end >= start) || (range.start >= start && range.start <= end)) {\n                    rangeSpan.push(range);\n                }\n            }\n\n            return rangeSpan;\n        },\n\n        _removeModelFromRanges: function(model) {\n            var that = this;\n            var range;\n\n            for (var idx = 0, length = this._ranges.length; idx < length; idx++) {\n                range = this._ranges[idx];\n\n                that._removeModelFromRange(range, model);\n            }\n\n            that._updateRangesLength();\n        },\n\n        _removeModelFromRange: function(range, model) {\n            this._eachItem(range.data, function(data) {\n                if (!data) {\n                    return;\n                }\n                for (var idx = 0; idx < data.length; idx++) {\n                    var dataItem = data[idx];\n\n                    if (dataItem.uid && dataItem.uid == model.uid) {\n                        [].splice.call(data, idx, 1);\n                        break;\n                    }\n                }\n            });\n        },\n\n        _insertModelInRange: function(index, model) {\n            var that = this;\n            var ranges = that._ranges || [];\n            var rangesLength = ranges.length;\n            var range;\n            var i;\n\n            for (i = 0; i < rangesLength; i++) {\n                range = ranges[i];\n\n                if (range.start <= index && range.end >= index) {\n                    if (!that._getByUid(model.uid, range.data)) {\n                        if (that._isServerGrouped()) {\n                            range.data.splice(index, 0, that._wrapInEmptyGroup(model));\n                        } else {\n                            range.data.splice(index, 0, model);\n                        }\n                    }\n\n                    break;\n                }\n            }\n\n            that._updateRangesLength();\n        },\n\n        _updateRangesLength: function() {\n            var that = this;\n            var ranges = that._ranges || [];\n            var rangesLength = ranges.length;\n            var mismatchFound = false;\n            var mismatchLength = 0;\n            var lengthDifference = 0;\n            var rangeLength;\n            var range;\n            var i;\n\n            for (i = 0; i < rangesLength; i++) {\n                range = ranges[i];\n                rangeLength = that._isGroupPaged() ? range.data.length : that._flatData(range.data, true).length;\n                lengthDifference = rangeLength - math.abs(range.end - range.start);\n\n                if (!mismatchFound && lengthDifference !== 0) {\n                    mismatchFound = true;\n                    mismatchLength = lengthDifference;\n                    range.end += mismatchLength;\n                    continue;\n                }\n\n                if (mismatchFound) {\n                    range.start += mismatchLength;\n                    range.end += mismatchLength;\n                }\n            }\n        },\n\n        _updateOuterRangesLength: function () {\n            var that = this;\n            var ranges = that._ranges || [];\n            var rangesLength = ranges.length;\n            var mismatchLength = 0;\n            var range;\n            var i;\n            var prevRange;\n            var rangeLength;\n\n            for (i = 0; i < rangesLength; i++) {\n                range = ranges[i];\n                rangeLength = that._isGroupPaged() ? that._calculateGroupsTotal(range.data, true, \"items\", true) : that._flatData(range.data, true).length;\n\n                if (prevRange) {\n                    if (prevRange.end != range.start) {\n                        mismatchLength = range.start - prevRange.end;\n                    }\n                    range.outerStart = prevRange.outerEnd + mismatchLength;\n                    mismatchLength = 0;\n                } else {\n                    range.outerStart = range.start;\n                }\n\n                range.outerEnd = range.outerStart + rangeLength;\n                prevRange = range;\n            }\n        }\n    });\n\n    var Transport = {};\n\n    Transport.create = function(options, data, dataSource) {\n        var transport,\n            transportOptions = options.transport ? $.extend({}, options.transport) : null;\n\n        if (transportOptions) {\n            transportOptions.read = typeof transportOptions.read === STRING ? { url: transportOptions.read } : transportOptions.read;\n\n            if (options.type === \"jsdo\") {\n                transportOptions.dataSource = dataSource;\n            }\n\n            if (options.type) {\n                kendo.data.transports = kendo.data.transports || {};\n                kendo.data.schemas = kendo.data.schemas || {};\n\n                if (!kendo.data.transports[options.type]) {\n                    kendo.logToConsole(\"Unknown DataSource transport type '\" + options.type + \"'.\\nVerify that registration scripts for this type are included after Kendo UI on the page.\", \"warn\");\n                } else if (!isPlainObject(kendo.data.transports[options.type])) {\n                    transport = new kendo.data.transports[options.type](extend(transportOptions, { data: data }));\n                } else {\n                    transportOptions = extend(true, {}, kendo.data.transports[options.type], transportOptions);\n                }\n\n                options.schema = extend(true, {}, kendo.data.schemas[options.type], options.schema);\n            }\n\n            if (!transport) {\n                transport = isFunction(transportOptions.read) ? transportOptions : new RemoteTransport(transportOptions);\n            }\n        } else {\n            transport = new LocalTransport({ data: options.data || [] });\n        }\n        return transport;\n    };\n\n    DataSource.create = function(options) {\n        if (isArray(options) || options instanceof ObservableArray) {\n           options = { data: options };\n        }\n\n        var dataSource = options || {},\n            data = dataSource.data,\n            fields = dataSource.fields,\n            table = dataSource.table,\n            select = dataSource.select,\n            idx,\n            length,\n            model = {},\n            field;\n\n        if (!data && fields && !dataSource.transport) {\n            if (table) {\n                data = inferTable(table, fields);\n            } else if (select) {\n                data = inferSelect(select, fields);\n\n                if (dataSource.group === undefined && data[0] && data[0].optgroup !== undefined) {\n                    dataSource.group = \"optgroup\";\n                }\n            }\n        }\n\n        if (kendo.data.Model && fields && (!dataSource.schema || !dataSource.schema.model)) {\n            for (idx = 0, length = fields.length; idx < length; idx++) {\n                field = fields[idx];\n                if (field.type) {\n                    model[field.field] = field;\n                }\n            }\n\n            if (!isEmptyObject(model)) {\n                dataSource.schema = extend(true, dataSource.schema, { model:  { fields: model } });\n            }\n        }\n\n        dataSource.data = data;\n\n        select = null;\n        dataSource.select = null;\n        table = null;\n        dataSource.table = null;\n\n        return dataSource instanceof DataSource ? dataSource : new DataSource(dataSource);\n    };\n\n    function inferSelect(select, fields) {\n        select = $(select)[0];\n        var options = select.options;\n        var firstField = fields[0];\n        var secondField = fields[1];\n\n        var data = [];\n        var idx, length;\n        var optgroup;\n        var option;\n        var record;\n        var value;\n\n        for (idx = 0, length = options.length; idx < length; idx++) {\n            record = {};\n            option = options[idx];\n            optgroup = option.parentNode;\n\n            if (optgroup === select) {\n                optgroup = null;\n            }\n\n            if (option.disabled || (optgroup && optgroup.disabled)) {\n                continue;\n            }\n\n            if (optgroup) {\n                record.optgroup = optgroup.label;\n            }\n\n            record[firstField.field] = option.text;\n\n            value = option.attributes.value;\n\n            if (value && value.specified) {\n                value = option.value;\n            } else {\n                value = option.text;\n            }\n\n            record[secondField.field] = value;\n\n            data.push(record);\n        }\n\n        return data;\n    }\n\n    function inferTable(table, fields) {\n        var tbody = $(table)[0].tBodies[0],\n        rows = tbody ? tbody.rows : [],\n        idx,\n        length,\n        fieldIndex,\n        fieldCount = fields.length,\n        data = [],\n        cells,\n        record,\n        cell,\n        empty;\n\n        for (idx = 0, length = rows.length; idx < length; idx++) {\n            record = {};\n            empty = true;\n            cells = rows[idx].cells;\n\n            for (fieldIndex = 0; fieldIndex < fieldCount; fieldIndex++) {\n                cell = cells[fieldIndex];\n                if(cell.nodeName.toLowerCase() !== \"th\") {\n                    empty = false;\n                    record[fields[fieldIndex].field] = cell.innerHTML;\n                }\n            }\n            if(!empty) {\n                data.push(record);\n            }\n        }\n\n        return data;\n    }\n\n    var Node = Model.define({\n        idField: \"id\",\n\n        init: function(value) {\n            var that = this,\n                hasChildren = that.hasChildren || value && value.hasChildren,\n                childrenField = \"items\",\n                childrenOptions = {};\n\n            kendo.data.Model.fn.init.call(that, value);\n\n            if (typeof that.children === STRING) {\n                childrenField = that.children;\n            }\n\n            childrenOptions = {\n                schema: {\n                    data: childrenField,\n                    model: {\n                        hasChildren: hasChildren,\n                        id: that.idField,\n                        fields: that.fields\n                    }\n                }\n            };\n\n            if (typeof that.children !== STRING) {\n                extend(childrenOptions, that.children);\n            }\n\n            childrenOptions.data = value;\n\n            if (!hasChildren) {\n                hasChildren = childrenOptions.schema.data;\n            }\n\n            if (typeof hasChildren === STRING) {\n                hasChildren = kendo.getter(hasChildren);\n            }\n\n            if (isFunction(hasChildren)) {\n                var hasChildrenObject = hasChildren.call(that, that);\n\n                if(hasChildrenObject && hasChildrenObject.length === 0){\n                    that.hasChildren = false;\n                } else{\n                    that.hasChildren = !!hasChildrenObject;\n                }\n            }\n\n            that._childrenOptions = childrenOptions;\n\n            if (that.hasChildren) {\n                that._initChildren();\n            }\n\n            that._loaded = !!(value && value._loaded);\n        },\n\n        _initChildren: function() {\n            var that = this;\n            var children, transport, parameterMap;\n\n            if (!(that.children instanceof HierarchicalDataSource)) {\n                children = that.children = new HierarchicalDataSource(that._childrenOptions);\n\n                transport = children.transport;\n                parameterMap = transport.parameterMap;\n\n                transport.parameterMap = function(data, type) {\n                    data[that.idField || \"id\"] = that.id;\n\n                    if (parameterMap) {\n                        data = parameterMap.call(that, data, type);\n                    }\n\n                    return data;\n                };\n\n                children.parent = function(){\n                    return that;\n                };\n\n                children.bind(CHANGE, function(e){\n                    e.node = e.node || that;\n                    that.trigger(CHANGE, e);\n                });\n\n                children.bind(ERROR, function(e){\n                    var collection = that.parent();\n\n                    if (collection) {\n                        e.node = e.node || that;\n                        collection.trigger(ERROR, e);\n                    }\n                });\n\n                children.bind(ITEMSLOADED, function (e) {\n                    var collection = that.parent();\n\n                    if (collection) {\n                        collection.trigger(ITEMSLOADED, e);\n                    }\n                });\n\n                that._updateChildrenField();\n            }\n        },\n\n        append: function(model) {\n            this._initChildren();\n            this.loaded(true);\n            this.children.add(model);\n        },\n\n        hasChildren: false,\n\n        level: function() {\n            var parentNode = this.parentNode(),\n                level = 0;\n\n            while (parentNode && parentNode.parentNode) {\n                level++;\n                parentNode = parentNode.parentNode ? parentNode.parentNode() : null;\n            }\n\n            return level;\n        },\n\n        _updateChildrenField: function() {\n            var fieldName = this._childrenOptions.schema.data;\n\n            this[fieldName || \"items\"] = this.children.data();\n        },\n\n        _childrenLoaded: function() {\n            this._loaded = true;\n\n            this._updateChildrenField();\n        },\n\n        load: function() {\n            var options = {};\n            var method = \"_query\";\n            var children, promise;\n\n            if (this.hasChildren) {\n                this._initChildren();\n\n                children = this.children;\n\n                options[this.idField || \"id\"] = this.id;\n\n                if (!this._loaded) {\n                    children._data = undefined;\n                    method = \"read\";\n                }\n\n                children.one(CHANGE, this._childrenLoaded.bind(this));\n\n                if(this._matchFilter){\n                    options.filter = { field: '_matchFilter', operator: 'eq', value: true };\n                }\n\n                promise = children[method](options);\n                if (!this._loaded) {\n                    this.trigger(ITEMLOAD, {promise: promise, node: this});\n                }\n            } else {\n                this.loaded(true);\n            }\n\n            return promise || $.Deferred().resolve().promise();\n        },\n\n        parentNode: function() {\n            var array = this.parent();\n\n            return array.parent();\n        },\n\n        loaded: function(value) {\n            if (value !== undefined) {\n                this._loaded = value;\n            } else {\n                return this._loaded;\n            }\n        },\n\n        shouldSerialize: function(field) {\n            return Model.fn.shouldSerialize.call(this, field) &&\n                    field !== \"children\" &&\n                    field !== \"_loaded\" &&\n                    field !== \"hasChildren\" &&\n                    field !== \"_childrenOptions\";\n        }\n    });\n\n    function dataMethod(name) {\n        return function() {\n            var data = this._data,\n                result = DataSource.fn[name].apply(this, slice.call(arguments));\n\n            if (this._data != data) {\n                this._attachBubbleHandlers();\n            }\n\n            return result;\n        };\n    }\n\n    var HierarchicalDataSource = DataSource.extend({\n        init: function(options) {\n            var node = Node.define({\n                children: options\n            });\n\n            if(options.filter && !options.serverFiltering){\n                this._hierarchicalFilter = options.filter;\n                options.filter = null;\n            }\n\n            DataSource.fn.init.call(this, extend(true, {}, { schema: { modelBase: node, model: node } }, options));\n\n            this._attachBubbleHandlers();\n        },\n\n        _attachBubbleHandlers: function() {\n            var that = this;\n\n            that._data.bind(ERROR, function(e) {\n                that.trigger(ERROR, e);\n            });\n\n            that._data.bind(ITEMSLOADED, function(e) {\n                that.trigger(ITEMSLOADED, e);\n            });\n        },\n\n        loading: function () {\n            if(this._data) {\n                return this._data.loading() || this._childrenLoading();\n            }\n            return false;\n        },\n\n        _childrenLoading: function () {\n            var isLoading = false;\n            this._data.forEach(function (node) {\n                if(node.hasChildren && node.children.loading()) {\n                    isLoading = true;\n                }\n            });\n            return isLoading;\n        },\n\n        read: function(data) {\n            var result = DataSource.fn.read.call(this, data);\n\n            if(this._hierarchicalFilter){\n                if(this._data && this._data.length > 0){\n                    this.filter(this._hierarchicalFilter);\n                }else{\n                    this.options.filter = this._hierarchicalFilter;\n                    this._filter = normalizeFilter(this.options.filter);\n                    this._hierarchicalFilter = null;\n                }\n            }\n\n            return result;\n        },\n\n        remove: function(node){\n            var parentNode = node.parentNode(),\n                dataSource = this,\n                result;\n\n            if (parentNode && parentNode._initChildren) {\n                dataSource = parentNode.children;\n            }\n\n            result = DataSource.fn.remove.call(dataSource, node);\n\n            if (parentNode && !dataSource.data().length) {\n                parentNode.hasChildren = false;\n            }\n\n            return result;\n        },\n\n        success: dataMethod(\"success\"),\n\n        data: dataMethod(\"data\"),\n\n        insert: function(index, model) {\n            var parentNode = this.parent();\n\n            if (parentNode && parentNode._initChildren) {\n                parentNode.hasChildren = true;\n                parentNode._initChildren();\n            }\n\n            return DataSource.fn.insert.call(this, index, model);\n        },\n\n        filter: function(val) {\n            if (val === undefined) {\n                 return this._filter;\n            }\n\n            if(!this.options.serverFiltering && this._markHierarchicalQuery(val)){\n                val = { logic: \"or\", filters: [val, {field:'_matchFilter', operator: 'equals', value: true }]};\n            }\n\n            this.trigger(\"reset\");\n            this._query({ filter: val, page: 1 });\n        },\n\n        _markHierarchicalQuery: function(expressions){\n            var compiled;\n            var predicate;\n            var fields;\n            var operators;\n            var filter;\n            var accentFoldingFiltering = this.options.accentFoldingFiltering;\n\n            expressions = accentFoldingFiltering ? $.extend({}, normalizeFilter(expressions), { accentFoldingFiltering: accentFoldingFiltering}) : normalizeFilter(expressions);\n\n            if (!expressions || expressions.filters.length === 0) {\n                this._updateHierarchicalFilter(function(){return true;});\n                return false;\n            }\n\n            compiled = Query.filterExpr(expressions);\n            fields = compiled.fields;\n            operators = compiled.operators;\n\n            predicate = filter = new Function(\"d, __f, __o\", \"return \" + compiled.expression);\n\n            if (fields.length || operators.length) {\n                filter = function(d) {\n                    return predicate(d, fields, operators);\n                };\n            }\n\n            this._updateHierarchicalFilter(filter);\n            return true;\n        },\n\n         _updateHierarchicalFilter: function(filter){\n            var current;\n            var data = this._data;\n            var result = false;\n\n            for (var idx = 0; idx < data.length; idx++) {\n                 current = data[idx];\n\n                 if(current.hasChildren){\n                     current._matchFilter = current.children._updateHierarchicalFilter(filter);\n                    if(!current._matchFilter){\n                        current._matchFilter = filter(current);\n                    }\n                }else{\n                    current._matchFilter = filter(current);\n                }\n\n                if(current._matchFilter){\n                    result = true;\n                }\n            }\n            return result;\n        },\n\n        _find: function(method, value) {\n            var idx, length, node, children;\n            var data = this._data;\n\n            if (!data) {\n                return;\n            }\n\n            node = DataSource.fn[method].call(this, value);\n\n            if (node) {\n                return node;\n            }\n\n            data = this._flatData(this._data);\n\n            for (idx = 0, length = data.length; idx < length; idx++) {\n                children = data[idx].children;\n\n                if (!(children instanceof HierarchicalDataSource)) {\n                    continue;\n                }\n\n                node = children[method](value);\n\n                if (node) {\n                    return node;\n                }\n            }\n        },\n\n        get: function(id) {\n            return this._find(\"get\", id);\n        },\n\n        getByUid: function(uid) {\n            return this._find(\"getByUid\", uid);\n        }\n    });\n\n    function inferList(list, fields) {\n        var items = $(list).children(),\n            idx,\n            length,\n            data = [],\n            record,\n            textField = fields[0].field,\n            urlField = fields[1] && fields[1].field,\n            spriteCssClassField = fields[2] && fields[2].field,\n            imageUrlField = fields[3] && fields[3].field,\n            item,\n            id,\n            textChild,\n            className,\n            children;\n\n        function elements(collection, tagName) {\n            return collection.filter(tagName).add(collection.find(tagName));\n        }\n\n        for (idx = 0, length = items.length; idx < length; idx++) {\n            record = { _loaded: true };\n            item = items.eq(idx);\n\n            textChild = item[0].firstChild;\n            children = item.children();\n            list = children.filter(\"ul\");\n            children = children.filter(\":not(ul)\");\n\n            id = item.attr(\"data-id\");\n\n            if (id) {\n                record.id = id;\n            }\n\n            if (textChild) {\n                record[textField] = textChild.nodeType == 3 ? textChild.nodeValue : children.text();\n            }\n\n            if (urlField) {\n                record[urlField] = elements(children, \"a\").attr(\"href\");\n            }\n\n            if (imageUrlField) {\n                record[imageUrlField] = elements(children, \"img\").attr(\"src\");\n            }\n\n            if (spriteCssClassField) {\n                className = elements(children, \".k-sprite\").prop(\"className\");\n                record[spriteCssClassField] = className && kendo.trim(className.replace(\"k-sprite\", \"\"));\n            }\n\n            if (list.length) {\n                record.items = inferList(list.eq(0), fields);\n            }\n\n            if (item.attr(\"data-hasChildren\") == \"true\") {\n                record.hasChildren = true;\n            }\n\n            data.push(record);\n        }\n\n        return data;\n    }\n\n    HierarchicalDataSource.create = function(options) {\n        options = options && options.push ? { data: options } : options;\n\n        var dataSource = options || {},\n            data = dataSource.data,\n            fields = dataSource.fields,\n            list = dataSource.list;\n\n        if (data && data._dataSource) {\n            return data._dataSource;\n        }\n\n        if (!data && fields && !dataSource.transport) {\n            if (list) {\n                data = inferList(list, fields);\n            }\n        }\n\n        dataSource.data = data;\n\n        return dataSource instanceof HierarchicalDataSource ? dataSource : new HierarchicalDataSource(dataSource);\n    };\n\n    var Buffer = kendo.Observable.extend({\n        init: function(dataSource, viewSize, disablePrefetch) {\n            kendo.Observable.fn.init.call(this);\n\n            this._prefetching = false;\n            this.dataSource = dataSource;\n            this.prefetch = !disablePrefetch;\n\n            var buffer = this;\n\n            dataSource.bind(\"change\", function() {\n                buffer._change();\n            });\n\n            dataSource.bind(\"reset\", function() {\n                buffer._reset();\n            });\n\n            this._syncWithDataSource();\n\n            this.setViewSize(viewSize);\n        },\n\n        setViewSize: function(viewSize) {\n            this.viewSize = viewSize;\n            this._recalculate();\n        },\n\n        at: function(index)  {\n            var pageSize = this.pageSize,\n                itemPresent = true;\n\n            if (index >= this.total()) {\n                this.trigger(\"endreached\", {index: index });\n                return null;\n            }\n\n            if (!this.useRanges) {\n               return this.dataSource.view()[index];\n            }\n            if (this.useRanges) {\n                // out of range request\n                if (index < this.dataOffset || index >= this.skip + pageSize) {\n                    itemPresent = this.range(Math.floor(index / pageSize) * pageSize);\n                }\n\n                // prefetch\n                if (index === this.prefetchThreshold) {\n                    this._prefetch();\n                }\n\n                // mid-range jump - prefetchThreshold and nextPageThreshold may be equal, do not change to else if\n                if (index === this.midPageThreshold) {\n                    this.range(this.nextMidRange, true);\n                }\n                // next range jump\n                else if (index === this.nextPageThreshold) {\n                    this.range(this.nextFullRange);\n                }\n                // pull-back\n                else if (index === this.pullBackThreshold) {\n                    if (this.offset === this.skip) { // from full range to mid range\n                        this.range(this.previousMidRange);\n                    } else { // from mid range to full range\n                        this.range(this.previousFullRange);\n                    }\n                }\n\n                if (itemPresent) {\n                    return this.dataSource.at(index - this.dataOffset);\n                } else {\n                    this.trigger(\"endreached\", { index: index });\n                    return null;\n                }\n            }\n        },\n\n        indexOf: function(item) {\n            return this.dataSource.data().indexOf(item) + this.dataOffset;\n        },\n\n        total: function() {\n            return parseInt(this.dataSource.total(), 10);\n        },\n\n        next: function() {\n            var buffer = this,\n                pageSize = buffer.pageSize,\n                offset = buffer.skip - buffer.viewSize + pageSize,\n                pageSkip = math.max(math.floor(offset / pageSize), 0) * pageSize;\n\n            this.offset = offset;\n            this.dataSource.prefetch(pageSkip, pageSize, function() {\n                buffer._goToRange(offset, true);\n            });\n        },\n\n        range: function(offset, nextRange) {\n            if (this.offset === offset) {\n                return true;\n            }\n\n            var buffer = this,\n                pageSize = this.pageSize,\n                pageSkip = math.max(math.floor(offset / pageSize), 0) * pageSize,\n                dataSource = this.dataSource;\n\n            if (nextRange) {\n                pageSkip += pageSize;\n            }\n\n            if (dataSource.inRange(offset, pageSize)) {\n                this.offset = offset;\n                this._recalculate();\n                this._goToRange(offset);\n                return true;\n            } else if (this.prefetch) {\n                dataSource.prefetch(pageSkip, pageSize, function() {\n                    buffer.offset = offset;\n                    buffer._recalculate();\n                    buffer._goToRange(offset, true);\n                });\n                return false;\n            }\n\n            return true;\n        },\n\n        syncDataSource: function() {\n            var offset = this.offset;\n            this.offset = null;\n            this.range(offset);\n        },\n\n        destroy: function() {\n            this.unbind();\n        },\n\n        _prefetch: function() {\n            var buffer = this,\n                pageSize = this.pageSize,\n                prefetchOffset = this.skip + pageSize,\n                dataSource = this.dataSource;\n\n            if (!dataSource.inRange(prefetchOffset, pageSize) && !this._prefetching && this.prefetch) {\n                this._prefetching = true;\n                this.trigger(\"prefetching\", { skip: prefetchOffset, take: pageSize });\n\n                dataSource.prefetch(prefetchOffset, pageSize, function() {\n                    buffer._prefetching = false;\n                    buffer.trigger(\"prefetched\", { skip: prefetchOffset, take: pageSize });\n                });\n            }\n        },\n\n        _goToRange: function(offset, expanding) {\n            if (this.offset !== offset) {\n                return;\n            }\n\n            this.dataOffset = offset;\n            this._expanding = expanding;\n            this.dataSource.range(offset, this.pageSize);\n            this.dataSource.enableRequestsInProgress();\n        },\n\n        _reset: function() {\n            this._syncPending = true;\n        },\n\n        _change: function() {\n            var dataSource = this.dataSource;\n\n            this.length = this.useRanges ? dataSource.lastRange().end : dataSource.view().length;\n\n            if (this._syncPending) {\n                this._syncWithDataSource();\n                this._recalculate();\n                this._syncPending = false;\n                this.trigger(\"reset\", { offset: this.offset });\n            }\n\n            this.trigger(\"resize\");\n\n            if (this._expanding) {\n                this.trigger(\"expand\");\n            }\n\n            delete this._expanding;\n        },\n\n        _syncWithDataSource: function() {\n            var dataSource = this.dataSource;\n\n            this._firstItemUid = dataSource.firstItemUid();\n            this.dataOffset = this.offset = dataSource.skip() || 0;\n            this.pageSize = dataSource.pageSize();\n            this.useRanges = dataSource.options.serverPaging;\n        },\n\n        _recalculate: function() {\n            var pageSize = this.pageSize,\n                offset = this.offset,\n                viewSize = this.viewSize,\n                skip = Math.ceil(offset / pageSize) * pageSize;\n\n            this.skip = skip;\n            this.midPageThreshold = skip + pageSize - 1;\n            this.nextPageThreshold = skip + viewSize - 1;\n            this.prefetchThreshold = skip + Math.floor(pageSize / 3 * 2);\n            this.pullBackThreshold = this.offset - 1;\n\n            this.nextMidRange = skip + pageSize - viewSize;\n            this.nextFullRange = skip;\n            this.previousMidRange = offset - viewSize;\n            this.previousFullRange = skip - pageSize;\n        }\n    });\n\n    var BatchBuffer = kendo.Observable.extend({\n        init: function(dataSource, batchSize) {\n            var batchBuffer = this;\n\n            kendo.Observable.fn.init.call(batchBuffer);\n\n            this.dataSource = dataSource;\n            this.batchSize = batchSize;\n            this._total = 0;\n\n            this.buffer = new Buffer(dataSource, batchSize * 3);\n\n            this.buffer.bind({\n                \"endreached\": function (e) {\n                    batchBuffer.trigger(\"endreached\", { index: e.index });\n                },\n                \"prefetching\": function (e) {\n                    batchBuffer.trigger(\"prefetching\", { skip: e.skip, take: e.take });\n                },\n                \"prefetched\": function (e) {\n                    batchBuffer.trigger(\"prefetched\", { skip: e.skip, take: e.take });\n                },\n                \"reset\": function () {\n                    batchBuffer._total = 0;\n                    batchBuffer.trigger(\"reset\");\n                },\n                \"resize\": function () {\n                    batchBuffer._total = Math.ceil(this.length / batchBuffer.batchSize);\n                    batchBuffer.trigger(\"resize\", { total: batchBuffer.total(), offset: this.offset });\n                }\n            });\n        },\n\n        syncDataSource: function() {\n            this.buffer.syncDataSource();\n        },\n\n        at: function(index) {\n            var buffer = this.buffer,\n                skip = index * this.batchSize,\n                take = this.batchSize,\n                view = [],\n                item;\n\n            if (buffer.offset > skip) {\n                buffer.at(buffer.offset - 1);\n            }\n\n            for (var i = 0; i < take; i++) {\n                item = buffer.at(skip + i);\n\n                if (item === null) {\n                    break;\n                }\n\n                view.push(item);\n            }\n\n            return view;\n        },\n\n        total: function() {\n            return this._total;\n        },\n\n        destroy: function() {\n            this.buffer.destroy();\n            this.unbind();\n        }\n    });\n\n    extend(true, kendo.data, {\n        readers: {\n            json: DataReader\n        },\n        Query: Query,\n        DataSource: DataSource,\n        HierarchicalDataSource: HierarchicalDataSource,\n        Node: Node,\n        Comparer: Comparer,\n        ObservableObject: ObservableObject,\n        ObservableArray: ObservableArray,\n        LazyObservableArray: LazyObservableArray,\n        LocalTransport: LocalTransport,\n        RemoteTransport: RemoteTransport,\n        Cache: Cache,\n        DataReader: DataReader,\n        Model: Model,\n        Buffer: Buffer,\n        BatchBuffer: BatchBuffer\n    });\n})(window.kendo.jQuery);\n\nreturn window.kendo;\n\n}, typeof define == 'function' && define.amd ? define : function(a1, a2, a3){ (a3 || a2)(); });\n\n"],"names":["define","__meta__","id","name","category","description","depends","features","$","window","kendo","jQuery","undefined","extend","isPlainObject","isEmptyObject","isArray","Array","grep","ajax","map","each","noop","isFunction","Observable","Class","STRING","FUNCTION","ASCENDING","CREATE","READ","UPDATE","DESTROY","CHANGE","SYNC","GET","ERROR","REQUESTSTART","PROGRESS","REQUESTEND","ITEMSLOADED","ITEMLOAD","crud","identity","o","getter","stringify","math","Math","push","join","pop","splice","shift","slice","unshift","toString","stableSort","support","dateRegExp","objectKeys","ObservableArray","init","array","type","that","this","ObservableObject","fn","call","length","wrapAll","_loadPromises","_loadedNodes","at","index","toJSON","serializeFunctions","idx","value","json","parent","source","target","wrap","object","observable","Model","bind","e","isGroup","hasOwnProperty","trigger","field","node","items","action","promise","_loading","done","indexOf","collection","nodes","loading","arguments","result","apply","omitChangeEvent","sort","howMany","item","i","len","concat","children","unbind","forEach","callback","thisArg","context","reduce","reduceRight","filter","find","every","some","remove","empty","Symbol","iterator","prototype","LazyObservableArray","data","events","parentFn","_events","_parent","eventHandler","prefix","event","key","_notifyChange","ownKeys","ignoreObjectKeys","props","keys","filteredObjectKeys","Object","getOwnPropertyNames","prop","getPrototypeOf","member","_handlers","getTime","charAt","uid","guid","shouldSerialize","f","get","_set","composite","paths","split","path","obj","set","setter","isSetPrevented","current","change","isObservableArray","isDataSource","DataSource","equal","x","y","xtype","ytype","parsers","number","toLowerCase","parseFloat","date","parseDate","boolean","string","default","defaultValues","Date","getFieldByName","fieldName","defaults","_initializers","dirty","dirtyFields","idField","_defaultId","_parse","fields","parse","editable","accept","isNew","Comparer","base","options","model","proto","originalName","functionFields","nullable","defaultValue","selector","compare","a","b","localeCompare","create","dir","combine","comparers","StableComparer","asc","valueA","valueB","__position","desc","operators","quote","str","replace","JSON","textOp","impl","ignore","accentFoldingFiltering","toLocaleLowerCase","operator","op","exec","getMatchRegexp","pattern","rx","esc","ch","eq","neq","gt","gte","lt","lte","startswith","doesnotstartwith","endswith","n","doesnotendwith","contains","doesnotcontain","matches","substring","doesnotmatch","isempty","isnotempty","isnull","isnotnull","isnullorempty","isnotnullorempty","Query","normalizeSort","descriptor","descriptors","d","sortFields","sorts","sortObject","filterExpr","expression","expressions","logic","and","or","expr","fieldFunctions","operatorFunctions","filters","match","ignoreCase","operatorMap","==","equals","isequalto","equalto","!=","ne","notequals","isnotequalto","notequalto","notequal","<","islessthan","lessthan","less","<=","le","islessthanorequalto","lessthanequal",">","isgreaterthan","greaterthan","greater",">=","isgreaterthanorequalto","greaterthanequal","ge","notsubstringof","normalizeOperator","normalizeFilter","compareDescriptor","f1","f2","normalizeDescriptor","fieldComparer","compareFilters","expr1","expr2","filters1","filters2","normalizeAggregate","normalizeGroup","skipItemSorting","aggregates","normalizeGroupWithoutCompare","anyGroupDescriptorHasCompare","groupDescriptors","groupValueComparer","calculateAggregate","accumulator","state","aggr","functionName","aggregate","functions","accessor","toArray","range","count","skip","take","select","order","inPlace","orderBy","orderByDescending","comparer","compiled","predicate","Function","group","allData","groupPaging","groupAllData","hasSubgroups","itemCount","subgroupCount","groupBy","sorted","_sortForGrouping","groupValue","currentValue","_sortGroups","groups","sum","isNumber","average","max","isDate","min","val","isNaN","process","customGroupSort","query","groupDescriptorsWithoutCompare","normalizedSort","groupDescriptorsWithoutSort","total","filterCallback","flatGroups","groupDescriptor","virtual","LocalTransport","read","success","update","destroy","RemoteTransport","parameterMap","url","cache","Cache","add","submit","option","setup","error","parameters","operation","_store","clear","serializeRecords","getters","modelInstance","originalFieldNames","fieldNames","record","setters","convertRecords","convertGroup","wrapDataAccess","originalFunction","converter","wrapDataAccessBase","store","inmemory","DataReader","schema","modelBase","dataFunction","_dataAccessFunction","groupsFunction","serializeFunction","serialize","serializeGetters","fromName","from","_wrapDataAccessBase","errors","fillLastGroup","originalGroup","newGroup","currOriginal","currentNew","mergeGroups","dest","indexFunction","groupsLength","indexFn","groupIndex","itemIndex","flattenGroups","wrapGroupItems","eachGroupItems","func","replaceInRanges","ranges","replaceInRange","replaceWithObservable","view","serverGrouping","viewIndex","removeModel","dataItem","indexOfPristineModel","indexOfModel","fieldNameFromModel","convertFilterDescriptorsField","convertDescriptorsField","_map","_prefetch","_data","_pristineData","_ranges","_view","_pristineTotal","_destroyed","_pageSize","pageSize","_page","page","_sort","_sortFields","_filter","_group","_aggregate","_total","_groupPaging","_groupsState","_shouldDetachObservableParents","transport","Transport","pushCreate","_pushCreate","pushUpdate","_pushUpdate","pushDestroy","_pushDestroy","offlineStorage","_storage","getItem","localStorage","setItem","reader","readers","_detachObservableParents","_observe","_online","serverSorting","serverPaging","serverFiltering","serverAggregates","batch","inPlaceSort","clone","online","sync","Deferred","resolve","offlineData","_isServerGrouped","_isServerGroupPaged","_isGroupPaged","_push","_readData","_flatData","useRanges","getByUid","_getByUid","dataItems","_storeData","_addRange","_process","_observeView","flatView","insert","_createNewModel","_wrapInEmptyGroup","_insertModelInRange","pushInsert","rangeSpan","_getCurrentRangeSpan","pushed","autoSync","pristine","last","pristineData","_updatePristineForModel","_removeItems","removePristine","shouldRemovePristine","destroyed","found","_eachItem","_removePristineForModel","pushMove","_moveItems","moved","hasGroups","_removeModelFromRanges","created","updated","promises","_sendSubmit","_send","when","then","_accept","_syncEnd","_change","cancelChanges","_cancelModel","_changesCanceled","_markOfflineUpdatesAsDirty","__state__","hasChanges","models","response","serverGroup","_handleCustomErrors","values","_executeOnPristineForModel","deepExtend","_eachPristineItem","_pristineForModel","_modelCanceled","_submit","status","reject","deferred","_promise","method","converted","params","_params","_queueRequest","isPrevented","args","_dequeueRequest","_readAggregates","replaceSubset","_serverGroupsTotal","_aggregateResult","itemIds","_skip","endless","j","_changeHandler","updatePristine","start","end","timestamp","_timeStamp","outerStart","outerEnd","_sortRanges","_groupsFlat","_appendToGroupsFlat","_updateOuterRangesLength","_getGroupByUid","xhr","errorThrown","_requestInProgress","_pending","_shouldWrap","arrayType","_updateTotalForAction","parseInt","handler","first","_calculateAggregates","_take","currentRangeStart","_clearEmptyGroups","_queryProcess","dataToAggregate","_setView","_setFilterTotal","_mergeState","_currentRangeStart","remote","moreItemsCount","_hasExpandedSubGroups","_findGroupedRange","parents","itemsLength","groupCount","itemsToSkip","taken","_fetchGroupItems","_fetchingGroupItems","skipped","includeParents","excludeHeader","currentItems","_expandedSubGroupItemsCount","includeCurrentItems","subGroup","endSpecified","temp","groupItemsSkip","firstItem","lastItem","groupItemCount","expandedSubGroupItemsCount","getGroupItems","notFetched","floor","round","subgroups","_composeItemsFilter","findSubgroups","clearTimeout","_timeout","setTimeout","_groupItemsSuccessHandler","totalField","totalCount","_updateRangePristineData","countAdded","_currentRequestTimeStamp","_skipRequestsInProgress","indexOfCurrentGroup","g","rangesLength","currentGroup","dataLength","indexes","currIdx","_containsSubGroup","_cloneGroup","subgroup","currentSubGroup","filterTotal","setDefaultValue","fetch","_query","next","totalPages","prev","_pageableQueryOptions","getGroupsFlat","groupsTotal","includeExpanded","_calculateGroupsTotal","itemsField","ignoreState","_groupsTotal","countGroupRange","_emptyAggregates","ceil","inRange","_findRange","lastRange","firstItemUid","enableRequestsInProgress","pageSkip","size","_processRangeData","_originalPageSkip","_originalSize","_adjustPageSkip","_groupRangeExists","_rangeExists","prefetch","skipIdx","takeIdx","startIndex","endIndex","rangeData","rangeEnd","processed","flatData","groupMapOptions","prevRangeEnd","isGroupPaged","startField","endField","currentDataLength","_mergeGroups","_getRangesMismatch","mismatch","prevGroup","eventData","_omitPrefetch","paging","sorting","filtering","_prefetchSuccessHandler","force","_multiplePrefetch","prevRange","_getPrevRange","_getNextRange","availableItemsCount","_removeModelFromRange","_updateRangesLength","mismatchFound","mismatchLength","lengthDifference","rangeLength","abs","inferSelect","firstField","secondField","optgroup","parentNode","disabled","label","text","attributes","specified","inferTable","table","tbody","tBodies","rows","fieldIndex","fieldCount","cells","cell","nodeName","innerHTML","dataSource","transportOptions","transports","schemas","logToConsole","Node","hasChildren","childrenField","childrenOptions","hasChildrenObject","_childrenOptions","_initChildren","_loaded","HierarchicalDataSource","_updateChildrenField","append","loaded","level","_childrenLoaded","load","one","_matchFilter","dataMethod","_attachBubbleHandlers","_hierarchicalFilter","_childrenLoading","isLoading","_markHierarchicalQuery","_updateHierarchicalFilter","_find","inferList","list","textField","urlField","spriteCssClassField","imageUrlField","textChild","className","elements","tagName","firstChild","attr","nodeType","nodeValue","trim","_dataSource","Buffer","viewSize","disablePrefetch","_prefetching","buffer","_reset","_syncWithDataSource","setViewSize","_recalculate","itemPresent","dataOffset","prefetchThreshold","midPageThreshold","nextMidRange","nextPageThreshold","nextFullRange","pullBackThreshold","offset","previousMidRange","previousFullRange","_goToRange","nextRange","syncDataSource","prefetchOffset","expanding","_expanding","_syncPending","_firstItemUid","BatchBuffer","batchSize","batchBuffer","endreached","prefetching","prefetched","reset","resize","amd","a1","a2","a3"],"mappings":"CAAA,SAAaA,QACTA,OAAO,aAAa,CAAE,aAAc,mBAAoB,kBACzD,WAEH,IAAIC,EAAW,CACXC,GAAI,OACJC,KAAM,cACNC,SAAU,YACVC,YAAa,gIACbC,QAAS,CAAE,QACXC,SAAU,CAAE,CACRL,GAAI,aACJC,KAAM,QACNE,YAAa,6DACbC,QAAS,CAAE,eACZ,CACCJ,GAAI,eACJC,KAAM,UACNE,YAAa,uCACbC,QAAS,CAAE,iBACZ,CACCJ,GAAI,WACJC,KAAM,MACNE,YAAa,8BACbC,QAAS,CAAE,eAKTE,EAi8MPC,OAAOC,MAAMC,OAj8MHC,OAAb,EACQC,EAASL,EAAEK,OACXC,EAAgBN,EAAEM,cAClBC,EAAgBP,EAAEO,cAClBC,EAAUC,MAAMD,QAChBE,EAAOV,EAAEU,KACTC,EAAOX,EAAEW,KACTC,EACAC,EAAOb,EAAEa,KACTC,EAAOd,EAAEc,KACTZ,EAAQD,OAAOC,MACfa,EAAab,EAAMa,WACnBC,EAAad,EAAMc,WACnBC,EAAQf,EAAMe,MACdC,EAAS,SACTC,EAAW,WACXC,EAAY,MACZC,EAAS,SACTC,EAAO,OACPC,EAAS,SACTC,EAAU,UACVC,EAAS,SACTC,EAAO,OACPC,EAAM,MACNC,EAAQ,QACRC,EAAe,eACfC,EAAW,WACXC,EAAa,aACbC,EAAc,cACdC,EAAW,WACXC,EAAO,CAACb,EAAQC,EAAMC,EAAQC,GAC9BW,EAAW,SAASC,GAAK,OAAOA,GAChCC,EAASnC,EAAMmC,OACfC,EAAYpC,EAAMoC,UAClBC,EAAOC,KACPC,EAAO,GAAGA,KACVC,EACAC,EAAM,GAAGA,IACTC,EAAS,GAAGA,OACZC,EAAQ,GAAGA,MACXC,EAAQ,GAAGA,MACXC,EAAU,GAAGA,QACbC,EAAW,GAAGA,SACdC,EAAa/C,EAAMgD,QAAQD,WAC3BE,EAAa,sBACbC,EAAa,GAEbC,EAAkBrC,EAAWX,OAAO,CACpCiD,KAAM,SAASC,EAAOC,GAClB,IAAIC,EAAOC,KAEXD,EAAKD,KAAOA,GAAQG,EAEpB3C,EAAW4C,GAAGN,KAAKO,KAAKJ,GAExBA,EAAKK,OAASP,EAAMO,OAEpBL,EAAKM,QAAQR,EAAOE,GACpBA,EAAKO,cAAgB,GACrBP,EAAKQ,aAAe,IAGxBC,GAAI,SAASC,GACT,OAAOT,KAAKS,IAGhBC,OAAQ,SAASC,GACb,IAAIC,EAAKR,EAASJ,KAAKI,OAAQS,EAAOC,EAAO,IAAI/D,MAAMqD,GAEvD,IAAKQ,EAAM,EAAGA,EAAMR,EAAQQ,IAAM,CAC9BC,EAAQb,KAAKY,GAEb,GAAIC,aAAiBZ,EACjBY,EAAQA,EAAMH,OAAOC,GAGzBG,EAAKF,GAAOC,EAGhB,OAAOC,GAGXC,OAAQ3D,EAERiD,QAAS,SAASW,EAAQC,GACtB,IAAIlB,EAAOC,KACPY,EACAR,EACAW,EAAS,WACL,OAAOhB,GAGfkB,EAASA,GAAU,GAEnB,IAAKL,EAAM,EAAGR,EAASY,EAAOZ,OAAQQ,EAAMR,EAAQQ,IAChDK,EAAOL,GAAOb,EAAKmB,KAAKF,EAAOJ,GAAMG,GAGzC,OAAOE,GAGXC,KAAM,SAASC,EAAQJ,GACnB,IAAIhB,EAAOC,KACPoB,EAEJ,GAAID,IAAW,MAAQ7B,EAASa,KAAKgB,KAAY,kBAAmB,CAChEC,EAAaD,aAAkBpB,EAAKD,MAAQqB,aAAkBE,GAE9D,IAAKD,EAAY,CACbD,EAASA,aAAkBlB,EAAmBkB,EAAOT,SAAWS,EAChEA,EAAS,IAAIpB,EAAKD,KAAKqB,GAG3BA,EAAOJ,OAASA,EAEhBI,EAAOG,KAAKvD,EAAQ,SAASwD,GACzB,IAAIC,EAAUL,EAAOM,eAAe,gBACpC1B,EAAK2B,QAAQ3D,EAAQ,CACjB4D,MAAOJ,EAAEI,MACTC,KAAML,EAAEK,KACRnB,MAAOc,EAAEd,MACToB,MAAON,EAAEM,OAAS,CAAC7B,MACnB8B,OAAQP,EAAEK,MAAQJ,EAAWD,EAAEO,QAAU,aAAgB,iBAIjEX,EAAOG,KAAK/C,EAAU,SAAUgD,GAC5BxB,EAAKO,cAAcvB,KAAKwC,EAAEQ,SAC1BhC,EAAKiC,SAAW,KAEhBT,EAAEQ,QAAQE,KAAK,WACXlC,EAAKQ,aAAaxB,KAAKwC,EAAEK,MACzB,IAAInB,EAAQV,EAAKO,cAAc4B,QAAQX,EAAEQ,SACzChC,EAAKO,cAAcpB,OAAOuB,EAAO,GAEjC,IAAIV,EAAKO,cAAcF,OAAO,CAC1BL,EAAKiC,SAAW,MAChBjC,EAAK2B,QAAQpD,EAAa,CAAC6D,WAAYpC,EAAMqC,MAAOrC,EAAKQ,eACzDR,EAAKQ,aAAe,QAMpC,OAAOY,GAGXkB,QAAS,WACL,OAAOrC,KAAKgC,UAGhBjD,KAAM,WACF,IAAI0B,EAAQT,KAAKI,OACbyB,EAAQ7B,KAAKK,QAAQiC,WACrBC,EAEJA,EAASxD,EAAKyD,MAAMxC,KAAM6B,GAE1B,IAAK7B,KAAKyC,gBACNzC,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,MACRrB,MAAOA,EACPoB,MAAOA,IAIf,OAAOU,GAGXnD,MAAOA,EAEPsD,KAAM,GAAGA,KAET1D,KAzIO,GAAGA,KA2IVC,IAAK,WACD,IAAImB,EAASJ,KAAKI,OAAQmC,EAAStD,EAAIuD,MAAMxC,MAE7C,GAAII,EACAJ,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,SACRrB,MAAOL,EAAS,EAChByB,MAAM,CAACU,KAIf,OAAOA,GAGXrD,OAAQ,SAASuB,EAAOkC,EAASC,GAC7B,IAAIf,EAAQ7B,KAAKK,QAAQjB,EAAMe,KAAKmC,UAAW,IAC3CC,EAAQM,EAAGC,EAEfP,EAASrD,EAAOsD,MAAMxC,KAAM,CAACS,EAAOkC,GAASI,OAAOlB,IAEpD,GAAIU,EAAOnC,OAAQ,CACf,IAAKJ,KAAKyC,gBACNzC,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,SACRrB,MAAOA,EACPoB,MAAOU,IAIf,IAAKM,EAAI,EAAGC,EAAMP,EAAOnC,OAAQyC,EAAIC,EAAKD,IACtC,GAAIN,EAAOM,IAAMN,EAAOM,GAAGG,SACvBT,EAAOM,GAAGI,OAAOlF,GAK7B,GAAI6E,EACA,IAAK5C,KAAKyC,gBACNzC,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,MACRrB,MAAOA,EACPoB,MAAOA,IAInB,OAAOU,GAGXpD,MAAO,WACH,IAAIiB,EAASJ,KAAKI,OAAQmC,EAASpD,EAAMqD,MAAMxC,MAE/C,GAAII,EACAJ,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,SACRrB,MAAO,EACPoB,MAAM,CAACU,KAIf,OAAOA,GAGXlD,QAAS,WACL,IAAIwC,EAAQ7B,KAAKK,QAAQiC,WACrBC,EAEJA,EAASlD,EAAQmD,MAAMxC,KAAM6B,GAE7B7B,KAAK0B,QAAQ3D,EAAQ,CACjB+D,OAAQ,MACRrB,MAAO,EACPoB,MAAOA,IAGX,OAAOU,GAGXL,QAAS,SAASU,GACd,IAAI7C,EAAOC,KACPY,EACAR,EAEJ,IAAKQ,EAAM,EAAGR,EAASL,EAAKK,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAIb,EAAKa,KAASgC,EACd,OAAOhC,EAGf,OAAQ,GAGZsC,QAAS,SAASC,EAAUC,GACxB,IAAIxC,EAAM,EACV,IAAIR,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IACjBuC,EAAShD,KAAKkD,EAASrD,KAAKY,GAAMA,EAAKZ,OAI/C9C,IAAK,SAASiG,EAAUC,GACpB,IAAIxC,EAAM,EACV,IAAI2B,EAAS,GACb,IAAInC,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IACjB2B,EAAO3B,GAAOuC,EAAShD,KAAKkD,EAASrD,KAAKY,GAAMA,EAAKZ,MAGzD,OAAOuC,GAGXe,OAAQ,SAASH,GACb,IAAIvC,EAAM,EACN2B,EACAnC,EAASJ,KAAKI,OAElB,GAAIkC,UAAUlC,QAAU,EACpBmC,EAASD,UAAU,QAChB,GAAI1B,EAAMR,EACbmC,EAASvC,KAAKY,KAGlB,KAAOA,EAAMR,EAAQQ,IACjB2B,EAASY,EAASZ,EAAQvC,KAAKY,GAAMA,EAAKZ,MAG9C,OAAOuC,GAGXgB,YAAa,SAASJ,GAClB,IAAIvC,EAAMZ,KAAKI,OAAS,EACpBmC,EAEJ,GAAID,UAAUlC,QAAU,EACpBmC,EAASD,UAAU,QAChB,GAAI1B,EAAM,EACb2B,EAASvC,KAAKY,KAGlB,KAAOA,GAAO,EAAGA,IACb2B,EAASY,EAASZ,EAAQvC,KAAKY,GAAMA,EAAKZ,MAG9C,OAAOuC,GAGXiB,OAAQ,SAASL,EAAUC,GACvB,IAAIxC,EAAM,EACV,IAAI2B,EAAS,GACb,IAAIK,EACJ,IAAIxC,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IAAO,CACxBgC,EAAO5C,KAAKY,GACZ,GAAIuC,EAAShD,KAAKkD,EAAST,EAAMhC,EAAKZ,MAClCuC,EAAOA,EAAOnC,QAAUwC,EAIhC,OAAOL,GAGXkB,KAAM,SAASN,EAAUC,GACrB,IAAIxC,EAAM,EACV,IAAIgC,EACJ,IAAIxC,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IAAO,CACxBgC,EAAO5C,KAAKY,GACZ,GAAIuC,EAAShD,KAAKkD,EAAST,EAAMhC,EAAKZ,MAClC,OAAO4C,IAKnBc,MAAO,SAASP,EAAUC,GACtB,IAAIxC,EAAM,EACV,IAAIgC,EACJ,IAAIxC,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IAAO,CACxBgC,EAAO5C,KAAKY,GACZ,IAAKuC,EAAShD,KAAKkD,EAAST,EAAMhC,EAAKZ,MACnC,OAAO,MAIf,OAAO,MAGX2D,KAAM,SAASR,EAAUC,GACrB,IAAIxC,EAAM,EACV,IAAIgC,EACJ,IAAIxC,EAASJ,KAAKI,OAClB,IAAIiD,EAAUD,GAAW7G,OAEzB,KAAOqE,EAAMR,EAAQQ,IAAO,CACxBgC,EAAO5C,KAAKY,GACZ,GAAIuC,EAAShD,KAAKkD,EAAST,EAAMhC,EAAKZ,MAClC,OAAO,KAIf,OAAO,OAIX4D,OAAQ,SAAShB,GACb,IAAIhC,EAAMZ,KAAKkC,QAAQU,GAEvB,GAAIhC,KAAS,EACTZ,KAAKd,OAAO0B,EAAK,IAIzBiD,MAAO,WACH7D,KAAKd,OAAO,EAAGc,KAAKI,WAK5B,UAAW0D,SAAW,aAAeA,OAAOC,WAAapE,EAAgBqE,UAAUF,OAAOC,UACtFpE,EAAgBqE,UAAUF,OAAOC,UAAY,GAAGD,OAAOC,UAG3D,IAAIE,EAAsBtE,EAAgBhD,OAAO,CAC7CiD,KAAM,SAAUsE,EAAMpE,EAAMqE,GACxB,IAAIC,EAAW,WAAa,OAAOpE,MAEnC1C,EAAW4C,GAAGN,KAAKO,KAAKH,MAExBA,KAAKF,KAAOA,GAAQG,EAEpB,GAAIkE,EACAnE,KAAKqE,QAAUF,EAGnB,IAAK,IAAIvD,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IACjCZ,KAAKY,GAAOsD,EAAKtD,GAGrBZ,KAAKI,OAASQ,EACdZ,KAAKsE,QAAUF,EAAS9C,KAAKtB,OAEjCQ,GAAI,SAASC,GACT,IAAImC,EAAO5C,KAAKS,GAEhB,KAAMmC,aAAgB5C,KAAKF,MACvB8C,EAAO5C,KAAKS,GAAST,KAAKkB,KAAK0B,EAAM5C,KAAKsE,cAE1C1B,EAAK7B,OAASf,KAAKsE,QAGvB,OAAO1B,KAIf,SAAS2B,EAAalB,EAASvD,EAAM6B,EAAO6C,GACxC,OAAO,SAASjD,GACZ,IAAIkD,EAAQ,GAAIC,EAEhB,IAAKA,KAAOnD,EACRkD,EAAMC,GAAOnD,EAAEmD,GAGnB,GAAIF,EACAC,EAAM9C,MAAQA,EAAQ,IAAMJ,EAAEI,WAE9B8C,EAAM9C,MAAQA,EAGlB,GAAI7B,GAAQ/B,GAAUsF,EAAQsB,cAC1BtB,EAAQsB,cAAcF,GAG1BpB,EAAQ3B,QAAQ5B,EAAM2E,IAI9B,SAASG,EAAS/D,EAAOgE,GACrB,IAAIC,EAAQ,GACZ,IAAIC,EAAMC,EAEVnE,EAAQA,GAAS,GAEjBkE,EAAOE,OAAOC,oBAAoBrE,GAClCmE,EAAqBtF,EAAW8D,OAAO,SAASkB,GAC5C,OAAOK,EAAK7C,QAAQwC,GAAO,IAG/B,MAAO7D,EAAO,CACVoE,OAAOC,oBAAoBrE,GAAOqC,QAAQ,SAAUiC,GAChD,GAAIL,EAAM5C,QAAQiD,MAAW,KAAON,GAAoBG,EAAmB9C,QAAQiD,GAAQ,GACvFL,EAAM/F,KAAKoG,KAGnBtE,EAAQoE,OAAOG,eAAevE,GAGlC,OAAOiE,EAGXpF,EAAakF,EAAQ,GAAI,OAEzB,IAAI3E,EAAmB3C,EAAWX,OAAO,CACrCiD,KAAM,SAASiB,GACX,IAAId,EAAOC,KACPqF,EACAN,EAAOH,EAAQ/D,EAAO,MACtBE,EAAS,WACL,OAAOhB,GAGfzC,EAAW4C,GAAGN,KAAKO,KAAKH,MAExBA,KAAKsF,UAAY,GAEjBP,EAAK7B,QAAQ,SAASvB,GAClB0D,EAASxE,EAAMc,GAEf,UAAW0D,IAAW,UAAYA,IAAWA,EAAOE,SAAW5D,EAAM6D,OAAO,IAAM,IAC9EH,EAAStF,EAAKmB,KAAKmE,EAAQ1D,EAAOZ,GAGtChB,EAAK4B,GAAS0D,IAGlBtF,EAAK0F,IAAMjJ,EAAMkJ,QAGrBC,gBAAiB,SAAShE,EAAOhB,GAC7B,OAAOX,KAAKyB,eAAeE,IAAUA,IAAU,aAAeA,IAAU,YAAehB,GAAsBA,EAAmBgB,WAAkB3B,KAAK2B,KAAWlE,IAAakE,IAAU,OAG7LuB,QAAS,SAAS0C,GACd,IAAK,IAAI/C,KAAK7C,KACV,GAAIA,KAAK2F,gBAAgB9C,GACrB+C,EAAE5F,KAAK6C,GAAIA,IAKvBnC,OAAQ,SAAUC,GACd,IAAI4B,EAAS,GAAI1B,EAAOc,EAExB,IAAKA,KAAS3B,KACV,GAAIA,KAAK2F,gBAAgBhE,EAAOhB,GAAqB,CACjDE,EAAQb,KAAK2B,GAEb,GAAId,aAAiBZ,GAAoBY,aAAiBlB,EACtDkB,EAAQA,EAAMH,OAAOC,GAGzB4B,EAAOZ,GAASd,EAIxB,OAAO0B,GAGXsD,IAAK,SAASlE,GACV,IAAI5B,EAAOC,KAAMuC,EAEjBxC,EAAK2B,QAAQzD,EAAK,CAAE0D,MAAOA,IAE3B,GAAIA,IAAU,OACVY,EAASxC,OAETwC,EAAS/F,EAAMmC,OAAOgD,EAAO,KAApBnF,CAA0BuD,GAGvC,OAAOwC,GAGXuD,KAAM,SAASnE,EAAOd,GAClB,IAAId,EAAOC,KACX,IAAI+F,EAAYpE,EAAMO,QAAQ,MAAQ,EAEtC,GAAI6D,EAAW,CACX,IAAIC,EAAQrE,EAAMsE,MAAM,KACpBC,EAAO,GAEX,MAAOF,EAAM5F,OAAS,EAAG,CACrB8F,GAAQF,EAAM7G,QACd,IAAIgH,EAAM3J,EAAMmC,OAAOuH,EAAM,KAAnB1J,CAAyBuD,GACnC,GAAIoG,aAAelG,EAAkB,CACjCkG,EAAIC,IAAIJ,EAAMhH,KAAK,KAAM6B,GACzB,OAAOkF,EAEXG,GAAQ,KAIhB1J,EAAM6J,OAAO1E,EAAbnF,CAAoBuD,EAAMc,GAE1B,OAAOkF,GAGXK,IAAK,SAASzE,EAAOd,GACjB,IAAId,EAAOC,KACPsG,EAAiB,MACjBP,EAAYpE,EAAMO,QAAQ,MAAQ,EAClCqE,EAAU/J,EAAMmC,OAAOgD,EAAO,KAApBnF,CAA0BuD,GAExC,GAAIwG,IAAY1F,EAAO,CACnB,GAAI0F,aAAmBjJ,GAAc0C,KAAKsF,UAAU3D,GAAQ,CACxD,GAAI3B,KAAKsF,UAAU3D,GAAOkE,IACvBU,EAAQtD,OAAOhF,EAAK+B,KAAKsF,UAAU3D,GAAOkE,KAE7CU,EAAQtD,OAAOlF,EAAQiC,KAAKsF,UAAU3D,GAAO6E,QAGjDF,EAAiBvG,EAAK2B,QAAQ,MAAO,CAAEC,MAAOA,EAAOd,MAAOA,IAE5D,IAAKyF,EAAgB,CACjB,IAAKP,EACDlF,EAAQd,EAAKmB,KAAKL,EAAOc,EAAO,WAAa,OAAO5B,IAExD,IAAKA,EAAK+F,KAAKnE,EAAOd,IAAUc,EAAMO,QAAQ,MAAQ,GAAKP,EAAMO,QAAQ,MAAQ,EAC7EnC,EAAK2B,QAAQ3D,EAAQ,CAAE4D,MAAOA,KAK1C,OAAO2E,GAGXvF,OAAQ3D,EAER8D,KAAM,SAASC,EAAQQ,EAAOZ,GAC1B,IAAIhB,EAAOC,KACX,IAAI6F,EACJ,IAAIW,EACJ,IAAI1G,EAAOR,EAASa,KAAKgB,GAEzB,GAAIA,GAAU,OAASrB,IAAS,mBAAqBA,IAAS,kBAAmB,CAC7E,IAAI2G,EAAoBtF,aAAkBxB,EAC1C,IAAI+G,EAAevF,aAAkBwF,GAErC,GAAI7G,IAAS,oBAAsB4G,IAAiBD,EAAmB,CACnE,KAAMtF,aAAkBlB,GACpBkB,EAAS,IAAIlB,EAAiBkB,GAGlC0E,EAAMtB,EAAaxE,EAAM9B,EAAK0D,EAAO,MACrCR,EAAOG,KAAKrD,EAAK4H,GACjBW,EAASjC,EAAaxE,EAAMhC,EAAQ4D,EAAO,MAC3CR,EAAOG,KAAKvD,EAAQyI,GAEpBzG,EAAKuF,UAAU3D,GAAS,CAAEkE,IAAKA,EAAKW,OAAQA,QACzC,GAAI1G,IAAS,kBAAoB2G,GAAqBC,EAAc,CACvE,IAAKD,IAAsBC,EACvBvF,EAAS,IAAIxB,EAAgBwB,GAGjCqF,EAASjC,EAAaxE,EAAMhC,EAAQ4D,EAAO,OAE3CR,EAAOG,KAAKvD,EAAQyI,GAEpBzG,EAAKuF,UAAU3D,GAAS,CAAE6E,OAAQA,GAGtCrF,EAAOJ,OAASA,EAGpB,OAAOI,KAIf,SAASyF,GAAMC,EAAGC,GACd,GAAID,IAAMC,EACN,OAAO,KAGX,IAAIC,EAAQvK,EAAMsD,KAAK+G,GAAIG,EAAQxK,EAAMsD,KAAKgH,GAAInF,EAElD,GAAIoF,IAAUC,EACV,OAAO,MAGX,GAAID,IAAU,OACV,OAAOF,EAAEtB,YAAcuB,EAAEvB,UAG7B,GAAIwB,IAAU,UAAYA,IAAU,QAChC,OAAO,MAGX,IAAKpF,KAASkF,EACV,IAAKD,GAAMC,EAAElF,GAAQmF,EAAEnF,IACnB,OAAO,MAIf,OAAO,KAGX,IAAIsF,GAAU,CACVC,OAAU,SAASrG,GACf,UAAWA,IAAUrD,GAAUqD,EAAMsG,gBAAkB,OACnD,OAAO,KAEX,OAAO3K,EAAM4K,WAAWvG,IAG5BwG,KAAQ,SAASxG,GACb,UAAWA,IAAUrD,GAAUqD,EAAMsG,gBAAkB,OACnD,OAAO,KAEX,OAAO3K,EAAM8K,UAAUzG,IAG3B0G,QAAW,SAAS1G,GAChB,UAAWA,IAAUrD,EACjB,GAAIqD,EAAMsG,gBAAkB,OACxB,OAAO,UAEP,OAAOtG,EAAMsG,gBAAkB,OAGvC,OAAOtG,GAAS,OAASA,EAAQA,GAGrC2G,OAAU,SAAS3G,GACf,UAAWA,IAAUrD,GAAUqD,EAAMsG,gBAAkB,OACnD,OAAO,KAEX,OAAOtG,GAAS,KAAQA,EAAQ,GAAMA,GAG1C4G,QAAW,SAAS5G,GAChB,OAAOA,IAIX6G,GAAgB,CAChBF,OAAU,GACVN,OAAU,EACVG,KAAQ,IAAIM,KACZJ,QAAW,MACXE,QAAW,IAGf,SAASG,GAAezB,EAAKlK,GACzB,IAAI0F,EACAkG,EAEJ,IAAKA,KAAa1B,EAAK,CACnBxE,EAAQwE,EAAI0B,GACZ,GAAIjL,EAAc+E,IAAUA,EAAMA,OAASA,EAAMA,QAAU1F,EACvD,OAAO0F,OACJ,GAAIA,IAAU1F,EACjB,OAAO0F,EAGf,OAAO,KAGX,IAAIN,GAAQpB,EAAiBtD,OAAO,CAChCiD,KAAM,SAASsE,GACX,IAAInE,EAAOC,KAEX,IAAKkE,GAAQ5H,EAAEO,cAAcqH,GAAO,CAChCA,EAAO5H,EAAEK,OAAO,GAAIoD,EAAK+H,SAAU5D,GAEnC,GAAInE,EAAKgI,cACL,IAAK,IAAInH,EAAM,EAAGA,EAAMb,EAAKgI,cAAc3H,OAAQQ,IAAO,CACrD,IAAI3E,EAAO8D,EAAKgI,cAAcnH,GAC9BsD,EAAKjI,GAAQ8D,EAAK+H,SAAS7L,MAKxCgE,EAAiBC,GAAGN,KAAKO,KAAKJ,EAAMmE,GAEpCnE,EAAKiI,MAAQ,MACbjI,EAAKkI,YAAc,GAEnB,GAAIlI,EAAKmI,QAAS,CACdnI,EAAK/D,GAAK+D,EAAK8F,IAAI9F,EAAKmI,SAExB,GAAInI,EAAK/D,KAAOU,EACZqD,EAAK/D,GAAK+D,EAAKoI,aAK3BxC,gBAAiB,SAAShE,GACtB,OAAO1B,EAAiBC,GAAGyF,gBAAgBxF,KAAKH,KAAM2B,IAClDA,IAAU,SAAW3B,KAAKkI,UAAY,MAAQvG,IAAU,OACxDA,IAAU,SAAYA,IAAU,eAAiBA,IAAU,cAGnEyG,OAAQ,SAASzG,EAAOd,GACpB,IAAId,EAAOC,KACP6H,EAAYlG,EACZ0G,EAAUtI,EAAKsI,QAAU,GACzBC,EAEJ3G,EAAQ0G,EAAO1G,GACf,IAAKA,EACDA,EAAQiG,GAAeS,EAAQR,GAEnC,GAAIlG,EAAO,CACP2G,EAAQ3G,EAAM2G,MACd,IAAKA,GAAS3G,EAAM7B,KAChBwI,EAAQrB,GAAQtF,EAAM7B,KAAKqH,eAInC,OAAOmB,EAAQA,EAAMzH,GAASA,GAGlC8D,cAAe,SAASpD,GACpB,IAAIO,EAASP,EAAEO,OAEf,GAAIA,GAAU,OAASA,GAAU,SAAU,CACvC9B,KAAKgI,MAAQ,KACbhI,KAAKiI,YAAY1G,EAAEI,OAAS,OAIpC4G,SAAU,SAAS5G,GACfA,GAAS3B,KAAKqI,QAAU,IAAI1G,GAC5B,OAAOA,EAAQA,EAAM4G,WAAa,MAAQ,MAG9CnC,IAAK,SAASzE,EAAOd,GACjB,IAAId,EAAOC,KACX,IAAIgI,EAAQjI,EAAKiI,MAEjB,GAAIjI,EAAKwI,SAAS5G,GAAQ,CACtBd,EAAQd,EAAKqI,OAAOzG,EAAOd,GAE3B,IAAK+F,GAAM/F,EAAOd,EAAK8F,IAAIlE,IAAS,CAChC5B,EAAKiI,MAAQ,KACbjI,EAAKkI,YAAYtG,GAAS,KAE1B,GAAI1B,EAAiBC,GAAGkG,IAAIjG,KAAKJ,EAAM4B,EAAOd,KAAWmH,EAAO,CAC5DjI,EAAKiI,MAAQA,EAEb,IAAKjI,EAAKiI,MACNjI,EAAKkI,YAAYtG,GAAS,YAIlC5B,EAAK2B,QAAQ,WAAY,CAAEC,MAAOA,EAAOd,MAAOA,MAK5D2H,OAAQ,SAAStE,GACb,IAAInE,EAAOC,KACPe,EAAS,WAAa,OAAOhB,GAC7B4B,EAEJ,IAAKA,KAASuC,EAAM,CAChB,IAAIrD,EAAQqD,EAAKvC,GAEjB,GAAIA,EAAM6D,OAAO,IAAM,IACnB3E,EAAQd,EAAKmB,KAAKgD,EAAKvC,GAAQA,EAAOZ,GAG1ChB,EAAK+F,KAAKnE,EAAOd,GAGrB,GAAId,EAAKmI,QACLnI,EAAK/D,GAAK+D,EAAK8F,IAAI9F,EAAKmI,SAG5BnI,EAAKiI,MAAQ,MACbjI,EAAKkI,YAAc,IAGvBQ,MAAO,WACH,OAAOzI,KAAKhE,KAAOgE,KAAKmI,cAyF5BO,IArFJrH,GAAMvF,OAAS,SAAS6M,EAAMC,GAC1B,GAAIA,IAAYlM,EAAW,CACvBkM,EAAUD,EACVA,EAAOtH,GAGX,IAAIwH,EACAC,EAAQnM,EAAO,CAAEmL,SAAU,IAAMc,GACjC3M,EACA0F,EACA7B,EACAe,EACAD,EACAR,EACAiI,EAAS,GACTU,EACA/M,EAAK8M,EAAM9M,GACXgN,EAAiB,GAErB,GAAIhN,EACA8M,EAAMZ,QAAUlM,EAGpB,GAAI8M,EAAM9M,UACC8M,EAAM9M,GAGjB,GAAIA,EACA8M,EAAMhB,SAAS9L,GAAM8M,EAAMX,WAAa,GAG5C,GAAI7I,EAASa,KAAK2I,EAAMT,UAAY,iBAAkB,CAClD,IAAKzH,EAAM,EAAGR,EAAS0I,EAAMT,OAAOjI,OAAQQ,EAAMR,EAAQQ,IAAO,CAC7De,EAAQmH,EAAMT,OAAOzH,GACrB,UAAWe,IAAUnE,EACjB6K,EAAO1G,GAAS,QACb,GAAIA,EAAMA,MACb0G,EAAO1G,EAAMA,OAASA,EAG9BmH,EAAMT,OAASA,EAGnB,IAAKpM,KAAQ6M,EAAMT,OAAQ,CACvB1G,EAAQmH,EAAMT,OAAOpM,GACrB6D,EAAO6B,EAAM7B,MAAQ,UACrBe,EAAQ,KACRkI,EAAe9M,EAEfA,SAAe0F,EAAW,QAAMnE,EAASmE,EAAMA,MAAQ1F,EAEvD,IAAK0F,EAAMsH,SAAU,CACjBpI,EAAQiI,EAAMhB,SAASiB,IAAiB9M,EAAO8M,EAAe9M,GAAQ0F,EAAMuH,eAAiBxM,EAAYiF,EAAMuH,aAAexB,GAAc5H,EAAKqH,eAEjJ,UAAWtG,IAAU,WACjBmI,EAAejK,KAAK9C,GAI5B,GAAI2M,EAAQ5M,KAAOC,EACf6M,EAAMX,WAAatH,EAGvBiI,EAAMhB,SAASiB,IAAiB9M,EAAO8M,EAAe9M,GAAQ4E,EAE9Dc,EAAM2G,MAAQ3G,EAAM2G,OAASrB,GAAQnH,GAGzC,GAAIkJ,EAAe5I,OAAS,EACxB0I,EAAMf,cAAgBiB,EAG1BH,EAAQF,EAAKhM,OAAOmM,GACpBD,EAAM/M,OAAS,SAAS8M,GACpB,OAAOvH,GAAMvF,OAAO+M,EAAOD,IAG/B,GAAIE,EAAMT,OAAQ,CACdQ,EAAMR,OAASS,EAAMT,OACrBQ,EAAMX,QAAUY,EAAMZ,QAG1B,OAAOW,GAGI,CACXM,SAAU,SAASxH,GACf,OAAOtE,EAAWsE,GAASA,EAAQhD,EAAOgD,IAG9CyH,QAAS,SAASzH,GACd,IAAIwH,EAAWnJ,KAAKmJ,SAASxH,GAC7B,OAAO,SAAU0H,EAAGC,GAChBD,EAAIF,EAASE,GACbC,EAAIH,EAASG,GAEb,GAAID,GAAK,MAAQC,GAAK,KAClB,OAAO,EAGX,GAAID,GAAK,KACL,OAAQ,EAGZ,GAAIC,GAAK,KACL,OAAO,EAGX,GAAID,EAAEE,cACF,OAAOF,EAAEE,cAAcD,GAG3B,OAAOD,EAAIC,EAAI,EAAKD,EAAIC,GAAK,EAAI,IAIzCE,OAAQ,SAAS9G,GACb,IAAI0G,EAAU1G,EAAK0G,SAAWpJ,KAAKoJ,QAAQ1G,EAAKf,OAEhD,GAAIe,EAAK+G,KAAO,OACZ,OAAO,SAASJ,EAAGC,GACf,OAAOF,EAAQE,EAAGD,EAAG,OAI7B,OAAOD,GAGXM,QAAS,SAASC,GACd,OAAO,SAASN,EAAGC,GACf,IAAI/G,EAASoH,EAAU,GAAGN,EAAGC,GACzB1I,EACAR,EAEJ,IAAKQ,EAAM,EAAGR,EAASuJ,EAAUvJ,OAAQQ,EAAMR,EAAQQ,IACnD2B,EAASA,GAAUoH,EAAU/I,GAAKyI,EAAGC,GAGzC,OAAO/G,MAKfqH,GAAiBjN,EAAO,GAAI+L,GAAU,CACtCmB,IAAK,SAASlI,GACV,IAAIwH,EAAWnJ,KAAKmJ,SAASxH,GAC7B,OAAO,SAAU0H,EAAGC,GAChB,IAAIQ,EAASX,EAASE,GACtB,IAAIU,EAASZ,EAASG,GAEtB,GAAIQ,GAAUA,EAAOvE,SAAWwE,GAAUA,EAAOxE,QAAS,CACtDuE,EAASA,EAAOvE,UAChBwE,EAASA,EAAOxE,UAGpB,GAAIuE,IAAWC,EACX,OAAOV,EAAEW,WAAaV,EAAEU,WAG5B,GAAIF,GAAU,KACV,OAAQ,EAGZ,GAAIC,GAAU,KACV,OAAO,EAGX,GAAID,EAAOP,cACP,OAAOO,EAAOP,cAAcQ,GAGhC,OAAOD,EAASC,EAAS,GAAK,IAItCE,KAAM,SAAStI,GACX,IAAIwH,EAAWnJ,KAAKmJ,SAASxH,GAC7B,OAAO,SAAU0H,EAAGC,GAChB,IAAIQ,EAASX,EAASE,GACtB,IAAIU,EAASZ,EAASG,GAEtB,GAAIQ,GAAUA,EAAOvE,SAAWwE,GAAUA,EAAOxE,QAAS,CACtDuE,EAASA,EAAOvE,UAChBwE,EAASA,EAAOxE,UAGpB,GAAIuE,IAAWC,EACX,OAAOV,EAAEW,WAAaV,EAAEU,WAG5B,GAAIF,GAAU,KACV,OAAO,EAGX,GAAIC,GAAU,KACV,OAAQ,EAGZ,GAAIA,EAAOR,cACP,OAAOQ,EAAOR,cAAcO,GAGhC,OAAOA,EAASC,EAAS,GAAK,IAGtCP,OAAQ,SAAS9G,GACd,OAAO1C,KAAK0C,EAAK+G,KAAK/G,EAAKf,UAc9BuI,IAVJhN,EAAM,SAAU2C,EAAOsD,GACnB,IAAIvC,EAAKR,EAASP,EAAMO,OAAQmC,EAAS,IAAIxF,MAAMqD,GAEnD,IAAKQ,EAAM,EAAGA,EAAMR,EAAQQ,IACxB2B,EAAO3B,GAAOuC,EAAStD,EAAMe,GAAMA,EAAKf,GAG5C,OAAO0C,GAGK,WAEZ,SAAS4H,EAAMC,GACX,UAAWA,GAAO,SACdA,EAAMA,EAAIC,QAAQ,WAAY,IAElC,OAAOC,KAAK1L,UAAUwL,GAG1B,SAASG,EAAOC,GACZ,OAAO,SAASnB,EAAGC,EAAGmB,EAAQC,GAC1BpB,GAAK,GACL,GAAImB,EAAQ,CACRpB,EAAI,IAAMA,EAAI,qBAAuB,EAA2B,uBAAyBqB,EAAyB,KAAO,kBACzHpB,EAAK,EAA2BA,EAAEqB,kBAAkBD,GAA0BpB,EAAEnC,cAEpF,OAAOqD,EAAKnB,EAAGc,EAAMb,GAAImB,IAIjC,SAASG,EAASC,EAAIxB,EAAGC,EAAGmB,EAAQC,GAChC,GAAIpB,GAAK,KAAM,CACX,UAAWA,IAAM9L,EAAQ,CACrB,IAAI6J,EAAO5H,EAAWqL,KAAKxB,GAC3B,GAAIjC,EACAiC,EAAI,IAAI3B,MAAMN,EAAK,SAChB,GAAIoD,EAAQ,CACfnB,EAAIa,EAAO,EAA2Bb,EAAEqB,kBAAkBD,GAA0BpB,EAAEnC,eACtFkC,EAAI,KAAOA,EAAI,eAAiB,EAA2B,uBAAyBqB,EAAyB,KAAO,uBAEpHpB,EAAIa,EAAMb,GAIlB,GAAIA,EAAE/D,QAAS,CAEX8D,EAAI,IAAMA,EAAI,KAAOA,EAAI,YAAcA,EAAI,cAAgBA,EAAI,IAC/DC,EAAIA,EAAE/D,WAId,OAAO8D,EAAI,IAAMwB,EAAK,IAAMvB,EAGhC,SAASyB,EAAeC,GASpB,IAAK,IAAIC,EAAK,KAAMC,EAAM,MAAOrI,EAAI,EAAGA,EAAImI,EAAQ5K,SAAUyC,EAAG,CAC7D,IAAIsI,EAAKH,EAAQxF,OAAO3C,GACxB,GAAIqI,EACAD,GAAM,KAAOE,OACV,GAAIA,GAAM,IAAK,CAClBD,EAAM,KACN,cACG,GAAIC,GAAM,IACbF,GAAM,UACH,GAAIE,GAAM,IACbF,GAAM,SACH,GAAI,kCAAqC/I,QAAQiJ,IAAO,EAC3DF,GAAM,KAAOE,OAEbF,GAAME,EAEVD,EAAM,MAEV,OAAOD,EAAK,KAGhB,MAAO,CACHd,MAAO,SAAStJ,GACZ,GAAIA,GAASA,EAAM0E,QACf,MAAO,YAAc1E,EAAM0E,UAAY,IAE3C,OAAO4E,EAAMtJ,IAEjBuK,GAAI,SAAS/B,EAAGC,EAAGmB,EAAQC,GACvB,OAAOE,EAAS,KAAMvB,EAAGC,EAAGmB,EAAQC,IAExCW,IAAK,SAAShC,EAAGC,EAAGmB,EAAQC,GACxB,OAAOE,EAAS,KAAMvB,EAAGC,EAAGmB,EAAQC,IAExCY,GAAI,SAASjC,EAAGC,EAAGmB,GACf,OAAOG,EAAS,IAAKvB,EAAGC,EAAGmB,IAE/Bc,IAAK,SAASlC,EAAGC,EAAGmB,GAChB,OAAOG,EAAS,KAAMvB,EAAGC,EAAGmB,IAEhCe,GAAI,SAASnC,EAAGC,EAAGmB,GACf,OAAOG,EAAS,IAAKvB,EAAGC,EAAGmB,IAE/BgB,IAAK,SAASpC,EAAGC,EAAGmB,GAChB,OAAOG,EAAS,KAAMvB,EAAGC,EAAGmB,IAEhCiB,WAAYnB,EAAO,SAASlB,EAAGC,GAC3B,OAAOD,EAAI,gBAAkBC,EAAI,cAErCqC,iBAAkBpB,EAAO,SAASlB,EAAGC,GACjC,OAAOD,EAAI,gBAAkBC,EAAI,eAErCsC,SAAUrB,EAAO,SAASlB,EAAGC,GACzB,IAAIuC,EAAIvC,EAAIA,EAAElJ,OAAS,EAAI,EAC3B,OAAOiJ,EAAI,YAAcC,EAAI,KAAOD,EAAI,aAAewC,EAAI,WAE/DC,eAAgBvB,EAAO,SAASlB,EAAGC,GAC/B,IAAIuC,EAAIvC,EAAIA,EAAElJ,OAAS,EAAI,EAC3B,OAAOiJ,EAAI,YAAcC,EAAI,KAAOD,EAAI,aAAewC,EAAI,UAE/DE,SAAUxB,EAAO,SAASlB,EAAGC,GACzB,OAAOD,EAAI,YAAcC,EAAI,WAEjC0C,eAAgBzB,EAAO,SAASlB,EAAGC,GAC/B,OAAOD,EAAI,YAAcC,EAAI,YAEjC2C,QAAS1B,EAAO,SAASlB,EAAGC,GACxBA,EAAIA,EAAE4C,UAAU,EAAG5C,EAAElJ,OAAS,GAC9B,OAAO2K,EAAezB,GAAK,SAAWD,EAAI,MAE9C8C,aAAc5B,EAAO,SAASlB,EAAGC,GAC7BA,EAAIA,EAAE4C,UAAU,EAAG5C,EAAElJ,OAAS,GAC9B,MAAO,IAAM2K,EAAezB,GAAK,SAAWD,EAAI,MAEpD+C,QAAS,SAAS/C,GACd,OAAOA,EAAI,WAEfgD,WAAY,SAAShD,GACjB,OAAOA,EAAI,WAEfiD,OAAQ,SAASjD,GACb,MAAO,IAAMA,EAAI,aAErBkD,UAAW,SAASlD,GAChB,MAAO,IAAMA,EAAI,aAErBmD,cAAe,SAASnD,GACpB,MAAO,IAAMA,EAAI,kBAAoBA,EAAI,YAE7CoD,iBAAkB,SAASpD,GACvB,MAAO,IAAMA,EAAI,kBAAoBA,EAAI,aA/IrC,IAoJhB,SAASqD,EAAMxI,GACXlE,KAAKkE,KAAOA,GAAQ,GA0DxB,SAASyI,GAAchL,EAAO8H,GAC1B,GAAI9H,EAAO,CACP,IAAIiL,SAAoBjL,IAAUnE,EAAS,CAAEmE,MAAOA,EAAO8H,IAAKA,GAAQ9H,EACxEkL,EAAc/P,EAAQ8P,GAAcA,EAAcA,IAAelQ,EAAY,CAACkQ,GAAc,GAE5F,OAAO5P,EAAK6P,EAAa,SAASC,GAAK,QAASA,EAAErD,OAI1D,SAASsD,GAAWC,EAAOvD,GACvB,IAAIwD,EAAa,GAEjB,GAAID,EAAO,CACP,IAAIJ,SAAoBI,IAAUxP,EAAS,CAAEmE,MAAOqL,EAAOvD,IAAKA,GAAQuD,EACxEH,EAAc/P,EAAQ8P,GAAcA,EAAcA,IAAelQ,EAAY,CAACkQ,GAAc,GAE5F,IAAK,IAAI/J,EAAI,EAAGA,EAAIgK,EAAYzM,OAAQyC,IACpCoK,EAAWJ,EAAYhK,GAAGlB,OAAS,CAAE8H,IAAKoD,EAAYhK,GAAG4G,IAAKhJ,MAAOoC,EAAI,GAIjF,OAAOoK,EA5EXP,EAAMQ,WAAa,SAASC,GACxB,IAAIC,EAAc,GACdC,EAAQ,CAAEC,IAAK,OAAQC,GAAI,QAC3B3M,EACAR,EACAoD,EACAgK,EACAC,EAAiB,GACjBC,EAAoB,GACpB/L,EACAiJ,EACA+C,EAAUR,EAAWQ,QAEzB,IAAK/M,EAAM,EAAGR,EAASuN,EAAQvN,OAAQQ,EAAMR,EAAQQ,IAAO,CACxD4C,EAASmK,EAAQ/M,GACjBe,EAAQ6B,EAAO7B,MACfiJ,EAAWpH,EAAOoH,SAElB,GAAIpH,EAAOmK,QAAS,CAChBH,EAAOd,EAAMQ,WAAW1J,GAExBA,EAASgK,EAAKL,WACb9C,QAAQ,gBAAiB,SAASuD,EAAOnN,GACtCA,GAASA,EACT,MAAO,QAAUiN,EAAkBtN,OAASK,GAAS,MAExD4J,QAAQ,gBAAiB,SAASuD,EAAOnN,GACtCA,GAASA,EACT,MAAO,QAAUgN,EAAerN,OAASK,GAAS,MAGtDiN,EAAkB3O,KAAKyD,MAAMkL,EAAmBF,EAAKtD,WACrDuD,EAAe1O,KAAKyD,MAAMiL,EAAgBD,EAAKnF,YAC5C,CACH,UAAW1G,IAAUlE,EAAU,CAC3B+P,EAAO,OAASC,EAAerN,OAAQ,OACvCqN,EAAe1O,KAAK4C,QAEpB6L,EAAOhR,EAAMgR,KAAK7L,GAGtB,UAAWiJ,IAAanN,EAAU,CAC9B+F,EAAS,OAASkK,EAAkBtN,OAAS,KAAOoN,EAAO,KAAOtD,GAAUC,MAAM3G,EAAO3C,OAAS,IAClG6M,EAAkB3O,KAAK6L,QAEvBpH,EAAS0G,IAAWU,GAAY,MAAMzD,eAAeqG,EAAMhK,EAAO3C,MAAO2C,EAAOqK,aAAenR,EAAW8G,EAAOqK,WAAa,KAAMV,EAAWzC,wBAIvJ0C,EAAYrO,KAAKyE,GAGrB,MAAQ,CAAE2J,WAAY,IAAMC,EAAYpO,KAAKqO,EAAMF,EAAWE,QAAU,IAAKhF,OAAQoF,EAAgBvD,UAAWwD,IA2BpH,IAAII,GAAc,CACdC,KAAM,KACNC,OAAQ,KACRC,UAAW,KACXC,QAAS,KACTtH,MAAO,KACPuH,KAAM,MACNC,GAAI,MACJC,UAAW,MACXC,aAAc,MACdC,WAAY,MACZC,SAAU,MACVC,IAAK,KACLC,WAAY,KACZC,SAAU,KACVC,KAAM,KACNC,KAAM,MACNC,GAAI,MACJC,oBAAqB,MACrBC,cAAe,MACfC,IAAK,KACLC,cAAe,KACfC,YAAa,KACbC,QAAS,KACTC,KAAM,MACNC,uBAAwB,MACxBC,iBAAkB,MAClBC,GAAI,MACJC,eAAgB,iBAChBnD,OAAQ,SACRF,QAAS,UACTC,WAAY,cAGhB,SAASqD,GAAkBvC,GACvB,IAAIvM,EACJR,EACAoD,EACAoH,EACA+C,EAAUR,EAAWQ,QAErB,GAAIA,EACA,IAAK/M,EAAM,EAAGR,EAASuN,EAAQvN,OAAQQ,EAAMR,EAAQQ,IAAO,CACxD4C,EAASmK,EAAQ/M,GACjBgK,EAAWpH,EAAOoH,SAElB,GAAIA,UAAmBA,IAAapN,EAChCgG,EAAOoH,SAAWkD,GAAYlD,EAASzD,gBAAkByD,EAG7D8E,GAAkBlM,IAK9B,SAASmM,GAAgBxC,GACrB,GAAIA,IAAetQ,EAAcsQ,GAAa,CAC1C,GAAIrQ,EAAQqQ,KAAgBA,EAAWQ,QACnCR,EAAa,CACTE,MAAO,MACPM,QAAS7Q,EAAQqQ,GAAcA,EAAa,CAACA,IAIrDuC,GAAkBvC,GAElB,OAAOA,GAMf,SAASyC,GAAkBC,EAAIC,GAC3B,GAAID,EAAGxC,OAASyC,EAAGzC,MACf,OAAO,MAGX,OAAOwC,EAAGlO,QAAUmO,EAAGnO,OAASkO,EAAGhP,QAAUiP,EAAGjP,OAASgP,EAAGjF,WAAakF,EAAGlF,SAGhF,SAASmF,GAAoBvM,GACzBA,EAASA,GAAU,GAEnB,GAAI3G,EAAc2G,GACd,MAAO,CAAE6J,MAAO,MAAOM,QAAS,IAGpC,OAAOgC,GAAgBnM,GAG3B,SAASwM,GAAc3G,EAAGC,GACtB,GAAIA,EAAE+D,OAAUhE,EAAE1H,MAAQ2H,EAAE3H,MACxB,OAAO,OACJ,GAAI0H,EAAE1H,MAAQ2H,EAAE3H,MACnB,OAAQ,OAER,OAAO,EAIf,SAASsO,GAAeC,EAAOC,GAC3BD,EAAQH,GAAoBG,GAC5BC,EAAQJ,GAAoBI,GAE5B,GAAID,EAAM7C,QAAU8C,EAAM9C,MACtB,OAAO,MAGX,IAAIwC,EAAIC,EACR,IAAIM,GAAYF,EAAMvC,SAAW,IAAIvO,QACrC,IAAIiR,GAAYF,EAAMxC,SAAW,IAAIvO,QAErC,GAAIgR,EAAShQ,SAAWiQ,EAASjQ,OAC7B,OAAO,MAGXgQ,EAAWA,EAAS1N,KAAKsN,IACzBK,EAAWA,EAAS3N,KAAKsN,IAEzB,IAAK,IAAIpP,EAAM,EAAGA,EAAMwP,EAAShQ,OAAQQ,IAAO,CAC5CiP,EAAKO,EAASxP,GACdkP,EAAKO,EAASzP,GAEd,GAAIiP,EAAGxC,OAASyC,EAAGzC,OACf,IAAK4C,GAAeJ,EAAIC,GACpB,OAAO,WAER,IAAKF,GAAkBC,EAAIC,GAC9B,OAAO,MAIf,OAAO,KAKX,SAASQ,GAAmBlD,GACxB,OAAOtQ,EAAQsQ,GAAeA,EAAc,CAACA,GAGjD,SAASmD,GAAe5O,EAAO8H,EAAKL,EAASoH,GACzC,IAAI5D,SAAoBjL,IAAUnE,EAAS,CAAEmE,MAAOA,EAAO8H,IAAKA,EAAKL,QAASA,EAASoH,gBAAkBA,GAAoB7O,EAC7HkL,EAAc/P,EAAQ8P,GAAcA,EAAcA,IAAelQ,EAAY,CAACkQ,GAAc,GAE5F,OAAO1P,EAAI2P,EAAa,SAASC,GAC7B,MAAO,CACHnL,MAAOmL,EAAEnL,MACT8H,IAAKqD,EAAErD,KAAO,MACdgH,WAAY3D,EAAE2D,WACdrH,QAAS0D,EAAE1D,QACXoH,gBAAiB1D,EAAE0D,mBAK/B,SAASE,GAA6B/O,EAAO8H,EAAKL,GAC9C,IAAIyD,EAAc0D,GAAe5O,EAAO8H,EAAKL,GAE7C,IAAK,IAAIvG,EAAI,EAAGA,EAAIgK,EAAYzM,OAAQyC,WAC7BgK,EAAYhK,GAAGuG,QAG1B,OAAOyD,EAGX,SAAS8D,GAA6BC,GAClC,IAAI/D,EAAc/P,EAAQ8T,GAAoBA,EAAmB,CAACA,GAElE,IAAK,IAAI/N,EAAI,EAAGA,EAAIgK,EAAYzM,OAAQyC,IACpC,GAAIgK,EAAYhK,IAAMxF,EAAWwP,EAAYhK,GAAGuG,SAC5C,OAAO,KAIf,OAAO,MAsRX,SAASyH,GAAmBxH,EAAGC,GAC3B,GAAID,GAAKA,EAAE9D,SAAW+D,GAAKA,EAAE/D,QACzB,OAAO8D,EAAE9D,YAAc+D,EAAE/D,UAE7B,OAAO8D,IAAMC,EAGjB,SAASwH,GAAmBC,EAAaN,EAAY7N,EAAMnC,EAAOL,EAAQ4Q,GACtEP,EAAaA,GAAc,GAC3B,IAAI7P,EACAqQ,EACAC,EACApO,EAAM2N,EAAWrQ,OAErB,IAAKQ,EAAM,EAAGA,EAAMkC,EAAKlC,IAAO,CAC5BqQ,EAAOR,EAAW7P,GAClBsQ,EAAeD,EAAKE,UACpB,IAAIxP,EAAQsP,EAAKtP,MACjBoP,EAAYpP,GAASoP,EAAYpP,IAAU,GAC3CqP,EAAMrP,GAASqP,EAAMrP,IAAU,GAC/BqP,EAAMrP,GAAOuP,GAAgBF,EAAMrP,GAAOuP,IAAiB,GAC3DH,EAAYpP,GAAOuP,GAAgBE,GAAUF,EAAa/J,eAAe4J,EAAYpP,GAAOuP,GAAetO,EAAMpG,EAAM6U,SAAS1P,GAAQlB,EAAOL,EAAQ4Q,EAAMrP,GAAOuP,KApZ5KxE,EAAMiD,gBAAkBA,GAiExBjD,EAAMuD,eAAiBA,GA2CvBvD,EAAM1I,UAAY,CACdsN,QAAS,WACL,OAAOtR,KAAKkE,MAEhBqN,MAAO,SAAS9Q,EAAO+Q,GACnB,OAAO,IAAI9E,EAAM1M,KAAKkE,KAAK9E,MAAMqB,EAAOA,EAAQ+Q,KAEpDC,KAAM,SAAUD,GACZ,OAAO,IAAI9E,EAAM1M,KAAKkE,KAAK9E,MAAMoS,KAErCE,KAAM,SAAUF,GACZ,OAAO,IAAI9E,EAAM1M,KAAKkE,KAAK9E,MAAM,EAAGoS,KAExCG,OAAQ,SAAUxI,GACd,OAAO,IAAIuD,EAAMxP,EAAI8C,KAAKkE,KAAMiF,KAEpCyI,MAAO,SAASzI,EAAUM,EAAKoI,GAC3B,IAAInP,EAAO,CAAE+G,IAAKA,GAElB,GAAIN,EACA,GAAIA,EAASC,QACT1G,EAAK0G,QAAUD,EAASC,aAExB1G,EAAKf,MAAQwH,EAIrB,GAAI0I,EACA,OAAO,IAAInF,EAAM1M,KAAKkE,KAAKxB,KAAKgG,GAASc,OAAO9G,KAGpD,OAAO,IAAIgK,EAAM1M,KAAKkE,KAAK9E,MAAM,GAAGsD,KAAKgG,GAASc,OAAO9G,MAE7DoP,QAAS,SAAS3I,EAAU0I,GACxB,OAAO7R,KAAK4R,MAAMzI,EAAU,MAAO0I,IAEvCE,kBAAmB,SAAS5I,EAAU0I,GAClC,OAAO7R,KAAK4R,MAAMzI,EAAU,OAAQ0I,IAExCnP,KAAM,SAASf,EAAO8H,EAAKuI,EAAUH,GACjC,IAAIjR,EACJR,EACAyM,EAAcF,GAAchL,EAAO8H,GACnCE,EAAY,GAEZqI,EAAWA,GAAYtJ,GAEvB,GAAImE,EAAYzM,OAAQ,CACpB,IAAKQ,EAAM,EAAGR,EAASyM,EAAYzM,OAAQQ,EAAMR,EAAQQ,IACrD+I,EAAU5K,KAAKiT,EAASxI,OAAOqD,EAAYjM,KAG/C,OAAOZ,KAAK8R,QAAQ,CAAE1I,QAAS4I,EAAStI,QAAQC,IAAckI,GAGlE,OAAO7R,MAGXwD,OAAQ,SAAS4J,GACb,IAAIxM,EACJ2F,EACAnG,EACA6R,EACAC,EACAhO,EAAOlE,KAAKkE,KACZmE,EACA6B,EACA3H,EAAS,GACTiB,EAEA4J,EAAcuC,GAAgBvC,GAE9B,IAAKA,GAAeA,EAAYO,QAAQvN,SAAW,EAC/C,OAAOJ,KAGXiS,EAAWvF,EAAMQ,WAAWE,GAC5B/E,EAAS4J,EAAS5J,OAClB6B,EAAY+H,EAAS/H,UAErBgI,EAAY1O,EAAS,IAAI2O,SAAS,cAAe,UAAYF,EAAS9E,YAEtE,GAAI9E,EAAOjI,QAAU8J,EAAU9J,OAC3BoD,EAAS,SAASsJ,GACd,OAAOoF,EAAUpF,EAAGzE,EAAQ6B,IAKpC,IAAKtJ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrD2F,EAAUrC,EAAKtD,GAEf,GAAI4C,EAAO+C,GACPhE,EAAOxD,KAAKwH,GAIpB,OAAO,IAAImG,EAAMnK,IAGrB6P,MAAO,SAASvF,EAAawF,EAASzJ,GAClCiE,EAAe0D,GAAe1D,GAAe,IAC7CwF,EAAUA,GAAWrS,KAAKkE,KAE1B,IAAInE,EAAOC,KACXuC,EAAS,IAAImK,EAAM3M,EAAKmE,MACxB0I,EAEA,GAAIC,EAAYzM,OAAS,EAAG,CACxBwM,EAAaC,EAAY,GAEzB,GAAIjE,GAAWA,EAAQ0J,YACnB/P,EAAS,IAAImK,EAAM2F,GAASE,aAAa3F,EAAYyF,GAASV,OAAO,SAAUS,GAC3E,IAAIlO,EAAO,IAAIwI,EAAM2F,GAAS7O,OAAO,CAAC,CAClC7B,MAAOyQ,EAAMzQ,MACbiJ,SAAU,KACV/J,MAAOuR,EAAMvR,MACbgN,WAAY,SAEhB,IAAIhM,EAAQgL,EAAYzM,OAAS,EAAI,IAAIsM,EAAM0F,EAAMvQ,OAAOuQ,MAAMvF,EAAYzN,MAAM,GAAI8E,EAAKoN,UAAW1I,GAAS0I,UAAYc,EAAMvQ,MACnI,MAAO,CACHF,MAAOyQ,EAAMzQ,MACbd,MAAOuR,EAAMvR,MACb2R,aAAc3F,EAAYzM,OAAS,EACnCyB,MAAOA,EACP4O,WAAYvM,EAAKiN,UAAUvE,EAAW6D,YACtChL,IAAKjJ,EAAMkJ,OACX+M,UAAW5Q,EAAMzB,OACjBsS,cAAe7Q,EAAMzB,eAK7BmC,EAASA,EAAOoQ,QAAQ/F,GAAY+E,OAAO,SAASS,GAChD,IAAIlO,EAAO,IAAIwI,EAAM2F,GAAS7O,OAAO,CAAE,CAAE7B,MAAOyQ,EAAMzQ,MAAOiJ,SAAU,KAAM/J,MAAOuR,EAAMvR,MAAOgN,WAAY,SAC7G,MAAO,CACHlM,MAAOyQ,EAAMzQ,MACbd,MAAOuR,EAAMvR,MACbgB,MAAOgL,EAAYzM,OAAS,EAAI,IAAIsM,EAAM0F,EAAMvQ,OAAOuQ,MAAMvF,EAAYzN,MAAM,GAAI8E,EAAKoN,WAAWA,UAAYc,EAAMvQ,MACrH2Q,aAAc3F,EAAYzM,OAAS,EACnCqQ,WAAYvM,EAAKiN,UAAUvE,EAAW6D,eAKtD,OAAOlO,GAGXoQ,QAAS,SAAS/F,GACd,IAAI7M,EAAOC,KAEX,GAAInD,EAAc+P,KAAgB5M,KAAKkE,KAAK9D,OACxC,OAAO,IAAIsM,EAAM,IAGrB,IAAI/K,EAAQiL,EAAWjL,MACnBiR,EAAShG,EAAW4D,gBAAkBxQ,KAAKkE,KAAOlE,KAAK6S,iBAAiBlR,EAAOiL,EAAWnD,KAAO,OACjG4H,EAAW7U,EAAM6U,SAAS1P,GAC1BiB,EACAkQ,EAAazB,EAASxL,IAAI+M,EAAO,GAAIjR,GACrCyQ,EAAQ,CACJzQ,MAAOA,EACPd,MAAOiS,EACPjR,MAAO,IAEXkR,EACAnS,EACAkC,EACAP,EAAS,CAAC6P,GAEd,IAAIxR,EAAM,EAAGkC,EAAM8P,EAAOxS,OAAQQ,EAAMkC,EAAKlC,IAAO,CAChDgC,EAAOgQ,EAAOhS,GACdmS,EAAe1B,EAASxL,IAAIjD,EAAMjB,GAClC,IAAIkP,GAAmBiC,EAAYC,GAAe,CAC9CD,EAAaC,EACbX,EAAQ,CACJzQ,MAAOA,EACPd,MAAOiS,EACPjR,MAAO,IAEXU,EAAOxD,KAAKqT,GAEhBA,EAAMvQ,MAAM9C,KAAK6D,GAGrBL,EAASxC,EAAKiT,YAAYzQ,EAAQqK,GAElC,OAAO,IAAIF,EAAMnK,IAGrBgQ,aAAc,SAAU3F,EAAYyF,GAChC,GAAIxV,EAAc+P,IAAe5M,KAAKkE,OAASlE,KAAKkE,KAAK9D,OACrD,OAAO,IAAIsM,EAAM,IAGrB,IAAI/K,EAAQiL,EAAWjL,MACnBiR,EAAShG,EAAW4D,gBAAkB6B,EAAU,IAAI3F,EAAM2F,GAAS3P,KAAKf,EAAOiL,EAAWnD,KAAO,MAAOG,IAAgB0H,UACxHD,EAAW7U,EAAM6U,SAAS1P,GAC1BiB,EACAkQ,EAAazB,EAASxL,IAAI+M,EAAO,GAAIjR,GACrCyQ,EAAQ,CACJzQ,MAAOA,EACPd,MAAOiS,EACPjR,MAAO,IAEXkR,EACAnS,EACAkC,EACAP,EAAS,CAAC6P,GAEd,IAAKxR,EAAM,EAAGkC,EAAM8P,EAAOxS,OAAQQ,EAAMkC,EAAKlC,IAAO,CACjDgC,EAAOgQ,EAAOhS,GACdmS,EAAe1B,EAASxL,IAAIjD,EAAMjB,GAClC,IAAKkP,GAAmBiC,EAAYC,GAAe,CAC/CD,EAAaC,EACbX,EAAQ,CACJzQ,MAAOA,EACPd,MAAOiS,EACPjR,MAAO,IAEXU,EAAOxD,KAAKqT,GAEhBA,EAAMvQ,MAAM9C,KAAK6D,GAGrBL,EAASvC,KAAKgT,YAAYzQ,EAAQqK,GAElC,OAAO,IAAIF,EAAMnK,IAGrBsQ,iBAAkB,SAASlR,EAAO8H,GAC9B,IAAI7I,EAAKR,EACL8D,EAAOlE,KAAKkE,KAEhB,IAAK3E,EAAY,CACb,IAAKqB,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9CsD,EAAKtD,GAAKoJ,WAAapJ,EAG3BsD,EAAO,IAAIwI,EAAMxI,GAAMxB,KAAKf,EAAO8H,EAAKG,IAAgB0H,UAExD,IAAK1Q,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,WACvCsD,EAAKtD,GAAKoJ,WAErB,OAAO9F,EAGX,OAAOlE,KAAK0C,KAAKf,EAAO8H,GAAK6H,WAGjC0B,YAAa,SAASC,EAAQrG,GAC1B,IAAIrK,EAAS0Q,EAEb,GAAIrG,GAAcvP,EAAWuP,EAAWxD,SACpC7G,EAAS,IAAImK,EAAMnK,GAAQqP,MAAM,CAAExI,QAASwD,EAAWxD,SAAWwD,EAAWnD,KAAO/L,GAAW4T,UAGnG,OAAO/O,GAGX4O,UAAW,SAAUV,GACjB,IAAI7P,EACAkC,EACAP,EAAS,GACTyO,EAAQ,GAEZ,GAAIP,GAAcA,EAAWrQ,OACzB,IAAIQ,EAAM,EAAGkC,EAAM9C,KAAKkE,KAAK9D,OAAQQ,EAAMkC,EAAKlC,IAC5CkQ,GAAmBvO,EAAQkO,EAAYzQ,KAAKkE,KAAKtD,GAAMA,EAAKkC,EAAKkO,GAGzE,OAAOzO,IA6Bf,IAAI6O,GAAY,CACZ8B,IAAK,SAASnC,EAAanO,EAAMyO,GAC7B,IAAIxQ,EAAQwQ,EAASxL,IAAIjD,GAEzB,IAAKuQ,GAASpC,GACVA,EAAclQ,OACX,GAAIsS,GAAStS,GAChBkQ,GAAelQ,EAGnB,OAAOkQ,GAEXS,MAAO,SAAST,GACZ,OAAQA,GAAe,GAAK,GAEhCqC,QAAS,SAASrC,EAAanO,EAAMyO,EAAU5Q,EAAOL,EAAQ4Q,GAC1D,IAAInQ,EAAQwQ,EAASxL,IAAIjD,GAEzB,GAAIoO,EAAMQ,QAAU9U,EAChBsU,EAAMQ,MAAQ,EAGlB,IAAK2B,GAASpC,GACVA,EAAclQ,OACX,GAAIsS,GAAStS,GAChBkQ,GAAelQ,EAGnB,GAAIsS,GAAStS,GACTmQ,EAAMQ,QAGV,GAAG/Q,GAASL,EAAS,GAAK+S,GAASpC,GAC/BA,EAAcA,EAAcC,EAAMQ,MAEtC,OAAOT,GAEXsC,IAAK,SAAStC,EAAanO,EAAMyO,GAC7B,IAAIxQ,EAAQwQ,EAASxL,IAAIjD,GAEzB,IAAKuQ,GAASpC,KAAiBuC,GAAOvC,GAClCA,EAAclQ,EAGlB,GAAGkQ,EAAclQ,IAAUsS,GAAStS,IAAUyS,GAAOzS,IACjDkQ,EAAclQ,EAElB,OAAOkQ,GAEXwC,IAAK,SAASxC,EAAanO,EAAMyO,GAC7B,IAAIxQ,EAAQwQ,EAASxL,IAAIjD,GAEzB,IAAKuQ,GAASpC,KAAiBuC,GAAOvC,GAClCA,EAAclQ,EAGlB,GAAGkQ,EAAclQ,IAAUsS,GAAStS,IAAUyS,GAAOzS,IACjDkQ,EAAclQ,EAElB,OAAOkQ,IAIf,SAASoC,GAASK,GACd,cAAcA,IAAQ,WAAaC,MAAMD,GAG7C,SAASF,GAAOE,GACZ,OAAOA,GAAOA,EAAIjO,QAGtB,SAAS7E,GAAOb,GACZ,IAAIe,EAAKR,EAASP,EAAMO,OAAQmC,EAAS,IAAIxF,MAAMqD,GAEnD,IAAKQ,EAAM,EAAGA,EAAMR,EAAQQ,IACxB2B,EAAO3B,GAAOf,EAAMe,GAAKF,SAG7B,OAAO6B,EAGXmK,EAAM6D,eAAiBA,GACvB7D,EAAMC,cAAgBA,GAEtBD,EAAMgH,QAAU,SAASxP,EAAM0E,EAASiJ,GACpCjJ,EAAUA,GAAW,GAErB,IAAIwJ,EAAQxJ,EAAQwJ,MACpB,IAAIuB,EAAkBhD,GAA6BJ,GAAe6B,GAAS,KAC3E,IAAIwB,EAAQ,IAAIlH,EAAMxI,GAClB2P,EAAiCnD,GAA6B0B,GAAS,IACvE0B,EAAiBnH,GAAc/D,EAAQlG,MAAQ,IAC/CA,EAAOiR,EAAkBG,EAAiBD,EAA+B9Q,OAAO+Q,GAChFC,EACAC,EACAC,EAAiBrL,EAAQqL,eACzBzQ,EAASoF,EAAQpF,OACjBiO,EAAO7I,EAAQ6I,KACfC,EAAO9I,EAAQ8I,KAEnB,GAAIhP,GAAQmP,EACR+B,EAAQA,EAAMlR,KAAKA,EAAMhG,EAAWA,EAAWmV,GAGnD,GAAIrO,EAAQ,CACRoQ,EAAQA,EAAMpQ,OAAOA,GAErB,GAAIyQ,EACAL,EAAQK,EAAeL,GAG3BI,EAAQJ,EAAMtC,UAAUlR,OAG5B,GAAIsC,EAAM,CACN,IAAKmP,EACD+B,EAAQA,EAAMlR,KAAKA,GAGvB,GAAI0P,EACAlO,EAAO0P,EAAMtC,UAIrB,GAAIqC,EAAiB,CACjBC,EAAQA,EAAMxB,MAAMA,EAAOlO,EAAM0E,GAEjC,GAAI6I,IAAS/U,GAAagV,IAAShV,IAAckM,EAAQ0J,YAAa,CAClEsB,EAAQ,IAAIlH,EAAMwH,GAAWN,EAAMtC,YAAYC,MAAME,EAAMC,GAE3DqC,EAA8B7W,EAAI2W,EAAgC,SAASM,GACvE,OAAOxX,EAAO,GAAIwX,EAAiB,CAC/B3D,gBAAiB,SAIzBoD,EAAQA,EAAMxB,MAAM2B,EAA6B7P,EAAM0E,QAExD,CACH,GAAI6I,IAAS/U,GAAagV,IAAShV,EAAW,CAC1CsX,EAAQJ,EAAM1P,KAAK9D,OAEnB,GAAIqR,EAAOC,EAAOsC,GAASpL,EAAQwL,QAC/B3C,GAAQA,EAAOC,EAAOsC,EAE1BJ,EAAQA,EAAMrC,MAAME,EAAMC,GAG9B,GAAIU,KAAWvV,EAAcuV,IAAUA,EAAMhS,SAAW,GACpDwT,EAAQA,EAAMxB,MAAMA,EAAOlO,EAAM0E,GAIzC,MAAO,CACHoL,MAAOA,EACP9P,KAAM0P,EAAMtC,YAIpB,IAAI+C,GAAiB9W,EAAMZ,OAAO,CAC9BiD,KAAM,SAASgJ,GACX5I,KAAKkE,KAAO0E,EAAQ1E,MAGxBoQ,KAAM,SAAS1L,GACXA,EAAQ2L,QAAQvU,KAAKkE,OAEzBsQ,OAAQ,SAAS5L,GACbA,EAAQ2L,QAAQ3L,EAAQ1E,OAE5BsF,OAAQ,SAASZ,GACbA,EAAQ2L,QAAQ3L,EAAQ1E,OAE5BuQ,QAAS,SAAS7L,GACdA,EAAQ2L,QAAQ3L,EAAQ1E,SAI5BwQ,GAAkBnX,EAAMZ,OAAQ,CAChCiD,KAAM,SAASgJ,GACX,IAAI7I,EAAOC,KAAM2U,EAEjB/L,EAAU7I,EAAK6I,QAAUjM,EAAO,GAAIoD,EAAK6I,QAASA,GAElDzL,EAAKqB,EAAM,SAASiC,EAAOX,GACvB,UAAW8I,EAAQ9I,KAAUtC,EACzBoL,EAAQ9I,GAAQ,CACZ8U,IAAKhM,EAAQ9I,MAKzBC,EAAK8U,MAAQjM,EAAQiM,MAAOC,GAAMtL,OAAOZ,EAAQiM,OAAS,CACtDpR,KAAMrG,EACN2X,IAAK3X,GAGTuX,EAAe/L,EAAQ+L,aAEvB,GAAI/L,EAAQoM,OACRjV,EAAKiV,OAASpM,EAAQoM,OAG1B,GAAI3X,EAAWuL,EAAQ7J,MACnBgB,EAAKhB,KAAO6J,EAAQ7J,KAGxB,IAAKgB,EAAKhB,KACNgB,EAAKhB,KAAON,EAGhBsB,EAAK4U,aAAetX,EAAWsX,GAAgBA,EAAe,SAAS/L,GACnE,IAAIrG,EAAS,GAEbpF,EAAKyL,EAAS,SAASqM,EAAQpU,GAC3B,GAAIoU,KAAUN,EAAc,CACxBM,EAASN,EAAaM,GACtB,GAAIrY,EAAcqY,GAAS,CACvBpU,EAAQoU,EAAOpU,MAAMA,GACrBoU,EAASA,EAAOvQ,KAIxBnC,EAAO0S,GAAUpU,IAGrB,OAAO0B,IAIfqG,QAAS,CACL+L,aAAclW,GAGlB+K,OAAQ,SAASZ,GACb,OAAO3L,EAAK+C,KAAKkV,MAAMtM,EAASjL,KAGpC2W,KAAM,SAAS1L,GACX,IAAI7I,EAAOC,KACPuU,EACAY,EACA5S,EACAsS,EAAQ9U,EAAK8U,MAEjBjM,EAAU7I,EAAKmV,MAAMtM,EAAShL,GAE9B2W,EAAU3L,EAAQ2L,SAAWnX,EAC7B+X,EAAQvM,EAAQuM,OAAS/X,EAEzBmF,EAASsS,EAAMpR,KAAKmF,EAAQ1E,MAE5B,GAAG3B,IAAW7F,EACV6X,EAAQhS,OACL,CACHqG,EAAQ2L,QAAU,SAAShS,GACvBsS,EAAME,IAAInM,EAAQ1E,KAAM3B,GAExBgS,EAAQhS,IAGZjG,EAAEW,KAAK2L,KAIf4L,OAAQ,SAAS5L,GACb,OAAO3L,EAAK+C,KAAKkV,MAAMtM,EAAS/K,KAGpC4W,QAAS,SAAS7L,GACd,OAAO3L,EAAK+C,KAAKkV,MAAMtM,EAAS9K,KAGpCoX,MAAO,SAAStM,EAAS9I,GACrB8I,EAAUA,GAAW,GAErB,IAAI7I,EAAOC,KACPoV,EACAC,EAAYtV,EAAK6I,QAAQ9I,GACzBoE,EAAO7G,EAAWgY,EAAUnR,MAAQmR,EAAUnR,KAAK0E,EAAQ1E,MAAQmR,EAAUnR,KAEjF0E,EAAUjM,EAAO,KAAM,GAAI0Y,EAAWzM,GACtCwM,EAAazY,EAAO,KAAM,GAAIuH,EAAM0E,EAAQ1E,MAE5C0E,EAAQ1E,KAAOnE,EAAK4U,aAAaS,EAAYtV,GAE7C,GAAIzC,EAAWuL,EAAQgM,KACnBhM,EAAQgM,IAAMhM,EAAQgM,IAAIQ,GAG9B,OAAOxM,KAIXkM,GAAQvX,EAAMZ,OAAO,CACrBiD,KAAM,WACFI,KAAKsV,OAAS,IAElBP,IAAK,SAASrQ,EAAKR,GACf,GAAGQ,IAAQhI,EACPsD,KAAKsV,OAAO1W,EAAU8F,IAAQR,GAGtCT,KAAM,SAASiB,GACX,OAAO1E,KAAKsV,OAAO1W,EAAU8F,KAEjC6Q,MAAO,WACHvV,KAAKsV,OAAS,IAElB1R,OAAQ,SAASc,UACN1E,KAAKsV,OAAO1W,EAAU8F,OAoBrC,SAAS8Q,GAAiBtR,EAAMuR,EAASC,EAAeC,EAAoBC,GACxE,IAAIC,EACAlX,EACAoK,EACAnI,EACAkV,EAAU,GACV1V,EAEJ,IAAKQ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDiV,EAAS3R,EAAKtD,GACd,IAAKjC,KAAU8W,EAAS,CACpB1M,EAAe6M,EAAWjX,GAE1B,GAAIoK,GAAgBA,IAAiBpK,EAAQ,CACzC,IAAKmX,EAAQ/M,GACT+M,EAAQ/M,GAAgBvM,EAAM6J,OAAO0C,GAEzC+M,EAAQ/M,GAAc8M,EAAQJ,EAAQ9W,GAAQkX,WACvCA,EAAOlX,MAM9B,SAASoX,GAAe7R,EAAMuR,EAASC,EAAeC,EAAoBC,GACtE,IAAIC,EACAlX,EACAoK,EACAnI,EACAR,EAEJ,IAAKQ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDiV,EAAS3R,EAAKtD,GACd,IAAKjC,KAAU8W,EAAS,CACpBI,EAAOlX,GAAU+W,EAActN,OAAOzJ,EAAQ8W,EAAQ9W,GAAQkX,IAE9D9M,EAAe6M,EAAWjX,GAC1B,GAAIoK,GAAgBA,IAAiBpK,SAC1BkX,EAAO9M,KAM9B,SAASiN,GAAa9R,EAAMuR,EAASC,EAAeC,EAAoBC,GACpE,IAAIC,EACAjV,EACAiH,EACAzH,EAEJ,IAAKQ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDiV,EAAS3R,EAAKtD,GAEdiH,EAAY8N,EAAmBE,EAAOlU,OACtC,GAAIkG,GAAaA,GAAagO,EAAOlU,MACjCkU,EAAOlU,MAAQkG,EAGnBgO,EAAOhV,MAAQ6U,EAActN,OAAOyN,EAAOlU,MAAOkU,EAAOhV,OAEzD,GAAIgV,EAAOhU,MACP,GAAIgU,EAAOrD,aACPwD,GAAaH,EAAOhU,MAAO4T,EAASC,EAAeC,EAAoBC,QAEvEG,GAAeF,EAAOhU,MAAO4T,EAASC,EAAeC,EAAoBC,IAMzF,SAASK,GAAeC,EAAkBrN,EAAOsN,EAAWV,EAASE,EAAoBC,GACrF,OAAO,SAAS1R,GACZA,EAAOgS,EAAiBhS,GAExB,OAAOkS,GAAmBvN,EAAOsN,EAAWV,EAASE,EAAoBC,EAAlEQ,CAA8ElS,IAI7F,SAASkS,GAAmBvN,EAAOsN,EAAWV,EAASE,EAAoBC,GACvE,OAAO,SAAS1R,GAEZ,GAAIA,IAASrH,EAAc4Y,GAAU,CACjC,GAAInW,EAASa,KAAK+D,KAAU,oBAAsBA,aAAgBvE,GAC9DuE,EAAO,CAACA,GAGZiS,EAAUjS,EAAMuR,EAAS,IAAI5M,EAAS8M,EAAoBC,GAG9D,OAAO1R,GAAQ,IAzGvB4Q,GAAMtL,OAAS,SAASZ,GACpB,IAAIyN,EAAQ,CACRC,SAAY,WAAa,OAAO,IAAIxB,KAGxC,GAAIlY,EAAcgM,IAAYvL,EAAWuL,EAAQnF,MAC7C,OAAOmF,EAGX,GAAIA,IAAY,KACZ,OAAO,IAAIkM,GAGf,OAAOuB,EAAMzN,MAgGjB,IAAI2N,GAAahZ,EAAMZ,OAAO,CAC1BiD,KAAM,SAAS4W,GACX,IAAIzW,EAAOC,KAAMqF,EAAQQ,EAAKgD,EAAOF,EAErC6N,EAASA,GAAU,GAEnB,IAAKnR,KAAUmR,EAAQ,CACnB3Q,EAAM2Q,EAAOnR,GAEbtF,EAAKsF,UAAiBQ,IAAQrI,EAASmB,EAAOkH,GAAOA,EAGzD8C,EAAO6N,EAAOC,WAAapV,GAE3B,GAAIzE,EAAcmD,EAAK8I,OACnB9I,EAAK8I,MAAQA,EAAQF,EAAK7M,OAAOiE,EAAK8I,OAG1C,IAAI6N,EAAe3W,EAAKmE,KAAK5C,KAAKvB,GAElCA,EAAK4W,oBAAsBD,EAE3B,GAAI3W,EAAK8I,MAAO,CACZ,IAAI+N,EAAiB7W,EAAKkT,OAAO3R,KAAKvB,GAClC8W,EAAoB9W,EAAK+W,UAAUxV,KAAKvB,GACxC4V,EAAqB,GACrBF,EAAU,GACVsB,EAAmB,GACnBnB,EAAa,GACbjQ,EAAkB,MAClBkC,EACA5L,EAEJ4M,EAAQ9I,EAAK8I,MAEb,GAAIA,EAAMR,OAAQ,CACdlL,EAAK0L,EAAMR,OAAQ,SAAS1G,EAAOd,GAC/B,IAAImW,EAEJnP,EAAYlG,EAEZ,GAAI/E,EAAciE,IAAUA,EAAMc,MAC9BkG,EAAYhH,EAAMc,WACf,UAAWd,IAAUrD,EACxBqK,EAAYhH,EAGhB,GAAIjE,EAAciE,IAAUA,EAAMoW,KAC9BD,EAAWnW,EAAMoW,KAGrBtR,EAAkBA,GAAoBqR,GAAYA,IAAarV,GAAUkG,IAAclG,EACvF1F,EAAO+a,GAAYnP,EACnB4N,EAAQ9T,GAAS1F,EAAKiG,QAAQ,QAAU,EAAIvD,EAAO1C,EAAM,MAAQ0C,EAAO1C,GACxE8a,EAAiBpV,GAAShD,EAAOgD,GACjCgU,EAAmBqB,GAAYnP,GAAalG,EAC5CiU,EAAWjU,GAASqV,GAAYnP,IAGpC,IAAK2O,EAAOM,WAAanR,EACrB5F,EAAK+W,UAAYb,GAAeY,EAAmBhO,EAAO2M,GAAkBuB,EAAkBpB,EAAoBC,GAI1H7V,EAAK4W,oBAAsBD,EAC3B3W,EAAKmX,oBAAsBd,GAAmBvN,EAAOkN,GAAgBN,EAASE,EAAoBC,GAClG7V,EAAKmE,KAAO+R,GAAeS,EAAc7N,EAAOkN,GAAgBN,EAASE,EAAoBC,GAC7F7V,EAAKkT,OAASgD,GAAeW,EAAgB/N,EAAOmN,GAAcP,EAASE,EAAoBC,KAGvGuB,OAAQ,SAASjT,GACb,OAAOA,EAAOA,EAAKiT,OAAS,MAEhC7O,MAAO7J,EACPyF,KAAMzF,EACNuV,MAAO,SAAS9P,GACZ,OAAOA,EAAK9D,QAEhB6S,OAAQxU,EACRgS,WAAY,WACR,MAAO,IAEXqG,UAAW,SAAS5S,GAChB,OAAOA,KAIf,SAASkT,GAAcC,EAAeC,GAClC,IAAIC,EACJ,IAAIC,EAEJ,GAAIF,EAASzV,OAASyV,EAASzV,MAAMzB,OACjC,IAAK,IAAIyC,EAAI,EAAGA,EAAIyU,EAASzV,MAAMzB,OAAQyC,IAAK,CAC5C0U,EAAeF,EAAcxV,MAAMwV,EAAcxV,MAAMzB,OAAS,GAChEoX,EAAaF,EAASzV,MAAMgB,GAC5B,GAAI0U,GAAgBC,EAChB,GAAID,EAAa/E,cAAgB+E,EAAa1W,OAAS2W,EAAW3W,MAC9DuW,GAAcG,EAAcC,QACzB,GAAID,EAAa5V,OAAS4V,EAAa1W,OAAS2W,EAAW3W,MAC9D0W,EAAa1V,MAAM9C,KAAKyD,MAAM+U,EAAa1V,MAAO2V,EAAW3V,YAE7DwV,EAAcxV,MAAM9C,KAAKyD,MAAM6U,EAAcxV,MAAO,CAAC2V,SAEtD,GAAIA,EACPH,EAAcxV,MAAM9C,KAAKyD,MAAM6U,EAAcxV,MAAO,CAAC2V,KAKrE,SAASC,GAAYxW,EAAQyW,EAAMjG,EAAMC,GACrC,IAAIU,EACAxR,EAAM,EACNiB,EAEJ,MAAO6V,EAAKtX,QAAUsR,EAAM,CACxBU,EAAQsF,EAAK9W,GACbiB,EAAQuQ,EAAMvQ,MAEd,IAAIzB,EAASyB,EAAMzB,OAEnB,GAAIa,GAAUA,EAAOU,QAAUyQ,EAAMzQ,OAASV,EAAOJ,QAAUuR,EAAMvR,MAAO,CACxE,GAAII,EAAOuR,cAAgBvR,EAAOY,MAAMzB,OACpCqX,GAAYxW,EAAOY,MAAMZ,EAAOY,MAAMzB,OAAS,GAAIgS,EAAMvQ,MAAO4P,EAAMC,OACnE,CACH7P,EAAQA,EAAMzC,MAAMqS,EAAMA,EAAOC,GACjCzQ,EAAOY,MAAQZ,EAAOY,MAAMkB,OAAOlB,GAEvC6V,EAAKxY,OAAO0B,IAAO,QAChB,GAAIwR,EAAMI,cAAgB3Q,EAAMzB,OAAQ,CAC3CqX,GAAYrF,EAAOvQ,EAAO4P,EAAMC,GAChC,IAAKU,EAAMvQ,MAAMzB,OACbsX,EAAKxY,OAAO0B,IAAO,OAEpB,CACHiB,EAAQA,EAAMzC,MAAMqS,EAAMA,EAAOC,GACjCU,EAAMvQ,MAAQA,EAEd,IAAKuQ,EAAMvQ,MAAMzB,OACbsX,EAAKxY,OAAO0B,IAAO,GAI3B,GAAIiB,EAAMzB,SAAW,EACjBqR,GAAQrR,MACL,CACHqR,EAAO,EACPC,GAAQ7P,EAAMzB,OAGlB,KAAMQ,GAAO8W,EAAKtX,OACd,MAIR,GAAIQ,EAAM8W,EAAKtX,OACXsX,EAAKxY,OAAO0B,EAAK8W,EAAKtX,OAASQ,GAIvC,SAASsT,GAAWjB,EAAQ0E,GACxB,IAAIpV,EAAS,GACb,IAAIqV,GAAgB3E,GAAU,IAAI7S,OAClC,IAAIgS,EACJ,IAAIvQ,EACJ,IAAIgW,EAAUxa,EAAWsa,GAAiBA,EAAgB,SAAS9X,EAAOY,GACtE,OAAOZ,EAAMY,IAGjB,IAAK,IAAIqX,EAAa,EAAGA,EAAaF,EAAcE,IAAc,CAC9D1F,EAAQyF,EAAQ5E,EAAQ6E,GAExB,GAAI1F,EAAMI,aACNjQ,EAASA,EAAOQ,OAAOmR,GAAW9B,EAAMvQ,YACrC,CACHA,EAAQuQ,EAAMvQ,MAEd,IAAK,IAAIkW,EAAY,EAAGA,EAAYlW,EAAMzB,OAAQ2X,IAC9CxV,EAAOxD,KAAK8Y,EAAQhW,EAAOkW,KAIvC,OAAOxV,EAGX,SAASyV,GAAc9T,GACnB,IAAItD,EACA2B,EAAS,GACTnC,EACAyB,EACAkW,EAEJ,IAAKnX,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrD,IAAIwR,EAAQlO,EAAK1D,GAAGI,GACpB,GAAIwR,EAAMvQ,MACN,GAAIuQ,EAAMI,aACNjQ,EAASA,EAAOQ,OAAOiV,GAAc5F,EAAMvQ,YACxC,CACHA,EAAQuQ,EAAMvQ,MACd,IAAKkW,EAAY,EAAGA,EAAYlW,EAAMzB,OAAQ2X,IAC1CxV,EAAOxD,KAAK8C,EAAMrB,GAAGuX,KAKrC,OAAOxV,EAGX,SAAS0V,GAAe/T,EAAM2E,GAC1B,IAAIjI,EAAKR,EAAQgS,EACjB,GAAIvJ,EACA,IAAKjI,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDwR,EAAQlO,EAAK1D,GAAGI,GAChB,GAAIwR,EAAMvQ,MACN,GAAIuQ,EAAMI,aACNyF,GAAe7F,EAAMvQ,MAAOgH,QAE5BuJ,EAAMvQ,MAAQ,IAAIoC,EAAoBmO,EAAMvQ,MAAOgH,EAAOuJ,EAAMvQ,MAAMwC,UAO1F,SAAS6T,GAAehU,EAAMiU,GAC1B,IAAK,IAAIvX,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IACjC,GAAIsD,EAAKtD,GAAK4R,cACV,GAAI0F,GAAehU,EAAKtD,GAAKiB,MAAOsW,GAChC,OAAO,UAER,GAAIA,EAAKjU,EAAKtD,GAAKiB,MAAOqC,EAAKtD,IAClC,OAAO,KAKnB,SAASwX,GAAgBC,EAAQnU,EAAMtB,EAAMxB,GACzC,IAAK,IAAIR,EAAM,EAAGA,EAAMyX,EAAOjY,OAAQQ,IAAO,CAC1C,GAAIyX,EAAOzX,GAAKsD,OAASA,EACrB,MAEJ,GAAIoU,GAAeD,EAAOzX,GAAKsD,KAAMtB,EAAMxB,GACvC,OAKZ,SAASkX,GAAezW,EAAOe,EAAMxB,GACjC,IAAK,IAAIR,EAAM,EAAGR,EAASyB,EAAMzB,OAAQQ,EAAMR,EAAQQ,IACnD,GAAIiB,EAAMjB,IAAQiB,EAAMjB,GAAK4R,aACzB,OAAO8F,GAAezW,EAAMjB,GAAKiB,MAAOe,EAAMxB,QAC3C,GAAIS,EAAMjB,KAASgC,GAAQf,EAAMjB,KAASQ,EAAY,CAC1DS,EAAMjB,GAAOQ,EACb,OAAO,MAKlB,SAASmX,GAAsBC,EAAMtU,EAAMmU,EAAQvY,EAAM2Y,GACrD,IAAK,IAAIC,EAAY,EAAGtY,EAASoY,EAAKpY,OAAQsY,EAAYtY,EAAQsY,IAAa,CAC3E,IAAI9V,EAAO4V,EAAKE,GAEhB,IAAK9V,GAAQA,aAAgB9C,EACzB,SAGJ,GAAI8C,EAAK4P,eAAiB9V,IAAc+b,EACpCF,GAAsB3V,EAAKf,MAAOqC,EAAMmU,EAAQvY,EAAM2Y,QAEtD,IAAK,IAAI7X,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IACjC,GAAIsD,EAAKtD,KAASgC,EAAM,CACpB4V,EAAKE,GAAaxU,EAAK1D,GAAGI,GAC1BwX,GAAgBC,EAAQnU,EAAMtB,EAAM4V,EAAKE,IACzC,QAOpB,SAASC,GAAYzU,EAAM2E,GACvB,IAAK3E,EACD,OAEJ,IAAI9D,EAAS8D,EAAK9D,OAClB,IAAIwY,EACJ,IAAIhY,EAEJ,IAAKA,EAAM,EAAGA,EAAMR,EAAQQ,IAAO,CAC/BgY,EAAW1U,EAAKtD,GAEhB,GAAIgY,EAASnT,KAAOmT,EAASnT,KAAOoD,EAAMpD,IAAK,CAC3CvB,EAAKhF,OAAO0B,EAAK,GACjB,OAAOgY,IAKnB,SAASC,GAAqB3U,EAAM2E,GAChC,GAAIA,EACA,OAAO3G,GAAQgC,EAAM,SAAStB,GAC1B,OAAQA,EAAK6C,KAAO7C,EAAK6C,KAAOoD,EAAMpD,KAAS7C,EAAKiG,EAAMX,WAAaW,EAAM7M,IAAM6M,EAAM7M,KAAO6M,EAAMV,aAG9G,OAAQ,EAGZ,SAAS2Q,GAAa5U,EAAM2E,GACxB,GAAIA,EACA,OAAO3G,GAAQgC,EAAM,SAAStB,GAC1B,OAAOA,EAAK6C,KAAOoD,EAAMpD,MAGjC,OAAQ,EAGZ,SAASvD,GAAQgC,EAAM8N,GACnB,IAAIpR,EAAKR,EACT,IAAK8D,EACD,OAGJ,IAAKtD,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAIoR,EAAS9N,EAAKtD,IACd,OAAOA,EAIf,OAAQ,EAGZ,SAASmY,GAAmB1Q,EAAQpM,GAChC,GAAIoM,IAAWxL,EAAcwL,GAAS,CAClC,IAAIuE,EAAavE,EAAOpM,GACxB,IAAI4L,EACJ,GAAIjL,EAAcgQ,GACd/E,EAAY+E,EAAWqK,MAAQrK,EAAWjL,OAAS1F,OAEnD4L,EAAYQ,EAAOpM,IAASA,EAGhC,GAAIoB,EAAWwK,GACX,OAAO5L,EAGX,OAAO4L,EAEX,OAAO5L,EAGX,SAAS+c,GAA8BpM,EAAY/D,GAC/C,IAAIjI,EACAR,EACAa,EAAS,GAEb,IAAK,IAAIU,KAASiL,EACd,GAAIjL,IAAU,UACVV,EAAOU,GAASiL,EAAWjL,GAInC,GAAIiL,EAAWe,QAAS,CACpB1M,EAAO0M,QAAU,GACjB,IAAK/M,EAAM,EAAGR,EAASwM,EAAWe,QAAQvN,OAAQQ,EAAMR,EAAQQ,IAC5DK,EAAO0M,QAAQ/M,GAAOoY,GAA8BpM,EAAWe,QAAQ/M,GAAMiI,QAGjF5H,EAAOU,MAAQoX,GAAmBlQ,EAAMR,OAAQpH,EAAOU,OAE3D,OAAOV,EAGX,SAASgY,GAAwBpM,EAAahE,GAC1C,IAAIjI,EACAR,EACAmC,EAAS,GACTtB,EACA2L,EAEJ,IAAKhM,EAAM,EAAGR,EAASyM,EAAYzM,OAAQQ,EAAMR,EAAQQ,IAAQ,CAC7DK,EAAS,GAET2L,EAAaC,EAAYjM,GAEzB,IAAK,IAAIe,KAASiL,EACd3L,EAAOU,GAASiL,EAAWjL,GAG/BV,EAAOU,MAAQoX,GAAmBlQ,EAAMR,OAAQpH,EAAOU,OAEvD,GAAIV,EAAOwP,YAAc3T,EAAQmE,EAAOwP,YACpCxP,EAAOwP,WAAawI,GAAwBhY,EAAOwP,WAAY5H,GAEnEtG,EAAOxD,KAAKkC,GAEhB,OAAOsB,EAGX,IAAIoE,GAAarJ,EAAWX,OAAO,CAC/BiD,KAAM,SAASgJ,GACX,IAAI7I,EAAOC,KAAM6I,EAAO3E,EAExB,GAAI0E,EACA1E,EAAO0E,EAAQ1E,KAGnB0E,EAAU7I,EAAK6I,QAAUjM,EAAO,GAAIoD,EAAK6I,QAASA,GAElD7I,EAAKmZ,KAAO,GACZnZ,EAAKoZ,UAAY,GACjBpZ,EAAKqZ,MAAQ,GACbrZ,EAAKsZ,cAAgB,GACrBtZ,EAAKuZ,QAAU,GACfvZ,EAAKwZ,MAAQ,GACbxZ,EAAKyZ,eAAiB,EACtBzZ,EAAK0Z,WAAa,GAClB1Z,EAAK2Z,UAAY9Q,EAAQ+Q,SACzB5Z,EAAK6Z,MAAQhR,EAAQiR,OAAUjR,EAAQ+Q,SAAW,EAAIjd,GACtDqD,EAAK+Z,MAAQnN,GAAc/D,EAAQlG,MACnC3C,EAAKga,YAAchN,GAAWnE,EAAQlG,MACtC3C,EAAKia,QAAUrK,GAAgB/G,EAAQpF,QACvCzD,EAAKka,OAAS1J,GAAe3H,EAAQwJ,OACrCrS,EAAKma,WAAatR,EAAQuI,UAC1BpR,EAAKoa,OAASvR,EAAQoL,MACtBjU,EAAKqa,aAAexR,EAAQ0J,YAE5B,GAAIvS,EAAKqa,aACLra,EAAKsa,aAAe,GAExBta,EAAKua,+BAAiC,KAEtChd,EAAW4C,GAAGN,KAAKO,KAAKJ,GAExBA,EAAKwa,UAAYC,GAAUhR,OAAOZ,EAAS1E,EAAMnE,GAEjD,GAAI1C,EAAW0C,EAAKwa,UAAUxb,MAC1BgB,EAAKwa,UAAUxb,KAAK,CAChB0b,WAAY1a,EAAK2a,YAAYpZ,KAAKvB,GAClC4a,WAAY5a,EAAK6a,YAAYtZ,KAAKvB,GAClC8a,YAAa9a,EAAK+a,aAAaxZ,KAAKvB,KAI5C,GAAI6I,EAAQmS,gBAAkB,KAC1B,UAAWnS,EAAQmS,gBAAkB,SAAU,CAC3C,IAAIrW,EAAMkE,EAAQmS,eAElBhb,EAAKib,SAAW,CACZC,QAAS,WACL,OAAO3Q,KAAKhC,MAAM4S,aAAaD,QAAQvW,KAE3CyW,QAAS,SAASvY,GACdsY,aAAaC,QAAQzW,EAAK9F,EAAUmB,EAAKqb,OAAOtE,UAAUlU,YAIlE7C,EAAKib,SAAWpS,EAAQmS,eAIhChb,EAAKqb,OAAS,IAAI5e,EAAM0H,KAAKmX,QAAQzS,EAAQ4N,OAAO1W,MAAQ,QAAS8I,EAAQ4N,QAE7E3N,EAAQ9I,EAAKqb,OAAOvS,OAAS,GAE7B9I,EAAKub,2BAELvb,EAAKqZ,MAAQrZ,EAAKwb,SAASxb,EAAKqZ,OAChCrZ,EAAKyb,QAAU,KAEfzb,EAAKuB,KAAK,CAAC,OAAQpD,EAAOH,EAAQI,EAAcH,EAAMK,EAAYD,GAAWwK,IAGjFA,QAAS,CACL1E,KAAM,KACNsS,OAAQ,CACLC,UAAWpV,IAEd0Z,eAAgB,KAChBU,cAAe,MACfC,aAAc,MACdC,gBAAiB,MACjBlD,eAAgB,MAChBmD,iBAAkB,MAClBC,MAAO,MACPC,YAAa,OAGjBC,MAAO,WACH,OAAO/b,MAGXgc,OAAQ,SAASnb,GACb,GAAIA,IAAUnE,EAAW,CACrB,GAAIsD,KAAKwb,SAAW3a,EAAO,CACvBb,KAAKwb,QAAU3a,EAEf,GAAIA,EACA,OAAOb,KAAKic,OAIpB,OAAO3f,EAAE4f,WAAWC,UAAUpa,eAE9B,OAAO/B,KAAKwb,SAIpBY,YAAa,SAASpL,GAClB,GAAIhR,KAAK4I,QAAQmS,gBAAkB,KAC/B,OAAO,KAGX,GAAI/J,IAAUtU,EACV,OAAOsD,KAAKgb,SAASG,QAAQnK,GAGjC,OAAOhR,KAAKgb,SAASC,WAAa,IAGtCoB,iBAAkB,WACd,IAAIjK,EAAQpS,KAAKoS,SAAW,GAE5B,OAAOpS,KAAK4I,QAAQ6P,gBAAkBrG,EAAMhS,QAGhDkc,oBAAqB,WACjB,OAAOtc,KAAKqc,oBAAsBrc,KAAKoa,cAG3CmC,cAAe,WACX,IAAInK,EAAQpS,KAAKia,QAAU,GAE3B,OAAOja,KAAKoa,cAAgBhI,EAAMhS,QAGtCsa,YAAa,SAASnY,GAClBvC,KAAKwc,MAAMja,EAAQ,eAGvBqY,YAAa,SAASrY,GAClBvC,KAAKwc,MAAMja,EAAQ,eAGvBuY,aAAc,SAASvY,GACnBvC,KAAKwc,MAAMja,EAAQ,gBAGvBia,MAAO,SAASja,EAAQ8S,GACpB,IAAInR,EAAOlE,KAAKyc,UAAUla,GAE1B,IAAK2B,EACDA,EAAO3B,EAGXvC,KAAKqV,GAAWnR,IAGpBwY,UAAW,SAASxY,EAAMuN,GACtB,GAAIvN,EAAM,CACN,GAAIlE,KAAKqc,mBACL,OAAOrE,GAAc9T,GAGzB,IAAKuN,EACD,IAAK,IAAI7Q,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IACjCsD,EAAK1D,GAAGI,GAKpB,OAAOsD,GAGXnD,OAAQ3D,EAERyI,IAAK,SAAS7J,GACV,IAAI4E,EAAKR,EAAQ8D,EAAOlE,KAAK0c,UAAU1c,KAAKoZ,MAAOpZ,KAAK4I,QAAQ+T,WAEhE,IAAK/b,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAIsD,EAAKtD,GAAK5E,IAAMA,EAChB,OAAOkI,EAAKtD,IAKxBgc,SAAU,SAAS5gB,GACf,OAAOgE,KAAK6c,UAAU7gB,EAAIgE,KAAKoZ,QAGnCyD,UAAW,SAAS7gB,EAAI8gB,GACpB,IAAIlc,EAAKR,EAAQ8D,EAAOlE,KAAK0c,UAAUI,EAAW9c,KAAK4I,QAAQ+T,WAE/D,IAAKzY,EACD,OAGJ,IAAKtD,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAIsD,EAAKtD,GAAK6E,KAAOzJ,EACjB,OAAOkI,EAAKtD,IAKxBsB,QAAS,SAAS2G,GACd,OAAOiQ,GAAa9Y,KAAKoZ,MAAOvQ,IAGpCrI,GAAI,SAASC,GACT,OAAOT,KAAKoZ,MAAM5Y,GAAGC,IAGzByD,KAAM,SAASrD,GACX,IAAId,EAAOC,KACX,GAAIa,IAAUnE,EAAW,CACrBqD,EAAKub,2BACLvb,EAAKqZ,MAAQpZ,KAAKub,SAAS1a,GAE3Bd,EAAKsZ,cAAgBxY,EAAMzB,MAAM,GAEjCW,EAAKgd,aAELhd,EAAKuZ,QAAU,GACfvZ,EAAK2B,QAAQ,SACb3B,EAAKid,UAAUjd,EAAKqZ,OAEpBrZ,EAAKoa,OAASpa,EAAKqZ,MAAMhZ,OACzBL,EAAKyZ,eAAiBzZ,EAAKoa,OAE3Bpa,EAAKkd,SAASld,EAAKqZ,WAChB,CACH,GAAIrZ,EAAKqZ,MACL,IAAK,IAAIxY,EAAM,EAAGA,EAAMb,EAAKqZ,MAAMhZ,OAAQQ,IACvCb,EAAKqZ,MAAM5Y,GAAGI,GAItB,OAAOb,EAAKqZ,QAIpBZ,KAAM,SAAS3X,GACX,GAAIA,IAAUnE,EACV,OAAOsD,KAAKuZ,WAEZvZ,KAAKuZ,MAAQvZ,KAAKkd,aAAarc,IAIvCqc,aAAc,SAAShZ,GACnB,IAAInE,EAAOC,KACXuY,GAAsBrU,EAAMnE,EAAKqZ,MAAOrZ,EAAKuZ,QAASvZ,EAAKqb,OAAOvS,OAAS5I,EAAkBF,EAAKsc,oBAElG,IAAI7D,EAAO,IAAIvU,EAAoBC,EAAMnE,EAAKqb,OAAOvS,OACrD2P,EAAKzX,OAAS,WAAa,OAAOhB,EAAKgB,UACvC,OAAOyX,GAGX2E,SAAU,WACN,IAAIlK,EAASjT,KAAKoS,SAAW,GAE7B,GAAIa,EAAO7S,OACP,OAAO4X,GAAchY,KAAKuZ,YAE1B,OAAOvZ,KAAKuZ,OAIpBxE,IAAK,SAASlM,GACV,OAAO7I,KAAKod,OAAOpd,KAAKoZ,MAAMhZ,OAAQyI,IAG1CwU,gBAAiB,SAASxU,GACtB,GAAI7I,KAAKob,OAAOvS,MACZ,OAAO,IAAI7I,KAAKob,OAAOvS,MAAMA,GAGjC,GAAIA,aAAiB5I,EACjB,OAAO4I,EAGX,OAAO,IAAI5I,EAAiB4I,IAGhCuU,OAAQ,SAAS3c,EAAOoI,GACpB,IAAKA,EAAO,CACRA,EAAQpI,EACRA,EAAQ,EAGZ,KAAMoI,aAAiBxH,IACnBwH,EAAQ7I,KAAKqd,gBAAgBxU,GAGjC,GAAI7I,KAAKqc,mBACLrc,KAAKoZ,MAAMla,OAAOuB,EAAO,EAAGT,KAAKsd,kBAAkBzU,SAEnD7I,KAAKoZ,MAAMla,OAAOuB,EAAO,EAAGoI,GAGhC7I,KAAKud,oBAAoB9c,EAAOoI,GAEhC,OAAOA,GAGX2U,WAAY,SAAS/c,EAAOoB,GACxB,IAAI9B,EAAOC,KACX,IAAIyd,EAAY1d,EAAK2d,uBAErB,IAAK7b,EAAO,CACRA,EAAQpB,EACRA,EAAQ,EAGZ,IAAK3D,EAAQ+E,GACTA,EAAQ,CAACA,GAGb,IAAI8b,EAAS,GACb,IAAIC,EAAW5d,KAAK4I,QAAQgV,SAC5B5d,KAAK4I,QAAQgV,SAAW,MAExB,IACI,IAAK,IAAIhd,EAAM,EAAGA,EAAMiB,EAAMzB,OAAQQ,IAAQ,CAC1C,IAAIgC,EAAOf,EAAMjB,GAEjB,IAAI2B,EAASvC,KAAKod,OAAO3c,EAAOmC,GAEhC+a,EAAO5e,KAAKwD,GAEZ,IAAIsb,EAAWtb,EAAO7B,SAEtB,GAAIV,KAAKqc,mBACLwB,EAAW7d,KAAKsd,kBAAkBO,GAGtC7d,KAAKqZ,cAActa,KAAK8e,GAExB,GAAIJ,GAAaA,EAAUrd,OACvB9D,EAAEmhB,GAAWK,OAAO,GAAGC,aAAahf,KAAK8e,GAG7Cpd,KAEN,QACET,KAAK4I,QAAQgV,SAAWA,EAG5B,GAAID,EAAOvd,OACPJ,KAAK0B,QAAQ,OAAQ,CACjB5B,KAAM,SACN+B,MAAO8b,KAKnBlD,WAAY,SAAS5Y,GACjB7B,KAAKwd,WAAWxd,KAAKoZ,MAAMhZ,OAAQyB,IAGvC8Y,WAAY,SAAS9Y,GACjB,IAAK/E,EAAQ+E,GACTA,EAAQ,CAACA,GAGb,IAAI8b,EAAS,GAEb,IAAK,IAAI/c,EAAM,EAAGA,EAAMiB,EAAMzB,OAAQQ,IAAQ,CAC1C,IAAIgC,EAAOf,EAAMjB,GACjB,IAAIiI,EAAQ7I,KAAKqd,gBAAgBza,GAEjC,IAAI3B,EAASjB,KAAK6F,IAAIgD,EAAM7M,IAE5B,GAAIiF,EAAQ,CACR0c,EAAO5e,KAAKkC,GAEZA,EAAOuH,OAAO5F,GAEd3B,EAAOS,QAAQ3D,GAEfiC,KAAKge,wBAAwB/c,EAAQ2B,QAErC5C,KAAKya,WAAW7X,GAIxB,GAAI+a,EAAOvd,OACPJ,KAAK0B,QAAQ,OAAQ,CACjB5B,KAAM,SACN+B,MAAO8b,KAKnB9C,YAAa,SAAShZ,GAClB,IAAI8b,EAAS3d,KAAKie,aAAapc,GAE/B,GAAI8b,EAAOvd,OACPJ,KAAK0B,QAAQ,OAAQ,CACjB5B,KAAM,UACN+B,MAAO8b,KAKnBM,aAAc,SAASpc,EAAOqc,GAC1B,IAAKphB,EAAQ+E,GACTA,EAAQ,CAACA,GAGb,IAAIsc,SAA8BD,IAAmB,YAAcA,EAAiB,KAEpF,IAAIE,EAAY,GAChB,IAAIR,EAAW5d,KAAK4I,QAAQgV,SAC5B5d,KAAK4I,QAAQgV,SAAW,MACxB,IACI,IAAK,IAAIhd,EAAM,EAAGA,EAAMiB,EAAMzB,OAAQQ,IAAQ,CAC1C,IAAIgC,EAAOf,EAAMjB,GACjB,IAAIiI,EAAQ7I,KAAKqd,gBAAgBza,GACjC,IAAIyb,EAAQ,MAEZre,KAAKse,UAAUte,KAAKoZ,MAAO,SAASvX,GAChC,IAAK,IAAIjB,EAAM,EAAGA,EAAMiB,EAAMzB,OAAQQ,IAAO,CACzC,IAAIgC,EAAOf,EAAMrB,GAAGI,GACpB,GAAIgC,EAAK5G,KAAO6M,EAAM7M,GAAI,CACtBoiB,EAAUrf,KAAK6D,GACff,EAAM3C,OAAO0B,EAAK,GAClByd,EAAQ,KACR,UAKZ,GAAIA,GAASF,EAAsB,CAC/Bne,KAAKue,wBAAwB1V,GAC7B7I,KAAKyZ,WAAWxa,QAG1B,QACEe,KAAK4I,QAAQgV,SAAWA,EAG5B,OAAOQ,GAGXI,SAAU,SAAS/d,EAAOoB,GACtB,IAAI8b,EAAS3d,KAAKye,WAAWhe,EAAOoB,GAEpC,GAAI8b,EAAOvd,OACPJ,KAAK0B,QAAQ,OAAQ,CACjB5B,KAAM,SACN+B,MAAO8b,KAKnBc,WAAY,SAAUhe,EAAOoB,GACzB,IAAK/E,EAAQ+E,GACTA,EAAQ,CAACA,GAGb,IAAI6c,EAAQ,GACZ,IAAId,EAAW5d,KAAK4I,QAAQgV,SAC5B5d,KAAK4I,QAAQgV,SAAW,MAExB,IACI,IAAK,IAAI/a,EAAI,EAAGA,EAAIhB,EAAMzB,OAAQyC,IAAM,CACpC,IAAID,EAAOf,EAAMgB,GACjB,IAAIgG,EAAQ7I,KAAKqd,gBAAgBza,GAEjC5C,KAAKse,UAAUte,KAAKoZ,MAAO,SAAS0D,GAChC,IAAK,IAAIlc,EAAM,EAAGA,EAAMkc,EAAU1c,OAAQQ,IAAO,CAC7C,IAAIgY,EAAWkE,EAAUtc,GAAGI,GAC5B,GAAIgY,EAAS5c,KAAO6M,EAAM7M,GAAI,CAC1B0iB,EAAM3f,KAAK6Z,GACXkE,EAAU5d,OAAOuB,GAASG,IAAQH,EAAQA,EAAO,EAAGqc,EAAU5d,OAAO0B,EAAK,GAAG,IAC7EH,IACA,WAKlB,QACET,KAAK4I,QAAQgV,SAAWA,EAG5B,OAAOc,GAGX9a,OAAQ,SAASiF,GACb,IAAItG,EACAxC,EAAOC,KACP2e,EAAY5e,EAAKsc,mBAErB,GAAIsC,GAAa9V,EAAMpD,OAASoD,EAAMJ,QAAUI,EAAMJ,SAClD1I,EAAK0Z,WAAW1a,KAAK8J,GAGzB7I,KAAKse,UAAUve,EAAKqZ,MAAO,SAASvX,GAChCU,EAASoW,GAAY9W,EAAOgH,GAE5B,GAAItG,GAAUoc,EACV,OAAO,OAIf3e,KAAK4e,uBAAuB/V,GAE5B,OAAOA,GAGXuV,UAAW,WACP,OAAOpe,KAAKyZ,YAGhBoF,QAAS,WACL,IAAIje,EACAR,EACAmC,EAAS,GACT2B,EAAOlE,KAAK0c,UAAU1c,KAAKoZ,MAAOpZ,KAAK4I,QAAQ+T,WAEnD,IAAK/b,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAIsD,EAAKtD,GAAK6H,OAASvE,EAAKtD,GAAK6H,QAC7BlG,EAAOxD,KAAKmF,EAAKtD,IAGzB,OAAO2B,GAGXuc,QAAS,WACL,IAAIle,EACAR,EACAmC,EAAS,GACT2B,EAAOlE,KAAK0c,UAAU1c,KAAKoZ,MAAOpZ,KAAK4I,QAAQ+T,WAEnD,IAAK/b,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAKsD,EAAKtD,GAAK6H,QAAUvE,EAAKtD,GAAK6H,SAAYvE,EAAKtD,GAAKoH,MACrDzF,EAAOxD,KAAKmF,EAAKtD,IAGzB,OAAO2B,GAGX0Z,KAAM,WACF,IAAIlc,EAAOC,KACP6e,EAAU,GACVC,EAAU,GACVV,EAAYre,EAAK0Z,WAErB,IAAI1X,EAAUzF,EAAE4f,WAAWC,UAAUpa,UAErC,GAAIhC,EAAKic,SAAU,CAEf,IAAKjc,EAAKqb,OAAOvS,MACb,OAAO9G,EAGX8c,EAAU9e,EAAK8e,UACfC,EAAU/e,EAAK+e,UAEf,IAAIC,EAAW,GAEf,GAAIhf,EAAK6I,QAAQiT,OAAS9b,EAAKwa,UAAUvF,OACrC+J,EAAWhf,EAAKif,YAAYH,EAASC,EAASV,OAC3C,CACHW,EAAShgB,KAAKyD,MAAMuc,EAAUhf,EAAKkf,MAAM,SAAUJ,IACnDE,EAAShgB,KAAKyD,MAAMuc,EAAUhf,EAAKkf,MAAM,SAAUH,IACnDC,EAAShgB,KAAKyD,MAAMuc,EAAUhf,EAAKkf,MAAM,UAAWb,IAGxDrc,EAAUzF,EAAE4iB,KACV1c,MAAM,KAAMuc,GACZI,KAAK,WACH,IAAIve,EAAKR,EAET,IAAKQ,EAAM,EAAGR,EAASkC,UAAUlC,OAAQQ,EAAMR,EAAQQ,IACnD,GAAI0B,UAAU1B,GACVb,EAAKqf,QAAQ9c,UAAU1B,IAI/Bb,EAAKgd,WAAW,MAEhBhd,EAAKsf,WAELtf,EAAKuf,QAAQ,CAAExd,OAAQ,SAEvB/B,EAAK2B,QAAQ1D,GAEb,GAAI+B,EAAKuc,sBACLvc,EAAKuU,aAGV,CACHvU,EAAKgd,WAAW,MAEhBhd,EAAKsf,WAELtf,EAAKuf,QAAQ,CAAExd,OAAQ,SAG3B,OAAOC,GAGXsd,SAAUjiB,EAEVmiB,cAAe,SAAS1W,GACpB,IAAI9I,EAAOC,KAEX,GAAI6I,aAAiBrM,EAAM0H,KAAK7C,MAC5BtB,EAAKyf,aAAa3W,OACf,CACH9I,EAAK0Z,WAAa,GAClB1Z,EAAKub,2BACLvb,EAAKqZ,MAAQrZ,EAAKwb,SAASxb,EAAKsZ,eAChC,GAAItZ,EAAK6I,QAAQ8S,aACb3b,EAAKoa,OAASpa,EAAKyZ,eAGvBzZ,EAAKuZ,QAAU,GACfvZ,EAAKid,UAAUjd,EAAKqZ,MAAO,GAE3BrZ,EAAK0f,mBAEL1f,EAAKuf,UAELvf,EAAK2f,6BAEL,GAAI3f,EAAKsc,mBACLtc,EAAKuU,SAKjBmL,iBAAkBriB,EAElBsiB,2BAA4B,WACxB,IAAI3f,EAAOC,KAEX,GAAID,EAAK6I,QAAQmS,gBAAkB,KAC/Bhb,EAAKue,UAAUve,EAAKqZ,MAAO,SAASvX,GAChC,IAAK,IAAIjB,EAAM,EAAGA,EAAMiB,EAAMzB,OAAQQ,IAAO,CACzC,IAAIgC,EAAOf,EAAMrB,GAAGI,GACpB,GAAIgC,EAAK+c,WAAa,UAAY/c,EAAK+c,WAAa,SAChD/c,EAAKoF,MAAQ,SAOjC4X,WAAY,WACR,IAAIhf,EACAR,EACA8D,EAAOlE,KAAK0c,UAAU1c,KAAKoZ,MAAOpZ,KAAK4I,QAAQ+T,WAEnD,GAAI3c,KAAKyZ,WAAWrZ,OAChB,OAAO,KAGX,IAAKQ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9C,GAAKsD,EAAKtD,GAAK6H,OAASvE,EAAKtD,GAAK6H,SAAYvE,EAAKtD,GAAKoH,MACpD,OAAO,KAIf,OAAO,OAGXoX,QAAS,SAAS7c,GACd,IAAIxC,EAAOC,KACP6f,EAAStd,EAAOsd,OAChBC,EAAWvd,EAAOud,SAClBlf,EAAM,EACNmf,EAAchgB,EAAKsc,mBACnBwB,EAAW9d,EAAKsZ,cAChBvZ,EAAOyC,EAAOzC,KACdM,EAEJL,EAAK2B,QAAQrD,EAAY,CAAEyhB,SAAUA,EAAUhgB,KAAMA,IAErD,GAAIggB,IAAajjB,EAAcijB,GAAW,CACtCA,EAAW/f,EAAKqb,OAAO9S,MAAMwX,GAE7B,GAAI/f,EAAKigB,oBAAoBF,GACzB,OAGJA,EAAW/f,EAAKqb,OAAOlX,KAAK4b,GAE5B,IAAKhjB,EAAQgjB,GACTA,EAAW,CAACA,QAGhBA,EAAWxjB,EAAEY,IAAI2iB,EAAQ,SAAShX,GAAS,OAAOA,EAAMnI,WAG5D,GAAIZ,IAAS,UACTC,EAAK0Z,WAAa,GAGtB,IAAK7Y,EAAM,EAAGR,EAASyf,EAAOzf,OAAQQ,EAAMR,EAAQQ,IAChD,GAAId,IAAS,UAAW,CACpB+f,EAAOjf,GAAK4H,OAAOsX,EAASlf,IAE5B,GAAId,IAAS,SACT+d,EAAS9e,KAAKghB,EAAchgB,EAAKud,kBAAkBuC,EAAOjf,GAAKF,UAAYof,EAASlf,SACjF,GAAId,IAAS,SAChBC,EAAKie,wBAAwB6B,EAAOjf,GAAMkf,EAASlf,SAGvDb,EAAKwe,wBAAwBsB,EAAOjf,KAKhDod,wBAAyB,SAASnV,EAAOoX,GACrCjgB,KAAKkgB,2BAA2BrX,EAAO,SAASpI,EAAOoB,GACnDrF,EAAM2jB,WAAWte,EAAMpB,GAAQwf,MAIvCC,2BAA4B,SAASrX,EAAO1F,GACxCnD,KAAKogB,kBACD,SAASve,GACL,IAAIpB,EAAQoY,GAAqBhX,EAAOgH,GACxC,GAAIpI,GAAS,EAAG,CACZ0C,EAAS1C,EAAOoB,GAChB,OAAO,SAKvB0c,wBAAyB,SAAS1V,GAC9B7I,KAAKkgB,2BAA2BrX,EAAO,SAASpI,EAAOoB,GACnDA,EAAM3C,OAAOuB,EAAO,MAI5Bgc,UAAW,SAASvY,GAChB,IAAIoQ,GAAQtU,KAAKqc,mBAAqBrc,KAAKob,OAAOlX,KAAOlE,KAAKob,OAAOnI,OACrE,OAAOqB,EAAKnU,KAAKH,KAAKob,OAAQlX,IAGlCkc,kBAAmB,SAASjd,GACxB,IAAIpD,EAAOC,KACX,IAAI4I,EAAU7I,EAAK6I,QACnB,IAAI6U,EAAY1d,EAAK2d,uBAErB3d,EAAKue,UAAUve,EAAKsZ,cAAelW,GAEnC,GAAIyF,EAAQ8S,cAAgB9S,EAAQ+T,UAChCxf,EAAKsgB,EAAW,SAAS5a,EAAG0O,GACxBxR,EAAKue,UAAU/M,EAAMwM,aAAc5a,MAKhDmb,UAAW,SAASpa,EAAMf,GACrB,GAAIe,GAAQA,EAAK9D,OACb,GAAIJ,KAAKqc,mBACLnE,GAAehU,EAAMf,QAErBA,EAASe,IAKrBmc,kBAAmB,SAASxX,GACxB,IAAIgV,EACAjd,EACAuC,EAAW,SAAStB,GAChBjB,EAAMiY,GAAqBhX,EAAOgH,GAClC,GAAIjI,GAAO,EAAG,CACVid,EAAWhc,EAAMjB,GACjB,OAAO,OAInBZ,KAAKogB,kBAAkBjd,GAEvB,OAAO0a,GAGX2B,aAAc,SAAS3W,GACnB,IAAI9I,EAAOC,KACX,IAAI6d,EAAW7d,KAAKqgB,kBAAkBxX,GAEtC7I,KAAKse,UAAUte,KAAKoZ,MAAO,SAASvX,GAChC,IAAIjB,EAAMkY,GAAajX,EAAOgH,GAC9B,GAAIjI,GAAO,EACP,GAAIid,KAAchV,EAAMJ,SAAWoV,EAAS8B,WAAY,CACpD9d,EAAMjB,GAAK4H,OAAOqV,GAElB,GAAIA,EAAS8B,WAAa,SACtB9d,EAAMjB,GAAKoH,MAAQ,SAGpB,CACHjI,EAAKugB,eAAezX,GAEpBhH,EAAM3C,OAAO0B,EAAK,GAElBb,EAAK6e,uBAAuB/V,OAM5CyX,eAAgBljB,EAEhBmjB,QAAS,SAASxB,EAAU7a,GACxB,IAAInE,EAAOC,KAEXD,EAAK2B,QAAQvD,EAAc,CAAE2B,KAAM,WAEnCC,EAAK2B,QAAQtD,GAEb2B,EAAKwa,UAAUvF,OAAOrY,EAAO,CACzB4X,QAAS,SAASuL,EAAUhgB,GACxB,IAAIiC,EAAUzF,EAAEU,KAAK+hB,EAAU,SAASlY,GACpC,OAAOA,EAAE/G,MAAQA,IAClB,GAEH,GAAIiC,EACAA,EAAQoa,QAAQ,CACZ2D,SAAUA,EACVD,OAAQ9d,EAAQ8d,OAChB/f,KAAMA,KAIlBqV,MAAO,SAAS2K,EAAUU,EAAQrL,GAC9B,IAAK,IAAIvU,EAAM,EAAGA,EAAMme,EAAS3e,OAAQQ,IACrCme,EAASne,GAAK6f,OAAOX,GAGzB/f,EAAKoV,MAAM2K,EAAUU,EAAQrL,KAElCjR,KAGP8a,YAAa,SAASH,EAASC,EAASV,GACpC,IAAIre,EAAOC,KACP+e,EAAW,GAEf,GAAIhf,EAAK6I,QAAQiT,MAAO,CACpB,GAAIgD,EAAQze,OACR2e,EAAShgB,KAAKzC,EAAE4f,SAAS,SAASwE,GAC9BA,EAAS5gB,KAAO,SAChB4gB,EAASb,OAAShB,KAI1B,GAAIC,EAAQ1e,OACR2e,EAAShgB,KAAKzC,EAAE4f,SAAS,SAASwE,GAC9BA,EAAS5gB,KAAO,SAChB4gB,EAASb,OAASf,KAI1B,GAAIV,EAAUhe,OACV2e,EAAShgB,KAAKzC,EAAE4f,SAAS,SAASwE,GAC9BA,EAAS5gB,KAAO,UAChB4gB,EAASb,OAASzB,KAI1Bre,EAAKwgB,QAAQxB,EAAU,CACnB7a,KAAM,CACF2a,QAAS9e,EAAKqb,OAAOtE,UAAUpW,GAAOme,IACtCC,QAAS/e,EAAKqb,OAAOtE,UAAUpW,GAAOoe,IACtCV,UAAWre,EAAKqb,OAAOtE,UAAUpW,GAAO0d,OAKpD,OAAOW,GAGX4B,SAAU,SAASzc,EAAM2b,EAAQ/f,GAC7B,IAAIC,EAAOC,KAEX,OAAO1D,EAAE4f,SAAS,SAASwE,GACvB3gB,EAAK2B,QAAQvD,EAAc,CAAE2B,KAAMA,IAEnCC,EAAK2B,QAAQtD,GAEb2B,EAAKwa,UAAUza,GAAMK,KAAKJ,EAAKwa,UAAW5d,EAAO,CAC7C4X,QAAS,SAASuL,GACdY,EAASvE,QAAQ,CACb2D,SAAUA,EACVD,OAAQA,EACR/f,KAAMA,KAGdqV,MAAO,SAAS2K,EAAUU,EAAQrL,GAC9BuL,EAASD,OAAOX,GAChB/f,EAAKoV,MAAM2K,EAAUU,EAAQrL,KAElCjR,MACJnC,WAGPkd,MAAO,SAAS2B,EAAQ1c,GACpB,IAAInE,EAAOC,KACPY,EACAR,EACA2e,EAAW,GACX8B,EAAY9gB,EAAKqb,OAAOtE,UAAUpW,GAAOwD,IAE7C,GAAInE,EAAK6I,QAAQiT,OACb,GAAI3X,EAAK9D,OACL2e,EAAShgB,KAAKgB,EAAK4gB,SAAU,CAAEzc,KAAM,CAAE2b,OAAQgB,IAAe3c,EAAO0c,SAGzE,IAAKhgB,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAC9Cme,EAAShgB,KAAKgB,EAAK4gB,SAAU,CAAEzc,KAAM2c,EAAUjgB,IAAQ,CAAEsD,EAAKtD,IAAQggB,IAI9E,OAAO7B,GAGXzK,KAAM,SAASpQ,GACX,IAAInE,EAAOC,KAAM8gB,EAAS/gB,EAAKghB,QAAQ7c,GACvC,IAAIwc,EAAWpkB,EAAE4f,WAEjBnc,EAAKihB,cAAcF,EAAQ,WACvB,IAAIG,EAAclhB,EAAK2B,QAAQvD,EAAc,CAAE2B,KAAM,SACrD,IAAKmhB,EAAa,CACdlhB,EAAK2B,QAAQtD,GAEb2B,EAAKuZ,QAAU,GACfvZ,EAAK2B,QAAQ,SACb,GAAI3B,EAAKic,SACLjc,EAAKwa,UAAUjG,KAAK,CAChBpQ,KAAM4c,EACNvM,QAAS,SAASrQ,GACdnE,EAAKuZ,QAAU,GACfvZ,EAAKwU,QAAQrQ,EAAM4c,GAEnBJ,EAASvE,WAEbhH,MAAO,WACH,IAAI+L,EAAO9hB,EAAMe,KAAKmC,WAEtBvC,EAAKoV,MAAM3S,MAAMzC,EAAMmhB,GAEvBR,EAASD,OAAOje,MAAMke,EAAUQ,WAGrC,GAAInhB,EAAK6I,QAAQmS,gBAAkB,KAAK,CAC3Chb,EAAKwU,QAAQxU,EAAKqc,cAAe0E,GAEjCJ,EAASvE,eAEV,CACHpc,EAAKohB,kBAELT,EAASvE,QAAQ8E,MAIzB,OAAOP,EAAS3e,WAGpBqf,gBAAiB,SAASld,GACtB,OAAOlE,KAAKob,OAAO3K,WAAWvM,IAGlCqQ,QAAS,SAASrQ,GACd,IAAInE,EAAOC,KACP4I,EAAU7I,EAAK6I,QACf/G,EACAwf,EAEJthB,EAAK2B,QAAQrD,EAAY,CAAEyhB,SAAU5b,EAAMpE,KAAM,SAEjD,GAAIC,EAAKic,SAAU,CACf9X,EAAOnE,EAAKqb,OAAO9S,MAAMpE,GAEzB,GAAInE,EAAKigB,oBAAoB9b,GAAO,CAChCnE,EAAKohB,kBACL,OAGJphB,EAAKoa,OAASpa,EAAKqb,OAAOpH,MAAM9P,GAEhC,GAAInE,EAAKuc,sBACLvc,EAAKuhB,mBAAqBvhB,EAAKoa,OAGnC,GAAIpa,EAAK2Z,UAAY3Z,EAAKoa,OAAQ,CAC9Bpa,EAAK2Z,UAAY3Z,EAAKoa,OACtB,GAAIpa,EAAK6I,QAAQ+Q,UAAY5Z,EAAK6I,QAAQ+Q,SAAW5Z,EAAK2Z,UACtD3Z,EAAK2Z,UAAY3Z,EAAK6I,QAAQ+Q,SAItC,GAAI5Z,EAAKma,YAActR,EAAQgT,iBAC3B7b,EAAKwhB,iBAAmBxhB,EAAKqhB,gBAAgBld,GAGjDA,EAAOnE,EAAK0c,UAAUvY,GAEtBnE,EAAK0Z,WAAa,OACf,CACHvV,EAAOnE,EAAK0c,UAAUvY,GAEtBrC,EAAQ,GACR,IAAI2f,EAAU,GACd,IAAI3Y,EAAQ9I,EAAKqb,OAAOvS,MACxB,IAAIX,EAAUW,EAAQA,EAAMX,QAAU,KACtC,IAAItH,EAEJ,IAAKA,EAAM,EAAGA,EAAMZ,KAAKyZ,WAAWrZ,OAAQQ,IAAO,CAC/C,IAAI5E,EAAKgE,KAAKyZ,WAAW7Y,GAAKsH,GAC9BsZ,EAAQxlB,GAAMA,EAGlB,IAAK4E,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IAAO,CACpC,IAAIgC,EAAOsB,EAAKtD,GAChB,IAAIoQ,EAAQpO,EAAK+c,UACjB,GAAI3O,GAAS,WACT,IAAKwQ,EAAQ5e,EAAKsF,IACdlI,KAAKyZ,WAAW1a,KAAKiB,KAAKqd,gBAAgBza,SAG9Cf,EAAM9C,KAAK6D,GAInBsB,EAAOrC,EAEP9B,EAAKoa,OAASjW,EAAK9D,OAGvBL,EAAKyZ,eAAiBzZ,EAAKoa,OAC3BkH,EAAgBthB,EAAK0hB,OAAS1hB,EAAKqZ,MAAMhZ,QAAUL,EAAK0hB,MAAQ1hB,EAAKqZ,MAAMhZ,OAE3E,GAAIL,EAAK6I,QAAQ8Y,QAAS,CACtB,GAAIL,EACAthB,EAAKsZ,cAAcna,OAAOa,EAAK0hB,MAAO1hB,EAAKsZ,cAAcjZ,QAE7DyB,EAAQqC,EAAK9E,MAAM,GACnB,IAAK,IAAIuiB,EAAI,EAAGA,EAAI9f,EAAMzB,OAAQuhB,IAC9B5hB,EAAKsZ,cAActa,KAAK8C,EAAM8f,SAGlC5hB,EAAKsZ,cAAgBnV,EAAK9E,MAAM,GAGpCW,EAAKub,2BAEL,GAAIvb,EAAK6I,QAAQ8Y,QAAS,CACtB3hB,EAAKqZ,MAAMnW,OAAOlF,EAAQgC,EAAK6hB,gBAE/B,GAAI7hB,EAAKsc,oBAAsBtc,EAAKqZ,MAAMrZ,EAAKqZ,MAAMhZ,OAAS,GAAGS,QAAUqD,EAAK,GAAGrD,MAAO,CACtFuW,GAAcrX,EAAKqZ,MAAMrZ,EAAKqZ,MAAMhZ,OAAS,GAAI8D,EAAK,IACtDA,EAAK/E,QAGT+E,EAAOnE,EAAKwb,SAASrX,GACrB,GAAImd,EACAthB,EAAKqZ,MAAMla,OAAOa,EAAK0hB,MAAO1hB,EAAKqZ,MAAMhZ,QAE7C,IAAK,IAAIyC,EAAI,EAAGA,EAAIqB,EAAK9D,OAAQyC,IAC7B9C,EAAKqZ,MAAMra,KAAKmF,EAAKrB,IAEzB9C,EAAKqZ,MAAM9X,KAAKvD,EAAQgC,EAAK6hB,qBAE7B7hB,EAAKqZ,MAAQrZ,EAAKwb,SAASrX,GAG/BnE,EAAK2f,6BAEL3f,EAAKgd,aAELhd,EAAKid,UAAUjd,EAAKqZ,OAEpBrZ,EAAKkd,SAASld,EAAKqZ,OAEnBrZ,EAAKohB,mBAGT7F,yBAA0B,WACtB,GAAItb,KAAKoZ,OAASpZ,KAAKsa,+BACnB,IAAK,IAAI1Z,EAAM,EAAGA,EAAMZ,KAAKoZ,MAAMhZ,OAAQQ,IACvC,GAAIZ,KAAKoZ,MAAMxY,GAAKG,OAChBf,KAAKoZ,MAAMxY,GAAKG,OAAS3D,GAMzC2f,WAAY,SAAS8E,GACjB,IAAIpJ,EAAiBzY,KAAKqc,mBAC1B,IAAIxT,EAAQ7I,KAAKob,OAAOvS,MAExB,SAAShH,EAAMqC,GACX,IAAI8M,EAAQ,GAEZ,IAAK,IAAIpQ,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IAAO,CACxC,IAAIgY,EAAW1U,EAAK1D,GAAGI,GACvB,IAAIgC,EAAOgW,EAASlY,SAEpB,GAAI+X,GAAkBG,EAAS/W,MAC3Be,EAAKf,MAAQA,EAAM+W,EAAS/W,WACzB,CACHe,EAAK6C,IAAMmT,EAASnT,IAEpB,GAAIoD,EACA,GAAI+P,EAASnQ,QACT7F,EAAK+c,UAAY,cACd,GAAI/G,EAAS5Q,MAChBpF,EAAK+c,UAAY,SAI7B3O,EAAMjS,KAAK6D,GAGf,OAAOoO,EAGX,GAAIhR,KAAK4I,QAAQmS,gBAAkB,KAAM,CACrC,IAAI/J,EAAQnP,EAAM7B,KAAKoZ,OAEvB,IAAIgF,EAAY,GAEhB,IAAK,IAAIxd,EAAM,EAAGA,EAAMZ,KAAKyZ,WAAWrZ,OAAQQ,IAAO,CACnD,IAAIgC,EAAO5C,KAAKyZ,WAAW7Y,GAAKF,SAChCkC,EAAK+c,UAAY,UACjBvB,EAAUrf,KAAK6D,GAGnB5C,KAAKoc,YAAYpL,EAAMjO,OAAOqb,IAE9B,GAAIyD,EACA7hB,KAAKqZ,cAAgBrZ,KAAKob,OAAOA,OAASpb,KAAKob,OAAOA,OAAOlE,oBAAoBlG,GAAShR,KAAKob,OAAOlE,oBAAoBlG,KAKtIgM,UAAW,SAAU9Y,EAAMuN,GACvB,IAAI1R,EAAOC,KACP8hB,SAAe,IAAW,YAAcrQ,EAAQ1R,EAAK0hB,OAAS,EAC9DM,EACAxQ,EAAQ,CACJrN,KAAMA,EACN6Z,aAAc7Z,EAAKxD,SACnBshB,UAAWjiB,EAAKkiB,cAGxB,GAAIjiB,KAAKuc,gBAAiB,CACtBwF,EAAMD,EAAQ5d,EAAK9D,OACnBmR,EAAM2Q,WAAaJ,EACnBvQ,EAAM4Q,SAAWJ,OAEjBA,EAAMD,EAAQ/hB,EAAK2c,UAAUxY,EAAM,MAAM9D,OAG7CmR,EAAMuQ,MAAQA,EACdvQ,EAAMwQ,IAAMA,EACZhiB,EAAKuZ,QAAQva,KAAKwS,GAClBxR,EAAKqiB,cAEL,GAAIriB,EAAKwc,gBAAiB,CACtB,IAAKxc,EAAKsiB,YACNtiB,EAAKsiB,YAAc,GAEvBtiB,EAAKuiB,oBAAoB/Q,EAAMrN,MAC/BnE,EAAKwiB,6BAIbD,oBAAqB,SAAUpe,GAC3B,IAAI9D,EAAS8D,EAAK9D,OAElB,IAAK,IAAIyC,EAAI,EAAGA,EAAIzC,EAAQyC,IACxB7C,KAAKqiB,YAAYtjB,KAAKmF,EAAKrB,KAInC2f,eAAgB,SAAS/c,GACrB,IAAIrF,EAASJ,KAAKqiB,YAAYjiB,OAC9B,IAAIgS,EAEJ,IAAK,IAAIvP,EAAI,EAAGA,EAAIzC,EAAQyC,IAAK,CAC7BuP,EAAQpS,KAAKqiB,YAAYxf,GACzB,GAAIuP,EAAM3M,MAAQA,EACd,OAAO2M,IAKnBgQ,YAAa,WACTpiB,KAAKsZ,QAAQ5W,KAAK,SAASmE,EAAGC,GAC1B,OAAOD,EAAEib,MAAQhb,EAAEgb,SAI3B3M,MAAO,SAASsN,EAAKjC,EAAQkC,GACzB1iB,KAAKmhB,kBACLnhB,KAAK0B,QAAQrD,EAAY,IACzB2B,KAAK0B,QAAQxD,EAAO,CAAEukB,IAAKA,EAAKjC,OAAQA,EAAQkC,YAAaA,KAGjE3B,QAAS,SAAS7c,GACd,IAAInE,EAAOC,KACP4I,EAAWjM,EAAO,CACd+U,KAAM3R,EAAK2R,OACXD,KAAM1R,EAAK0R,OACXoI,KAAM9Z,EAAK8Z,OACXF,SAAU5Z,EAAK4Z,WACfjX,KAAM3C,EAAK+Z,MACXtW,OAAQzD,EAAKia,QACb5H,MAAOrS,EAAKka,OACZ9I,UAAWpR,EAAKma,WAChB5H,cAAevS,EAAKqa,cACrBlW,GAEP,IAAKnE,EAAK6I,QAAQ8S,aAAc,QACrB9S,EAAQ8I,YACR9I,EAAQ6I,YACR7I,EAAQiR,YACRjR,EAAQ+Q,SAGnB,IAAK5Z,EAAK6I,QAAQ6P,sBACP7P,EAAQwJ,WACZ,GAAIrS,EAAKqb,OAAOvS,OAASD,EAAQwJ,MACpCxJ,EAAQwJ,MAAQ6G,GAAwBrQ,EAAQwJ,MAAOrS,EAAKqb,OAAOvS,OAGvE,IAAK9I,EAAK6I,QAAQ+S,uBACP/S,EAAQpF,YACZ,GAAIzD,EAAKqb,OAAOvS,OAASD,EAAQpF,OACrCoF,EAAQpF,OAASwV,GAA8BpQ,EAAQpF,OAAQzD,EAAKqb,OAAOvS,OAG9E,IAAK9I,EAAK6I,QAAQ6S,qBACP7S,EAAQlG,UACZ,GAAI3C,EAAKqb,OAAOvS,OAASD,EAAQlG,KACpCkG,EAAQlG,KAAOuW,GAAwBrQ,EAAQlG,KAAM3C,EAAKqb,OAAOvS,OAGrE,IAAK9I,EAAK6I,QAAQgT,wBACPhT,EAAQuI,eACZ,GAAIpR,EAAKqb,OAAOvS,OAASD,EAAQuI,UACpCvI,EAAQuI,UAAY8H,GAAwBrQ,EAAQuI,UAAWpR,EAAKqb,OAAOvS,OAG/E,IAAK9I,EAAK6I,QAAQ0J,mBACP1J,EAAQ0J,YAGnB,OAAO1J,GAGXoY,cAAe,SAASpY,EAASzF,GAC7B,IAAIpD,EAAOC,KACX,IAAKD,EAAK4iB,mBAAoB,CAC1B5iB,EAAK4iB,mBAAqB,KAC1B5iB,EAAK6iB,SAAWlmB,EAChByG,SAEApD,EAAK6iB,SAAW,CAAEzf,SAAUA,EAAS7B,KAAKvB,GAAO6I,QAASA,IAIlEuY,gBAAiB,WACb,IAAIphB,EAAOC,KACXD,EAAK4iB,mBAAqB,MAC1B,GAAI5iB,EAAK6iB,SACL7iB,EAAKihB,cAAcjhB,EAAK6iB,SAASha,QAAS7I,EAAK6iB,SAASzf,WAIhE6c,oBAAqB,SAASF,GAC1B,GAAI9f,KAAKob,OAAOjE,OAAQ,CACpB,IAAIA,EAASnX,KAAKob,OAAOjE,OAAO2I,GAChC,GAAI3I,EAAQ,CACRnX,KAAK0B,QAAQxD,EAAO,CAAEukB,IAAK,KAAMjC,OAAQ,cAAekC,YAAa,eAAgBvL,OAAQA,IAC7F,OAAO,MAGf,OAAO,OAGX0L,YAAa,SAAS3e,GAClB,IAAI2E,EAAQ7I,KAAKob,OAAOvS,MAExB,GAAIA,GAAS3E,EAAK9D,OACd,QAAS8D,EAAK,aAAc2E,GAGhC,OAAO,OAGX0S,SAAU,SAASrX,GACf,IAAInE,EAAOC,KACP6I,EAAQ9I,EAAKqb,OAAOvS,MAExB9I,EAAKua,+BAAiC,KAEtC,GAAIpW,aAAgBvE,EAAiB,CACjCI,EAAKua,+BAAiC,MACtC,GAAIva,EAAK8iB,YAAY3e,GAAO,CACxBA,EAAKpE,KAAOC,EAAKqb,OAAOvS,MACxB3E,EAAK7D,QAAQ6D,EAAMA,QAEpB,CACH,IAAI4e,EAAY/iB,EAAK4Z,aAAe5Z,EAAK6I,QAAQ8S,aAAezX,EAAsBtE,EACtFuE,EAAO,IAAI4e,EAAU5e,EAAMnE,EAAKqb,OAAOvS,OACvC3E,EAAKnD,OAAS,WAAa,OAAOhB,EAAKgB,UAG3C,GAAIhB,EAAKsc,mBACLpE,GAAe/T,EAAM2E,GAGzB,GAAI9I,EAAK6hB,gBAAkB7hB,EAAKqZ,OAASrZ,EAAKqZ,iBAAiBzZ,KACzDI,EAAK6I,QAAQ+T,WAAa5c,EAAK6I,QAAQ8S,cACzC3b,EAAKqZ,MAAMnW,OAAOlF,EAAQgC,EAAK6hB,qBAE/B7hB,EAAK6hB,eAAiB7hB,EAAKuf,QAAQhe,KAAKvB,GAG5C,OAAOmE,EAAK5C,KAAKvD,EAAQgC,EAAK6hB,iBAGlCmB,sBAAuB,SAASjhB,EAAQD,GACpC,IAAI9B,EAAOC,KAEX,IAAIgU,EAAQgP,SAASjjB,EAAKoa,OAAQ,IAElC,IAAKhH,GAASpT,EAAKoa,QACfnG,EAAQgP,SAASjjB,EAAKyZ,eAAgB,IAE1C,GAAI1X,IAAW,MACXkS,GAASnS,EAAMzB,YACZ,GAAI0B,IAAW,SAClBkS,GAASnS,EAAMzB,YACZ,GAAI0B,IAAW,cAAgBA,IAAW,SAAW/B,EAAK6I,QAAQ8S,aACrE1H,EAAQjU,EAAKyZ,oBACV,GAAI1X,IAAW,OAClBkS,EAAQjU,EAAKyZ,eAAiBwJ,SAASjjB,EAAKoa,OAAQ,IAGxDpa,EAAKoa,OAASnG,GAGlBsL,QAAS,SAAS/d,GACd,IAAIxB,EAAOC,KAAMY,EAAKR,EAAQ0B,EAASP,EAAIA,EAAEO,OAAS,GAEtD,GAAIA,IAAW,SACX,IAAKlB,EAAM,EAAGR,EAASmB,EAAEM,MAAMzB,OAAQQ,EAAMR,EAAQQ,IACjD,IAAKW,EAAEM,MAAMjB,GAAK6H,QAAUlH,EAAEM,MAAMjB,GAAK6H,QACrC1I,EAAK0Z,WAAW1a,KAAKwC,EAAEM,MAAMjB,IAKzC,GAAIb,EAAK6I,QAAQgV,WAAa9b,IAAW,OAASA,IAAW,UAAYA,IAAW,cAAe,CAE/F,IAAImhB,EAAU,SAAS/B,GACnB,GAAIA,EAAKpf,SAAW,OAAQ,CACxB/B,EAAKkD,OAAO,SAAUggB,GACtBljB,EAAKgjB,sBAAsBjhB,EAAQP,EAAEM,SAI7C9B,EAAKmjB,MAAM,SAAUD,GAErBljB,EAAKkc,WAEF,CACHlc,EAAKgjB,sBAAsBjhB,EAAQP,EAAIA,EAAEM,MAAQ,IAEjD9B,EAAKkd,SAASld,EAAKqZ,MAAO7X,KAIlC4hB,qBAAsB,SAAUjf,EAAM0E,GAClCA,EAAUA,GAAW,GAErB,IAAIgL,EAAQ,IAAIlH,EAAMxI,GAClBuM,EAAa7H,EAAQuI,UACrB3N,EAASoF,EAAQpF,OAErB,GAAIA,EACAoQ,EAAQA,EAAMpQ,OAAOA,GAGzB,OAAOoQ,EAAMzC,UAAUV,IAG3BwM,SAAU,SAAU/Y,EAAM3C,GACtB,IAAIxB,EAAOC,KACP4I,EAAU,GACVrG,EAEJ,GAAIxC,EAAK6I,QAAQ8S,eAAiB,KAAM,CACpC9S,EAAQ6I,KAAO1R,EAAK0hB,MACpB7Y,EAAQ8I,KAAO3R,EAAKqjB,OAASrjB,EAAK2Z,UAElC,GAAG9Q,EAAQ6I,OAAS/U,GAAaqD,EAAK6Z,QAAUld,GAAaqD,EAAK2Z,YAAchd,EAC5EkM,EAAQ6I,MAAQ1R,EAAK6Z,MAAQ,GAAK7Z,EAAK2Z,UAG3C,GAAI3Z,EAAK6I,QAAQ+T,UACb/T,EAAQ6I,KAAO1R,EAAKsjB,oBAI5B,GAAItjB,EAAK6I,QAAQ6S,gBAAkB,KAC/B7S,EAAQlG,KAAO3C,EAAK+Z,MAGxB,GAAI/Z,EAAK6I,QAAQ+S,kBAAoB,KACjC/S,EAAQpF,OAASzD,EAAKia,QAG1B,GAAIja,EAAK6I,QAAQ6P,iBAAmB,KAChC7P,EAAQwJ,MAAQrS,EAAKka,OAGzB,GAAIla,EAAK6I,QAAQgT,mBAAqB,KAClChT,EAAQuI,UAAYpR,EAAKma,WAG7B,GAAIna,EAAK6I,QAAQ6P,eACb1Y,EAAKujB,kBAAkBpf,GAG3B0E,EAAQ0J,YAAcvS,EAAKqa,aAE3B,GAAIra,EAAKwc,iBAAmBhb,IAAMA,EAAEO,SAAW,QAAUP,EAAEO,SAAW,eAAiBP,EAAEO,SAAW,iBAChGS,EAASxC,EAAKwjB,cAAcrf,EAAM,CAC9BiN,UAAWpR,EAAKma,kBAGpB3X,EAASxC,EAAKwjB,cAAcrf,EAAM0E,GAGtC,GAAI7I,EAAK6I,QAAQgT,mBAAqB,KAGlC7b,EAAKwhB,iBAAmBxhB,EAAKojB,qBAAqB5gB,EAAOihB,iBAAmBtf,EAAM0E,GAGtF7I,EAAK0jB,SAASlhB,EAAQqG,EAASrH,GAE/BxB,EAAK2jB,gBAAgBnhB,EAAOyR,MAAO,OAEnCzS,EAAIA,GAAK,GAETA,EAAEM,MAAQN,EAAEM,OAAS9B,EAAKwZ,MAE1BxZ,EAAK2B,QAAQ3D,EAAQwD,IAGzBkiB,SAAU,SAAUlhB,EAAQqG,EAASrH,GACjC,IAAIxB,EAAOC,KAEX,GAAID,EAAKwc,kBAAoBxc,EAAKsc,mBAC9B,GAAI9a,IAAMA,EAAEO,SAAW,QAAUP,EAAEO,SAAW,eAAiBP,EAAEO,SAAW,iBAAkB,CAC1F/B,EAAKyY,KAAKjW,EAAO2B,MACjBnE,EAAKwiB,+BACF,CACHxiB,EAAKuZ,QAAU,GACf,IAAI1F,EAAQ,IAAIlH,EAAMnK,EAAO2B,MAC7BnE,EAAKid,UAAUjd,EAAKwb,SAAShZ,EAAO2B,OAEpC,GAAI0E,EAAQ6I,KAAO7I,EAAQ8I,KAAOnP,EAAO2B,KAAK9D,OAC1CwI,EAAQ6I,KAAOlP,EAAO2B,KAAK9D,OAASwI,EAAQ8I,KAGhD3R,EAAKyY,KAAK5E,EAAMrC,MAAM3I,EAAQ6I,KAAM7I,EAAQ8I,MAAMJ,gBAItDvR,EAAKyY,KAAKjW,EAAO2B,OAIzBof,kBAAmB,SAASpf,GACxB,IAAK,IAAItD,EAAMsD,EAAK9D,OAAS,EAAGQ,GAAM,EAAGA,IAAO,CAC5C,IAAIwR,EAAQlO,EAAKtD,GACjB,GAAIwR,EAAMI,aACNxS,KAAKsjB,kBAAkBlR,EAAMvQ,OAGjC,GAAIuQ,EAAMvQ,QAAUuQ,EAAMvQ,MAAMzB,SAAWgS,EAAMK,UAC7CvT,EAAOsD,MAAM4P,EAAMrR,SAAU,CAACH,EAAK,MAK/C2iB,cAAe,SAASrf,EAAM0E,GAC1B,GAAI5I,KAAK4I,QAAQkT,YACb,OAAOpP,EAAMgH,QAAQxP,EAAM0E,EAAS5I,KAAK4I,QAAQkT,kBAGjD,OAAOpP,EAAMgH,QAAQxP,EAAM0E,IAInC+a,YAAa,SAAS/a,GAClB,IAAI7I,EAAOC,KAEX,GAAI4I,IAAYlM,EAAW,CACvBqD,EAAK2Z,UAAY9Q,EAAQ+Q,SACzB5Z,EAAK6Z,MAAQhR,EAAQiR,KACrB9Z,EAAK+Z,MAAQlR,EAAQlG,KACrB3C,EAAKia,QAAUpR,EAAQpF,OACvBzD,EAAKka,OAASrR,EAAQwJ,MACtBrS,EAAKma,WAAatR,EAAQuI,UAC1BpR,EAAK0hB,MAAQ1hB,EAAK6jB,mBAAqBhb,EAAQ6I,KAC/C1R,EAAKqjB,MAAQxa,EAAQ8I,KAErB,GAAG3R,EAAK0hB,QAAU/kB,EAAW,CACzBqD,EAAK0hB,MAAQ1hB,EAAK6jB,mBAAqB7jB,EAAK0R,OAC5C7I,EAAQ6I,KAAO1R,EAAK0R,OAGxB,GAAG1R,EAAKqjB,QAAU1mB,GAAaqD,EAAK2Z,YAAchd,EAAW,CACzDqD,EAAKqjB,MAAQrjB,EAAK2Z,UAClB9Q,EAAQ8I,KAAO3R,EAAKqjB,MAGxB,GAAGrjB,EAAK6I,QAAQwL,QACZxL,EAAQwL,QAAUrU,EAAK6I,QAAQwL,QAGnC,GAAIxL,EAAQlG,KAAM,CACd3C,EAAK+Z,MAAQlR,EAAQlG,KAAOiK,GAAc/D,EAAQlG,MAClD3C,EAAKga,YAAchN,GAAWnE,EAAQlG,MAG1C,GAAIkG,EAAQpF,OACRzD,EAAKia,QAAUpR,EAAQpF,OAAUzD,EAAK6I,QAAQ8B,yBAA2BpO,EAAEO,cAAc+L,EAAQpF,QAAWlH,EAAEK,OAAO,GAAIgT,GAAgB/G,EAAQpF,QAAS,CAAEkH,uBAAwB3K,EAAK6I,QAAQ8B,yBAA2BiF,GAAgB/G,EAAQpF,QAGxP,GAAIoF,EAAQwJ,MACRrS,EAAKka,OAASrR,EAAQwJ,MAAQ7B,GAAe3H,EAAQwJ,OAEzD,GAAIxJ,EAAQuI,UACRpR,EAAKma,WAAatR,EAAQuI,UAAYb,GAAmB1H,EAAQuI,WAGzE,OAAOvI,GAGXgL,MAAO,SAAShL,GACZ,IAAIrG,EACJ,IAAIshB,EAAS7jB,KAAK4I,QAAQ6S,eAAiBzb,KAAK4I,QAAQ8S,cAAgB1b,KAAK4I,QAAQ+S,iBAAmB3b,KAAK4I,QAAQ6P,gBAAkBzY,KAAK4I,QAAQgT,iBAEpJ,GAAIiI,IAAY7jB,KAAKoZ,QAAU1c,GAAasD,KAAKoZ,MAAMhZ,SAAW,KAAOJ,KAAKyZ,WAAWrZ,OAAS,CAC9F,GAAIJ,KAAK4I,QAAQ8Y,QAAS,CACtB,IAAIoC,EAAiBlb,EAAQ+Q,SAAW3Z,KAAK2Z,WAC7C,GAAImK,EAAiB,EAAG,CACpBA,EAAiB9jB,KAAK2Z,WACtB/Q,EAAQiR,KAAOjR,EAAQ+Q,SAAWmK,EAClClb,EAAQ+Q,SAAWmK,MAChB,CACHlb,EAAQiR,KAAO,EACf7Z,KAAK4I,QAAQ8Y,QAAU,OAG/B,OAAO1hB,KAAKsU,KAAKtU,KAAK2jB,YAAY/a,IAGtC,IAAIqY,EAAcjhB,KAAK0B,QAAQvD,EAAc,CAAE2B,KAAM,SACrD,IAAKmhB,EAAa,CACdjhB,KAAK0B,QAAQtD,GACb,GAAIwK,EACAA,EAAQ0J,YAActS,KAAKoa,aAE/B7X,EAASvC,KAAKujB,cAAcvjB,KAAKoZ,MAAOpZ,KAAK2jB,YAAY/a,IAEzD5I,KAAK0jB,gBAAgBnhB,EAAOyR,MAAO,MAEnChU,KAAKuhB,iBAAmBvhB,KAAKmjB,qBAAqB5gB,EAAOihB,iBAAmBxjB,KAAKoZ,MAAOxQ,GACxF5I,KAAKyjB,SAASlhB,EAAQqG,GACtB5I,KAAK0B,QAAQrD,EAAY,CAAEyB,KAAM,SACjCE,KAAK0B,QAAQ3D,EAAQ,CAAE8D,MAAOU,EAAO2B,KAAMpC,OAAQ8G,EAAUA,EAAQ9G,OAAS,KAGlF,OAAOxF,EAAE4f,WAAWC,QAAQ8E,GAAalf,WAG7CgiB,sBAAuB,SAAU3R,GAC7B,IAAI7P,EAAS,MACb,IAAInC,EAASgS,EAAMvQ,MAAQuQ,EAAMvQ,MAAMzB,OAAS,EAEhD,IAAKgS,EAAMI,aACP,OAAO,MAGX,IAAK,IAAI3P,EAAI,EAAGA,EAAIzC,EAAQyC,IACxB,GAAI7C,KAAKqa,aAAajI,EAAMvQ,MAAMgB,GAAG4C,KAAM,CACvClD,EAAS,KACT,MAGR,OAAOA,GAGXyhB,kBAAmB,SAAU9f,EAAM3B,EAAQqG,EAASqb,EAAS9gB,GACzD,IAAIpD,EAAOC,KACX,IAAII,EAAS8D,EAAK9D,OAClB,IAAIgS,EACJ,IAAI7L,EACJ,IAAI2d,EACJ,IAAIC,EACJ,IAAIC,EAEJ,IAAK,IAAIvhB,EAAI,EAAGA,EAAIzC,EAAQyC,IAAK,CAC7BuP,EAAQlO,EAAKrB,GAEb,GAAI+F,EAAQyb,OAASzb,EAAQ8I,KACzB,MAGJ,IAAK3R,EAAKyiB,eAAepQ,EAAM3M,KAC3B1F,EAAKsiB,YAAYtjB,KAAKqT,GAG1B,GAAIrS,EAAKsa,aAAajI,EAAM3M,KAAM,CAC9B,GAAI1F,EAAKuc,sBAAuB,CAC7B,GAAIvc,EAAKukB,iBAAiBlS,EAAOxJ,EAASqb,EAAS9gB,GAAW,CACzDpD,EAAKwkB,oBAAsB,KAC3B,OAELJ,GAAc/R,EAAMM,eAAiBN,EAAMK,WAAa,EACxD2R,EAAcxb,EAAQ6I,KAAO7I,EAAQ4b,QACrC,IAAKzkB,EAAKgkB,sBAAsB3R,IAAUgS,EAAcD,EAAY,CAChEvb,EAAQ4b,SAAWL,EACnB,UAIP,GAAIvb,EAAQ6b,gBAAkB7b,EAAQ4b,QAAU5b,EAAQ6I,KAAM,CAC1D7I,EAAQ4b,UACRpS,EAAMsS,cAAgB,UACnB,GAAI9b,EAAQ6b,eAAgB,CAC/B7b,EAAQyb,QACRjS,EAAMsS,cAAgB,MAG1B,GAAItS,EAAMI,cAAgBJ,EAAMvQ,OAASuQ,EAAMvQ,MAAMzB,OAAQ,CACzDgS,EAAMuS,aAAe,GAErB,IAAKV,EACDA,EAAU,GAEdA,EAAQllB,KAAKqT,GAEbrS,EAAKikB,kBAAkB5R,EAAMvQ,MAAOuQ,EAAMuS,aAAc/b,EAASqb,EAAS9gB,GAC1E8gB,EAAQhlB,MAER,GAAImT,EAAMuS,aAAavkB,QAAUwI,EAAQyb,MAAQ,EAC7C9hB,EAAOxD,KAAKqT,QAEZA,EAAMsS,cAAgB,UAEvB,CACHne,EAAU,GACV2d,EAAc9R,EAAMvQ,MAAMzB,OAE1B,IAAK,IAAIuhB,EAAI,EAAGA,EAAIuC,EAAavC,IAAK,CAClC,GAAI/Y,EAAQ4b,QAAU5b,EAAQ6I,KAAM,CAChC7I,EAAQ4b,UACR,SAGJ,GAAI5b,EAAQyb,OAASzb,EAAQ8I,KACzB,MAEJnL,EAAQxH,KAAKqT,EAAMvQ,MAAM8f,IACzB/Y,EAAQyb,QAGZ,GAAI9d,EAAQnG,QAAUwI,EAAQyb,MAAQ,EAAG,CACrCjS,EAAMuS,aAAepe,EACrBhE,EAAOxD,KAAKqT,QAEZA,EAAMsS,cAAgB,WAG3B,CACH,GAAI9b,EAAQ4b,QAAU5b,EAAQ6I,KAAM,CAChC7I,EAAQ4b,UACR,SAEJjiB,EAAOxD,KAAKqT,GACZxJ,EAAQyb,WAKpBO,4BAA6B,SAAUxS,EAAO2P,EAAK8C,GAC/C,IAAI9kB,EAAOC,KACX,IAAIuC,EAAS,EACb,IAAIuiB,EACJ,IAAIC,SAAsBhD,IAAQ,SAClC,IAAI3hB,EAAS2kB,EAAehD,EAAM3P,EAAMM,cACxC,IAAIsS,EAEJ,IAAK5S,EAAMI,aACP,OAAOjQ,EAGX,IAAK,IAAIM,EAAI,EAAGA,EAAIzC,EAAQyC,IAAK,CAC7BiiB,EAAW1S,EAAMvQ,MAAMgB,GAEvB,IAAKiiB,EACD,MAGJ,GAAIA,EAAStS,cAAgBzS,EAAKsa,aAAajI,EAAM3M,KAAM,CACvDuf,EAAOjlB,EAAK6kB,4BAA4BE,EAAU1kB,EAAQ,MAC1DmC,GAAUyiB,EAEV,GAAID,EACA3kB,GAAU4kB,OAEX,IAAKF,EAAStS,cAAgBzS,EAAKsa,aAAayK,EAASrf,KAAM,CAClEuf,EAAOF,EAASjjB,MAAQijB,EAASjjB,MAAMzB,OAAS,EAChDmC,GAAUyiB,EACV,GAAID,EACA3kB,GAAU4kB,EAIlB,GAAIH,EAAqB,CACrBtiB,GAAU,EACV,GAAIwiB,EACA3kB,GAAU,EAIlB,GAAI2kB,GAAgBxiB,EAASnC,EACzB,OAAOmC,EAIf,OAAOA,GAGX+hB,iBAAkB,SAASlS,EAAOxJ,EAASqb,EAAS9gB,GAChD,IAAIpD,EAAOC,KACX,IAAIilB,EACJ,IAAIC,EACJ,IAAIC,EACJ,IAAIC,EAAiBhT,EAAMI,aAAeJ,EAAMM,cAAgBN,EAAMK,UACtE,IAAIf,EAAO9I,EAAQ8I,KACnB,IAAI8S,EAAU5b,EAAQ4b,QACtB,IAAI7K,EAAW5Z,EAAK2R,OACpB,IAAI2T,EAEJ,GAAIzc,EAAQ6b,eACR,GAAID,EAAU5b,EAAQ6I,KAClB+S,GAAW,OAEX9S,GAAQ,EAIhB,IAAKU,EAAMvQ,OAAUuQ,EAAMvQ,QAAUuQ,EAAMvQ,MAAMzB,OAAS,CACtDL,EAAKulB,cAAclT,EAAOxJ,EAASqb,EAAS9gB,EAAU,GACtD,OAAO,SACJ,CACHkiB,EAA6BrlB,KAAK4kB,4BAA4BxS,EAAOxJ,EAAQ6I,KAAO+S,GACpFS,EAAiBnmB,KAAKuU,IAAIzK,EAAQ6I,MAAQ+S,EAAUa,GAA6B,GAEjF,GAAIJ,GAAkBG,EAClB,OAAO,MAGXF,EAAY9S,EAAMvQ,MAAMojB,GACxBE,EAAW/S,EAAMvQ,MAAM/C,KAAKyU,IAAI0R,EAAiBvT,EAAM0T,EAAiB,IAExE,GAAIF,EAAUK,WAAY,CACtBxlB,EAAKulB,cAAclT,EAAOxJ,EAASqb,EAAS9gB,EAAUtE,EAAKwU,IAAIxU,EAAK2mB,MAAMP,EAAiBtL,GAAW,GAAKA,EAAU9a,EAAK4mB,OAAOR,EAAiBtL,GAAYA,IAC9J,OAAO,KAGX,GAAIwL,EAASI,WAAY,CACrBxlB,EAAKulB,cAAclT,EAAOxJ,EAASqb,EAAS9gB,EAAUtE,EAAKwU,IAAIxU,EAAK2mB,OAAOP,EAAiBtL,GAAYA,GAAW,GAAKA,EAAU9a,EAAK4mB,OAAOR,EAAiBtL,GAAYA,IAC3K,OAAO,QAKnB2L,cAAe,SAASlT,EAAOxJ,EAASqb,EAAS9gB,EAAU8hB,EAAgBpL,GACvE,IAAI9Z,EAAOC,KACX,IAAI0R,EACJ,IAAIlO,EACJ,IAAIU,EACJ,IAAIwhB,EAEJ,IAAKtT,EAAMvQ,MACPuQ,EAAMvQ,MAAQ,GAGlB6P,EAAO3R,EAAK2R,OACZlO,EAASxD,KAAK2lB,oBAAoBvT,EAAO6R,GACzC/f,EAAO,CACH2V,KAAMA,GAAQ,EACdF,SAAUjI,EACVD,KAAMwT,EACNvT,KAAMA,EACNlO,OAAQA,EACR2N,UAAWpR,EAAKma,WAChBxX,KAAM3C,EAAK+Z,OAEf4L,EAAY3lB,EAAK6lB,cAAcxT,GAE/B,GAAIsT,GAAaA,EAAUtlB,OAAQ,CAC/B8D,EAAKkO,MAAQsT,EACbxhB,EAAKoO,YAAc,KAGvBuT,aAAa9lB,EAAK+lB,UAClB/lB,EAAK+lB,SAAWC,WAAW,WACvBhmB,EAAKihB,cAAc9c,EAAM,WACrB,IAAKnE,EAAK2B,QAAQvD,EAAc,CACxB2B,KAAM,SAEVC,EAAKwa,UAAUjG,KAAK,CAChBpQ,KAAMA,EACNqQ,QAASxU,EAAKimB,0BAA0B5T,EAAOxJ,EAAQ6I,KAAM1R,EAAK2R,OAAQvO,EAAU8hB,GACpF9P,MAAO,WACH,IAAI+L,EAAO9hB,EAAMe,KAAKmC,WACtBvC,EAAKoV,MAAM3S,MAAMzC,EAAMmhB,WAI/BnhB,EAAKohB,qBAGd,MAGP6E,0BAA2B,SAAS5T,EAAOX,EAAMC,EAAMvO,EAAU8hB,GAC7D,IAAIllB,EAAOC,KACX,IAAIgiB,EAAYjiB,EAAKkiB,aACrB9e,EAAW9F,EAAW8F,GAAYA,EAAW/F,EAC7C,IAAI6oB,EAAalmB,EAAK6I,QAAQ4N,QAAUzW,EAAK6I,QAAQ4N,OAAOxC,MAAQjU,EAAK6I,QAAQ4N,OAAOxC,MAAQ,QAEhG,OAAO,SAAU9P,GACb,IAAI8gB,EACJ,IAAInc,EAAQxH,GAAMvF,OAAOiE,EAAK6I,QAAQ4N,OAAO3N,OAC7C,IAAIqd,EAEJnmB,EAAKohB,kBAELphB,EAAK2B,QAAQrD,EAAY,CACrByhB,SAAU5b,EACVpE,KAAM,SAGV,GAAIzC,EAAW4oB,GACXC,EAAaD,EAAW/hB,QAExBgiB,EAAahiB,EAAK+hB,GAGtB/hB,EAAOnE,EAAKqb,OAAO9S,MAAMpE,GAEzB,GAAIkO,EAAMI,aAAc,CACpBwS,EAAOjlB,EAAKqb,OAAOnI,OAAO/O,GAC1BkO,EAAMM,cAAgBwT,MACnB,CACHlB,EAAOjlB,EAAKqb,OAAOlX,KAAKA,GACxB8gB,EAAOA,EAAK9nB,IAAI,SAAU0F,GACtB,OAAO,IAAIiG,EAAMjG,KAIzBwP,EAAMvQ,MAAMY,gBAAkB,KAC9B,IAAK,IAAII,EAAI,EAAGA,EAAIqjB,EAAYrjB,IAC5B,GAAIA,GAAKoiB,GAAkBpiB,EAAKoiB,EAAiBvT,EAC7CU,EAAMvQ,MAAM3C,OAAO2D,EAAG,EAAGmiB,EAAKniB,EAAIoiB,SAElC,IAAK7S,EAAMvQ,MAAMgB,GACbuP,EAAMvQ,MAAM3C,OAAO2D,EAAG,EAAG,CAAE0iB,WAAY,OAInDnT,EAAMvQ,MAAMY,gBAAkB,MAE9B1C,EAAKomB,yBAAyB/T,GAC9BrS,EAAKwkB,oBAAsB,MAE3B,IAAKnS,EAAMgU,WAAY,CACnBrmB,EAAKuhB,oBAAsB4E,EAC3B9T,EAAMgU,WAAa,KAGvBrmB,EAAKwR,MAAME,EAAMC,EAAMvO,EAAU,eAEjC,GAAI6e,GAAajiB,EAAKsmB,2BAA6BtmB,EAAKumB,wBACpDvmB,EAAK2B,QAAQ3D,EAAQ,MAKjC6nB,cAAe,SAASxT,GACpB,IAAImU,EAAsBvmB,KAAKia,OAAO/c,IAAI,SAAUspB,GAChD,OAAOA,EAAE7kB,QACVO,QAAQkQ,EAAMzQ,OAEjB,OAAO3B,KAAKia,OAAO7a,MAAMmnB,EAAsB,EAAGvmB,KAAKia,OAAO7Z,SAGlEulB,oBAAqB,SAASvT,EAAO6R,GACjC,IAAIzgB,EAASxD,KAAKwD,UAAY,CAC1B6J,MAAO,MACPM,QAAS,IAGbnK,EAAO6J,MAAQ,MACf7J,EAAS7G,EAAO,KAAM,GAAI6G,GAC1BA,EAAOmK,QAAQ5O,KAAK,CAChB4C,MAAOyQ,EAAMzQ,MACbiJ,SAAU,KACV/J,MAAOuR,EAAMvR,QAGjB,GAAIojB,EACA,IAAK,IAAIphB,EAAI,EAAGA,EAAIohB,EAAQ7jB,OAAQyC,IAChCW,EAAOmK,QAAQ5O,KAAK,CAChB4C,MAAOsiB,EAAQphB,GAAGlB,MAClBiJ,SAAU,KACV/J,MAAOojB,EAAQphB,GAAGhC,QAK9B,OAAO2C,GAGX2iB,yBAA0B,SAAS/T,GAC/B,IAAIrS,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,QAClB,IAAImN,EAAepO,EAAOjY,OAC1B,IAAI4kB,EACJ,IAAI0B,EACJ,IAAInV,EACJ,IAAIoV,EACJ,IAAIC,EACJ,IAAIC,EAEJ,IAAK,IAAIhkB,EAAI,EAAGA,EAAI4jB,EAAc5jB,IAAK,CACnC0O,EAAQ8G,EAAOxV,GACf8jB,EAAapV,EAAMrN,KAAK9D,OACxBwmB,EAAU,GACV5B,EAAO,KAEP,IAAK,IAAIrD,EAAI,EAAGA,EAAIgF,EAAYhF,IAAK,CACjC+E,EAAenV,EAAMrN,KAAKyd,GAC1BiF,EAAQ7nB,KAAK4iB,GAEb,GAAK+E,EAAajhB,MAAQ2M,EAAM3M,KAASihB,EAAalU,cAAgBkU,EAAa7kB,MAAMzB,QAAUL,EAAK+mB,kBAAkBJ,EAActU,EAAOwU,GAC3I,MAEJA,EAAQ3nB,MAGZ,GAAI2nB,EAAQxmB,OAAQ,CAChB4kB,EAAO3M,EAAOxV,GAAGkb,aAEjB,MAAO6I,EAAQxmB,OAAS,EAAG,CACvBymB,EAAUD,EAAQ1nB,OAAO,EAAG,GAAG,GAC/B8lB,EAAOA,EAAK6B,GAAShlB,MAEzBmjB,EAAK4B,EAAQ,IAAM7mB,EAAKgnB,YAAY3U,GACpC,SAKZ0U,kBAAmB,SAAS1U,EAAO4U,EAAUJ,GACzC,IAAI7mB,EAAOC,KACX,IAAII,EAASgS,EAAMvQ,MAAMzB,OACzB,IAAI6mB,EAEJ,GAAI7U,EAAMI,cAAgBpS,EACtB,IAAK,IAAIyC,EAAI,EAAGA,EAAIzC,EAAQyC,IAAK,CAC7BokB,EAAkB7U,EAAMvQ,MAAMgB,GAC9B+jB,EAAQ7nB,KAAK8D,GACb,GAAIokB,EAAgBxhB,MAAQuhB,EAASvhB,IACjC,OAAO,UACJ,GAAIwhB,EAAgBzU,cAAgByU,EAAgBplB,MAAMzB,OAC7D,OAAOL,EAAK+mB,kBAAkBG,EAAiBD,EAAUJ,GAE7DA,EAAQ3nB,QAMpB8nB,YAAa,SAAS3U,GAClB,IAAIrS,EAAOC,KACXoS,SAAeA,EAAM1R,QAAU,WAAa0R,EAAM1R,SAAW0R,EAE7D,GAAIA,EAAMvQ,OAASuQ,EAAMvQ,MAAMzB,OAC3BgS,EAAMvQ,MAAQuQ,EAAMvQ,MAAM3E,IAAI,SAAU0F,GACpC,OAAO7C,EAAKgnB,YAAYnkB,KAIhC,OAAOwP,GAGXsR,gBAAiB,SAASwD,EAAaC,GACnC,IAAIpnB,EAAOC,KAEX,IAAKD,EAAK6I,QAAQ+S,gBACd,GAAIuL,IAAgBxqB,EAChBqD,EAAKoa,OAAS+M,OACX,GAAIC,EACPpnB,EAAKoa,OAASpa,EAAKqZ,MAAMhZ,QAKrCgnB,MAAO,SAASjkB,GACZ,IAAIpD,EAAOC,KACX,IAAIE,EAAK,SAAS+gB,GACd,GAAIA,IAAgB,MAAQ5jB,EAAW8F,GACnCA,EAAShD,KAAKJ,IAItB,OAAOC,KAAKqnB,SAASplB,KAAK/B,IAG9BmnB,OAAQ,SAASze,GACb,IAAI7I,EAAOC,KAEX,OAAOD,EAAK6T,MAAMjX,EAAO,GAAI,CACzBkd,KAAM9Z,EAAK8Z,OACXF,SAAU5Z,EAAK4Z,WACfjX,KAAM3C,EAAK2C,OACXc,OAAQzD,EAAKyD,SACb4O,MAAOrS,EAAKqS,QACZjB,UAAWpR,EAAKoR,aACjBvI,KAGP0e,KAAM,SAAS1e,GACX,IAAI7I,EAAOC,KACP6Z,EAAO9Z,EAAK8Z,OACZ7F,EAAQjU,EAAKiU,QAEjBpL,EAAUA,GAAW,GAErB,IAAKiR,GAAS7F,GAAS6F,EAAO,EAAI9Z,EAAKwnB,aACnC,OAGJxnB,EAAK0hB,MAAQ1hB,EAAK6jB,mBAAqB/J,EAAO9Z,EAAK2R,OAEnDmI,GAAQ,EACRjR,EAAQiR,KAAOA,EAEf9Z,EAAKsnB,OAAOze,GAEZ,OAAOiR,GAGX2N,KAAM,SAAS5e,GACX,IAAI7I,EAAOC,KACP6Z,EAAO9Z,EAAK8Z,OAEhBjR,EAAUA,GAAW,GAErB,IAAKiR,GAAQA,IAAS,EAClB,OAGJ9Z,EAAK0hB,MAAQ1hB,EAAK6jB,mBAAqB7jB,EAAK0hB,MAAQ1hB,EAAK2R,OAEzDmI,GAAQ,EACRjR,EAAQiR,KAAOA,EAEf9Z,EAAKsnB,OAAOze,GAEZ,OAAOiR,GAGXA,KAAM,SAASrG,GACX,IAAIzT,EAAOC,KACXyR,EAEA,GAAG+B,IAAQ9W,EAAW,CAClB8W,EAAM3U,EAAKwU,IAAIxU,EAAK0U,IAAI1U,EAAKwU,IAAIG,EAAK,GAAIzT,EAAKwnB,cAAe,GAC9D,IAAI7V,EAAO3R,EAAK2R,OAEhB,GAAI3R,EAAKwc,gBAAiB,CACtB/I,GAAO,EACPzT,EAAKwR,MAAMiC,EAAM9B,EAAMA,EAAM,KAAM,QACnC,OAEJ3R,EAAKsnB,OAAOtnB,EAAK0nB,sBAAsB,CAAE5N,KAAMrG,KAC/C,OAEJ/B,EAAO1R,EAAK0R,OAEZ,OAAOA,IAAS/U,EAAYmC,EAAK4mB,OAAOhU,GAAQ,IAAM1R,EAAK2R,QAAU,IAAM,EAAIhV,GAGnFid,SAAU,SAASnG,GACf,IAAIzT,EAAOC,KAEX,GAAIwT,IAAQ9W,EAAW,CACnBqD,EAAKsnB,OAAOtnB,EAAK0nB,sBAAsB,CAAE9N,SAAUnG,EAAKqG,KAAM,KAC9D,OAGJ,OAAO9Z,EAAK2R,QAGhBhP,KAAM,SAAS8Q,GACX,IAAIzT,EAAOC,KAEX,GAAGwT,IAAQ9W,EAAW,CAClBqD,EAAK2B,QAAQ,QACb3B,EAAKsnB,OAAO,CAAE3kB,KAAM8Q,IACpB,OAGJ,OAAOzT,EAAK+Z,OAGhBtW,OAAQ,SAASgQ,GACb,IAAIzT,EAAOC,KAEX,GAAIwT,IAAQ9W,EACR,OAAOqD,EAAKia,QAGhBja,EAAK2B,QAAQ,SACb3B,EAAKsnB,OAAO,CAAE7jB,OAAQgQ,EAAKqG,KAAM,KAGrCzH,MAAO,SAASoB,GACZ,IAAIzT,EAAOC,KACX,IAAI4I,EAAU,CAAEwJ,MAAOoB,GAEvB,GAAIzT,EAAKqa,aAAc,CAEnB,GAAI5G,IAAO9W,KAAe8W,IAAQA,EAAIpT,QAClCL,EAAKuZ,QAAU,GAEnB1Q,EAAQiR,KAAO,EAGnB,GAAGrG,IAAQ9W,EAAW,CAClBqD,EAAKsnB,OAAOze,GACZ,OAGJ,OAAO7I,EAAKka,QAGhByN,cAAe,SAAUxjB,GACrB,IAAItD,EACA2B,EAAS,GACTnC,EAEJ,IAAKQ,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrD,IAAIwR,EAAQlO,EAAKtD,GACjB,GAAIwR,EAAMI,aACNjQ,EAASA,EAAOQ,OAAO/C,KAAK0nB,cAActV,EAAMvQ,QAGpDU,EAAOxD,KAAKqT,GAGhB,OAAO7P,GAGXyR,MAAO,WACH,OAAOgP,SAAShjB,KAAKma,QAAU,EAAG,KAGtCwN,YAAa,SAAUC,GACnB,IAAI7nB,EAAOC,KAEX,IAAKD,EAAKka,OAAO7Z,OACb,OAAOL,EAAKiU,QAGhB,GAAIjU,EAAKsc,mBAAoB,CACzB,GAAItc,EAAKuhB,mBACL,OAAOvhB,EAAKuhB,mBAEhBvhB,EAAKuhB,mBAAqBvhB,EAAKiU,QAE/B,OAAOjU,EAAKuhB,mBAGhB,OAAOvhB,EAAK8nB,sBAAsB9nB,EAAKuZ,QAAQlZ,OAASL,EAAKuZ,QAAQ,GAAGpV,KAAO,GAAI0jB,IAGvFC,sBAAuB,SAAU5U,EAAQ2U,EAAiBE,EAAYC,GAClE,IAAIhoB,EAAOC,KACX8nB,EAAaA,GAAc,QAC3B,IAAI9T,EACJ,IAAI5T,EAEJ,GAAIL,EAAKka,OAAO7Z,QAAU6S,EAAQ,CAC9Be,EAAQ,EACR5T,EAAS6S,EAAO7S,OAEhB,IAAK,IAAIyC,EAAI,EAAGA,EAAIzC,EAAQyC,IACxBmR,GAASjU,EAAKokB,WAAWlR,EAAOpQ,GAAI+kB,EAAiBE,EAAYC,GAErEhoB,EAAKioB,aAAehU,EACpB,OAAOA,EAGXjU,EAAKioB,aAAejoB,EAAKqZ,MAAMhZ,OAC/B,OAAOL,EAAKioB,cAGhB7D,WAAY,SAAU/R,EAAOwV,EAAiBE,EAAYC,GACtD,IAAIhoB,EAAOC,KACX,IAAIgU,EAAQ,EAEZ,GAAI5B,EAAMI,cAAgBzS,EAAKsa,aAAajI,EAAM3M,KAAM,CACpD,GAAImiB,IAAoBxV,EAAMsS,eAAiBqD,EAC3C/T,GAAS,EAGb5B,EAAM0V,GAAY5kB,QAAQ,SAAU8jB,GAChChT,GAASjU,EAAKokB,WAAW6C,EAAUY,EAAiBE,EAAYC,UAGpE,GAAIhoB,EAAKsa,aAAajI,EAAM3M,KAAM,CAC9B,GAAImiB,IAAoBxV,EAAMsS,eAAiBqD,EAC3C/T,IAEJA,GAAS5B,EAAM0V,GAAc1V,EAAM0V,GAAY1nB,OAAS,OAExD4T,IAGR,OAAOA,GAGXiU,gBAAiB,SAAU1W,GACvB,IAAIyC,EAAQ,EACZ,IAAI5T,EAASmR,EAAMnR,OAEnB,IAAK,IAAIyC,EAAI,EAAGA,EAAIzC,EAAQyC,IACxBmR,GAAShU,KAAKmkB,WAAW5S,EAAM1O,GAAI,MAGvC,OAAOmR,GAGX7C,UAAW,SAASqC,GAChB,IAAIzT,EAAOC,KAEX,GAAGwT,IAAQ9W,EAAW,CAClBqD,EAAKsnB,OAAO,CAAElW,UAAWqC,IACzB,OAGJ,OAAOzT,EAAKma,YAGhBzJ,WAAY,WACR,IAAIlO,EAASvC,KAAKuhB,iBAElB,GAAI1kB,EAAc0F,GACdA,EAASvC,KAAKkoB,iBAAiBloB,KAAKmR,aAGxC,OAAO5O,GAGX2lB,iBAAkB,SAASzX,GACvB,IAAIlO,EAAS,GAEb,IAAK1F,EAAc4T,GAAa,CAC5B,IAAIU,EAAY,GAEhB,IAAKrU,EAAQ2T,GACTA,EAAa,CAACA,GAGlB,IAAK,IAAI7P,EAAM,EAAGA,EAAK6P,EAAWrQ,OAAQQ,IAAO,CAC7CuQ,EAAUV,EAAW7P,GAAKuQ,WAAa,EACvC5O,EAAOkO,EAAW7P,GAAKe,OAASwP,GAIxC,OAAO5O,GAGXklB,sBAAuB,SAAS7e,GAC5B,OAAOA,GAGX0U,kBAAmB,SAASzU,GACxB,IAAIoK,EAASjT,KAAKoS,QACdrR,EACAqR,EACAxR,EACAR,EAEJ,IAAKQ,EAAMqS,EAAO7S,OAAO,EAAGA,EAAS,EAAGQ,GAAOR,EAAQQ,IAAO,CAC1DwR,EAAQa,EAAOrS,GACfG,EAAS,CACLF,MAAOgI,EAAMhD,IAAMgD,EAAMhD,IAAIuM,EAAMzQ,OAASkH,EAAMuJ,EAAMzQ,OACxDA,MAAOyQ,EAAMzQ,MACbE,MAAOd,EAAS,CAACA,GAAU,CAAC8H,GAC5B2J,eAAgBzR,EAChB0P,WAAYzQ,KAAKkoB,iBAAiB9V,EAAM3B,aAIhD,OAAO1P,GAGXwmB,WAAY,WACR,IAAIxnB,EAAOC,KACP2Z,EAAW5Z,EAAK4Z,YAAc5Z,EAAKiU,QACnCA,EAAQjU,EAAKwc,gBAAkBxc,EAAK4nB,YAAY,MAAQ5nB,EAAKiU,QAEjE,OAAOnV,EAAKspB,MAAMnU,GAAS,GAAK2F,IAGpCyO,QAAS,SAAS3W,EAAMC,GACpB,IAAI3R,EAAOC,KACP+hB,EAAMljB,EAAK0U,IAAI9B,EAAOC,EAAM3R,EAAKiU,SAErC,IAAKjU,EAAK6I,QAAQ8S,cAAgB3b,EAAKqZ,MAAMhZ,OAAS,EAClD,OAAO,KAGX,OAAOL,EAAKsoB,WAAW5W,EAAMsQ,GAAK3hB,OAAS,GAG/CkoB,UAAW,WACP,IAAIjQ,EAASrY,KAAKsZ,QAClB,OAAOjB,EAAOA,EAAOjY,OAAS,IAAM,CAAE0hB,MAAO,EAAGC,IAAK,EAAG7d,KAAM,KAGlEqkB,aAAc,WACV,IAAIlQ,EAASrY,KAAKsZ,QAClB,OAAOjB,EAAOjY,QAAUiY,EAAO,GAAGnU,KAAK9D,QAAUiY,EAAO,GAAGnU,KAAK,GAAGuB,KAGvE+iB,yBAA0B,WACtBxoB,KAAKsmB,wBAA0B,OAGnCrE,WAAY,WACR,OAAO,IAAIta,MAAOpC,WAGtBgM,MAAO,SAASE,EAAMC,EAAMvO,EAAUrB,GAClC9B,KAAKqmB,yBAA2BrmB,KAAKiiB,aACrCjiB,KAAKsmB,wBAA0B,KAC/B,IAAItS,EAAQhU,KAAKuc,gBAAkBvc,KAAK2nB,YAAY,MAAQ3nB,KAAKgU,QAEjE,GAAIlS,IAAW,eAAiBA,IAAW,gBACvC9B,KAAKuiB,2BAGT9Q,EAAO5S,EAAK0U,IAAI9B,GAAQ,EAAGuC,GAC3B7Q,EAAW9F,EAAW8F,GAAYA,EAAW/F,EAE7C,IAAI2C,EAAOC,KACPyoB,EAAW5pB,EAAKwU,IAAIxU,EAAK2mB,MAAM/T,EAAOC,GAAO,GAAKA,EAClDgX,EAAO7pB,EAAK0U,IAAIkV,EAAW/W,EAAMsC,GACjC9P,EAEJA,EAAOnE,EAAKsoB,WAAW5W,EAAM5S,EAAK0U,IAAI9B,EAAOC,EAAMsC,GAAQ7Q,GAE3D,IAAKe,EAAK9D,QAAU4T,IAAU,KAAOjU,EAAKwkB,oBAAqB,CAC3DxkB,EAAK4oB,kBAAkBzkB,EAAMuN,EAAMC,EAAM3R,EAAK6oB,mBAAqBH,EAAU1oB,EAAK8oB,eAAiBH,EAAM,CACrG5mB,OAAQA,IAEZ/B,EAAK6oB,kBAAoB,KACzB7oB,EAAK8oB,cAAgB,KACrB1lB,IACA,OAGJ,GAAIpD,EAAKwc,gBAAiB,CACtBxc,EAAK6oB,kBAAoBH,EACzB1oB,EAAK8oB,cAAgBH,EAErBD,EAAW5pB,EAAKwU,IAAIxU,EAAK2mB,MAAMzlB,EAAK+oB,gBAAgBrX,EAAMC,GAAQA,GAAO,GAAKA,EAC9EgX,EAAO7pB,EAAK0U,IAAIkV,EAAW/W,EAAMsC,GAGrC,GAAItC,IAAShV,IAAcqD,EAAKwkB,oBAC5B,GAAKxkB,EAAKwc,kBAAoBxc,EAAKgpB,kBAAkBN,EAAU/W,KAAW3R,EAAKipB,aAAaP,EAAUC,GAClG3oB,EAAKkpB,SAASR,EAAU/W,EAAM,WAC1B,GAAID,EAAOgX,GAAYC,EAAO3oB,EAAKiU,UAAYjU,EAAKipB,aAAaN,EAAM7pB,EAAK0U,IAAImV,EAAOhX,EAAM3R,EAAKiU,UAC9FjU,EAAKkpB,SAASP,EAAMhX,EAAM,WACtB3R,EAAKwR,MAAME,EAAMC,EAAMvO,UAG3BpD,EAAKwR,MAAME,EAAMC,EAAMvO,UAG5B,GAAIslB,EAAWhX,EAClB1R,EAAKkpB,SAASP,EAAMhX,EAAM,WACtB3R,EAAKwR,MAAME,EAAMC,EAAMvO,MAMvCklB,WAAY,SAASvG,EAAOC,EAAK5e,GAC7B,IAAIpD,EAAOC,KACPqY,EAAStY,EAAKuZ,QACd/H,EACArN,EAAO,GACPglB,EACAC,EACAC,EACAC,EACAC,EACAC,EACAC,EACA5gB,EAAU7I,EAAK6I,QACfib,EAASjb,EAAQ6S,eAAiB7S,EAAQ8S,cAAgB9S,EAAQ+S,iBAAmB/S,EAAQ6P,gBAAkB7P,EAAQgT,iBACvH6N,EACAjY,EACApR,EACAspB,EAAkB,CACVhY,KAAMqQ,EAAMD,EACZrQ,KAAMqQ,EACN0C,QAAS,EACTH,MAAO,EACPI,eAAgB,MAExBkF,EACAC,EAAe7pB,EAAKwc,gBACpBsN,EAAaD,EAAe,aAAe,QAC3CE,EAAWF,EAAe,WAAa,MACvCG,EAEJ,IAAKb,EAAU,EAAG9oB,EAASiY,EAAOjY,OAAQ8oB,EAAU9oB,EAAQ8oB,IAAW,CACnE3X,EAAQ8G,EAAO6Q,GAEf,GAAIU,EAAc,CACd,GAAIrY,EAAM2Q,YAAcH,EACpB,MAAO,GAGX,GAAID,EAAQvQ,EAAM4Q,SAAU,CACxBuH,EAAgBlF,SAAWjT,EAAM4Q,UAAYwH,GAAgB,GAC7DA,EAAepY,EAAM4Q,SACrB,SAGJ,UAAWwH,IAAiB,aAAeA,GAAgBpY,EAAM2Q,WAC7DwH,EAAgBlF,SAAWjT,EAAM2Q,WAAayH,EAGlD,GAAID,EAAgBlF,QAAUkF,EAAgBjY,KAC1C,MAAO,GAGX,UAAWkY,IAAiB,aAAe7H,EAAQ,GAAKvQ,EAAMuQ,MAAQ,EAClE4H,EAAgBlF,QAAUjT,EAAM2Q,WAGpCiH,EAAUD,EACV,MAAO,KAAM,CACTlpB,KAAKgkB,kBAAkBzS,EAAMrN,KAAMA,EAAMwlB,EAAiB,KAAMvmB,GAChE4mB,EAAoBhqB,EAAK8nB,sBAAsB3jB,EAAM,KAAM,gBAE3D,GAAI6lB,GAAqBL,EAAgBhY,KACrC,OAAOxN,EAGX,GAAInE,EAAKwkB,oBACL,MAAO,GAEX4E,IAEA,GAAI9Q,EAAO8Q,IAAY9Q,EAAO8Q,GAASjH,aAAe3Q,EAAM4Q,SACxD5Q,EAAQ8G,EAAO8Q,QAEf,YAGL,GAAIrH,GAASvQ,EAAMsY,IAAe/H,GAASvQ,EAAMuY,GAAW,CAC/DtY,EAAQ,EAER,IAAK2X,EAAUD,EAASC,EAAU/oB,EAAQ+oB,IAAW,CACjD5X,EAAQ8G,EAAO8Q,GACfM,EAAW1pB,EAAK2c,UAAUnL,EAAMrN,KAAM,MAEtC,GAAIulB,EAASrpB,QAAU0hB,EAAQtQ,GAASD,EAAMuQ,MAAO,CACjDwH,EAAY/X,EAAMrN,KAClBqlB,EAAWhY,EAAMwQ,IAEjB,IAAK8B,EAAQ,CACT,GAAIjb,EAAQkT,YACR0N,EAAYzpB,EAAKwjB,cAAchS,EAAMrN,KAAM,CAAEV,OAAQzD,EAAKyD,eACvD,CACH,IAAId,EAAOgO,GAA6B3Q,EAAKqS,SAAW,IAAIrP,OAAO4J,GAAc5M,EAAK2C,QAAU,KAChG8mB,EAAYzpB,EAAKwjB,cAAchS,EAAMrN,KAAM,CAAExB,KAAMA,EAAMc,OAAQzD,EAAKyD,WAE1EimB,EAAWH,EAAYE,EAAUtlB,KAEjC,GAAIslB,EAAUxV,QAAUtX,EACpB6sB,EAAWC,EAAUxV,MAI7BoV,EAAa,EACb,GAAItH,EAAQtQ,EAAQD,EAAMuQ,MACtBsH,EAActH,EAAQtQ,EAASD,EAAMuQ,MAEzCuH,EAAWI,EAASrpB,OACpB,GAAImpB,EAAWxH,EACXsH,EAAWA,GAAYE,EAAWxH,GAEtCvQ,GAAS6X,EAAWD,EACpBllB,EAAOnE,EAAKiqB,aAAa9lB,EAAMolB,EAAWF,EAAYC,GAEtD,GAAItH,GAAOxQ,EAAMwQ,KAAOvQ,GAASuQ,EAAMD,EACnC,OAAO5d,GAInB,MAEJylB,EAAepY,EAAM4Q,SAEzB,MAAO,IAGX8H,mBAAoB,SAAUxB,GAC1B,IAAI1oB,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,QAClB,IAAI4Q,EAAW,EACf,IAAIrnB,EAAI,EAER,MAAO,KAAM,CACT,IAAI0O,EAAQ8G,EAAOxV,GACnB,IAAK0O,GAASA,EAAM2Q,WAAauG,EAC7B,MAGJ,GAAIlX,EAAM4Q,UAAY5Q,EAAMwQ,IACxBmI,EAAW3Y,EAAM4Q,SAAW5Q,EAAMwQ,IAEtClf,IAGJ,OAAOqnB,GAGXF,aAAc,SAAS9lB,EAAMqN,EAAOE,EAAMC,GACtC,GAAI1R,KAAKqc,mBAAoB,CACzB,IAAI2I,EAAOzT,EAAM7Q,SACbypB,EAEJ,GAAIjmB,EAAK9D,OACL+pB,EAAYjmB,EAAKA,EAAK9D,OAAS,GAGnCqX,GAAY0S,EAAWnF,EAAMvT,EAAMC,GAEnC,OAAOxN,EAAKnB,OAAOiiB,GAEvB,OAAO9gB,EAAKnB,OAAOwO,EAAMnS,MAAMqS,EAAMC,KAGzCiX,kBAAmB,SAASzkB,EAAMuN,EAAMC,EAAM+W,EAAUC,EAAM0B,GAC1D,IAAIrqB,EAAOC,KAEXD,EAAK6iB,SAAWlmB,EAEhBqD,EAAK0hB,MAAQhQ,EAAO1R,EAAK0R,SAAW1R,EAAKsqB,cAAgBxrB,EAAK0U,IAAImV,GAAO3oB,EAAKwnB,aAAe,GAAKxnB,EAAK2R,QAAU+W,EAEjH1oB,EAAK6jB,mBAAqBnS,EAE1B1R,EAAKqjB,MAAQ1R,EAEb,IAAI4Y,EAASvqB,EAAK6I,QAAQ8S,aAC1B,IAAI6O,EAAUxqB,EAAK6I,QAAQ6S,cAC3B,IAAI+O,EAAYzqB,EAAK6I,QAAQ+S,gBAC7B,IAAIlL,EAAa1Q,EAAK6I,QAAQgT,iBAC9B,IACI7b,EAAK6I,QAAQ8S,aAAe,KAC5B,IAAK3b,EAAKsc,sBAAwBtc,EAAKqS,SAAWrS,EAAKqS,QAAQhS,QAC3DL,EAAK6I,QAAQ6S,cAAgB,KAEjC1b,EAAK6I,QAAQ+S,gBAAkB,KAC/B5b,EAAK6I,QAAQ8S,aAAe,KAC5B3b,EAAK6I,QAAQgT,iBAAmB,KAEhC,GAAI0O,EAAQ,CACRvqB,EAAKub,2BACLvb,EAAKqZ,MAAQlV,EAAOnE,EAAKwb,SAASrX,GAEtCnE,EAAKkd,SAAS/Y,EAAMkmB,GACtB,QACErqB,EAAK6I,QAAQ8S,aAAe4O,EAC5BvqB,EAAK6I,QAAQ6S,cAAgB8O,EAC7BxqB,EAAK6I,QAAQ+S,gBAAkB6O,EAC/BzqB,EAAK6I,QAAQgT,iBAAmBnL,IAIxCgB,KAAM,WACF,IAAI1R,EAAOC,KAEX,GAAID,EAAK0hB,QAAU/kB,EACf,OAAQqD,EAAK6Z,QAAUld,GAAaqD,EAAK6Z,MAAS,IAAM7Z,EAAK2R,QAAU,GAAKhV,EAEhF,OAAOqD,EAAK0hB,OAGhB4B,kBAAmB,WACf,OAAOrjB,KAAK4jB,oBAAsB,GAGtClS,KAAM,WACF,OAAO1R,KAAKojB,OAASpjB,KAAK0Z,WAG9B+Q,wBAAyB,SAAUhZ,EAAMiX,EAAMvlB,EAAUunB,GACrD,IAAI3qB,EAAOC,KACX,IAAIgiB,EAAYjiB,EAAKkiB,aAErB,OAAO,SAAS/d,GACZ,IAAIma,EAAQ,MACR9M,EAAQ,CAAEuQ,MAAOrQ,EAAMsQ,IAAK2G,EAAMxkB,KAAM,GAAI8d,UAAWjiB,EAAKkiB,cAC5DrhB,EACAR,EACA4kB,EAEJjlB,EAAKohB,kBAELphB,EAAK2B,QAAQrD,EAAY,CAAEyhB,SAAU5b,EAAMpE,KAAM,SAEjDoE,EAAOnE,EAAKqb,OAAO9S,MAAMpE,GAEzB8gB,EAAOjlB,EAAK0c,UAAUvY,GAEtB,GAAI8gB,EAAK5kB,OAAQ,CACb,IAAKQ,EAAM,EAAGR,EAASL,EAAKuZ,QAAQlZ,OAAQQ,EAAMR,EAAQQ,IACtD,GAAIb,EAAKuZ,QAAQ1Y,GAAKkhB,QAAUrQ,EAAM,CAClC4M,EAAQ,KACR9M,EAAQxR,EAAKuZ,QAAQ1Y,GAErB,IAAKb,EAAKwc,gBAAiB,CACvBhL,EAAMwM,aAAeiH,EACrBzT,EAAMrN,KAAOnE,EAAKwb,SAASyJ,GAC3BzT,EAAMwQ,IAAMxQ,EAAMuQ,MAAQ/hB,EAAK2c,UAAUnL,EAAMrN,KAAM,MAAM9D,OAC3DL,EAAKqiB,cAGT,MAIR,IAAK/D,EACDte,EAAKid,UAAUjd,EAAKwb,SAASyJ,GAAOvT,GAI5C1R,EAAKoa,OAASpa,EAAKqb,OAAOpH,MAAM9P,GAEhC,GAAIwmB,IAAU1I,GAAajiB,EAAKsmB,2BAA6BtmB,EAAKumB,yBAC9D,GAAInjB,GAAY6hB,EAAK5kB,OACjB+C,SAEApD,EAAK2B,QAAQ3D,EAAQ,MAMrCkrB,SAAU,SAASxX,EAAMC,EAAMvO,GAC3B,IAAIpD,EAAOC,KACP0oB,EAAO7pB,EAAK0U,IAAI9B,EAAOC,EAAM3R,EAAKiU,SAClCpL,EAAU,CACN8I,KAAMA,EACND,KAAMA,EACNoI,KAAMpI,EAAOC,EAAO,EACpBiI,SAAUjI,EACVhP,KAAM3C,EAAK+Z,MACXtW,OAAQzD,EAAKia,QACb5H,MAAOrS,EAAKka,OACZ9I,UAAWpR,EAAKma,YAIxB,GAAKna,EAAKwc,kBAAoBxc,EAAKsc,oBAAsBtc,EAAKgpB,kBAAkBtX,EAAMiX,GAAQ,CAC1F,GAAIvlB,EACAA,IAEJ,OAGJ,GAAKpD,EAAKuc,wBAA0Bvc,EAAKgpB,kBAAkBtX,EAAMiX,KAAW3oB,EAAKipB,aAAavX,EAAMiX,GAAO,CACvG7C,aAAa9lB,EAAK+lB,UAElB/lB,EAAK+lB,SAAWC,WAAW,WACvBhmB,EAAKihB,cAAcpY,EAAS,WACxB,IAAK7I,EAAK2B,QAAQvD,EAAc,CAAE2B,KAAM,SAAW,CAC/C,GAAIC,EAAKsqB,cACLtqB,EAAK2B,QAAQtD,GAEjB2B,EAAKwa,UAAUjG,KAAK,CAChBpQ,KAAMnE,EAAKghB,QAAQnY,GACnB2L,QAASxU,EAAK0qB,wBAAwBhZ,EAAMiX,EAAMvlB,GAClDgS,MAAO,WACH,IAAI+L,EAAO9hB,EAAMe,KAAKmC,WACtBvC,EAAKoV,MAAM3S,MAAMzC,EAAMmhB,WAI/BnhB,EAAKohB,qBAGd,UACA,GAAIhe,EACPA,KAIRwnB,kBAAmB,SAASlZ,EAAMC,EAAMvO,GACpC,IAAIpD,EAAOC,KACP0oB,EAAO7pB,EAAK0U,IAAI9B,EAAOC,EAAM3R,EAAKiU,SAClCpL,EAAU,CACN8I,KAAMA,EACND,KAAMA,EACNoI,KAAMpI,EAAOC,EAAO,EACpBiI,SAAUjI,EACVhP,KAAM3C,EAAK+Z,MACXtW,OAAQzD,EAAKia,QACb5H,MAAOrS,EAAKka,OACZ9I,UAAWpR,EAAKma,YAGxB,IAAKna,EAAKipB,aAAavX,EAAMiX,IACzB,IAAK3oB,EAAK2B,QAAQvD,EAAc,CAAE2B,KAAM,SACpCC,EAAKwa,UAAUjG,KAAK,CAChBpQ,KAAMnE,EAAKghB,QAAQnY,GACnB2L,QAASxU,EAAK0qB,wBAAwBhZ,EAAMiX,EAAMvlB,EAAU,aAGjE,GAAIA,EACPA,KAIR2lB,gBAAiB,SAAUhH,EAAOpQ,GAC9B,IAAI3R,EAAOC,KACX,IAAI4qB,EAAY7qB,EAAK8qB,cAAc/I,GACnC,IAAIvf,EACJ,IAAIyR,EAAQjU,EAAKiU,QACjB,IAAIkW,EAEJ,GAAIU,EAAW,CACXV,EAAWnqB,EAAKkqB,mBAAmBnI,GAEnC,IAAKoI,EACD,OAAOpI,EAEXA,GAASoI,EAEb3nB,EAAS1D,EAAKwU,IAAIxU,EAAK2mB,MAAM1D,EAAQpQ,GAAO,GAAKA,EAEjD,GAAInP,EAASyR,EACT,MAAO,KAAM,CACTzR,GAAUmP,EACV,GAAInP,EAASyR,EACT,MAIZ,OAAOzR,GAGXuoB,cAAe,SAAU/I,GACrB,IAAIhiB,EAAOC,KACPqY,EAAStY,EAAKuZ,QACd1Y,EACAR,EAEJ,IAAKQ,EAAM,EAAGR,EAASiY,EAAOjY,OAAQQ,EAAMR,EAAQQ,IAChD,GAAIyX,EAAOzX,GAAKkhB,OAASC,GAAO1J,EAAOzX,GAAKmhB,KAAOA,EAC/C,OAAO1J,EAAOzX,IAK1BiqB,cAAe,SAAU/I,GACrB,IAAI/hB,EAAOC,KACPqY,EAAStY,EAAKuZ,QACd1Y,EACA2Q,EACAnR,EAASiY,EAAOjY,OAEpB,IAAKQ,EAAMR,EAAS,EAAGQ,GAAO,EAAGA,IAC7B,GAAIyX,EAAOzX,GAAKshB,YAAcJ,EAAO,CACjCvQ,EAAQ8G,EAAOzX,GACf,MAKR,OAAO2Q,GAGXyX,aAAc,SAASlH,EAAOC,GAC1B,IAAIhiB,EAAOC,KACPqY,EAAStY,EAAKuZ,QACd1Y,EACAR,EAEJ,IAAKQ,EAAM,EAAGR,EAASiY,EAAOjY,OAAQQ,EAAMR,EAAQQ,IAChD,GAAIyX,EAAOzX,GAAKkhB,OAASA,GAASzJ,EAAOzX,GAAKmhB,KAAOA,EACjD,OAAO,KAIf,OAAO,OAGXgH,kBAAmB,SAAUjH,EAAOC,GAChC,IAAIhiB,EAAOC,KACPqY,EAAStY,EAAKuZ,QACd1Y,EACAR,EACA2qB,EAAsB,EACtB/W,EAAQjU,EAAK4nB,YAAY,MAE7B,GAAI5F,EAAM/N,IAAUjU,EAAKsc,mBACrB0F,EAAM/N,EAGV,IAAKpT,EAAM,EAAGR,EAASiY,EAAOjY,OAAQQ,EAAMR,EAAQQ,IAAO,CACvD,IAAI2Q,EAAQ8G,EAAOzX,GACnB,GAAI2Q,EAAM2Q,YAAcJ,GAASvQ,EAAM4Q,UAAYL,EAC/CiJ,GAAuBxZ,EAAM4Q,SAAWL,OACrC,GAAIvQ,EAAM2Q,YAAcH,GAAOxQ,EAAM4Q,UAAYJ,EACpDgJ,GAAuBhJ,EAAMxQ,EAAM2Q,WAI3C,OAAO6I,GAAuBhJ,EAAMD,GAGxCpE,qBAAsB,WAClB,IAAI3d,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,QAClB,IAAIwI,EAAQ/hB,EAAKsjB,oBACjB,IAAItB,EAAMD,GAAS/hB,EAAK2R,QAAU,GAClC,IAAI+L,EAAY,GAChB,IAAIlM,EACJ,IAAI3Q,EACJ,IAAIR,EAASiY,EAAOjY,OAEpB,IAAKQ,EAAM,EAAGA,EAAMR,EAAQQ,IAAO,CAC/B2Q,EAAQ8G,EAAOzX,GAEf,GAAK2Q,EAAMuQ,OAASA,GAASvQ,EAAMwQ,KAAOD,GAAWvQ,EAAMuQ,OAASA,GAASvQ,EAAMuQ,OAASC,EACxFtE,EAAU1e,KAAKwS,GAIvB,OAAOkM,GAGXmB,uBAAwB,SAAS/V,GAC7B,IAAI9I,EAAOC,KACX,IAAIuR,EAEJ,IAAK,IAAI3Q,EAAM,EAAGR,EAASJ,KAAKsZ,QAAQlZ,OAAQQ,EAAMR,EAAQQ,IAAO,CACjE2Q,EAAQvR,KAAKsZ,QAAQ1Y,GAErBb,EAAKirB,sBAAsBzZ,EAAO1I,GAGtC9I,EAAKkrB,uBAGTD,sBAAuB,SAASzZ,EAAO1I,GACnC7I,KAAKse,UAAU/M,EAAMrN,KAAM,SAASA,GAChC,IAAKA,EACD,OAEJ,IAAK,IAAItD,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IAAO,CACxC,IAAIgY,EAAW1U,EAAKtD,GAEpB,GAAIgY,EAASnT,KAAOmT,EAASnT,KAAOoD,EAAMpD,IAAK,CAC3C,GAAGvG,OAAOiB,KAAK+D,EAAMtD,EAAK,GAC1B,WAMhB2c,oBAAqB,SAAS9c,EAAOoI,GACjC,IAAI9I,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,SAAW,GAC7B,IAAImN,EAAepO,EAAOjY,OAC1B,IAAImR,EACJ,IAAI1O,EAEJ,IAAKA,EAAI,EAAGA,EAAI4jB,EAAc5jB,IAAK,CAC/B0O,EAAQ8G,EAAOxV,GAEf,GAAI0O,EAAMuQ,OAASrhB,GAAS8Q,EAAMwQ,KAAOthB,EAAO,CAC5C,IAAKV,EAAK8c,UAAUhU,EAAMpD,IAAK8L,EAAMrN,MACjC,GAAInE,EAAKsc,mBACL9K,EAAMrN,KAAKhF,OAAOuB,EAAO,EAAGV,EAAKud,kBAAkBzU,SAEnD0I,EAAMrN,KAAKhF,OAAOuB,EAAO,EAAGoI,GAIpC,OAIR9I,EAAKkrB,uBAGTA,oBAAqB,WACjB,IAAIlrB,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,SAAW,GAC7B,IAAImN,EAAepO,EAAOjY,OAC1B,IAAI8qB,EAAgB,MACpB,IAAIC,EAAiB,EACrB,IAAIC,EAAmB,EACvB,IAAIC,EACJ,IAAI9Z,EACJ,IAAI1O,EAEJ,IAAKA,EAAI,EAAGA,EAAI4jB,EAAc5jB,IAAK,CAC/B0O,EAAQ8G,EAAOxV,GACfwoB,EAActrB,EAAKwc,gBAAkBhL,EAAMrN,KAAK9D,OAASL,EAAK2c,UAAUnL,EAAMrN,KAAM,MAAM9D,OAC1FgrB,EAAmBC,EAAcxsB,EAAKysB,IAAI/Z,EAAMwQ,IAAMxQ,EAAMuQ,OAE5D,IAAKoJ,GAAiBE,IAAqB,EAAG,CAC1CF,EAAgB,KAChBC,EAAiBC,EACjB7Z,EAAMwQ,KAAOoJ,EACb,SAGJ,GAAID,EAAe,CACf3Z,EAAMuQ,OAASqJ,EACf5Z,EAAMwQ,KAAOoJ,KAKzB5I,yBAA0B,WACtB,IAAIxiB,EAAOC,KACX,IAAIqY,EAAStY,EAAKuZ,SAAW,GAC7B,IAAImN,EAAepO,EAAOjY,OAC1B,IAAI+qB,EAAiB,EACrB,IAAI5Z,EACJ,IAAI1O,EACJ,IAAI+nB,EACJ,IAAIS,EAEJ,IAAKxoB,EAAI,EAAGA,EAAI4jB,EAAc5jB,IAAK,CAC/B0O,EAAQ8G,EAAOxV,GACfwoB,EAActrB,EAAKwc,gBAAkBxc,EAAK8nB,sBAAsBtW,EAAMrN,KAAM,KAAM,QAAS,MAAQnE,EAAK2c,UAAUnL,EAAMrN,KAAM,MAAM9D,OAEpI,GAAIwqB,EAAW,CACX,GAAIA,EAAU7I,KAAOxQ,EAAMuQ,MACvBqJ,EAAiB5Z,EAAMuQ,MAAQ8I,EAAU7I,IAE7CxQ,EAAM2Q,WAAa0I,EAAUzI,SAAWgJ,EACxCA,EAAiB,OAEjB5Z,EAAM2Q,WAAa3Q,EAAMuQ,MAG7BvQ,EAAM4Q,SAAW5Q,EAAM2Q,WAAamJ,EACpCT,EAAYrZ,MAKpBiJ,GAAY,GAuFhB,SAAS+Q,GAAY5Z,EAAQtJ,GACzBsJ,EAASrV,EAAEqV,GAAQ,GACnB,IAAI/I,EAAU+I,EAAO/I,QACrB,IAAI4iB,EAAanjB,EAAO,GACxB,IAAIojB,EAAcpjB,EAAO,GAEzB,IAAInE,EAAO,GACX,IAAItD,EAAKR,EACT,IAAIsrB,EACJ,IAAIzW,EACJ,IAAIY,EACJ,IAAIhV,EAEJ,IAAKD,EAAM,EAAGR,EAASwI,EAAQxI,OAAQQ,EAAMR,EAAQQ,IAAO,CACxDiV,EAAS,GACTZ,EAASrM,EAAQhI,GACjB8qB,EAAWzW,EAAO0W,WAElB,GAAID,IAAa/Z,EACb+Z,EAAW,KAGf,GAAIzW,EAAO2W,UAAaF,GAAYA,EAASE,SACzC,SAGJ,GAAIF,EACA7V,EAAO6V,SAAWA,EAASG,MAG/BhW,EAAO2V,EAAW7pB,OAASsT,EAAO6W,KAElCjrB,EAAQoU,EAAO8W,WAAWlrB,MAE1B,GAAIA,GAASA,EAAMmrB,UACfnrB,EAAQoU,EAAOpU,WAEfA,EAAQoU,EAAO6W,KAGnBjW,EAAO4V,EAAY9pB,OAASd,EAE5BqD,EAAKnF,KAAK8W,GAGd,OAAO3R,EAGX,SAAS+nB,GAAWC,EAAO7jB,GACvB,IAAI8jB,EAAQ7vB,EAAE4vB,GAAO,GAAGE,QAAQ,GAChCC,EAAOF,EAAQA,EAAME,KAAO,GAC5BzrB,EACAR,EACAksB,EACAC,EAAalkB,EAAOjI,OACpB8D,EAAO,GACPsoB,EACA3W,EACA4W,EACA5oB,EAEA,IAAKjD,EAAM,EAAGR,EAASisB,EAAKjsB,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDiV,EAAS,GACThS,EAAQ,KACR2oB,EAAQH,EAAKzrB,GAAK4rB,MAElB,IAAKF,EAAa,EAAGA,EAAaC,EAAYD,IAAc,CACxDG,EAAOD,EAAMF,GACb,GAAGG,EAAKC,SAASvlB,gBAAkB,KAAM,CACrCtD,EAAQ,MACRgS,EAAOxN,EAAOikB,GAAY3qB,OAAS8qB,EAAKE,WAGhD,IAAI9oB,EACAK,EAAKnF,KAAK8W,GAIlB,OAAO3R,EAnKXsW,GAAUhR,OAAS,SAASZ,EAAS1E,EAAM0oB,GACvC,IAAIrS,EACAsS,EAAmBjkB,EAAQ2R,UAAYje,EAAEK,OAAO,GAAIiM,EAAQ2R,WAAa,KAE7E,GAAIsS,EAAkB,CAClBA,EAAiBvY,YAAcuY,EAAiBvY,OAAS9W,EAAS,CAAEoX,IAAKiY,EAAiBvY,MAASuY,EAAiBvY,KAEpH,GAAI1L,EAAQ9I,OAAS,OACjB+sB,EAAiBD,WAAaA,EAGlC,GAAIhkB,EAAQ9I,KAAM,CACdtD,EAAM0H,KAAK4oB,WAAatwB,EAAM0H,KAAK4oB,YAAc,GACjDtwB,EAAM0H,KAAK6oB,QAAUvwB,EAAM0H,KAAK6oB,SAAW,GAE3C,IAAKvwB,EAAM0H,KAAK4oB,WAAWlkB,EAAQ9I,MAC/BtD,EAAMwwB,aAAa,sCAAwCpkB,EAAQ9I,KAAO,8FAA+F,aACtK,IAAKlD,EAAcJ,EAAM0H,KAAK4oB,WAAWlkB,EAAQ9I,OACpDya,EAAY,IAAI/d,EAAM0H,KAAK4oB,WAAWlkB,EAAQ9I,MAAMnD,EAAOkwB,EAAkB,CAAE3oB,KAAMA,UAErF2oB,EAAmBlwB,EAAO,KAAM,GAAIH,EAAM0H,KAAK4oB,WAAWlkB,EAAQ9I,MAAO+sB,GAG7EjkB,EAAQ4N,OAAS7Z,EAAO,KAAM,GAAIH,EAAM0H,KAAK6oB,QAAQnkB,EAAQ9I,MAAO8I,EAAQ4N,QAGhF,IAAK+D,EACDA,EAAYld,EAAWwvB,EAAiBvY,MAAQuY,EAAmB,IAAInY,GAAgBmY,QAG3FtS,EAAY,IAAIlG,GAAe,CAAEnQ,KAAM0E,EAAQ1E,MAAQ,KAE3D,OAAOqW,GAGX5T,GAAW6C,OAAS,SAASZ,GACzB,GAAI9L,EAAQ8L,IAAYA,aAAmBjJ,EACxCiJ,EAAU,CAAE1E,KAAM0E,GAGrB,IAAIgkB,EAAahkB,GAAW,GACxB1E,EAAO0oB,EAAW1oB,KAClBmE,EAASukB,EAAWvkB,OACpB6jB,EAAQU,EAAWV,MACnBva,EAASib,EAAWjb,OACpB/Q,EACAR,EACAyI,EAAQ,GACRlH,EAEJ,IAAKuC,GAAQmE,IAAWukB,EAAWrS,UAC/B,GAAI2R,EACAhoB,EAAO+nB,GAAWC,EAAO7jB,QACtB,GAAIsJ,EAAQ,CACfzN,EAAOqnB,GAAY5Z,EAAQtJ,GAE3B,GAAIukB,EAAWxa,QAAU1V,GAAawH,EAAK,IAAMA,EAAK,GAAGwnB,WAAahvB,EAClEkwB,EAAWxa,MAAQ,WAK/B,GAAI5V,EAAM0H,KAAK7C,OAASgH,KAAYukB,EAAWpW,SAAWoW,EAAWpW,OAAO3N,OAAQ,CAChF,IAAKjI,EAAM,EAAGR,EAASiI,EAAOjI,OAAQQ,EAAMR,EAAQQ,IAAO,CACvDe,EAAQ0G,EAAOzH,GACf,GAAIe,EAAM7B,KACN+I,EAAMlH,EAAMA,OAASA,EAI7B,IAAK9E,EAAcgM,GACf+jB,EAAWpW,OAAS7Z,EAAO,KAAMiwB,EAAWpW,OAAQ,CAAE3N,MAAQ,CAAER,OAAQQ,KAIhF+jB,EAAW1oB,KAAOA,EAElByN,EAAS,KACTib,EAAWjb,OAAS,KACpBua,EAAQ,KACRU,EAAWV,MAAQ,KAEnB,OAAOU,aAAsBjmB,GAAaimB,EAAa,IAAIjmB,GAAWimB,IAoF1E,IAAIK,GAAO5rB,GAAMvF,OAAO,CACpBoM,QAAS,KAETtI,KAAM,SAASiB,GACX,IAAId,EAAOC,KACPktB,EAAcntB,EAAKmtB,aAAersB,GAASA,EAAMqsB,YACjDC,EAAgB,QAChBC,EAAkB,GAEtB5wB,EAAM0H,KAAK7C,MAAMnB,GAAGN,KAAKO,KAAKJ,EAAMc,GAEpC,UAAWd,EAAKiD,WAAaxF,EACzB2vB,EAAgBptB,EAAKiD,SAGzBoqB,EAAkB,CACd5W,OAAQ,CACJtS,KAAMipB,EACNtkB,MAAO,CACHqkB,YAAaA,EACblxB,GAAI+D,EAAKmI,QACTG,OAAQtI,EAAKsI,UAKzB,UAAWtI,EAAKiD,WAAaxF,EACzBb,EAAOywB,EAAiBrtB,EAAKiD,UAGjCoqB,EAAgBlpB,KAAOrD,EAEvB,IAAKqsB,EACDA,EAAcE,EAAgB5W,OAAOtS,KAGzC,UAAWgpB,IAAgB1vB,EACvB0vB,EAAc1wB,EAAMmC,OAAOuuB,GAG/B,GAAI7vB,EAAW6vB,GAAc,CACzB,IAAIG,EAAoBH,EAAY/sB,KAAKJ,EAAMA,GAE/C,GAAGstB,GAAqBA,EAAkBjtB,SAAW,EACjDL,EAAKmtB,YAAc,WAEnBntB,EAAKmtB,cAAgBG,EAI7BttB,EAAKutB,iBAAmBF,EAExB,GAAIrtB,EAAKmtB,YACLntB,EAAKwtB,gBAGTxtB,EAAKytB,WAAa3sB,GAASA,EAAM2sB,UAGrCD,cAAe,WACX,IAAIxtB,EAAOC,KACX,IAAIgD,EAAUuX,EAAW5F,EAEzB,KAAM5U,EAAKiD,oBAAoByqB,IAAyB,CACpDzqB,EAAWjD,EAAKiD,SAAW,IAAIyqB,GAAuB1tB,EAAKutB,kBAE3D/S,EAAYvX,EAASuX,UACrB5F,EAAe4F,EAAU5F,aAEzB4F,EAAU5F,aAAe,SAASzQ,EAAMpE,GACpCoE,EAAKnE,EAAKmI,SAAW,MAAQnI,EAAK/D,GAElC,GAAI2Y,EACAzQ,EAAOyQ,EAAaxU,KAAKJ,EAAMmE,EAAMpE,GAGzC,OAAOoE,GAGXlB,EAASjC,OAAS,WACd,OAAOhB,GAGXiD,EAAS1B,KAAKvD,EAAQ,SAASwD,GAC3BA,EAAEK,KAAOL,EAAEK,MAAQ7B,EACnBA,EAAK2B,QAAQ3D,EAAQwD,KAGzByB,EAAS1B,KAAKpD,EAAO,SAASqD,GAC1B,IAAIY,EAAapC,EAAKgB,SAEtB,GAAIoB,EAAY,CACZZ,EAAEK,KAAOL,EAAEK,MAAQ7B,EACnBoC,EAAWT,QAAQxD,EAAOqD,MAIlCyB,EAAS1B,KAAKhD,EAAa,SAAUiD,GACjC,IAAIY,EAAapC,EAAKgB,SAEtB,GAAIoB,EACAA,EAAWT,QAAQpD,EAAaiD,KAIxCxB,EAAK2tB,yBAIbC,OAAQ,SAAS9kB,GACb7I,KAAKutB,gBACLvtB,KAAK4tB,OAAO,MACZ5tB,KAAKgD,SAAS+R,IAAIlM,IAGtBqkB,YAAa,MAEbW,MAAO,WACH,IAAIlC,EAAa3rB,KAAK2rB,aAClBkC,EAAQ,EAEZ,MAAOlC,GAAcA,EAAWA,WAAY,CACxCkC,IACAlC,EAAaA,EAAWA,WAAaA,EAAWA,aAAe,KAGnE,OAAOkC,GAGXH,qBAAsB,WAClB,IAAI7lB,EAAY7H,KAAKstB,iBAAiB9W,OAAOtS,KAE7ClE,KAAK6H,GAAa,SAAW7H,KAAKgD,SAASkB,QAG/C4pB,gBAAiB,WACb9tB,KAAKwtB,QAAU,KAEfxtB,KAAK0tB,wBAGTK,KAAM,WACF,IAAInlB,EAAU,GACd,IAAIgY,EAAS,SACb,IAAI5d,EAAUjB,EAEd,GAAI/B,KAAKktB,YAAa,CAClBltB,KAAKutB,gBAELvqB,EAAWhD,KAAKgD,SAEhB4F,EAAQ5I,KAAKkI,SAAW,MAAQlI,KAAKhE,GAErC,IAAKgE,KAAKwtB,QAAS,CACfxqB,EAASoW,MAAQ1c,EACjBkkB,EAAS,OAGb5d,EAASgrB,IAAIjwB,EAAQiC,KAAK8tB,gBAAgBxsB,KAAKtB,OAE/C,GAAGA,KAAKiuB,aACJrlB,EAAQpF,OAAS,CAAE7B,MAAO,eAAgBiJ,SAAU,KAAM/J,MAAO,MAGrEkB,EAAUiB,EAAS4d,GAAQhY,GAC3B,IAAK5I,KAAKwtB,QACNxtB,KAAK0B,QAAQnD,EAAU,CAACwD,QAASA,EAASH,KAAM5B,YAGpDA,KAAK4tB,OAAO,MAGhB,OAAO7rB,GAAWzF,EAAE4f,WAAWC,UAAUpa,WAG7C4pB,WAAY,WACR,IAAI9rB,EAAQG,KAAKe,SAEjB,OAAOlB,EAAMkB,UAGjB6sB,OAAQ,SAAS/sB,GACb,GAAIA,IAAUnE,EACVsD,KAAKwtB,QAAU3sB,OAEf,OAAOb,KAAKwtB,SAIpB7nB,gBAAiB,SAAShE,GACtB,OAAON,GAAMnB,GAAGyF,gBAAgBxF,KAAKH,KAAM2B,IACnCA,IAAU,YACVA,IAAU,WACVA,IAAU,eACVA,IAAU,sBAI1B,SAASusB,GAAWjyB,GAChB,OAAO,WACH,IAAIiI,EAAOlE,KAAKoZ,MACZ7W,EAASoE,GAAWzG,GAAGjE,GAAMuG,MAAMxC,KAAMZ,EAAMe,KAAKmC,YAExD,GAAItC,KAAKoZ,OAASlV,EACdlE,KAAKmuB,wBAGT,OAAO5rB,GAIf,IAAIkrB,GAAyB9mB,GAAWhK,OAAO,CAC3CiD,KAAM,SAASgJ,GACX,IAAIhH,EAAOqrB,GAAKnxB,OAAO,CACnBkH,SAAU4F,IAGd,GAAGA,EAAQpF,SAAWoF,EAAQ+S,gBAAgB,CAC1C3b,KAAKouB,oBAAsBxlB,EAAQpF,OACnCoF,EAAQpF,OAAS,KAGrBmD,GAAWzG,GAAGN,KAAKO,KAAKH,KAAMrD,EAAO,KAAM,GAAI,CAAE6Z,OAAQ,CAAEC,UAAW7U,EAAMiH,MAAOjH,IAAUgH,IAE7F5I,KAAKmuB,yBAGTA,sBAAuB,WACnB,IAAIpuB,EAAOC,KAEXD,EAAKqZ,MAAM9X,KAAKpD,EAAO,SAASqD,GAC5BxB,EAAK2B,QAAQxD,EAAOqD,KAGxBxB,EAAKqZ,MAAM9X,KAAKhD,EAAa,SAASiD,GAClCxB,EAAK2B,QAAQpD,EAAaiD,MAIlCc,QAAS,WACL,GAAGrC,KAAKoZ,MACJ,OAAOpZ,KAAKoZ,MAAM/W,WAAarC,KAAKquB,mBAExC,OAAO,OAGXA,iBAAkB,WACd,IAAIC,EAAY,MAChBtuB,KAAKoZ,MAAMlW,QAAQ,SAAUtB,GACzB,GAAGA,EAAKsrB,aAAetrB,EAAKoB,SAASX,UACjCisB,EAAY,OAGpB,OAAOA,GAGXha,KAAM,SAASpQ,GACX,IAAI3B,EAASoE,GAAWzG,GAAGoU,KAAKnU,KAAKH,KAAMkE,GAE3C,GAAGlE,KAAKouB,oBACJ,GAAGpuB,KAAKoZ,OAASpZ,KAAKoZ,MAAMhZ,OAAS,EACjCJ,KAAKwD,OAAOxD,KAAKouB,yBAChB,CACDpuB,KAAK4I,QAAQpF,OAASxD,KAAKouB,oBAC3BpuB,KAAKga,QAAUrK,GAAgB3P,KAAK4I,QAAQpF,QAC5CxD,KAAKouB,oBAAsB,KAInC,OAAO7rB,GAGXqB,OAAQ,SAAShC,GACb,IAAI+pB,EAAa/pB,EAAK+pB,aAClBiB,EAAa5sB,KACbuC,EAEJ,GAAIopB,GAAcA,EAAW4B,cACzBX,EAAajB,EAAW3oB,SAG5BT,EAASoE,GAAWzG,GAAG0D,OAAOzD,KAAKysB,EAAYhrB,GAE/C,GAAI+pB,IAAeiB,EAAW1oB,OAAO9D,OACjCurB,EAAWuB,YAAc,MAG7B,OAAO3qB,GAGXgS,QAAS2Z,GAAW,WAEpBhqB,KAAMgqB,GAAW,QAEjB9Q,OAAQ,SAAS3c,EAAOoI,GACpB,IAAI8iB,EAAa3rB,KAAKe,SAEtB,GAAI4qB,GAAcA,EAAW4B,cAAe,CACxC5B,EAAWuB,YAAc,KACzBvB,EAAW4B,gBAGf,OAAO5mB,GAAWzG,GAAGkd,OAAOjd,KAAKH,KAAMS,EAAOoI,IAGlDrF,OAAQ,SAASgQ,GACb,GAAIA,IAAQ9W,EACP,OAAOsD,KAAKga,QAGjB,IAAIha,KAAK4I,QAAQ+S,iBAAmB3b,KAAKuuB,uBAAuB/a,GAC5DA,EAAM,CAAEnG,MAAO,KAAMM,QAAS,CAAC6F,EAAK,CAAC7R,MAAM,eAAgBiJ,SAAU,SAAU/J,MAAO,QAG1Fb,KAAK0B,QAAQ,SACb1B,KAAKqnB,OAAO,CAAE7jB,OAAQgQ,EAAKqG,KAAM,KAGrC0U,uBAAwB,SAASnhB,GAC7B,IAAI6E,EACJ,IAAIC,EACJ,IAAI7J,EACJ,IAAI6B,EACJ,IAAI1G,EACJ,IAAIkH,EAAyB1K,KAAK4I,QAAQ8B,uBAE1C0C,EAAc1C,EAAyBpO,EAAEK,OAAO,GAAIgT,GAAgBvC,GAAc,CAAE1C,uBAAwBA,IAA2BiF,GAAgBvC,GAEvJ,IAAKA,GAAeA,EAAYO,QAAQvN,SAAW,EAAG,CAClDJ,KAAKwuB,0BAA0B,WAAW,OAAO,OACjD,OAAO,MAGXvc,EAAWvF,EAAMQ,WAAWE,GAC5B/E,EAAS4J,EAAS5J,OAClB6B,EAAY+H,EAAS/H,UAErBgI,EAAY1O,EAAS,IAAI2O,SAAS,cAAe,UAAYF,EAAS9E,YAEtE,GAAI9E,EAAOjI,QAAU8J,EAAU9J,OAC3BoD,EAAS,SAASsJ,GACd,OAAOoF,EAAUpF,EAAGzE,EAAQ6B,IAIpClK,KAAKwuB,0BAA0BhrB,GAC/B,OAAO,MAGVgrB,0BAA2B,SAAShrB,GACjC,IAAI+C,EACJ,IAAIrC,EAAOlE,KAAKoZ,MAChB,IAAI7W,EAAS,MAEb,IAAK,IAAI3B,EAAM,EAAGA,EAAMsD,EAAK9D,OAAQQ,IAAO,CACvC2F,EAAUrC,EAAKtD,GAEf,GAAG2F,EAAQ2mB,YAAY,CACnB3mB,EAAQ0nB,aAAe1nB,EAAQvD,SAASwrB,0BAA0BhrB,GACnE,IAAI+C,EAAQ0nB,aACR1nB,EAAQ0nB,aAAezqB,EAAO+C,QAGlCA,EAAQ0nB,aAAezqB,EAAO+C,GAGlC,GAAGA,EAAQ0nB,aACP1rB,EAAS,KAGjB,OAAOA,GAGXksB,MAAO,SAAS7N,EAAQ/f,GACpB,IAAID,EAAKR,EAAQwB,EAAMoB,EACvB,IAAIkB,EAAOlE,KAAKoZ,MAEhB,IAAKlV,EACD,OAGJtC,EAAO+E,GAAWzG,GAAG0gB,GAAQzgB,KAAKH,KAAMa,GAExC,GAAIe,EACA,OAAOA,EAGXsC,EAAOlE,KAAK0c,UAAU1c,KAAKoZ,OAE3B,IAAKxY,EAAM,EAAGR,EAAS8D,EAAK9D,OAAQQ,EAAMR,EAAQQ,IAAO,CACrDoC,EAAWkB,EAAKtD,GAAKoC,SAErB,KAAMA,aAAoByqB,IACtB,SAGJ7rB,EAAOoB,EAAS4d,GAAQ/f,GAExB,GAAIe,EACA,OAAOA,IAKnBiE,IAAK,SAAS7J,GACV,OAAOgE,KAAKyuB,MAAM,MAAOzyB,IAG7B4gB,SAAU,SAASnX,GACf,OAAOzF,KAAKyuB,MAAM,WAAYhpB,MAItC,SAASipB,GAAUC,EAAMtmB,GACrB,IAAIxG,EAAQvF,EAAEqyB,GAAM3rB,WAChBpC,EACAR,EACA8D,EAAO,GACP2R,EACA+Y,EAAYvmB,EAAO,GAAG1G,MACtBktB,EAAWxmB,EAAO,IAAMA,EAAO,GAAG1G,MAClCmtB,EAAsBzmB,EAAO,IAAMA,EAAO,GAAG1G,MAC7CotB,EAAgB1mB,EAAO,IAAMA,EAAO,GAAG1G,MACvCiB,EACA5G,EACAgzB,EACAC,EACAjsB,EAEJ,SAASksB,EAAS/sB,EAAYgtB,GAC1B,OAAOhtB,EAAWqB,OAAO2rB,GAASpa,IAAI5S,EAAWsB,KAAK0rB,IAG1D,IAAKvuB,EAAM,EAAGR,EAASyB,EAAMzB,OAAQQ,EAAMR,EAAQQ,IAAO,CACtDiV,EAAS,CAAE2X,QAAS,MACpB5qB,EAAOf,EAAMuJ,GAAGxK,GAEhBouB,EAAYpsB,EAAK,GAAGwsB,WACpBpsB,EAAWJ,EAAKI,WAChB2rB,EAAO3rB,EAASQ,OAAO,MACvBR,EAAWA,EAASQ,OAAO,YAE3BxH,EAAK4G,EAAKysB,KAAK,WAEf,GAAIrzB,EACA6Z,EAAO7Z,GAAKA,EAGhB,GAAIgzB,EACAnZ,EAAO+Y,GAAaI,EAAUM,UAAY,EAAIN,EAAUO,UAAYvsB,EAAS8oB,OAGjF,GAAI+C,EACAhZ,EAAOgZ,GAAYK,EAASlsB,EAAU,KAAKqsB,KAAK,QAGpD,GAAIN,EACAlZ,EAAOkZ,GAAiBG,EAASlsB,EAAU,OAAOqsB,KAAK,OAG3D,GAAIP,EAAqB,CACrBG,EAAYC,EAASlsB,EAAU,aAAamC,KAAK,aACjD0Q,EAAOiZ,GAAuBG,GAAazyB,EAAMgzB,KAAKP,EAAU5kB,QAAQ,WAAY,KAGxF,GAAIskB,EAAKvuB,OACLyV,EAAOhU,MAAQ6sB,GAAUC,EAAKvjB,GAAG,GAAI/C,GAGzC,GAAIzF,EAAKysB,KAAK,qBAAuB,OACjCxZ,EAAOqX,YAAc,KAGzBhpB,EAAKnF,KAAK8W,GAGd,OAAO3R,EAGXupB,GAAuBjkB,OAAS,SAASZ,GACrCA,EAAUA,GAAWA,EAAQ7J,KAAO,CAAEmF,KAAM0E,GAAYA,EAExD,IAAIgkB,EAAahkB,GAAW,GACxB1E,EAAO0oB,EAAW1oB,KAClBmE,EAASukB,EAAWvkB,OACpBsmB,EAAO/B,EAAW+B,KAEtB,GAAIzqB,GAAQA,EAAKurB,YACb,OAAOvrB,EAAKurB,YAGhB,IAAKvrB,GAAQmE,IAAWukB,EAAWrS,UAC/B,GAAIoU,EACAzqB,EAAOwqB,GAAUC,EAAMtmB,GAI/BukB,EAAW1oB,KAAOA,EAElB,OAAO0oB,aAAsBa,GAAyBb,EAAa,IAAIa,GAAuBb,IAGlG,IAAI8C,GAASlzB,EAAMc,WAAWX,OAAO,CACjCiD,KAAM,SAASgtB,EAAY+C,EAAUC,GACjCpzB,EAAMc,WAAW4C,GAAGN,KAAKO,KAAKH,MAE9BA,KAAK6vB,aAAe,MACpB7vB,KAAK4sB,WAAaA,EAClB5sB,KAAKipB,UAAY2G,EAEjB,IAAIE,EAAS9vB,KAEb4sB,EAAWtrB,KAAK,SAAU,WACtBwuB,EAAOxQ,YAGXsN,EAAWtrB,KAAK,QAAS,WACrBwuB,EAAOC,WAGX/vB,KAAKgwB,sBAELhwB,KAAKiwB,YAAYN,IAGrBM,YAAa,SAASN,GAClB3vB,KAAK2vB,SAAWA,EAChB3vB,KAAKkwB,gBAGT1vB,GAAI,SAASC,GACT,IAAIkZ,EAAW3Z,KAAK2Z,SAChBwW,EAAc,KAElB,GAAI1vB,GAAST,KAAKgU,QAAS,CACvBhU,KAAK0B,QAAQ,aAAc,CAACjB,MAAOA,IACnC,OAAO,KAGX,IAAKT,KAAK2c,UACP,OAAO3c,KAAK4sB,WAAWpU,OAAO/X,GAEjC,GAAIT,KAAK2c,UAAW,CAEhB,GAAIlc,EAAQT,KAAKowB,YAAc3vB,GAAST,KAAKyR,KAAOkI,EAChDwW,EAAcnwB,KAAKuR,MAAMzS,KAAK0mB,MAAM/kB,EAAQkZ,GAAYA,GAI5D,GAAIlZ,IAAUT,KAAKqwB,kBACfrwB,KAAKmZ,YAIT,GAAI1Y,IAAUT,KAAKswB,iBACftwB,KAAKuR,MAAMvR,KAAKuwB,aAAc,WAG7B,GAAI9vB,IAAUT,KAAKwwB,kBACpBxwB,KAAKuR,MAAMvR,KAAKywB,oBAGf,GAAIhwB,IAAUT,KAAK0wB,kBACpB,GAAI1wB,KAAK2wB,SAAW3wB,KAAKyR,KACrBzR,KAAKuR,MAAMvR,KAAK4wB,uBAEhB5wB,KAAKuR,MAAMvR,KAAK6wB,mBAIxB,GAAIV,EACA,OAAOnwB,KAAK4sB,WAAWpsB,GAAGC,EAAQT,KAAKowB,gBACpC,CACHpwB,KAAK0B,QAAQ,aAAc,CAAEjB,MAAOA,IACpC,OAAO,QAKnByB,QAAS,SAASU,GACd,OAAO5C,KAAK4sB,WAAW1oB,OAAOhC,QAAQU,GAAQ5C,KAAKowB,YAGvDpc,MAAO,WACH,OAAOgP,SAAShjB,KAAK4sB,WAAW5Y,QAAS,KAG7CsT,KAAM,WACF,IAAIwI,EAAS9vB,KACT2Z,EAAWmW,EAAOnW,SAClBgX,EAASb,EAAOre,KAAOqe,EAAOH,SAAWhW,EACzC8O,EAAW5pB,EAAKwU,IAAIxU,EAAK2mB,MAAMmL,EAAShX,GAAW,GAAKA,EAE5D3Z,KAAK2wB,OAASA,EACd3wB,KAAK4sB,WAAW3D,SAASR,EAAU9O,EAAU,WACzCmW,EAAOgB,WAAWH,EAAQ,SAIlCpf,MAAO,SAASof,EAAQI,GACpB,GAAI/wB,KAAK2wB,SAAWA,EAChB,OAAO,KAGX,IAAIb,EAAS9vB,KACT2Z,EAAW3Z,KAAK2Z,SAChB8O,EAAW5pB,EAAKwU,IAAIxU,EAAK2mB,MAAMmL,EAAShX,GAAW,GAAKA,EACxDiT,EAAa5sB,KAAK4sB,WAEtB,GAAImE,EACAtI,GAAY9O,EAGhB,GAAIiT,EAAWxE,QAAQuI,EAAQhX,GAAW,CACtC3Z,KAAK2wB,OAASA,EACd3wB,KAAKkwB,eACLlwB,KAAK8wB,WAAWH,GAChB,OAAO,UACJ,GAAI3wB,KAAKipB,SAAU,CACtB2D,EAAW3D,SAASR,EAAU9O,EAAU,WACpCmW,EAAOa,OAASA,EAChBb,EAAOI,eACPJ,EAAOgB,WAAWH,EAAQ,QAE9B,OAAO,MAGX,OAAO,MAGXK,eAAgB,WACZ,IAAIL,EAAS3wB,KAAK2wB,OAClB3wB,KAAK2wB,OAAS,KACd3wB,KAAKuR,MAAMof,IAGflc,QAAS,WACLzU,KAAKiD,UAGTkW,UAAW,WACP,IAAI2W,EAAS9vB,KACT2Z,EAAW3Z,KAAK2Z,SAChBsX,EAAiBjxB,KAAKyR,KAAOkI,EAC7BiT,EAAa5sB,KAAK4sB,WAEtB,IAAKA,EAAWxE,QAAQ6I,EAAgBtX,KAAc3Z,KAAK6vB,cAAgB7vB,KAAKipB,SAAU,CACtFjpB,KAAK6vB,aAAe,KACpB7vB,KAAK0B,QAAQ,cAAe,CAAE+P,KAAMwf,EAAgBvf,KAAMiI,IAE1DiT,EAAW3D,SAASgI,EAAgBtX,EAAU,WAC1CmW,EAAOD,aAAe,MACtBC,EAAOpuB,QAAQ,aAAc,CAAE+P,KAAMwf,EAAgBvf,KAAMiI,QAKvEmX,WAAY,SAASH,EAAQO,GACzB,GAAIlxB,KAAK2wB,SAAWA,EAChB,OAGJ3wB,KAAKowB,WAAaO,EAClB3wB,KAAKmxB,WAAaD,EAClBlxB,KAAK4sB,WAAWrb,MAAMof,EAAQ3wB,KAAK2Z,UACnC3Z,KAAK4sB,WAAWpE,4BAGpBuH,OAAQ,WACJ/vB,KAAKoxB,aAAe,MAGxB9R,QAAS,WACL,IAAIsN,EAAa5sB,KAAK4sB,WAEtB5sB,KAAKI,OAASJ,KAAK2c,UAAYiQ,EAAWtE,YAAYvG,IAAM6K,EAAWpU,OAAOpY,OAE9E,GAAIJ,KAAKoxB,aAAc,CACnBpxB,KAAKgwB,sBACLhwB,KAAKkwB,eACLlwB,KAAKoxB,aAAe,MACpBpxB,KAAK0B,QAAQ,QAAS,CAAEivB,OAAQ3wB,KAAK2wB,SAGzC3wB,KAAK0B,QAAQ,UAEb,GAAI1B,KAAKmxB,WACLnxB,KAAK0B,QAAQ,iBAGV1B,KAAKmxB,YAGhBnB,oBAAqB,WACjB,IAAIpD,EAAa5sB,KAAK4sB,WAEtB5sB,KAAKqxB,cAAgBzE,EAAWrE,eAChCvoB,KAAKowB,WAAapwB,KAAK2wB,OAAS/D,EAAWnb,QAAU,EACrDzR,KAAK2Z,SAAWiT,EAAWjT,WAC3B3Z,KAAK2c,UAAYiQ,EAAWhkB,QAAQ8S,cAGxCwU,aAAc,WACV,IAAIvW,EAAW3Z,KAAK2Z,SAChBgX,EAAS3wB,KAAK2wB,OACdhB,EAAW3vB,KAAK2vB,SAChBle,EAAO3S,KAAKqpB,KAAKwI,EAAShX,GAAYA,EAE1C3Z,KAAKyR,KAAOA,EACZzR,KAAKswB,iBAAmB7e,EAAOkI,EAAW,EAC1C3Z,KAAKwwB,kBAAoB/e,EAAOke,EAAW,EAC3C3vB,KAAKqwB,kBAAoB5e,EAAO3S,KAAK0mB,MAAM7L,EAAW,EAAI,GAC1D3Z,KAAK0wB,kBAAoB1wB,KAAK2wB,OAAS,EAEvC3wB,KAAKuwB,aAAe9e,EAAOkI,EAAWgW,EACtC3vB,KAAKywB,cAAgBhf,EACrBzR,KAAK4wB,iBAAmBD,EAAShB,EACjC3vB,KAAK6wB,kBAAoBpf,EAAOkI,KAIpC2X,GAAc90B,EAAMc,WAAWX,OAAO,CACtCiD,KAAM,SAASgtB,EAAY2E,GACvB,IAAIC,EAAcxxB,KAElBxD,EAAMc,WAAW4C,GAAGN,KAAKO,KAAKqxB,GAE9BxxB,KAAK4sB,WAAaA,EAClB5sB,KAAKuxB,UAAYA,EACjBvxB,KAAKma,OAAS,EAEdna,KAAK8vB,OAAS,IAAIJ,GAAO9C,EAAY2E,EAAY,GAEjDvxB,KAAK8vB,OAAOxuB,KAAK,CACbmwB,WAAc,SAAUlwB,GACpBiwB,EAAY9vB,QAAQ,aAAc,CAAEjB,MAAOc,EAAEd,SAEjDixB,YAAe,SAAUnwB,GACrBiwB,EAAY9vB,QAAQ,cAAe,CAAE+P,KAAMlQ,EAAEkQ,KAAMC,KAAMnQ,EAAEmQ,QAE/DigB,WAAc,SAAUpwB,GACpBiwB,EAAY9vB,QAAQ,aAAc,CAAE+P,KAAMlQ,EAAEkQ,KAAMC,KAAMnQ,EAAEmQ,QAE9DkgB,MAAS,WACLJ,EAAYrX,OAAS,EACrBqX,EAAY9vB,QAAQ,UAExBmwB,OAAU,WACNL,EAAYrX,OAASrb,KAAKqpB,KAAKnoB,KAAKI,OAASoxB,EAAYD,WACzDC,EAAY9vB,QAAQ,SAAU,CAAEsS,MAAOwd,EAAYxd,QAAS2c,OAAQ3wB,KAAK2wB,aAKrFK,eAAgB,WACZhxB,KAAK8vB,OAAOkB,kBAGhBxwB,GAAI,SAASC,GACT,IAAIqvB,EAAS9vB,KAAK8vB,OACdre,EAAOhR,EAAQT,KAAKuxB,UACpB7f,EAAO1R,KAAKuxB,UACZ/Y,EAAO,GACP5V,EAEJ,GAAIktB,EAAOa,OAASlf,EAChBqe,EAAOtvB,GAAGsvB,EAAOa,OAAS,GAG9B,IAAK,IAAI9tB,EAAI,EAAGA,EAAI6O,EAAM7O,IAAK,CAC3BD,EAAOktB,EAAOtvB,GAAGiR,EAAO5O,GAExB,GAAID,IAAS,KACT,MAGJ4V,EAAKzZ,KAAK6D,GAGd,OAAO4V,GAGXxE,MAAO,WACH,OAAOhU,KAAKma,QAGhB1F,QAAS,WACLzU,KAAK8vB,OAAOrb,UACZzU,KAAKiD,YA0BjB,OAtBItG,EAAO,KAAMH,EAAM0H,KAAM,CACrBmX,QAAS,CACLva,KAAMyV,IAEV7J,MAAOA,EACP/F,WAAYA,GACZ8mB,uBAAwBA,GACxBR,KAAMA,GACNvkB,SAAUA,GACVzI,iBAAkBA,EAClBN,gBAAiBA,EACjBsE,oBAAqBA,EACrBoQ,eAAgBA,GAChBK,gBAAiBA,GACjBI,MAAOA,GACPyB,WAAYA,GACZlV,MAAOA,GACPquB,OAAQA,GACR4B,YAAaA,KAId/0B,OAAOC,QAh+Md,CAk+MoB,mBAAVV,QAAwBA,OAAOg2B,IAAMh2B,OAAS,SAASi2B,EAAIC,EAAIC,IAAMA,GAAMD"}