/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

/**
 * Copyright 2014 Telerik AD
 *
 * Licensed under the Apache License, Version 2.0 (the "License");
 * you may not use this file except in compliance with the License.
 * You may obtain a copy of the License at
 *
 *     http://www.apache.org/licenses/LICENSE-2.0
 *
 * Unless required by applicable law or agreed to in writing, software
 * distributed under the License is distributed on an "AS IS" BASIS,
 * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the License for the specific language governing permissions and
 * limitations under the License.
 */

!function(e,define){define(["./kendo.mobile.view.min","./kendo.userevents.min"],e)}(function(){return function(e,t){var n=window.kendo,i=n.mobile,r=n.support.mobileOS,a=n.effects.Transition,o=n.roleSelector,s="x",l=i.ui,u=!(r.ios&&7==r.majorVersion&&!r.appMode),c="beforeShow",d="init",f="show",p="hide",h={enable:e.noop},g=l.View.extend({init:function(t,r){var a,s,l,c,f;if(e(t).parent().prepend(t),i.ui.Widget.fn.init.call(this,t,r),this._layout(),this._scroller(),this._model(),a=this.element.closest(o("pane")).data("kendoMobilePane"))this.pane=a,this.pane.bind("viewShow",function(e){c._viewShow(e)}),this.pane.bind("sameViewRequested",function(){c.hide()}),s=this.userEvents=new n.UserEvents(a.element,{filter:o("view splitview"),allowSelection:!0});else{if(this.currentView=h,l=e(this.options.container),!l)throw Error("The drawer needs a container configuration option set.");s=this.userEvents=new n.UserEvents(l,{allowSelection:!0}),this._attachTransition(l)}c=this,f=function(e){c.visible&&(c.hide(),e.preventDefault())},this.options.swipeToOpen&&u?(s.bind("press",function(){c.transition.cancel()}),s.bind("start",function(e){c._start(e)}),s.bind("move",function(e){c._update(e)}),s.bind("end",function(e){c._end(e)}),s.bind("tap",f)):s.bind("press",f),this.leftPositioned="left"===this.options.position,this.visible=!1,this.element.hide().addClass("km-drawer").addClass(this.leftPositioned?"km-left-drawer":"km-right-drawer"),this.trigger(d)},options:{name:"Drawer",position:"left",views:[],swipeToOpen:!0,title:"",container:null},events:[c,p,d,f],show:function(){this._activate()&&this._show()},hide:function(){this.currentView&&(this.currentView.enable(),g.current=null,this._moveViewTo(0),this.trigger(p,{view:this}))},openFor:function(){this.visible?this.hide():this.show()},destroy:function(){l.View.fn.destroy.call(this),this.userEvents.destroy()},_activate:function(){if(this.visible)return!0;var e,t=!0,n=this.options.views;return this.pane&&n.length&&(e=this.pane.view(),t=this._viewsInclude(e.id.replace("#",""))||this._viewsInclude(e.element.attr("id"))),this.trigger(c,{view:this})||!t?!1:(this._setAsCurrent(),this.element.show(),this.trigger(f,{view:this}),!0)},_viewsInclude:function(e){return this.options.views.indexOf(e)>-1},_show:function(){this.currentView.enable(!1),this.visible=!0;var e=this.element.width();this.leftPositioned||(e=-e),this._moveViewTo(e)},_setAsCurrent:function(){g.last!==this&&(g.last&&g.last.element.hide(),this.element.show()),g.last=this,g.current=this},_moveViewTo:function(e){this.userEvents.cancel(),this.transition.moveTo({location:e,duration:400,ease:a.easeOutExpo})},_viewShow:function(e){return this.currentView&&this.currentView.enable(),this.currentView===e.view?(this.hide(),t):(this.currentView=e.view,this._attachTransition(e.view.element),t)},_attachTransition:function(e){var t=this,i=this.movable,r=i&&i.x;this.transition&&(this.transition.cancel(),this.movable.moveAxis("x",0)),i=this.movable=new n.ui.Movable(e),this.transition=new a({axis:s,movable:this.movable,onEnd:function(){0===i[s]&&(e[0].style.cssText="",t.element.hide(),t.visible=!1)}}),r&&(e.addClass("k-fx-hidden"),n.animationFrame(function(){e.removeClass("k-fx-hidden"),t.movable.moveAxis(s,r),t.hide()}))},_start:function(e){var i,r,a,o,s,l=e.sender;return Math.abs(e.x.velocity)<Math.abs(e.y.velocity)||n.triggeredByInput(e.event)?(l.cancel(),t):(i=this.leftPositioned,r=this.visible,a=i&&r||!i&&!g.current,o=!i&&r||i&&!g.current,s=0>e.x.velocity,(a&&s||o&&!s)&&this._activate()?(l.capture(),t):(l.cancel(),t))},_update:function(e){var t,n=this.movable,i=n.x+e.x.delta;t=this.leftPositioned?Math.min(Math.max(0,i),this.element.width()):Math.max(Math.min(0,i),-this.element.width()),this.movable.moveAxis(s,t),e.event.preventDefault(),e.event.stopPropagation()},_end:function(e){var t,n=e.x.velocity,i=Math.abs(this.movable.x)>this.element.width()/2,r=.8;t=this.leftPositioned?n>-r&&(n>r||i):r>n&&(-r>n||i),t?this._show():this.hide()}});l.plugin(g)}(window.kendo.jQuery),window.kendo},"function"==typeof define&&define.amd?define:function(e,t){t()});